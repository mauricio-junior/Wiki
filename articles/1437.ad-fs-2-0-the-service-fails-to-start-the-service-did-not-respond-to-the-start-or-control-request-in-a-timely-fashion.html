---
layout: default
title: 'AD FS 2.0&#58; The Service Fails to Start&#58; "The service did not respond to the start or control request in a timely fashion." - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<div>
<h2 class="subHeading"><a name="Symptoms"></a>Symptoms</h2>
<div class="section">
<ul>
<li>The <span id="#h2" class="KeywordHighlight">AD FS 2.0</span> Windows service fails to start. This can be observed during Initial Configuration, during a manual restart of the service, or after a system reboot.
</li></ul>
<p>&nbsp;</p>
<ul>
<li>The <strong>System</strong> event log indicates a timeout failure similar to the following:
</li></ul>
<p>Source: Service Control Manager</p>
<p>Event ID: 7000</p>
<p><strong>The <span id="#h3" class="KeywordHighlight">AD FS 2.0</span> Windows Service service failed to start due to the following error:</strong></p>
<p><strong>The service did not respond to the start or control request in a timely fashion.</strong></p>
<p>This is typically experienced on a slow-performing machine.</p>
</div>
</div>
<div>
<h2 class="subHeading"><a name="Cause"></a>Cause</h2>
<div class="section"><br />
<span style="font-size:12pt;font-family:&#39;times new roman&#39;,serif;">Service Control Manager (SCM)&nbsp;is timing out the service start before it is complete. This is usually due to lack of internet connectivity from the AD FS 2.0 Federation Server or AD FS 2.0 Federation
 Server Proxy. At service start, when <strong>generatePublisherEvidence</strong> is enabled for .NET 3.5, the server will attempt to connect to
<strong>crl.microsoft.com</strong> over <strong>TCP port 80</strong>. AD FS 2.0 does not rely on a positive or negative response from generatePublisherEvidence, and the default value can cause Service Control Manager to time out while waiting on the TCP/80
 connection to fail to connect to crl.microsoft.com. </span><br />
<br />
</div>
</div>
<h2 class="subHeading"><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_of_the_NET_Framework_The_common_language_runtime_CLR_tries_to_verify_the_Authenticode_signature_at_load_time_to_create_Publisher_evidence_for_the_assembly_However_by_default_most_applications_do_not_need_Publisher_evidence_Standard_CAS_policy_does_not_rely_on_the_PublisherMembershipCondition_You_should_avoid_the_unnecessary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_false_gt_lt_runtime_gt_lt_configuration_gt_Option_2"></a><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_of_the_NET_Framework_The_common_language_runtime_CLR_tries_to_verify_the_Authenticode_signature_at_load_time_to_create_Publisher_evidence_for_the_assembly_However_by_default_most_applications_do_not_need_Publisher_evidence_Standard_CAS_policy_does_not_rely_on_the_PublisherMembershipCondition_You_should_avoid_the_unnecessary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_false_gt_lt_runtime_gt_lt_configuration_gt_Option_2"></a>&nbsp;</h2>

<h2 class="subHeading"><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_of_the_NET_Framework_The_common_language_runtime_CLR_tries_to_verify_the_Authenticode_signature_at_load_time_to_create_Publisher_evidence_for_the_assembly_However_by_default_most_applications_do_not_need_Publisher_evidence_Standard_CAS_policy_does_not_rely_on_the_PublisherMembershipCondition_You_should_avoid_the_unnecessary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_quot_false_quot_gt_lt_runtime_gt_lt_configuration_gt"></a><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_of_the_NET_Framework_The_common_language_runtime_CLR_tries_to_verify_the_Authenticode_signature_at_load_time_to_create_Publisher_evidence_for_the_assembly_However_by_default_most_applisary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_quot_false_quot_gt_lt_runtime_gt_lt_configuration_gt"></a><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_ofcations_do_not_need_Publisher_evidence_Standard_CAS_policy_does_not_rely_on_the_PublisherMembershipCondition_You_should_avoid_the_unnecessary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_quot_false_quot_gt_lt_runtime_gt_lt_configuration_gt"></a><a name="Resolution_Option_1_Disable_generatePublisherEvidence_for_NET_3_5_Reference_doc_http_msdn_microsoft_com_en-us_library_bb629393_vVS_90_aspx_Remarks_This_element_was_introduced_in_the_NET_Framework_version_3_5_and_applies_only_to_that_version_It_has_no_effect_in_later_versions_of_the_NET_Framework_The_common_language_runtime_CLR_tries_to_verify_the_Authenticode_signature_at_load_time_to_create_Publisher_evidence_for_the_assembly_However_by_default_most_applications_do_not_need_Publisher_evidence_Standard_CAS_policy_does_not_rely_on_the_PublisherMembershipCondition_You_should_avoid_the_unnecessary_startup_cost_associated_with_verifying_the_publisher_signature_unless_your_application_executes_on_a_computer_with_custom_CAS_policy_or_is_intending_to_satisfy_demands_for_PublisherIdentityPermission_in_a_partial-trust_environment_Demands_for_identity_permissions_always_succeed_in_a_full-trust_environment_Place_the_following_in_C_Windows_Microsoft_NET_Framework_v2_0_50727_CONFIG_machine_config_lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_quot_false_quot_gt_lt_runtime_gt_lt_configuration_gt"></a>Resolution<br />
<strong><span style="font-size:18pt;font-family:&#39;times new roman&#39;,serif;"><br />
Option 1:</span></strong>
<p><strong><span style="font-size:12pt;font-family:&#39;times new roman&#39;,serif;">Disable generatePublisherEvidence for .NET 3.5</span></strong></p>
<ul>
<li>Reference doc:<strong> </strong>http://msdn.microsoft.com/en-us/library/bb629393(v=VS.90).aspx<strong></strong>
</li></ul>
<p><span style="font-size:18pt;font-family:&#39;times new roman&#39;,serif;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</strong></span><a title="Collapse"><span class="lwcollapsibleareatitle1" style="font-size:14.5pt;text-decoration:none;"><strong><span style="font-family:&#39;segoe ui&#39;;color:#3f529c;">Remarks</span></strong></span></a></p>
<p style="margin-left:1in;"><strong><span style="font-size:9.5pt;font-family:&#39;segoe ui&#39;,sans-serif;color:black;">This element was introduced in the .NET Framework version 3.5</span></strong><span style="font-size:9.5pt;font-family:&#39;segoe ui&#39;,sans-serif;color:black;">
 and applies only to that version. It has no effect in later versions of the .NET Framework.
</span></p>
<p style="margin-left:1in;"><strong><span style="font-size:9.5pt;font-family:&#39;segoe ui&#39;,sans-serif;color:black;">The common language runtime (CLR) tries to verify the Authenticode signature at load time to create
<a href="http://msdn.microsoft.com/en-us/library/system.security.policy.publisher(v=vs.90).aspx">
<span style="color:#0000ff;">Publisher</span></a> evidence for the assembly.</span></strong><span style="font-size:9.5pt;font-family:&#39;segoe ui&#39;,sans-serif;color:black;"> However, by default, most applications do not need
<a href="http://msdn.microsoft.com/en-us/library/system.security.policy.publisher(v=vs.90).aspx">
<span style="color:#0000ff;">Publisher</span></a> evidence. Standard CAS policy does not rely on the
<a href="http://msdn.microsoft.com/en-us/library/system.security.policy.publishermembershipcondition(v=vs.90).aspx">
<span style="color:#0000ff;">PublisherMembershipCondition</span></a>. <strong>You should avoid the unnecessary startup cost associated with verifying the publisher signature unless your application executes on a computer with custom CAS policy, or is intending
 to satisfy demands for <a href="http://msdn.microsoft.com/en-us/library/system.security.permissions.publisheridentitypermission(v=vs.90).aspx">
<span style="color:#0000ff;">PublisherIdentityPermission</span></a> in a partial-trust environment.
</strong>(Demands for identity permissions always succeed in a full-trust environment.)</span></p>
<ul>
<li>Place the following in C:\Windows\Microsoft.NET\Framework\v2.0.50727\CONFIG\machine.config<strong></strong>
</li></ul>
<blockquote dir="ltr" style="margin-right:0px;">
<blockquote dir="ltr" style="margin-right:0px;">
<p><span style="font-size:10pt;font-family:consolas;color:black;">&lt;configuration&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &lt;runtime&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <strong>
&lt;generatePublisherEvidence enabled=&quot;false&quot;/&gt;</strong></span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &lt;/runtime&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&lt;/configuration&gt;</span></p>
</blockquote>
</blockquote>
</h2>
<strong>
<p>&nbsp;</p>
<h2 class="subHeading">&nbsp;</h2>
<p>&nbsp;</p>
<h2 class="subHeading"><a name="Place_the_following_in_C_Windows_Microsoft_NET_Framework64_v2_0_50727_CONFIG_machine_config"></a><a name="Place_the_following_in_C_Windows_Microsoft_NET_Framework64_v2_0_50727_CONFIG_machine_config"></a><a name="Place_the_following_in_C_Windows_Microsoft_NET_Framework64_v2_0_50727_CONFIG_machine_config"></a>
<ul>
<li>Place the following in C:\Windows\Microsoft.NET\<strong>Framework64</strong>\v2.0.50727\CONFIG\machine.config<strong></strong>
</li></ul>
</h2>
<h2 class="subHeading"><a name="lt_configuration_gt_lt_runtime_gt_lt_generatePublisherEvidence_enabled_quot_false_quot_gt_lt_runtime_gt_lt_configuration_gt"></a>
<blockquote dir="ltr" style="margin-right:0px;">
<blockquote dir="ltr" style="margin-right:0px;">
<p><span style="font-size:10pt;font-family:consolas;color:black;">&lt;configuration&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &lt;runtime&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <strong>
&lt;generatePublisherEvidence enabled=&quot;false&quot;/&gt;</strong></span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&nbsp;&nbsp;&nbsp; &lt;/runtime&gt;</span></p>
<p><span style="font-size:10pt;font-family:consolas;color:black;">&lt;/configuration&gt;</span></p>
</blockquote>
</blockquote>
</h2>
<h2 class="subHeading">
<p>&nbsp;</p>
</h2>
</strong>
<h2 class="subHeading"><a name="Option_2"></a>
<p>&nbsp;</p>
<p><strong><span style="font-size:18pt;font-family:&#39;times new roman&#39;,serif;">Option 2:</span></strong></p>
</h2>

<h2 class="subHeading"></h2>
<div class="section">
<p><strong>Increase the default timeout value&nbsp;observed by SCM:</strong></p>
<ul><li>Start Registry Editor (Regedit.exe). </li><li>To change the value data for the <strong>ServicesPipeTimeout</strong><strong> DWORD</strong> value to 60000 in the
<strong>Control</strong> key, follow these steps:
<ol>
<li>Locate and then click the following registry key:
<div>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet</div>
</li><li>Click the <strong>Control</strong> subkey </li><li>Right-click the <strong>ServicesPipeTimeout</strong><strong> DWORD</strong> value, and then click
<strong>Modify</strong>. </li><li>Click <strong>Decimal</strong>. </li><li>Type <span>60000</span>, and then click <strong>OK</strong>. </li></ol>
</li><li>If the <strong>ServicesPipeTimeout</strong> value is <em>not</em> available, add the new
<strong>DWORD</strong> value, and then set its value data to 60000 in the <strong>
Control</strong> key. To do so, follow these steps:
<ol>
<li>Locate and then click the following registry key:
<div>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet</div>
</li><li>Click the <strong>Control</strong> subkey. </li><li>On the <strong>Edit</strong> menu, point to <strong>New</strong>, and then click
<strong>DWORD Value</strong>. </li><li>Type <span>ServicesPipeTimeout</span>, and then press ENTER. </li><li>Right-click the <strong>ServicesPipeTimeout</strong><strong> DWORD</strong> value, and then click
<strong>Modify</strong>. </li><li>Click <strong>Decimal</strong>. </li><li>Type a value of <span>60000</span>, and then click <strong>OK</strong>.
<br />
<br />
The value is 60000 milliseconds and is equivalent to 60 seconds or to one minute.
</li></ol>
<strong>Note </strong>This change does not take effect until the computer is restarted.
</li></ul></div>
<p>&nbsp;</p>
<div>
<h2 class="subHeading"><a name="More_Information"></a>More Information</h2>
<div class="section"><br />
After you increase the <strong>ServicesPipeTimeout</strong> value in the registry, the service control manager waits for the services to use the whole
<strong>ServicesPipeTimeout</strong> value before the system event log reports that the program did not start.
</div>
</div>
<br />
<h2 class="subHeading"><a name="Option_3"></a>
<p><strong><span style="font-size:18pt;font-family:&#39;times new roman&#39;,serif;">Option 3:</span></strong></p>
</h2>
<h2 class="subHeading"></h2>
<div class="section"><strong>Edit HOSTS file and point crl.microsoft.com to localhost:<br />
</strong>
<ul><li>Run Notepad (as Administrator) </li><li>Add the following Line at the end of the file: </li></ul></div>
127.0.0.1 crl.microsoft.com<br />

</div>
    
    
