---
layout: default
title: 'Configuration in Distributed Applications - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;"></span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;"><span style="font-size:11px;"></span><span style="font-size:13px;"></span>Configuration can prove challenging for distributed applications because they are comprised of multiple services and dependencies.&nbsp;
 Running live services requires maintaining configuration settings across different environments and updating them in production deployments. It is also important to hntent-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div clave the ability to quickly and easily roll back in case of an unintended or unexpected result.</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">During the development of CSF, we addressed this need by building an overlay on top of existing configuration capabilities to ease the friction between the traditional .NET configuration experience
 and the requirements of building a distributed cloud application.</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">The key principles were:</span></p>
<ul style="list-style-type:disc;direction:ltr;">
<li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
<strong>No concrete dependency on a specific configuration provider</strong>.&nbsp; Provide a layer of indirection between the application code and the configuration store (web.config, the role environment settings, etc.). This enables the store to be abstracted
 and changed over time without affecting the source application.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
<strong>Type management and conversion is the responsibility of the configuration framework</strong>.&nbsp; Applications work with strong types (such as doubles and
<strong>DateTime</strong> values); embedding parsing logic everywhere a configuration value is accessed leads to brittle and less maintainable code.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
<strong>Default values are natively supported when doing a configuration lookup</strong>.&nbsp; Missing configuration settings with well-known or broadly applicable default values should be handled in the configuration framework to streamline application code.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:8pt;">
<strong>Humans are an error source – make configuration simple to edit</strong>.&nbsp; Prefer key/value pairs and dictionaries to complicated hierarchical structures.</p>
</li></ul>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Let’s start with a review of the core .NET and Windows Azure configuration sources and APIs.</span></p>
<h2 style="margin:2pt 0in 0pt;"><a name="System_Configuration"></a><span style="font-family:Calibri Light;font-size:18px;">System.Configuration</span></h2>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">The configuration APIs in System.Configuration are the baseline configuration APIs, part of .NET since 1.0.&nbsp; They enable a rich experience, but they are often
<strong>very</strong> difficult to create and edit, especially in the case of working with typed schemas and chaining configuration files.&nbsp; Configuration values are stored in the
<em>app.config</em> or <em>web.config</em> file associated with the application (or application host in the case of web applications).</span><br />
<br />
<br />
<br />
</p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;"><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1346.figure-1_2D00_-appconfig.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1346.figure-1_2D00_-appconfig.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
<br />
Figure 1</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">While the <em>System.Configuration</em> API enables the creation of highly schematized configuration sections, these are difficult to develop and debug.&nbsp; For simplicity, we assume that our baseline
 for configuration are key/value settings and configuration strings (for database connections).</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">There are a number of challenges with directly leveraging the
<em>web.config</em> and <em>app.config</em> files via System.Configuration as part of a Windows Azure cloud application:</span></p>
<ul style="list-style-type:disc;direction:ltr;">
<li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
AppSettings (in System.Configuration) is hard-linked to the web.config and app.config files.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:8pt;">
In a PaaS environment, all of the files deployed as part of the application package are
<strong>immutable</strong>.&nbsp; This means that you are unable to update configuration settings without redeploying the entire application – not a practicable or desirable result.</p>
</li></ul>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">For these reasons, app.config and web.config are best used for immutable settings (those that are tied to an application version and only changed during a build update).</span></p>
<h2 style="margin:2pt 0in 0pt;"><a name="Windows_Azure_Role_Environment"></a><span style="font-family:Calibri Light;font-size:18px;">Windows Azure Role Environment</span></h2>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">The Windows Azure PaaS API layer (RoleEnvironment) provides a way to describe configuration across a cloud service.&nbsp; This should be the primary method of describing configuration settings that
 support modifications in production deployments. This data can be modified either in Visual Studio:</span></p>
<p style="margin:0in 0in 8pt;"><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.figure-2-_2D00_-visual-studio.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.figure-2-_2D00_-visual-studio.jpg" style="border-width:0px;border-style:solid;" /></a><span><ins datetime="2013-10-17T15:27"></ins></span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Figure 2</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Or by editing both the ServiceDefinition.csdef (lists the “configured” keys) and the ServiceConfiguration.[Environment].cscfg (contains the values for each deployment or environment).</span></p>
<h2 style="margin:2pt 0in 0pt;"><a name="Managing_Type_Conversions"></a><span style="font-family:Calibri Light;font-size:18px;">Managing Type Conversions</span></h2>
<p style="margin:0in 0in 8pt;">tp://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.figure-2-_2D00_-visual-studio.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.figure-2-_2D00_-visual-studio.jpg" style="border-width:0px;border-style:solid;" /></a><span><ins datetime="2013-10-17T15:27"></ins></span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Figure 2</span></p>
<p st<span style="font-family:Calibri;">Both of the configuration APIs mentioned provide a
<strong>string Get(string key)</strong> method.&nbsp; To streamline parsing these string values into typed objects, we created a set of wrapper APIs for converting values.</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">A baseline implementation could leverage Convert.ChangeType, but this doesn’t handle several common types like TimeSpan, Guid, DateTimeOffset and enums.&nbsp; Instead, we handle type conversions with
 the following ConvertValue&lt;T&gt; method:</span></p>
<p style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;summary&gt;</span></p>
<p style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;Attempt&nbsp;to&nbsp;coerce&nbsp;a&nbsp;value&nbsp;to&nbsp;the&nbsp;appropriate&nbsp;type&nbsp;and&nbsp;log&nbsp;the&nbsp;error&nbsp;as&nbsp;appropriate</span></p>
<p style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;/summary&gt;</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p style="background:white;"><span style="color:blue;font-family:Consolas;font-size:7.5pt;">public</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">static</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;T&nbsp;ConvertValue&lt;T&gt;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">string</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;key,&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">object</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;obj)</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">try</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T&nbsp;val&nbsp;=&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">default</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T);</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T)&nbsp;==&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">string</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">))</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)obj;</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">else</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T)&nbsp;==&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(TimeSpan))</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">object</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">)TimeSpan.Parse(obj.ToString());</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">else</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T)&nbsp;==&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(Guid))</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">object</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">)Guid.Parse(obj.ToString());</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">else</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T)&nbsp;==&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(DateTimeOffset))</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">object</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">)DateTimeOffset.Parse(obj.ToString(),&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">null</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">,&nbsp;</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Globalization.</span><span style="font-family:Consolas;font-size:7.5pt;">DateTimeStyles</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.AssumeUniversal);</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">else</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T).IsEnum)</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)</span><span style="font-family:Consolas;font-size:7.5pt;">Enum</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.Parse(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T),&nbsp;obj.ToString());</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">else</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;(T)</span><span style="font-family:Consolas;font-size:7.5pt;">Convert</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.ChangeType(obj,&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T));</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">return</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;val;</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">catch</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="font-family:Consolas;font-size:7.5pt;">Exception</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;ex0)</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.</span><span style="font-family:Consolas;font-size:7.5pt;">Trace</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.WriteLine(</span><span style="font-family:Consolas;font-size:7.5pt;">String</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.Format(</span><span style="font-family:Consolas;font-size:7.5pt;">&quot;Could&nbsp;not&nbsp;convert&nbsp;key&nbsp;{0}&nbsp;for&nbsp;value&nbsp;{1}&nbsp;to&nbsp;type&nbsp;{2}:&nbsp;{3}&quot;</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">,</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key,&nbsp;obj,&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">typeof</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T).Name,&nbsp;ex0.ToString()));</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">throw</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">;</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p>
<p style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">}</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">This method checks the desired type, works through the available parsers, and applies the appropriate transform.</span></p>
<h2 style="margin:2pt 0in 0pt;"><a name="Configuration_Overlay"></a><span style="font-family:Calibri Light;font-size:18px;">Configuration Overlay</span></h2>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Now that we can uplevel raw string configuration, let’s look at providing an API for using both RoleEnvironment and web.config/app.config settings in our applications.&nbsp; The following screenshot
 shows the members of a helper class, ConfigurationHelper.</span></p>
<p style="margin:0in 0in 8pt;"><span><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8510.figure-3.png"><img width="549" height="727" alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8510.figure-3.png" style="border-width:0px;border-style:solid;width:297px;height:449px;" /></a></span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Figure 3</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">In the ConfigurationHelper class, we have three methods for retrieving data:</span></p>
<ul style="list-style-type:disc;direction:ltr;">
<li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
GetAppConfigValue: gets the configuration value from System.Configuration.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
GetAzureConfigValue: gets the configuration value from RoleEnvironment.</p>
</li><li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-wei
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Figure 3</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">In the ConfigurationHelper class, we have three methods for retrieving data:</span></p>
<ul style="list-style-type:disc;direction:ltr;">
<li style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:0pt;">
GetAppConfigValue: gets the configuration value from System.Configuration.</p>
</li><li style="font-family:Calght:normal;">
<p style="font-family:Calibri,sans-serif;font-size:11pt;font-style:normal;font-weight:normal;margin-top:0in;margin-bottom:8pt;">
GetConfigValue: tries to get the configuration value from Windows Azure, otherwise get it from System.Configuration.</p>
</li></ul>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Each of them has an override for a TryGet method, and an optional default parameter (i.e. if no valid configuration setting found, return the default).&nbsp; The implementation of each of these is straightforward.
 For example, the following code shows the implementation of the TryGetAzureConfigValue method:</span></p>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;summary&gt;</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;If&nbsp;the&nbsp;Azure&nbsp;role&nbsp;environment&nbsp;is&nbsp;available,&nbsp;attempt&nbsp;to&nbsp;get&nbsp;the&nbsp;configuration</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;value&nbsp;from&nbsp;the&nbsp;role&nbsp;configuration&nbsp;as&nbsp;the&nbsp;given&nbsp;type</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;/summary&gt;</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;typeparam&nbsp;name=&quot;T&quot;&gt;&lt;/typeparam&gt;</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;param&nbsp;name=&quot;key&quot;&gt;&lt;/param&gt;</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;param&nbsp;name=&quot;val&quot;&gt;&lt;/param&gt;</span></pre>
<pre style="background:white;"><span style="color:gray;font-family:Consolas;font-size:7.5pt;">///</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:gray;font-family:Consolas;font-size:7.5pt;">&lt;returns&gt;&lt;/returns&gt;</span></pre>
<pre style="background:white;"><span style="color:blue;font-family:Consolas;font-size:7.5pt;">public</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">static</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">bool</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;TryGetAzureConfigValue&lt;T&gt;(</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">string</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;key,&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">out</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;T&nbsp;val)</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">{</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">default</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">(T);</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">try</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">if</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(!</span><span style="font-family:Consolas;font-size:7.5pt;">RoleEnvironment</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.IsAvailable)</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">return</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">false</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">;</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">object</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;strValue&nbsp;=&nbsp;</span><span style="font-family:Consolas;font-size:7.5pt;">RoleEnvironment</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.GetConfigurationSettingValue(key);</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val&nbsp;=&nbsp;ConvertValue&lt;T&gt;(key,&nbsp;strValue);</span></pre>
<pre style="background:white;"> </pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">return</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">true</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">;</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">catch</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="font-family:Consolas;font-size:7.5pt;">RoleEnvironmentException</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">)</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">//&nbsp;When&nbsp;the&nbsp;trace&nbsp;destination&nbsp;is&nbsp;being&nbsp;looked&nbsp;up&nbsp;from&nbsp;configuration&nbsp;settings&nbsp;for&nbsp;the</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">//&nbsp;azure&nbsp;trace&nbsp;listener&nbsp;_trace&nbsp;may&nbsp;yet&nbsp;be&nbsp;invalid</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.</span><span style="font-family:Consolas;font-size:7.5pt;">Trace</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.WriteLine(</span><span style="font-family:Consolas;font-size:7.5pt;">String</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.Format(</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:Consolas;font-size:7.5pt;">&quot;The&nbsp;requested&nbsp;key&nbsp;{0}&nbsp;does&nbsp;not&nbsp;exist&nbsp;in&nbs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:green;font-family:Consolas;font-size:7.5pt;">//&nbsp;azure&nbsp;trace&nbsp;listener&nbsp;_trace&nbsp;may&nbsp;yet&nbsp;be&nbsp;invalid</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.Diagnostics.</span><span style="font-family:Consolas;font-size:7.5pt;">Trace</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.WriteLine(</span><span style="font-family:Consolas;font-size:7.5pt;">String</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">.Format(</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family:Consolas;font-size:7.5pt;">&quot;The&nbsp;requested&nbsp;key&nbsp;{0}&nbsp;does&nbsp;not&nbsp;exp;Azure&nbsp;role&nbsp;configuration&quot;</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">,&nbsp;key));</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">return</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">false</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">;</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">catch</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;(</span><span style="font-family:Consolas;font-size:7.5pt;">Exception</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">)</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">return</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;</span><span style="color:blue;font-family:Consolas;font-size:7.5pt;">false</span><span style="color:black;font-family:Consolas;font-size:7.5pt;">;</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></pre>
<pre style="background:white;"><span style="color:black;font-family:Consolas;font-size:7.5pt;">}</span></pre>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">&nbsp;</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">With this approach, applications have a streamlined way of looking up configuration values:</span></p>
<p style="margin:0in 0in 8pt;"><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3513.figure-4.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3513.figure-4.jpg" style="border-width:0px;border-style:solid;" /></a></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">Figure 4</span></p>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">&nbsp;</span></p>
<h2 style="margin:2pt 0in 0pt;"><a name="Conclusion"></a><span style="font-family:Calibri Light;font-size:18px;">Conclusion</span></h2>
<p style="margin:0in 0in 8pt;"><span style="font-family:Calibri;">When building out configuration management in your cloud applications, ensure that you leverage an appropriate abstraction layer to save yourself pain and complexity as your application goes live
 and evolves.&nbsp; The configuration wrappers in CSF provide a solid baseline for this type of abstraction layer that can be used to create more manageable Windows Azure applications.</span></p>

</div>
    
    
