---
layout: default
title: 'Hands-On-Lab&#58; Introduction to Workflow Services using .NET Framework 4 - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup"><p>


</p>


<div class="WordSection1">
<div><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5164.Net_2D00_WWclass="content-fragment-bottom fiji-content-fragment-bottom"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">Hands-On-Lab: Introduction to Workflow Services using .NET Framework 4</h1>
    

    <div class="post-content user-defined-markup"><p>


</p>


<div class=F_5F00_rgb.png" style="border-width:0px;border-style:solid;" /></div>
<div>&nbsp;</div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<div><span style="background:none repeat scroll 0% 0% yellow;"></span></div>
<p class="HOLTitle1"><span style="font-family:arial black,avant garde;font-size:xx-large;">Hands-On Labs</span></p>
<div style="border-width:3pt medium medium;border-style:solid none none;border-color:windowtext -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;"><span style="font-size:10pt;">&nbsp;</span></div>
<div><span style="font-size:10pt;"><em><span style="color:#0000ff;"><span style="color:#3366ff;">&nbsp;</span><span style="font-size:medium;"><span style="color:#3366ff;">I</span><span style="color:#3366ff;font-family:times new roman,times;"><span style="color:#3366ff;">ntroduction to Workflow</span> Services using .NET Framework 4</span></span></span></em></span></div>
<div><span style="color:#000000;font-family:times new roman,times;font-size:medium;"></span></div>
<div><span style="font-size:10pt;">&nbsp;</span></div>
<div><span style="font-size:10pt;">&nbsp;</span></div>
<div><span style="font-size:10pt;"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6403.Developer_5F00_platform_5F00_evangelism.png" style="border-width:0px;border-style:solid;" />&nbsp;</span></div>
<div>&nbsp;</div>
<strong><span style="font-size:10pt;"><br clear="all" />
</span></strong>
<p class="MsoToc1">Contents</p>
<p class="MsoToc1"><a href="#_Toc256177104">Overview<span style="display:none;text-decoration:none;color:windowtext;">.. </span></a></p>
<p class="MsoToc1"><a href="#_Toc256177105">Setup</a></p>
<p class="MsoToc3"><a href="#_Toc256177106">Task 1 &ndash; Installing the Web Platform, Visual Studio and <span>Windows Server AppFabric</span></a></p>
<p class="MsoToc3"><a href="#_Toc256177107">Task 2 &ndash; Creating the Databases</a></p>
<p class="MsoToc3"><a href="#_Toc256177108">Task 3 &ndash; Installing and Configuring Windows Server AppFabric</a></p>
<p class="MsoToc1"><a href="#_Toc256177109">Exercise 1: Submit Application Service</a></p>
<p class="MsoToc3"><a href="#_Toc256177110">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177111">Task 1 &ndash; Adding a new a Workflow Service</a><span style="display:none;text-decoration:none;color:windowtext;"> </span></p>
<p class="MsoToc3"><a href="#_Toc256177112">Task 2 &ndash; Exploring the Workflow Service</a></p>
<p class="MsoToc3"><a href="#_Toc256177113">Task 3 &ndash; Creating Service Implementation Outline</a></p>
<p class="MsoToc3"><a href="#_Toc256177114">Task 4 &ndash; Adding Custom Activities</a></p>
<p class="MsoToc3"><a href="#_Toc256177115">Task 5 &ndash; Receiving a Job Application</a></p>
<p class="MsoToc3"><a href="#_Toc256177116">Task 6 &ndash; Saving the Job Application</a></p>
<p class="MsoToc3"><a href="#_Toc256177117">Task 7 &ndash; Configuring the Response</a></p>
<p class="MsoToc3"><a href="#_Toc256177118">Task 8 &ndash; Adding the Client Application</a></p>
<p class="MsoToc2"><a href="#_Toc256177119">Exercise 1: Verification</a></p>
<p class="MsoToc1"><a href="#_Toc256177120">Exercise 2: Email Notification</a></p>
<p class="MsoToc3"><a href="#_Toc256177121">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177122">Task 1 &ndash; Modifying the Workflow Service</a></p>
<p class="MsoToc2"><a href="#_Toc256177123">Exercise 2: Verification</a></p>
<p class="MsoToc1"><a href="#_Toc256177124">Exercise 3: Applicant Screening</a></p>
<p class="MsoToc3"><a href="#_Toc256177125">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177126">Task 1 &ndash; Adding the Education Screening Activity</a></p>
<p class="MsoToc3"><a href="#_Toc256177127">Task 2 - Calling the ScreenEducation Activity</a></p>
<p class="MsoToc3"><a href="#_Toc256177128">Task 3 &ndash; Conditionally Notifying a Human Reviewer</a></p>
<p class="MsoToc3"><a href="#_Toc256177129">Task 4 &ndash; Sending Human Screening Results</a></p>
<p class="MsoToc2"><a href="#_Toc256177130">Exercise 3: Verification</a></p>
<p class="MsoToc1"><a href="#_Toc256177131">Exercise 4: Deploy the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177132">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177133">Task 1 &ndash; Creating Configuration Transformations</a></p>
<p class="MsoToc3"><a href="#_Toc256177134">Task 2 &ndash; Creating the Deployment Package</a></p>
<p class="MsoToc3"><a href="#_Toc256177135">Task 3 &ndash; Deploying the Package</a></p>
<p class="MsoToc3"><a href="#_Toc256177136">Task 4 &ndash; Enabling the net.pipe Protocol on the Application</a></p>
<p class="MsoToc3"><a href="#_Toc256177137">Task 5 &ndash; Changing the Application Configuration</a></p>
<p class="MsoToc2"><a href="#_Toc256177138">Exercise 4: Verification<span style="display:none;text-decoration:none;color:windowtext;">&nbsp;</span></a></p>
<p class="MsoToc1"><a href="#_Toc256177139">Exercise 5: Troubleshooting</a></p>
<p class="MsoToc3"><a href="#_Toc256177140">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177141">Task 1 &ndash; Simulating an Error Condition</a></p>
<p class="MsoToc3"><a href="#_Toc256177142">Task 2 &ndash; Correcting the Error and Resuming the Workflow</a></p>
<p class="MsoToc1"><a href="#_Toc256177143">Summary</a></p>
<p class="ppBodyText"><br clear="all" />
&nbsp;</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;boTask 3 &ndash; Deploying the Package</a></p>
<p class="MsoToc3"><a href="#_Toc256177136">Task 4 &ndash; Enabling the net.pipe Protocol on the Application</a></p>
<p class="MsoToc3"><a href="#_Toc256177137">Task 5 &ndash; Changing the Application Configuration</a></p>
<p class="MsoToc2"><a href="#_Toc256177138">Exercise 4: Verification<span style="display:none;text-decoration:none;color:windowtext;">&nbsp;</span></a></p>
<p class="MsoToc1"><a href="#_Toc256177139">Exercise 5: Troubleshooting</a></p>
<p class="MsoToc3"><a href="#_Toc256177140">Task 0 &ndash; Opening the Solution</a></p>
<p class="MsoToc3"><a href="#_Toc256177141">Task 1 &ndash; Simulating an Error Condition</a></p>
<p class="MsoToc3"><a href="#_Toc256177142">Task 2 &ndash; Correcting the Error and Resuming the Workflow</a></p>
<p class="MsoToc1"><a href="#_Toc256177143">Summary</a></p>
<p class="ppBodyText"><br clerder-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177104"></a><a name="_Toc244310965"></a><span style="font-size:xx-large;">O<span style="font-size:x-large;">v</span><span style="font-size:x-large;"><span style="font-size:x-large;">e</span>rview</span></span></p>
</div>
<p class="ppBodyText">Windows Workflow Foundation (WF4) in .NET 4 introduces a new way to create web services that combines the power of Windows Communication Foundation (WCF), and the flexibility of WF4. In this lab, you will learn how to use the WF4 messaging activities to implement an HR business workflow scenario. &nbsp;&nbsp;You will also experience the improved hosting, deployment, tracking and troubleshooting capabilities of the new Windows Server AppFabric.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote"><strong></strong><strong>&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x25/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2260.26df7e7c_2D00_d461_2D00_4c86_2D00_bc11_2D00_869f966def71.png" style="border-width:0px;border-style:solid;" /> Do I have to do all the exercises?</strong></p>
<p class="ppNote">This lab is long. To do all of it will probably take close to 2 hours.&nbsp; The lab is designed so that each exercise can be done independently.&nbsp; Just open the solution found under the Begin folder for the exercise.&nbsp; For example, if you wanted to learn how Windows Server AppFabric make it easier to deploy an application you would start with Exercise 5 and open the solution from the <strong>\Source\Ex5 \Begin (choosing the folder that matches the language of your preference) </strong>folder</p>
</div>
<p class="ppBodyText"><span style="background:none repeat scroll 0% 0% yellow;">&nbsp;</span></p>
<p class="ppBodyText">Contoso has a business process for filling the open job requisitions in the company. The process will be divided in three tiers: a smart client application, a web site, a middle-tier workflow service, and a data layer. </p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The applicant submits an application to a workflow service using a Windows Forms client app</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The workflow service screens the applicant&rsquo;s education background by calling an Education service</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If the education screening passes, a human reviewer will receive an email with a link to the website to review the application</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The web site will call the workflow service to pass the result of the human review</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The applicant is notified by an email and a callback to the client application</p>
<p class="ppFigure">&nbsp;</p>
<p class="ppFigureNumber"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7801.238fe083_2D00_5c53_2D00_475d_2D00_83d3_2D00_ccf797bd21d4.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumber"><strong>Figure 1</strong></p>
<p class="ppFigureCaption">Services Diagram for the lab solution</p>
<p class="ppBodyText">&nbsp;</p>
<h1><a name="Objectives"></a>Objectives</h1>
<p class="ppBodyText">In this Hands-On Lab, you will learn how to:</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Use Messaging activities to send data in and out of workflows</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Configure the &nbsp;Messaging activities for a specific scenario</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Invoke Add Service Reference to create activities that consume another service</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Utilize Activity Templates to create pre-configured request-reply patterns</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Set up Content Based Correlation to correlate messages from the same client</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd"><span style="background:none repeat scroll 0% 0% yellow;">&nbsp;</span></p>
</div>
<h1><a name="System_Requirements"></a><a name="_Setup"></a>System Requirements</h1>
<p class="ppBodyText">You must have the following items to complete this lab:</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Microsoft Visual Studio 2010 - <a href="http://msdn.microsoft.com/en-us/vstudio/dd582936.aspx">Download</a></p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Microsoft .NET Framework 4 - <a href="http://msdn.microsoft.com/en-us/vstudio/dd582936.aspx">Download</a></p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>SQL Server 2008 Express (included with Visual Studio 2010)</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Microsoft Outlook or Windows Live Mail Client - <a href="http://download.live.com/">Download</a><span class="MsoHyperlink" style="font-family:&#39;calibri&#39;,&#39;sans-serif&#39;;"> </span></p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Windows Server AppFabric (Beta 2) &ndash; Download using the Web Platform Installer (see below)</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note: </strong>This Lab targets Visual Studio 2010 and .NET Framework 4. The current version of Windows Server AppFabric, that is Beta 2, requires .NET Framework 4 RC.</p>
<p class="ppNoteIndent">Therefore, the portion of this Lab that shows AppFabric features may not work as expectedly until a new version of AppFabric is released.</p>
</div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd"><span style="background:none repeat scroll 0% 0% yellow;">&nbsp;</span></p>
</div>
<h1><a name="Exercises"></a>Exercises</h1>
<p class="ppBodyText">This Hands-On Lab comprises the following exercises:</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Submit Application Service</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Email Notification</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Applicant Screening</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Deploy the Solution</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Troubleshooting</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Starting_Materials"></a>Starting Materials</h1>
<p class="ppBodyText">This Hands-On Lab includes the following starting materials.</p>
<p class="ppBulletList"><span style="font-family:symbol;">&middot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong>Visual Studio solutions. </strong>Depending on the exercise you will find Visual Studio solutions that you can use as starting point for the exercises.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote"><strong></strong><strong>&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/3857.26df7e7c_2D00_d461_2D00_4c86_2D00_bc11_2D00_869f966def71.png" style="border-width:0px;border-style:solid;" /> What if I get stuck?</strong></p>
<p class="ppNote">The source code that accompanies this hands-on lab includes an end folder where you can find a Visual Studio solution with the code that you would obtain if you complete the steps in each exercise. You can use this solution as a guide if you need additional help working through the exercises. </p>
<p class="ppNote">Remember to build the solutions before opening any file using the workflow designer.</p>
</div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<p class="ppBodyText"><span class="MsoHyperlink">Setup</span></p>
<p class="ppBodyText"><span class="MsoHyperlink">&nbsp;</span></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177105">Setup</a></p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177106"></a><a name="_Toc244310966"></a><a name="_Toc246389180">Task 1 &ndash; Installing the Web Platform, Visual Studio and </a><span style="line-height:115%;font-size:10.5pt;font-family:&#39;trebuchet ms&#39;,&#39;sans-serif&#39;;">Windows Server AppFabric</span></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Download the <a href="http://www.microsoft.com/web/">Microsoft Web Platform installer</a></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Install the recommended Web Platform options plus the following</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ASP.NET</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>.NET Extensibility</p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><a href="http://www.iis.net/expand/webdeploy">Web Deployment Tool 1.0</a></p>
<p class="ppNumberListIndent">d.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Windows Server AppFabric Beta 2</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:1.1in;margin-right:0in;">
<p class="ppNoteIndent2"><strong>Note: </strong>In the<strong> </strong>Web Platform Installer Windows Server AppFabric shows up in the Enterprise tab. This tab is not displayed by default. To display it, select options and tick the box for Enterprise scenarios. Afterward you will see the option for Application Server in the Enterprise tab.</p>
</div>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppFigureIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7587.784cccfc_2D00_530a_2D00_4247_2D00_8b73_2D00_37a88b72be5c.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 2</strong></p>
<p class="ppFigureCaptionIndent">The Web Platform Installer with the Enterprise Scenarios option enabled</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Download and Install <a href="http://msdn.microsoft.com/en-us/vstudio">Visual Studio 2010 and .NET Framework 4</a></p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You can optionally download and Install <a href="http://go.microsoft.com/fwlink/?LinkID=169435">Windows Server AppFabric</a><span class="MsoHyperlink"> </span>without using the Web Platform Installer.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Configure both the Persistence and Monitoring database</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Accept all the defaults on the remaining install pages</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177107"></a><a name="_Toc244310967"></a><a name="_Toc246389181">Task 2 &ndash; Creating the Databases</a></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Run the Dependency checker for the Training Kit if you haven&#39;t done it previously. To do this, browse to the <strong>Source\Setup</strong> folder of this lab, and run the <strong>CheckDependencies.cmd</strong> script. Install any pre-requisites that are missing (rescanning if necessary) and complete the wizard.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note: </strong>This script file creates a persistence database by invoking the SQL scripts included with the .NET Framework.&nbsp; You can also use AppFabric to create persistence databases.</p>
</div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177108"></a><a name="_Toc244310968"></a><a name="_Toc246389182">Task 3 &ndash; Installing and Configuring Windows Server AppFabric.</a>&nbsp; </p>
<p class="ppBodyText">After installing Windows Server AppFabric, you will be prompted to configure it.&nbsp; If you want to reconfigure it later just search for the Configure AppFabric menu shortcut.&nbsp; AppFabric can be configured to work with The SQLExpress database created by Visual Studio so you do not need to install a separate SQL Server.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote"><strong>Note: </strong>The Web Platform Installer automatically configures Windows Server AppFabric so you do not need to do these steps again unless you want to re-configure AppFabric.</p>
</div>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Configure AppFabric</strong> from the Start menu if it is not already running after installation.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>On the Configure Hosting Services page tick the <strong>Set monitoring configuration</strong> checkbox</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Select the monitoring provider <strong>System.Data.SqlClient</strong>.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Tick the <strong>Set persistence configuration</strong> checkbox</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Select the persistence provider <strong>sqlStoreProvider.</strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4705.4f08d790_2D00_b9eb_2D00_4dfd_2D00_bd37_2D00_d3419320ee1f.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 3</strong></p>
<p class="ppFigureCaptionIndent">Configuring AppFabric monitoring and persistence stores for SQL Server</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the <strong>DefaultMonitoringConnectionString,</strong> and choose <strong>Initialize Database &hellip; </strong>Use the defaults and click the <strong>OK</strong> button.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5383.dfa801a9_2D00_b181_2D00_499b_2D00_8673_2D00_ecb6c76488de.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 4</strong></p>
<p class="ppFigureCaptionIndent">Register and Initialize the monitoring store</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>back</strong> arrow to return to the main screen. </p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Features View pane in the center double click the <strong>Persistence Database Configuration </strong>icon.</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right-click the <strong>DefaultPersistenceConnectionString,</strong> and choose <strong>Initialize Database</strong>.<strong> </strong>&nbsp;Use the defaults, and click the <strong>OK</strong> button.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<p class="ppBodyText"><span class="MsoHyperlink">Exercise 1: Submit Application Service</span></p>
<span style="font-size:6pt;"><br clear="all" />
</span>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177109"></a><a name="_Toc244310969">Exercise 1: Submit Application Service</a></p>
</div>
<div>In the first exercise you will create a simple service that receives an Application from the smart client application and returns a response.</div>
<p class="ppProcedureStart"><a name="_Toc229399123"></a><a name="_Toc228784826"></a><a name="_Toc256177110"></a><a name="_Toc246389184"></a><a name="_Toc244310970">Task </a>0 &ndash; Opening the Solution</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Microsoft Visual Studio 2010</strong> from <strong>Start | All Programs | Microsoft Visual Studio 2010</strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the starting solution for Exercise 1 located under the <strong>Source\Ex1\Begin</strong> folder (choosing the folder that matches the language of your preference.) Use it as the starting point for this exercise.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1273.26df7e7c_2D00_d461_2D00_4c86_2D00_bc11_2D00_869f966def71.png" style="border-width:0px;border-style:solid;" /> <strong>What is in this solution?</strong></p>
<p class="ppNoteIndent">This solution contains a web site created from the WCF Workflow Service template, and a data layer project you will be using in this lab.&nbsp; The web.config file has some minor modifications to include an appSettings section, and connection string for the database.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+B</strong> to build the solution</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177111"></a><a name="_Toc246389185">Task 1 &ndash; </a>Adding a new a Workflow Service</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add a new Workflow Service.&nbsp; To do this, right click on <strong>HRApplicationServices,</strong> and select <strong>Add / New Item&hellip; (Ctrl+Shift+A)</strong>, in the <strong>Workflow Templates</strong> select the <strong>WCF Workflow Service template,</strong> name the service to <strong>SubmitApplication.xamlx</strong>, and then click <strong>Add.</strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1016.116da52a_2D00_1b77_2D00_415e_2D00_acbe_2D00_581e0d640233.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 5</strong></p>
<p class="ppFigureCaptionIndent">Create a New Workflow Service in C#</p>
<p class="ppFigureNumberIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4578.1e61c688_2D00_8233_2D00_420c_2D00_9dc8_2D00_39a07d47487c.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 6</strong></p>
<p class="ppFigureCaptionIndent">Create a New Workflow Service in Visual Basic</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177112"></a><a name="_Toc244310971"></a><a name="_Toc246389186">Task 2 &ndash; Exploring the Workflow Service</a></p>
<p class="ppBodyText">You probably have some questions about your service.&nbsp;&nbsp; What is the service contract?&nbsp; What binding does it use?&nbsp; What address is it hosted at?&nbsp; In this task, you will explore your service and how it interacts with the world.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/0167.b3673f4d_2D00_c0cb_2D00_4450_2D00_8d57_2D00_899544ee3eaa.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 7</strong></p>
<p class="ppFigureCaptionIndent">The default Workflow Service</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Workflow Services have an implicit contract that is defined by the messaging activities contained in the service.&nbsp; <strong>SubmitApplication.xamlx</strong> already has a working contract that might look familiar if you have built a WCF service before.&nbsp; Look at <strong>SubmitApplication.xamlx</strong> in the workflow designer.&nbsp; Notice that it has a sequence with two activities, a request labeled <strong>ReceiveRequest</strong> and a response labeled <strong>SendResponse</strong>.&nbsp; The request determines the parameters to the service.&nbsp; To see the message content, click <strong><em>View message</em> </strong>in the <strong>ReceiveRequest</strong> activity, next to the Content label.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5516.47ab89fa_2D00_ecc5_2D00_47f2_2D00_b30e_2D00_7fa81de635aa.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 8</strong></p>
<p class="ppFigureCaptionIndent">The message content &ndash; the parameters are implied by the data</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK </strong>to dismiss the Content Definition dialog.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The content of the message is a variable named data.&nbsp; To see this variable; click the Sequential Service activity and then click the <strong>Variables</strong> button in the lower left of the design surface.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2072.d426600c_2D00_bf44_2D00_455c_2D00_ab40_2D00_accc7922e535.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 9</strong></p>
<p class="ppFigureCaptionIndent">Variables created by the Workflow Services template.</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>There are two variables.&nbsp; The first variable <strong><em>handle</em></strong> is used to correlate the request and response messages.&nbsp; The second variable <strong><em>data</em></strong> defines the message content that you expect to receive.&nbsp; </p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iables</strong> button in the lower left of the design surface.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2072.d426600c_2D00_bf44_2D00_455c_2D00_ab&nbsp; </span>To see what the return value is, in the <strong>SendResponse</strong> activity click <strong><em>View message</em></strong>.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5460.8ce25ddc_2D00_0611_2D00_49e7_2D00_9f82_2D00_59b3296c1485.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 10</strong></p>
<p class="ppFigureCaptionIndent">The response message will be the data converted to a string</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK </strong>to dismiss the Content Definition dialog.</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You now have a workflow service, but it does not have Metadata publishing enabled.&nbsp; To add this, you can use the new &ldquo;tagless&rdquo; syntax for WCF configuration in .NET 4.&nbsp; Open the <strong>web.config</strong> file, and add the following section.&nbsp; Also notice that there is no &lt;service&gt; definition.&nbsp; The simplified configuration for WCF will supply a default binding (basicHttpBinding) address and contract as required.</p>
<p class="ppBodyTextIndent">(Code Snippet - Introduction to WFServices Lab &ndash; <em>WCF serviceMetatdata XML</em>)</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><strong><span style="font-size:9.5pt;color:blue;">&lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.serviceModel</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">behaviors</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">serviceBehaviors</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">behavior</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">serviceMetadata</span></strong><strong><span style="font-size:9.5pt;color:blue;"> </span></strong><strong><span style="font-size:9.5pt;color:red;">httpGetEnabled</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">/&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">behavior</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">serviceBehaviors</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">behaviors</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.serviceModel</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpLast"><span style="font-size:9.5pt;">&nbsp;</span></p>
</div>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You now have a working Workflow Service.&nbsp; To see it in action, right click the <strong>SubmitApplication.xamlx</strong> file, and select <strong>View in Browser </strong>(Ctrl+Shift+W).&nbsp; You should see a familiar site for WCF developers</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2061.c0c94763_2D00_d5b4_2D00_4ac7_2D00_b10d_2D00_42d3448923d2.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 11</strong></p>
<p class="ppFigureCaptionIndent">The service running in the browser.</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-us</p>
</div>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">8.<span>&nbsp;&e-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177113"></a><a name="_Toc244310973"></a><a name="_Toc246389188">Task 3 &ndash; Creating Service Implementation Outline</a></p>
<p class="ppBodyText">Your service has three phases to it.&nbsp; It will receive, screen and notify.&nbsp; Throughout the lab you will be implementing these phases.&nbsp; To begin with, you will add placeholders for each phase.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to <strong>SubmitApplication.xamlx</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Change the Display Name property of the outermost sequence from <strong>Sequential Service</strong> to<strong> Application Service</strong>.&nbsp; You can change it directly on the design surface or in the properties window.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4113.ce35eb96_2D00_affb_2D00_4ca8_2D00_9948_2D00_a350c3a9b5b4.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 12</strong></p>
<p class="ppFigureCaptionIndent">Change the name of the service to Application Service</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The first placeholder will require a transaction because you will be updating a database as well as persisting your workflow to the persistence database.&nbsp; Drag a <strong>TransactedReceiveScope</strong> from the <strong>Messaging</strong> group in the toolbox and drop it at the top of the Application Service sequence.&nbsp; Set the Display Name to <strong>Receive Application</strong></p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Drag the existing <strong>ReceiveRequest</strong> inside the Request area of the Receive Application activity.&nbsp; When the message is received it will create a transaction.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8831.c0f06c17_2D00_d29a_2D00_49a7_2D00_a884_2D00_a01c315a0ddc.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 13</strong></p>
<p class="ppFigureCaptionIndent">Drag the existing ReceiveRequest inside of the Request area of the Receive Application </p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the body area you want to put the work that will be done inside of the transaction. You will have more than one activity here so drop a <strong>Sequence</strong> from the <strong>Control Flow</strong> toolbox group inside of the body and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Save and Respond</strong></p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Drag the <strong>SendResponse</strong> and drop it inside of the Save and Respond sequence.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8156.48d20382_2D00_6947_2D00_45ec_2D00_b5fa_2D00_4a2fb80b8070.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 14</strong></p>
<p class="ppFigureCaptionIndent">The Service with the TransactedReceiveScope containing the messaging activities</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Collapse the Receive Application activity <img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8255.de71a4e0_2D00_d4ce_2D00_4870_2D00_957a_2D00_e91934ef6b46.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The second phase of the service will be to screen the applicant.&nbsp; You will implement this later but for now drag a <strong>Sequence</strong> activity from the <strong>Control Flow</strong> group and drop it below the Receive Application shape and set the Display Name to <strong>Screen Applicant </strong>then collapse the sequence</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The third phase will be notifying the applicant via email and by sending a notification message to the smart client application.&nbsp; Drop another Sequence, set the Display Name to <strong>Notify Applicant</strong> and collapse the sequence.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/0654.bf79f307_2D00_a33f_2D00_4879_2D00_97e0_2D00_06d73366af8d.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 15</strong></p>
<p class="ppFigureCaptionIndent">Collapsed view of the workflow service with three phases</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177114"></a><a name="_Toc244310974"></a><a name="_Toc246389189">Task 4 &ndash; Adding Custom Activities</a></p>
<p class="ppBodyText">Your service will accept a job application from the smart client app.&nbsp; In this task you will make the modifications necessary to prepare the service to accept a job application.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add existing projects containing the solution&#39;s data contracts and custom activities. To do this, in Solution Explorer right-click the solution node, and select <strong>Add / Existing Project</strong>. In the Open Project dialog, browse to <strong>Source\Assets</strong> folder of this lab (choosing the folder that matches the language of your preference) and select the following project(s)</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong>HRApplicationServices.Contracts</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong>HRApplicationServices.Activities</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>HRApplicationServices</strong> project, add references to the <strong>HRApplicationServices .Contracts</strong> and <strong>HRApplicationService.Activities</strong> projects. To do this in Solution Explorer, right-click the <strong>HRApplicationServices</strong> project and select Add Reference. In the Add Reference dialog, switch to the Projects tab, and select the projects. Click <strong>OK</strong> to add the references.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Your workflow is going to be long running.&nbsp; It will do some initial work and then wait for a human to respond.&nbsp; This means that you need to configure a persistence store. To add this, open the <strong>web.config</strong> from the <strong>HRApplicationServices</strong> project and add the following settings.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note:</strong> When you deploy the website to AppFabric you can configure the persistence store within IIS manager.&nbsp; While working with the ASP.NET Development server you have to create the persistence stores and add the persistence behavior manually. </p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To the <strong>&lt;connectionStrings&gt;</strong> section add the following connection string which will use the WF4Persistence store you created in the setup for the lab.</p>
<p class="ppBodyTextIndent">(Code Snippet - Introduction to WFServices Lab &ndash; <em>WF4 Persistence XML</em>)</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="color:blue;">&lt;</span><span style="color:#a31515;">connectionStrings</span><span style="color:blue;">&gt;</span></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="color:#a31515;">add</span></strong><strong><span style="color:blue;"> </span></strong><strong><span style="color:red;">name</span></strong><strong><span style="color:blue;">=</span></strong><strong>&quot;<span style="color:blue;">WF4Persistence</span>&quot;<span style="color:blue;"> </span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="color:red;">connectionString</span></strong><strong><span style="color:blue;">=</span></strong><strong>&quot;<span style="color:blue;">Data Source=.\sqlexpress;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsFirst"><span style="color:blue;">&lt;</span><span style="color:#a31515;">connectionStrings</span><span style="color:blue;">&gt;</span></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="color:#a31515;">add</span></strong><strong><span style="color:blue;"> </span></strong><strong><span style="color:red;">name</span></strong><strong><span style="color:blue;">=</span></strong><strong>&quot;<span style="color:blue;">WF4Persistencp;&nbsp;&nbsp; Database=WF4Persistence;</span></strong></p>
<p class="ppCodeIndentCxSpLast"><strong><span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Integrated Security=True</span></strong><strong>&quot;<span style="color:blue;">/&gt;</span></strong></p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To the <strong>&lt;behavior&gt;</strong> section add the <strong>sqlWorkflowInstanceStore</strong> behavior right after the <strong>serviceDebug</strong> behavior.</p>
<p class="ppBodyTextIndent">(Code Snippet - Introduction to WFServices Lab &ndash; <em>WF4 sqlWorkflowInstanceStore XML</em>)</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="font-size:9.5pt;color:blue;">&lt;</span><span style="font-size:9.5pt;color:#a31515;">serviceMetadata</span><span style="font-size:9.5pt;color:blue;"> </span><span style="font-size:9.5pt;color:red;">httpGetEnabled</span><span style="font-size:9.5pt;color:blue;">=</span><span style="font-size:9.5pt;">&quot;<span style="color:blue;">true</span>&quot;<span style="color:blue;">/&gt;</span></span></p>
<p class="ppCodeIndentCxSpLast"><strong><span style="color:blue;">&lt;</span></strong><strong><span style="color:#a31515;">sqlWorkflowInstanceStore</span></strong><strong><span style="color:blue;"> </span></strong><strong><span style="color:red;">connectionStringName</span></strong><strong><span style="color:blue;">=</span></strong><strong>&quot;<span style="color:blue;">WF4Persistence</span>&quot; <span style="color:blue;">/&gt;</span></strong></p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To make the custom activities available to your service you must build the solution.&nbsp; From the menu select <strong>Build / Build Solution</strong> (Ctrl+Shift+B).&nbsp; Ensure that the build succeeded by inspecting the Output window.&nbsp; If you look at <strong>SubmitApplication.xamlx</strong> in the workflow designer, you should now see a <strong>HRApplicationService.Activities</strong> group in the toolbox.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177115"></a><a name="_Toc244310976"></a><a name="_Toc246389191">Task 5 &ndash; Receiving a Job Application</a></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open <strong>SubmitApplication.xamlx </strong>and<strong> </strong>create<strong> </strong>variables to store the application request and response. To do this, follow these steps:</p>
<p class="ppNumberListIndent">a.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Select the <strong>Application Service</strong> activity by clicking over the shape surface.</p>
<p class="ppNumberListIndent">b.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Variables</strong> button located in lower left side of the workflow designer. A panel that displays the available variables for the <strong>Application Service</strong> activity appears.</p>
<p class="ppNumberListIndent">c.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Delete the <strong>data</strong> variable by selecting it and pressing the <strong>Delete</strong> key</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:1.1in;margin-right:0in;">
<p class="ppNoteIndent2"><strong>Note: </strong>When you delete the <strong>data</strong> variable the workflow designer will show warning icons indicating that the workflow is invalid until you update the activities that used the <strong>data</strong> variable.&nbsp; </p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberListIndent">d.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong><em>Create Variable</em></strong>.</p>
<p class="ppFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8446.7b280a24_2D00_13e3_2D00_41d2_2D00_a873_2D00_02578a0b3800.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 16</strong></p>
<p class="ppFigureCaptionIndent2">Adding a new variable</p>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppNumberListIndent">e.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Type <strong>ApplicationRequest</strong> in the Name box.</p>
<p class="ppNumberListIndent">f.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Variable type drop-down list select <strong>Browse for Types</strong>.</p>
<p class="ppNumberListIndent">g.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>Type Name</strong> box of the dialog box, type the first few characters of the type you are looking for such as <strong>SubmitJob</strong>.&nbsp; As you type matching names will show up in the list.&nbsp; Click on the <strong>SubmitJobApplicationRequest</strong> type to select it.</p>
<p class="p0-00-05/8446.7b280a24_2D00_13e3_2D00_41d2_2D00_a873_2D00_02578a0b3800.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 16</strong></pFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4212.c69e03f5_2D00_19e3_2D00_41c2_2D00_ad9b_2D00_59c4055b69ab.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 17</strong></p>
<p class="ppFigureCaptionIndent2">Selecting the SubmitJobApplicationRequest type from the type picker box</p>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppNumberListIndent">h.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong> to finish.</p>
<p class="ppFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2262.cdabeeb5_2D00_83fe_2D00_43a3_2D00_940b_2D00_b87c2eba25d5.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 18</strong></p>
<p class="ppFigureCaptionIndent2">Variables window</p>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Repeat the previous process to add another variable named <strong>ApplicationResponse</strong> of type <strong>SubmitJobApplicationResponse </strong>when finished click the Variables button to hide the variables window</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You need to create a response object to store the response.&nbsp; Set the Default value of the <strong>ApplicationResponse</strong> variable to <strong>New SubmitJobApplicationResponse()</strong>.&nbsp; Remember that expressions must be written with Visual Basic regardless of the language of the project.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now you can change the contract to receive a job application. To do this, expand the Receive Application sequence <img alt=" " height="20" width="18" id="Picture 24" src="http://social.technet.microsoft.com/wiki/contents/articles/add.aspx/Lab_files/image024.png" style="border-width:0px;border-style:solid;" />&nbsp;and select the <strong>ReceiveRequest</strong> activity in the designer and press <strong>F4</strong> to display the <strong>Properties</strong> Window. Set the following values:</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>OperationName: <strong>SubmitJobApplication</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ServiceContractName: {http://contoso.com/hr/}IApplicationService </p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Content: Click the &hellip; button to display the content definition dialog and change the Message data to<strong> ApplicationRequest</strong></p>
<p class="ppNumberListIndent">d.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Check the <strong>CanCreateInstance</strong> check box. This will cause every incoming message received by the Receive Job Application activity to create a new workflow instance</p>
<p class="ppFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7624.736a8e1a_2D00_0946_2D00_4fdc_2D00_ab39_2D00_fcb4eb2c7efe.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 19</strong></p>
<p class="ppFigureCaptionIndent2">Properties of the ReceiveRequest activity</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177116"></a><a name="_Toc244310977"></a><a name="_Toc246389192">Task 6 &ndash; Saving the Job Application</a></p>
<p class="ppBodyText">You need to store the job application data in the HR database.&nbsp; The provided <strong>SaveJobApplication</strong> custom activity does this using the ADO.NET Entity Framework.&nbsp; When the job application is saved the database will generate an Application ID that you will use as the primary key for the application.&nbsp; </p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Drop a <strong>SaveJobApplication</strong> activity from the <strong>HRApplicationServices.Activities</strong> group inside the Save and Respond sequence above the <strong>SendResponse</strong> activity.</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8863.e75342da_2D00_5515_2D00_4065_2D00_acf1_2D00_5c76dd19b6b2.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 20</strong></p>
<p class="ppFigureCaptionIndent">The SaveJobApplication activity</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Set the properties of the <strong>SaveJobApplicationActivity</strong></p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AppRequest: <strong>ApplicationRequest</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Result: <strong>ApplicationResponse</strong></p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177117"></a><a name="_Toc244310978"></a><a name="_Toc246389193">Task 7 &ndash; Configuring the Response</a></p>
<p class="ppBodyText">Though you have stored the application in the database, you are not finished processing it.&nbsp; You want to let the user of the client application know that you have received and are processing their job application.&nbsp; And you have to initialize the correlation handle that you will use to identify messages bound for this workflow instance using content based correlation.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>First, you need to create a correlation handle that will be used to correlate messages for this workflow instance.&nbsp; Select the Application Service scope, click the <strong>Variables</strong> button and just as you did before, add a new variable <strong>ApplicationIDHandle</strong> of type <strong>CorrelationHandle </strong>to the<strong> Application Service </strong>scope</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Next set the response data.&nbsp; In the <strong>SendResponse</strong> activity click on <em>View message&hellip;</em> to display the content definition dialog.&nbsp; Change the <strong>Message</strong> data to use the variable <strong>ApplicationResponse</strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8688.544741f6_2D00_1239_2D00_4a17_2D00_ab53_2D00_28bf25dd066d.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 21</strong></p>
<p class="ppFigureCaptionIndent">Set the message data of the response to ApplicationResponse</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now you can define the <strong>CorrelationInitializers</strong>.&nbsp; The initializer will extract data from the outgoing message using an XPath expression.&nbsp; The extracted key will be used to identify the persisted workflow instance.&nbsp; With the <strong>SendResponse</strong> activity selected, in the properties window click&nbsp;&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6648.912dc15a_2D00_a061_2D00_4a2b_2D00_a911_2D00_569813b8138c.png" style="border-width:0px;border-style:solid;" />beside <strong>CorrelationIntializers</strong> to display the Add Correlation Initializers dialog.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <em>Add initializer</em> and add <strong>ApplicationIDHandle</strong> </p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>With the <strong>ApplicationIDHandle</strong> initializer selected, in the XPath Queries window select the <strong>ApplicationID : Int32</strong> message content</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8311.257b8a5c_2D00_ac9f_2D00_483d_2D00_b312_2D00_865a29494cf9.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 22</strong></p>
<p class="ppFigureCaptionIndent">Select the ApplicationID : Int32 message content </p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong> to dismiss the dialog.</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The default namespace for types in your workflow service is tempuri.org.&nbsp; If you want to change the default namespace you will need to edit the XAMLX file using the XML editor.&nbsp; To do this right click on SubmitApplication.xamlx and select view code.</p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Locate the Name= attribute and insert <strong>p:</strong> in front of the name as shown.&nbsp; This will cause the service to use the namespace of the operation contract as the default namespace 9494cf9.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 22</strong></p>
<p class="ppFigureCaptionIndent">Select the ApplicationID : Int32 message content </p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong> to dismiss the dialog.</p>
<p class="ppNumberList">7.<span>&nbsp;&for the WSDL types</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="font-size:9.5pt;color:blue;">&lt;</span><span style="font-size:9.5pt;color:#a31515;">WorkflowService</span><span style="font-size:9.5pt;color:blue;"> </span></p>
<p class="ppCodeIndentCxSpMiddle"><span style="font-size:9.5pt;color:blue;">&nbsp; </span><span style="font-size:9.5pt;color:red;">mc:Ignorable</span><span style="font-size:9.5pt;color:blue;">=</span><span style="font-size:9.5pt;">&quot;<span style="color:blue;">sap</span>&quot;<span style="color:blue;"> </span></span></p>
<p class="ppCodeIndentCxSpMiddle"><span style="font-size:9.5pt;color:blue;">&nbsp; </span><span style="font-size:9.5pt;color:red;">ConfigurationName</span><span style="font-size:9.5pt;color:blue;">=</span><span style="font-size:9.5pt;">&quot;<span style="color:blue;">SubmitApplication</span>&quot;<span style="color:blue;"> </span></span></p>
<p class="ppCodeIndentCxSpMiddle"><span style="font-size:9.5pt;color:blue;">&nbsp; </span><span style="font-size:9.5pt;color:red;">sap:VirtualizedContainerService.HintSize</span><span style="font-size:9.5pt;color:blue;">=</span><span style="font-size:9.5pt;">&quot;<span style="color:blue;">252,435</span>&quot;<span style="color:blue;"> </span></span></p>
<p class="ppCodeIndentCxSpLast"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">Name</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">p:SubmitApplication</span>&quot;<span style="color:blue;"> </span></span></strong></p>
</div>
<p class="ppBodyText">&nbsp;</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177118"></a><a name="_Toc244310979"></a><a name="_Toc246389194">Task 8 &ndash; Adding the Client Application</a></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add the existing <strong>HRClient</strong> project. To do this, in Solution Explorer right-click the solution node, and select <strong>Add / Existing Project</strong>. In the Open Project dialog, browse to <strong>Source\Assets</strong> folder of this lab (choosing the folder that matches the language of your preference) and select the <strong>HRClient</strong> project.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add a Service Reference to the <strong>SubmitApplication.xamlx</strong> service, to do this</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click on the HRClient project and select <strong>Add Service Reference</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Add Service Reference dialog click on the <strong>Discover</strong> button to discover services in the solution.&nbsp; Visual Studio will find the <strong>SubmitApplication.xamlx</strong> file.&nbsp; Double click it to see the details of the service.&nbsp; This will launch the service in the ASP.NET Development server.</p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Set the namespace of the service to<strong> </strong><strong>SubmitApp</strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8244.365e2dea_2D00_d7e7_2D00_4e7e_2D00_a6c0_2D00_2f1b6b3c8cc2.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 23</strong></p>
<p class="ppFigureCaptionIndent">Configuring the service reference</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberListIndent">d.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Advanced</strong> button, and check the <strong>Generate asynchronous operations</strong> checkbox.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4617.3687275b_2D00_c00c_2D00_468c_2D00_b84f_2D00_4e1129b145ad.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 24</strong></p>
<p class="ppFigureCaptionIndent">Check the Generate asynchronous operations checkbox in the advanced settings.</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong> to save and dismiss the Add Service Reference dialog.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>From the menu select <strong>Build / Build Solution</strong&nbsp;&nbsp; </span>Click the <strong>Advanced</strong> button, and check the <strong>Generate asynchronous operations</strong> checkbox.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image> (Ctrl+Shift+B)</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 1: Verification</span></div>
<p class="ppBodyText"><span class="MsoHyperlink">&nbsp;</span></p>
<h2><a name="Exercise_1_Verification"></a><a name="_Toc256177119"></a><a name="_Toc244310980">Exercise 1: Verification</a></h2>
<div>In this verification, you will run a client application verify that you have created a working service.</div>
<h3><a name="Verification_1_ndash_View_the_service_in_the_browser"></a><a name="_Toc244310981"></a><a name="_Toc246389196">Verification 1 &ndash; View the service in the browser</a></h3>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Building the solution does not insure that your workflow is functional.&nbsp; The quickest way to determine if the workflow has any major problems is to view it in the browser.&nbsp; Right-Click <strong>SubmitApplication.xamlx</strong> and select <strong>view in browser</strong>.&nbsp; You should see the Workflow Service. </p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7181.735036ba_2D00_c1cf_2D00_4fc0_2D00_a462_2D00_524412e51d57.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 25</strong></p>
<p class="ppFigureCaptionIndent">The Workflow Service </p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note: </strong>If your workflow is invalid in some way you will see an ASP.NET Error page.&nbsp; </p>
</div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h3><a name="Verification_2_The_client_application_can_send_and_receive_messages"></a><a name="_Toc244310982"></a><a name="_Toc246389197">Verification 2 - The client application can send and receive messages</a></h3>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the HRClient project, and select <strong>Set as StartUp Project.</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>F5</strong> to debug the application.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>When the Candidate Information form comes up, press the <strong>Submit</strong> button</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6758.a7962168_2D00_a449_2D00_4db1_2D00_849e_2D00_88a061552961.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 26</strong></p>
<p class="ppFigureCaptionIndent">The Candidate Information Form</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You should see the application being submitted</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/0508.e4e84ab3_2D00_e2c0_2D00_4ad5_2D00_98ec_2D00_c65e53007509.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 27</strong></p>
<p class="ppFigureCaptionIndent">The submit message text</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Then you should see the response message from the server</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2870.732ab8ff_2D00_c9ea_2D00_4db9_2D00_8184_2D00_7c586a279cc0.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 28</strong></p>
<p class="ppFigureCaptionIndent">The response from the server &ndash; the applicant ID may vary</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 2: Email Notification</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177120"></a><a name="_Toc244310983">Exercise 2: Email Notification</a></p>
</div>
<p class="ppBodyText">One of the advantages of Workflow Services is that they can do work beyond the initial request/response.&nbsp; In your workflow service you have completed only the first of three phases. In this exercise, you will implement the third phase of your workflow, where you will notify the client of the result by email.&nbsp; Later you will implement the second phase to screen the application.</p>
<p class="ppProcedureStart"><a name="_Toc256177121"></a><a name="_Toc244310984"></a><a name="_Toc246389199">Task 0 &ndash; Opening the Solution</a></p>
<p class="ppBodyText">To begin this exercise you can use the solution you finished from Exercise 1. Alternatively, you can follow the following steps to begin with Exercise 2.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Microsoft Visual Studio 2010</strong> from <strong>Start | All Programs | Microsoft Visual Studio 2010</strong>.</p>
<p class="ppNumberList">Open the starting solution for Exercise 2 located under the <strong>\Source\Ex2\Begin</strong> folder (choosing the folder that matches the language of your preference.) Use it as the starting point for this exercise.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+B</strong> to build the solution.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177122"></a><a name="_Toc244310985"></a><a name="_Toc246389200">Task 1 &ndash; Modifying the Workflow Service</a></p>
<p class="ppBodyText">Your service has work to do after sending the initial response.&nbsp; In this task you send a hire notification email to the client.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the HRApplicationService project, open the <strong>SubmitApplication.xamlx file.</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Select the <strong>Application Service</strong> sequence.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add a Variable named <strong>Hire</strong> of type <strong>Boolean</strong> at the <strong>Application Service</strong> scope with a Default value of <strong>False</strong>.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To make it simple to send email, a <strong><em>code activity</em></strong> called <strong>NotifyApplicant</strong> is provided that will send an email.&nbsp; Drag a <strong>NotifyApplicant</strong> activity from the <strong>HRApplicationServices.Activities</strong> group, drop it in the <strong>Notify Applicant</strong> sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Notify Applicant Email</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Hire: <strong>Hire</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Resume: <strong>ApplicationRequest.Resume</strong></p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6180.26df7e7c_2D00_d461_2D00_4c86_2D00_bc11_2D00_869f966def71.png" style="border-width:0px;border-style:solid;" /><strong>Where will the email go?</strong></p>
<p class="ppNoteIndent">For testing purposes the web.config file is set to drop mail messages into a folder (C:\mailbox).&nbsp; You can view these email messages with the Outlook or the free Windows Live Mail client application.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 2: Verification</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h2><a name="Exercise_2_Verification"></a><a name="_Toc256177123"></a><a name="_Toc244310986">Exercise 2: Verification</a></h2>
<p class="ppBodyText">In this verification, you will run the <strong>HRClient</strong> application to verify that it sends the hire notification email.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the HRClient application, and select <strong>Set as StartUp Project</strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>F5</strong> to Debug the solution.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>Submit</strong> to send the job application, you should see a thank you message as you did before.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Look in the C:\Mailbox folder.&nbsp; You should see an email message.&nbsp; If you have Outlook or Windows Live Mail client you can open it.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2768.4301210d_2D00_29f5_2D00_4fc3_2D00_8d7e_2D00_a875861301e7.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 29</strong></p>
<p class="ppFigureCaptionIndent">Open the message with Outlook or Windows Live Mail</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the message.&nbsp; The candidate will not be hired because the <strong>Hire</strong> variable defaults to False.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6052.8e9922a3_2D00_13e6_2D00_4e4b_2D00_856b_2D00_e869d26fa17e.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 30</strong></p>
<p class="ppFigureCaptionIndent">The notification email</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 3: Applicant Screening</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177124"></a><a name="_Toc244310987">Exercise 3: Applicant Screening</a></p>
</div>
<p class="ppBodyText">Due to the high volume of r&eacute;sum&eacute;s that Contoso receives, they want to automate a portion of the r&eacute;sum&eacute; screening process.&nbsp; In this exercise, you will send a message to a Flowchart Workflow Service that screens candidates based on education, and then you will notify the HR reviewer of applications that need review by a human.</p>
<p class="ppProcedureStart"><a name="_Toc256177125"></a><a name="_Toc244310988"></a><a name="_Toc246389203">Task 0 &ndash; Opening the Solution</a></p>
<p class="ppBodyText">To begin this exercise, you can use the solution you finished from Exercise 2. Alternatively, you can follow the following steps to begin with Exercise 3.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Microsoft Visual Studio 2010</strong> from <strong>Start | All Programs | Microsoft Visual Studio 2010</strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the starting solution for <strong>Exercise 3</strong> located under the <strong>\Source\Ex3\Begin</strong> folder (choosing the folder that matches the language of your preference.) Use it as the starting point for this exercise.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+B</strong> to build the solution.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177126"></a><a name="_Toc244310989"></a><a name="_Toc246389204">Task 1 &ndash; Adding the Education Screening </a>Activity</p>
<p class="ppBodyTextIndent">In this task, you will add an existing activity that screens r&eacute;sum&eacute;s based on the level of education.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open <strong>ScreenEducation.xaml</strong> and explore it.&nbsp; This activity is implemented as a Flowchart that will be used to automatically screen out applicants based on the level of education.&nbsp; While the other activities in our HRApplicationServices.Activities library were implemented in code, this activity is implemented in <a class="ExistingPageLink" href="/wiki/contents/articles/3949.xaml.aspx" title="Click to view the page titled: XAML">XAML</a>.&nbsp; You can create and share activities implemented in code or XAML using the Workflow Designer.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2742.d48da754_2D00_381a_2D00_47f5_2D00_801d_2D00_77d03a8c1831.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 31</strong></p>
<p class="ppFigureCaptionIndent">The ScreenEducation Flowchart</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
<p class="ppListEnd">&nbsp;</p>
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177127"></a><a name="_Toc244310992"></a><a name="_Toc246389207">Task 2 - Calling the ScreenEducation Activity</a></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open <strong>SubmitApplication.xamlx</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Expand the <strong>Screen Applicant</strong> sequence</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add a new variable <strong>EducationPassed</strong> of type <strong>Boolean </strong>to the <strong>Screen Applicant</strong> scope<strong>.&nbsp; </strong>To do this</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Variables</strong> button</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click on <em>Create Variable</em></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Name the variable <strong>EducationPassed</strong></p>
<p class="ppNumberListIndent">d.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the type select <strong>Boolean</strong></p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>From the <strong>HRApplicationServices.Activities </strong>group drop a <strong>ScreenEducation</strong> activity onto the Screen Applicant sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Auto Screen Education</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Education: <strong>ApplicationRequest.Resume.Education</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>EducationPassed: <strong>EducationPassed</strong></p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177128"></a><a name="_Toc244310993"></a><a name="_Toc246389208">Task 3 &ndash; Conditionally Notifying a Human Reviewer</a></p>
<p class="ppProcedureStart"></p>
<p class="ppBodyTextIndent">Not all applicants will pass the education screening.&nbsp; For those that do not, you need to update the database and notify them.&nbsp; For those that do pass you need to notify a human reviewer to check the application and make a decision.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Drop an <strong>If</strong> activity from the Control Flow group below the Auto Screen Education activity and set its properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>If Education Screen Passed</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Condition: <strong>EducationPassed</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If the applicant failed the education screen you will simply update the database.&nbsp; Drop an <strong>UpdateHireApproved</strong> activity from the <strong>HRApplicationServices.Activities</strong> group on the <strong>Else</strong> part of the If activity and set the properties.&nbsp; The <strong>Hire</strong> variable defaulted to False so the applicant will not be hired in this branch.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Update No Hire</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ApplicantID: <strong>ApplicationResponse.ApplicationID</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>HireApproved: <strong>Hire</strong></p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If the applicant passed the education screen you need to notify a human reviewer and wait for a response.&nbsp; Drop a <strong>Sequence</strong> activity from the Control Flow group on the <strong>Then</strong> part of the If activity and set the properties.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Human Screening</strong></p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You need to send an email to the HR Administrator to let them know there is an application to review.&nbsp; To do this drop the <strong>RequestHumanScreening</strong> activity from the <strong>HRApplicationServices.Activities</strong> group and set the properties.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Request Human Screening</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ApplicationID: <strong>ApplicationResponse.ApplicationID</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ApplicationRequest: <strong>ApplicationRequest</strong></p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now you need to wait for a response from the HR Administrator.&nbsp; They will be using a web page to send a message to your workflow with the result of the screening.&nbsp; Drop a <strong>TransactedReceiveScope</strong> activity from the <strong>Messaging</strong> group below the Request Human Screening activity and set the properties.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>When Human Screening Complete</strong></p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add a variable <strong>HumanScreening</strong> of type <strong>HumanScreeningResult</strong> to the <strong>When Human Screening Complete</strong> scope</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Drop a Receive activity in the Request area and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Operation Name: <strong>HumanScreeningCompleted</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Service Contract Name:<strong> {http://contoso.com/hr/}IApplicationService</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Content: Click&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6180.912dc15a_2D00_a061_2D00_4a2b_2D00_a911_2D00_569813b8138c.png" style="border-width:0px;border-style:solid;" />&nbsp;to display the Content Definition dialog and set the Message Data to&nbsp; <strong>HumanScreening</strong></p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Because this message is sent to a workflow that already exists you must use correlation to provide a way for the WorkflowServiceHost to locate the correct workflow instance.&nbsp; To establish correlation for this Receive activity, do the following.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong>CorrelatesOn</strong>: Click&nbsp;&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1667.912dc15a_2D00_a061_2D00_4a2b_2D00_a911_2D00_569813b8138c.png" style="border-width:0px;border-style:solid;" />to display the CorrelatesOn Definition dialog</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>CorrelatesWith: <strong>ApplicationIDHandle</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Key: <strong>Select the AppID:Int32 value</strong></p>
<p class="ppNumberListIndent">d.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click OK to dismiss the dialog</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8204.248fd245_2D00_8e63_2D00_4aa1_2D00_b9a9_2D00_32f1478449e0.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 32</strong></p>
<p class="ppFigureCaptionIndent">The Correlation definition for the Human Screening Receive activity</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Once the message is received you need to update the database and send a reply. Since you have more than one activity in the body drop a Sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Update Human Screening Result</strong></p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>Now you can set the actual Hire value from the human screening result. Because Hire was initialized to False, the only way Hire is actually set to true is if the applicant passes both automated and human screening. Drag an <strong>Assign</strong> activity from the Primitives group and drop it into the <strong>Update Human Screening</strong> sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display NampNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Once the message is received you need to update the database and send a reply. Since you have more than one activity in the body drop a Sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Update Human Screening Result</strong></p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>Now you can set the actual Hire value from the human screening result. Because Hire was initialized to False, the only way Hire is actually set to true is if the applicant passes both automated and human screening. Drag an <strong>Assign</strong> activity from the Primitives group and drop it into the <strong>Update Human Screening</strong> sequence and set the properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&ne: <strong>Assign Hire</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To: <strong>Hire</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Value: <strong>HumanScreening.HiringApproved</strong></p>
<p class="ppNumberList">11.<span>&nbsp;&nbsp; </span>&nbsp;Drop an <strong>UpdateHireApproved</strong> activity from the <strong>HRApplicationServices.Activities</strong> group below the Assign Hire activity and set the properties.</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Update Hire Result</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ApplicantID: <strong>ApplicationResponse.ApplicationID</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>HireApproved: <strong>Hire</strong></p>
<p class="ppNumberList">12.<span>&nbsp;&nbsp; </span>Now you need to send a response to the web application.&nbsp; To create a <strong>SendReply</strong> activity, right click the Receive activity, and select <strong>Create SendReply</strong>.&nbsp; Because the Receive activity is inside the Request area and the reply cannot be placed there the <strong>SendReply</strong> activity will be placed on the clipboard.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4682.46066f3b_2D00_a660_2D00_41bf_2D00_ad06_2D00_9d0a7cad75c3.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 33</strong></p>
<p class="ppFigureCaptionIndent">Create a SendReply for the receive</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">13.<span>&nbsp;&nbsp; </span>Paste the <strong>SendReply</strong> below the Update Hire Result activity and set its properties</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Display Name: <strong>Send Human Screening Reply</strong></p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Content - Message Data: <strong>True</strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2100.aaee5bbb_2D00_8332_2D00_462a_2D00_a8d3_2D00_4de19047fedf.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 34</strong></p>
<p class="ppFigureCaptionIndent">Human Screening Completed</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">14.<span>&nbsp;&nbsp; </span>From the menu select <strong>Build / Build Solution</strong> (Ctrl+Shift+B)</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177129"></a><a name="_Toc244310994"></a><a name="_Toc246389209">Task 4 &ndash; Sending Human Screening Results</a></p>
<p class="ppProcedureStart"></p>
<p class="ppBodyTextIndent">The HireApproval.aspx page will need to call the SubmitApplication.xamlx workflow.&nbsp; Even though they are in the same website the way you call into the workflow is by sending it a message.&nbsp; In this task, you will modify the page to send the hire message.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Next we need to Add a Service Reference to send a message to the receive activity of the <strong>SubmitApplication.xamlx</strong> workflow that is waiting for the human screening result.&nbsp; To do this right click the <strong>HRApplicationServices</strong> project and select <strong>Add Service Reference.</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Add Service Reference dialog click on Discover to find the service <strong>SubmitApplication.xamlx.</strong></p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Name the service reference <strong>Application</strong>,<strong> </strong>and click Ok to generate the reference.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>HRApplicationServices</strong> project right click <strong>HireApproval.aspx</strong>, and select view code (F7).</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Add the following namespace directives.</p>
<p class="ppBodyTextIndent"><em>(Code Snippet - Introduction to WF Services Lab &ndash; </em>HireApprovalNamespace<em> CSharp)</em></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">C#</p>
</div>
<div ststrong>SubmitApplication.xamlx.</strong></p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Name the service reference <strong>Application</strong>,<strong> </strong>and click Ok to generate the reference.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>HRApplicationServices</strong> project right click <strong>HireApproval.aspx</strong>, and select view code (F7).</p>
<p class="ppNumberList">5.yle="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><strong><span style="color:blue;">using</span></strong><strong> HRApplicationServices.Contracts;</strong></p>
<p class="ppCodeIndentCxSpLast"><strong><span style="color:blue;">using </span></strong><strong>HRApplicationServices.Application;</strong></p>
</div>
<p class="ppBodyTextIndent"><em>&nbsp;</em></p>
<p class="ppBodyTextIndent"><em>(Code Snippet - Introduction to WF Services Lab &ndash; </em>HireApprovalNamespace<em> VB)</em></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">Visual Basic</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><strong><span style="color:blue;">Imports</span></strong><strong> HRApplicationServices.Contracts</strong></p>
<p class="ppCodeIndentCxSpLast"><strong><span style="color:blue;">Imports</span></strong><strong> HRApplicationServices.Application</strong></p>
</div>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Locate the <strong>SendHumanScreenComplete</strong> method, and modify the code as shown.</p>
<p class="ppBodyTextIndent"><em>(Code Snippet - Introduction to WF Services Lab &ndash; </em>SendHumanScreenComplete<em> CSharp)</em></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">C#</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="font-size:9.5pt;color:blue;">private</span><span style="font-size:9.5pt;"> <span style="color:blue;">void</span> SendHumanScreenComplete(<span style="color:blue;">bool</span> hire)</span></p>
<p class="ppCodeIndentCxSpMiddle">{</p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:#2b91af;">ApplicationServiceClient</span> proxy = <span style="color:blue;">new</span> <span style="color:#2b91af;">ApplicationServiceClient</span>();</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">try</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; {</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">// Create the result</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#2b91af;">HumanScreeningResult</span> result = <span style="color:blue;">new</span> <span style="color:#2b91af;">HumanScreeningResult</span>()</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AppID = <span style="color:#2b91af;">Convert</span>.ToInt32(LabelAppID.Text),</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HiringApproved = hire,</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;};</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">// Wrap it in a request</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:#2b91af;">HumanScreeningCompletedRequest</span> request = </strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">new</span> <span style="color:#2b91af;">HumanScreeningCompletedRequest</span>(result);</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">// Call the workflow service</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.HumanScreeningCompleted(result);</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.Close();</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; }</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">catch</span> (<span style="color:#2b91af;">Exception</span>)</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; {</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.Abort();</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">throw</span>;</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong></p>
<p class="ppCodeIndentCxSpLast"><span style="font-size:9.5pt;">}</span></p>
</div>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppBodyTextIndent"><em>(Code Snippet - Introduction to WF Services Lab &ndash; </em>SendHumanScreenComplete<em> VB)</em></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">VB</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="color:blue;">Private</span> <span style="color:blue;">Sub</span> SendHumanScreenComplete(<span style="color:blue;">ByVal</span> hire <span style="color:blue;">As</span> <span style="color:blue;">Boolean</span>)</p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">Dim</span> proxy <span style="color:blue;">As</span> <span style="color:#2b91af;">ApplicationServiceClient</span> = <span style="color:blue;">New</span> <span style="color:#2b91af;">ApplicationServiceClient</span>()</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">Try</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">Dim</span> result <span style="color:blue;">As</span> <span style="color:blue;">New</span> <span style="color:#2b91af;">HumanScreeningResult</span> <span style="color:blue;">With</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .AppID = <span style="color:#2b91af;">Convert</span>.ToInt32(LabelAppID.Text),</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .HiringApproved = hire</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.HumanScreeningCompleted(result)</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.Close()</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">Catch</span> ex <span style="color:blue;">As</span> <span style="color:#2b91af;">Exception</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proxy.Abort()</strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">Throw</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong>&nbsp;&nbsp;&nbsp; <span style="color:blue;">End</span> <span style="color:blue;">Try</span></strong></p>
<p class="ppCodeIndentCxSpLast"><span style="color:blue;">End</span> <span style="color:blue;">Sub</span></p>
</div>
<p class="ppBodyTextIndent">&nbsp;</p>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 3: Verification</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h2><a name="Exercise_3_Verification"></a><a name="_Toc256177130"></a><a name="_Toc244310995">Exercise 3: Verification</a>
</h2>
<h2 style="margin:10pt 0in 6pt;"><span></span><span></span><span style="line-height:115%;font-size:11pt;font-weight:normal;font-family:&#39;calibri&#39;,&#39;sans-serif&#39;;color:windowtext;"></span><span style="font-family:&#39;calibri&#39;,&#39;sans-serif&#39;;"></span></h2>
<div>In this verification you will create a new application and verify the screening process.</div>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Delete any mail messages from C:\Mailbox</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the <strong>HRClient</strong> project, and select <strong>Set as StartUp Project</strong></p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>F5</strong> to Debug the solution; the HRClient application should start</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Submit a new application where the education level is <strong>Bachelors</strong></p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Thsize:11pt;font-weight:normal;font-family:&#39;calibri&#39;,&#39;sans-serif&#39;;color:windowtext;"></span><span style="font-family:&#39;cale workflow should automatically reject this application and you should see a new email message in the C:\Mailbox folder.&nbsp; You can view the message if you like.&nbsp; Delete this message when finished.</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Contoso HR Tool click Start Again.&nbsp; This time submit a new application where the education level is <strong>Masters</strong></p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Look in C:\Mailbox.&nbsp; There should be a message, only this one is sent to the HR Reviewer. Right click and open the message.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1715.22c3c406_2D00_e063_2D00_4ffb_2D00_bca8_2D00_9a18e2c74057.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 35</strong></p>
<p class="ppFigureCaptionIndent">Request for Application Review</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the link in the message to go to the HR Job Application Approval web page</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6012.9953b159_2D00_1916_2D00_4296_2D00_9279_2D00_0bde80ce049d.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 36</strong></p>
<p class="ppFigureCaptionIndent">The HR Job Application Approval page.</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>Hire</strong> to hire the applicant.&nbsp; This will send a message to the workflow.</p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>You should see a second mail message with the hire message.</p>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 4: Deploy the Solution</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177131"></a><a name="_Toc244310996">Exercise 4: Deploy the Solution</a></p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic">&nbsp;</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"></p>
</div>
<p class="ppListEnd"></p>
</div>
</div>
<p class="ppBodyText">In this exercise you will deploy, configure and monitor the solution using Windows Server AppFabric; a set of extensions to the Windows Application Server and the Windows Process Activation Service (WAS).&nbsp; The goal of Windows Server AppFabric is to simplify the deployment, configuration, management, and monitoring of Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) services built on .NET 4. </p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt 0in;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2185.df509fc8_2D00_5649_2D00_4ae0_2D00_a11b_2D00_51d4b5d3c7cb.png" style="border-width:0px;border-style:solid;" />&nbsp; <strong>Is AppFabric installed?</strong></p>
<p class="ppNote">AppFabric is <strong>not installed</strong> as a part of the .NET Framework 4 installation.&nbsp; It comes as a separate install delivered through a Windows Update package for Windows that you can install it using the <a href="http://www.microsoft.com/web">Microsoft Web Platform Installer</a> (recommended) or download <a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=a1ed6018-ddd1-4bd8-b4af-6561e910ebb4">Windows Server App Fabric Beta 2</a> from the Download Center</p>
<p class="ppNote">To determine if AppFabric is installed open IIS Manager.&nbsp; If AppFabric is installed when you open the Default Web Site you will see<span class="MsoHyperlink"> </span><strong>Windows Server AppFabric </strong>at the top of the features window.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppProcedureStart"><a name="_Toc256177132"></a><a name="_Toc244310997"></a><a name="_Toc246389212">Task 0 &ndash; Opening the Solution</a></p>
<p class="ppProcedureStart"></p>
<p class="ppProcedureStart">To begin this exercise you can use the solution you finished from Exercise 3. Alternatively, you can follow the following steps to begin with Exercise 4.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Micros (recommended) or download <a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=a1ed6018-ddd1-4bd8-b4af-6561e910ebb4">Windows Server App Fabric Beta 2</a> from the Download Center</p>
<p class="ppNote">To determine if AppFabric is installed open IIS Manager.&nbsp; If AppFabric is installed when you open the Default Web Site you will see<span class="MsoHyperlink"> </span><strong>Windows Server AppFabric </strong>at the top of the features window.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppProcedureStart"><a name="_Toc25oft Visual Studio 2010</strong> from <strong>Start | All Programs | Microsoft Visual Studio 2010</strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the starting solution for <strong>Exercise 4</strong> located under the <strong>\Source\Ex4\Begin</strong> folder (choosing the folder that matches the language of your preference.) Use it as the starting point for this exercise.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+B</strong> to build the solution.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177133"></a><a name="_Toc244310998"></a><a name="_Toc246389213">Task 1 &ndash; Creating Configuration Transformations</a></p>
<p class="ppBodyText">Your <span class="ppBodyTextChar">application</span> has several service references that were created in your development environment.&nbsp; When you deploy the application you need to transform the web.config file so that it uses the correct URIs from the production environment.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>To create the configuration transformations in the <strong>HRApplicationServices</strong> project right click the <strong>web.config</strong> file, and select <strong>Add Config Transforms</strong>.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4571.604be2be_2D00_0af6_2D00_4a28_2D00_9404_2D00_02492fca8f25.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 37</strong></p>
<p class="ppFigureCaptionIndent">Right click web.config, and select Add Config Transforms in C#</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><strong><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8637.e0146397_2D00_c4f7_2D00_4023_2D00_969a_2D00_069c6858a04e.png" style="border-width:0px;border-style:solid;" /></strong></p>
<p class="ppFigureNumberIndent"><strong>Figure 38</strong></p>
<p class="ppFigureCaptionIndent">Right click web.config, and select Add Config Transforms in Visual Basic</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You should now see two additional config files under web.config</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6180.6a08a79a_2D00_bb9f_2D00_44ad_2D00_98b6_2D00_95f9f6115ebf.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 39</strong></p>
<p class="ppFigureCaptionIndent">You should now have config transforms</p>
<p class="ppBodyText">&nbsp;</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note: </strong>In Visual Basic these files are hidden by default. You must make them visible by enabling the &ldquo;<strong>Show All Files&rdquo;</strong> button in the Solution Explorer.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the Web.Release.config file.&nbsp; In this file you will add transformation instructions for how you want the web.config file to look after deployment.&nbsp; Modify it as shown</p>
<p class="ppBodyTextIndent">(Code Snippet - Introduction to WFServices Lab &ndash; <em>WF4 web.Release.Config XML</em>)</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><strong><span style="font-size:9.5pt;color:blue;">&lt;?</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">xml</span></strong><strong><span style="font-size:9.5pt;color:blue;"> </span></strong><strong><span style="font-size:9.5pt;color:red;">version</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">1.0</span>&quot;<span style="color:blue;">?&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;">&nbsp;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&lt;!--</span></strong><strong><span style="font-size:9.5pt;color:green;"> For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 </span></strong><strong><span style="font-size:9.5pt;color:blue;">--&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;">&nbsp;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">configuration</span></strong><strong><span style="font-size:9.5pt;color:blue;"> </span></strong><strong><span style="font-size:9.5pt;color:red;">xmlns:xdt</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">http://schemas.microsoft.com/XML-Document-Transform</span>&quot;<span style="color:blue;">&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;!--</span></strong><strong><span style="font-size:9.5pt;color:green;">Modify the BaseURI key </span></strong><strong><span style="font-size:9.5pt;color:blue;">--&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">appSettings</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">add</span></strong><strong><span style="font-size:9.5pt;color:blue;"> </span></strong><strong><span style="font-size:9.5pt;color:red;">key</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">BaseURI</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">value</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">http://localhost/HRApplicationServices</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">xdt:Transform</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">SetAttributes(value)</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">xdt:Locator</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">Match(key)</span>&quot;<span style="color:blue;">/&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">appSettings</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.serviceModel</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">client</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!--</span></strong><strong><span style="font-size:9.5pt;color:green;">Modify the endpoint addresses for production </span></strong><strong><span style="font-size:9.5pt;color:blue;">--&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">endpoint</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">address</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">http://localhost/HRApplicationServices/SubmitApplication.xamlx</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">binding</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">basicHttpBinding</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">bindingConfiguration</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">BasicHttpBinding_IApplicationService</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">contract</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">IApplicationService</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">name</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">BasicHttpBinding_IApplicationService</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">xdt:Transform</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">SetAttributes(address)</span>&quot;<span style="color:blue;"> </span><span style="color:red;">xdt:Locator</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">Match(name)</span>&quot;<span style="color:blue;">/&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">client</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.serviceModel</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.web</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">compilation</span></strong><strong><span style="font-size:9.5pt;color:blue;"> </span></strong><strong><span style="font-size:9.5pt;color:red;">xdt:Transform</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">RemoveAttributes(debug)</span>&quot;<span style="color:blue;"> /&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp; &lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">system.web</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&lt;/</span></strong><strong><span style="font-size:9.5pt;color:#a31515;">configuration</span></strong><strong><span style="font-size:9.5pt;color:blue;">&gt;</span></strong></p>
<p class="ppCodeIndentCxSpLast"><span style="font-size:9.5pt;">&nbsp;</span></p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch the current configuration to <strong>Release</strong> to do a release build by selecting it from the toolbar.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7838.0d210bd2_2D00_9856_2D00_49c0_2D00_bba8_2D00_b0a3add07dcd.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 40</strong></p>
<p class="ppFigureCaptionIndent">Switch to release build</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177134"></a><a name="_Toc244310999"></a><a name="_Toc246389214">Task 2 &ndash; Creating the Deployment Package</a></p>
<p class="ppBodyTextIndent">In this task you will use the Web Deployment feature inside Visual Studio to create a deployment package.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Solution Explorer right click the <strong>HRApplicationServices</strong> project, and select <strong>Package/Publish Settings</strong> set the options as follows</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Items to deploy (applies to all deployment methods) section</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><strong>Only files needed to run this application</strong></p>
<p class="ppFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5658.42cd511f_2D00_d67c_2D00_4c65_2D00_bd20_2D00_f3d88ed5cd93.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 41</strong></p>
<p class="ppFigureCaptionIndent2">Items to deploy</p>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Web Deployment Package Settings section</p>
<p class="ppNumberListIndent">a.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Create web package as a ZIP file</p>
<p class="ppNumberListIndent">b.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Location: <strong>obj\Debug\Package\HRApplicationServices.zip</strong></p>
<p class="ppNumberListIndent">c.<span style="font:7pt &#39;times new roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>IIS Web Site/Application name to be used on the destination server:&nbsp; <strong>Default Web Site/HRApplicationServices</strong> </p>
<p class="ppFigureIndent2">&nbsp;</p>
<p class="ppFigureNumberIndent2"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7652.image051.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent2"><strong>Figure 42</strong></p>
<p class="ppFigureCaptionIndent2">Web Deployment Package Settings</p>
<p class="ppBodyTextIndent2">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+S</strong> to save all files &ndash; this will save your changes.</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>Solution Explorer</strong> right click the <strong>HRApplicationServices</strong> project, and select <strong>Build Deployment Package</strong>. You should see <strong>Publish succeeded</strong> as the status in the bottom left corner when the action has completed.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177135"></a><a name="_Toc246389215">Task 3 &ndash; Deploying the Package</a>&nbsp;</p>
<p class="ppProcedureStart"></p>
<p class="ppNumberList">In this task, you will use the Web Deployment feature inside IIS Manager to deploy the package to the local web server.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open <strong>Internet Information Services (IIS) Manager</strong> using the Start menu.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Expand the <strong>Server</strong> node, expand <strong>Sites</strong> and right click the <strong>Default Web Site</strong>. Select <strong>Deploy</strong> / <strong>Import Application &hellip; </strong></p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8787.image052.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 43</strong></p>
<p class="ppFigureCaptionIndent">Import Application in the IIS Manager</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>For <strong>Package path</strong> browse to the location where the package was created. By default this was in the <strong>obj\Release\Package</strong> folder for the <strong>HRApplicationServices</strong> project. Select&nbsp; <strong>HRApplicationServices.zip</strong> </p>
<p class="ppFigureIndent"><strong></strong></p>
<p class="ppFigureNumberIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7217.image053.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 44</strong></p>
<p class="ppFigureCaptionIndent">Select the package</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>Next</strong> 3 times to use the defaults on the rest of the Import Application Package wizard pages.&nbsp; When asked if you want to run this application in the default .Net 4 application pool click <strong>Yes</strong>.</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>Finish</strong> when the wizard has finished.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177136"></a><a name="_Toc246389216">Task 4 &ndash; Enabling the net.pipe Protocol on the Application</a>&nbsp;</p>
<p class="ppProcedureStart"></p>
<div>AppFabric installs a Workflow Management Service (WMS) that works with the workflow persistence store to provide reliability and instance control. WMS communicates with the workflow service via the net.pipe protocol. Therefore, this protocol must be enabled on the application.</div>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In <strong>IIS Manager</strong> right click on the <strong>Default Web Site</strong> and select the <strong>Edit Bindings &hellip;</strong> option.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Ensure that <strong>net.pipe</strong> is added with <strong>*</strong> for its <strong>Binding information</strong>. If it is not, add it using the <strong>Add&hellip;</strong> button.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6138.image054.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 45</strong></p>
<p class="ppFigureCaptionIndent">Enable the net.pipe site binding</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Close</strong> button</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Expand the Default Web Site and right click the <strong>HRApplicationServices</strong> application in the tree. Select <strong>Manage Application</strong> <strong>/ Advanced Settings&hellip;</strong></p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>Enabled Protocols</strong> section after http add <strong>,net.pipe</strong> as shown</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1004.image055.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 46</strong></p>
<p class="ppFigureCaptionIndent">Enable the net.pipe protocol</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote"><strong><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8103.image003.png" style="border-width:0px;border-style:solid;" />Why enable the net.pipe protocol?</strong></p>
<p class="ppNote">The net.pipe protocol must be enabled so that the Workflow Management Service can communicate with the Workflow Control standard endpoint of workflow services.&nbsp; This is how it can manage workflow services.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong></p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177137"></a><a name="_Toc244311000"></a><a name="_Toc246389217">Task 5 &ndash; Changing the Application Configuration</a></p>
<p class="ppBodyText">While you were developing the solution you were using the WF4Persistence database for persistence. In the IIS environment you are going to use a different persistence database. You also want to configure AppFabric to suspend workflows with unhandled exceptions.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In IIS Manager, expand the Default Web Site and right click the <strong>HRApplicationServices</strong> application, and select <strong>Manage WCF and WF Services / Configure&hellip;</strong></p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Workflow Persistence</strong> category.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Under SQL Server Workflow Persistence select <a><strong>defaultSqlPersistenceStore</strong></a>.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2161.image056.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 47</strong></p>
<p class="ppFigureCaptionIndent">Configure persistence to use DefaultPersistenceConnectionString</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click <strong>OK</strong> &nbsp;to dismiss the dialog. Click <strong>Yes</strong> when you are warned about recycling the application.</p>
<div style="border-width:1pt medbsp; </span>Click the <strong>Workflow Persistence</strong> category.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Under SQL Server Workflow Persistence select <a><strong>defaultSqlPersistenceStore</strong></a>.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2161.image056.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 47</strong></p>
<p class="ppFigureCaptionIndent">Configure persisium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 4: Verification</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h2><a name="Exercise_4_Verification"></a><a name="_Toc256177138"></a><a name="_Toc244311001">Exercise 4: Verification</a></h2>
<div>The Dashboard shows the activity for the services at a particular scope in the IIS tree. For example, if you click the server node at the top of the tree and then click the AppFabric Dashboard you will see activity for all the WCF and WF services on the computer. In this verification, you will look at the Dashboard at your application level.</div>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote"><strong>Note:</strong> To follow this verification, it is required to follow the steps in exercise 4. Opening the End solution will not be sufficient to follow the verification since there are some IIS configuration tweaks to perform.</p>
</div>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In <strong>IIS Manager,</strong> expand the <strong>Default Web Site,</strong> and select the <strong>HRApplicationServices</strong> application in the tree.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>At the bottom of the IIS Manager window, click <strong>Content View</strong> to see the content of the website.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the <strong>SubmitApplication.xamlx </strong>file, and select <strong>Browse</strong>.</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You should see a browser window, with the <strong>Submit Application Service</strong>.&nbsp; If there are any problems with the configuration for the website this page will not appear</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>At the bottom of the IIS Manager window click&nbsp; <strong>Features View</strong></p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Double click on the <strong>AppFabric Dashboard</strong> icon.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2766.image057.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 48</strong></p>
<p class="ppFigureCaptionIndent">Open the Dashboard</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8664.image003.png" style="border-width:0px;border-style:solid;" /><strong>What is on the Dashboard?</strong></p>
<p class="ppNote"><strong>Persisted WF Instances</strong> : This section shows the number of workflow instances that are live or in flight. These are the instances that have persisted to the database but have not yet completed. </p>
<p class="ppNote"><strong>WCF Call History</strong> : This section shows the number of WCF calls the have been received. The heading shows counts of the calls that were completed or that encountered exceptions. </p>
<p class="ppNote"><strong>WF Instance History</strong>: This section shows the number of workflow instances that have been activated, have failed, or completed. </p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppFigure">&nbsp;</p>
<p class="ppFigureNumber"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4403.image059.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumber"><strong>Figure 49</strong></p>
<p class="ppFigureCaption">The Dashboard showing no activity for the HRApplicationService application.</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to <strong>Visual Studio 2010</strong></p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the <strong>app.config</strong> file in the <strong>HRClient</strong> project.&nbsp; Unlike the web.config which transformed when you deployed it, the <strong>app.config</strong> file must be manually edited.&nbsp; Change the endpoint address as shown in bold text below.</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppBodyTextIndent">(Code Snippet - Introduction to WFServices Lab &ndash; <em>WF4 ClientCon/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4403.image059.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumber"><strong>Figure 49</strong></p>
<p class="ppFigureCaption">The Dashboard showing no activity for the HRApplicationService application.</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to <strong>Visual Studio 2010</strong></p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the <strong>app.config</strong> file in the <strong>HRClient</strong> project.&nbsp; Unlike the web.config which transformed when you deployed it, the <strong>app.config</strong> filfig XML</em>)</p>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #c8cdde;padding:0in 0in 1pt;background:none repeat scroll 0% 0% #efeff7;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeLanguageIndent">XML</p>
</div>
<div style="border-width:1pt medium;border-style:solid none;border-color:white -moz-use-text-color #d5d5d3;padding:1pt 0in;background:none repeat scroll 0% 0% #f7f7ff;margin-left:0.5in;margin-right:0in;">
<p class="ppCodeIndentCxSpFirst"><span style="font-size:9.5pt;color:blue;">&lt;</span><span style="font-size:9.5pt;">client<span style="color:blue;">&gt;</span></span></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp; &lt;</span></strong><strong><span style="font-size:9.5pt;">endpoint<span style="color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:red;">address</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">http://localhost/HRApplicationServices/SubmitApplication.xamlx</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">binding</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">basicHttpBinding</span>&quot;<span style="color:blue;">&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:red;">bindingConfiguration</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">BasicHttpBinding_IApplicationService</span>&quot;</span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><strong><span style="font-size:9.5pt;color:blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></strong><strong><span style="font-size:9.5pt;color:red;">contract</span></strong><strong><span style="font-size:9.5pt;color:blue;">=</span></strong><strong><span style="font-size:9.5pt;">&quot;<span style="color:blue;">SubmitApp.IApplicationService</span>&quot;<span style="color:blue;"> <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color:red;">name</span><span style="color:blue;">=</span>&quot;<span style="color:blue;">BasicHttpBinding_IApplicationService</span>&quot;<span style="color:blue;"> /&gt;</span></span></strong></p>
<p class="ppCodeIndentCxSpMiddle"><span style="font-size:9.5pt;color:blue;">&lt;/</span><span style="font-size:9.5pt;">client<span style="color:blue;">&gt;</span></span></p>
<p class="ppCodeIndentCxSpLast">&nbsp;</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the <strong>HRClient</strong> project, and select Debug / Start new instance</p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>In the Contoso HR Tool, set the <strong>Education</strong> to <strong>Masters,</strong> and click the <strong>Submit</strong> button.&nbsp; After a few moments you should see a confirmation message that the resume is being processed.</p>
<p class="ppNumberList">11.<span>&nbsp;&nbsp; </span>In IIS Manager, <strong>refresh</strong> the <strong>AppFabric Dashboard</strong>. You should see activity in each of the three sections. </p>
<p class="ppNumberList">12.<span>&nbsp;&nbsp; </span>Click on the <strong>1</strong> beside <strong>Active</strong> in the <strong>Persisted WF Instances</strong> section to see a list of the active persisted instances. </p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7103.image060.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 50</strong></p>
<p class="ppFigureCaptionIndent">The SubmitApplication Workflow instance is active</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note:</strong> The host is configured by default to put active instances into the idle state after 60 seconds.&nbsp; If you do not have any instances in the Active state refresh the Dashboard and look for the instance in the Idle state.</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">13.<span>&nbsp;&nbsp; </span>Click on the hyperlink on the word <strong>Active</strong> or <strong>Idle</strong> in the <strong>Persisted WF Instances</strong> pane. This will open a query page with Persisted WF Instances</p>
<p class="ppNumberList">14.<span>&nbsp;&nbsp; </span>Click on the persisted instance.&nbsp; The <strong>Details</strong> pane at the bottom of the screen will show some information about the instance.&nbsp; In this example, you can see that the SubmitApplication Workflow has an active bookmark named <strong>HumanScreeningCompleted</strong>. That is the operation name of the bookmark created by the receive activity that it is currently waiting on.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:43.1pt;margin-right:0in;">
<p class="ppNoteIndent"><strong>Note: </strong>The active bookmark is visible only for instances that were idle</p>
</div>
<p class="ppBodyText">&nbsp;</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8512.image061.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 51</strong></p>
<p class="ppFigureCaptionIndent">Information about the persisted SubmitApplication workflow</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">15.<span>&nbsp;&nbsp; </span>In the picture above you can see that there are a number of tracked events.&nbsp; To see these events, right click the instance, and select the <strong>View Tracked Events</strong> action. This action will take you to the <strong>Tracked Events</strong> page populated with all the monitoring information that was collected for the instance, sorted with the newest data at the top. </p>
<p class="ppFigure">&nbsp;</p>
<p class="ppFigureNumber">&nbsp;</p>
<p class="ppFigureCaption"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7167.image062.jpg" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureCaption"><strong>Figure 52</strong></p>
<p class="ppFigureCaption">Monitoring collected Information for the instance in the Tracked Events feature.</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">16.<span>&nbsp;&nbsp; </span>The last activity to execute was the <strong>Request Human Screening </strong>activity. Click on this row and notice in the <strong>Details</strong> pane at the bottom of the screen you will see information about this event. Its state is <strong>Closed</strong>, indicating that the <strong>Request Human Screening</strong> activity has finished executing. </p>
<p class="ppNumberList">17.<span>&nbsp;&nbsp; </span>In <strong>Windows Explorer</strong>, go to <strong>C:\Mailbox</strong> and find the latest message. Open it and click the link to review the application.</p>
<p class="ppNumberList">18.<span>&nbsp;&nbsp; </span>In the review web page, click the <strong>Hire</strong> or <strong>No hire</strong> button.&nbsp; This will send a message to the SubmitApplication workflow using the HumanScreeningCompleted operation.</p>
<p class="ppNumberList">19.<span>&nbsp;&nbsp; </span>Return to <strong>IIS Manager</strong> (still on the <strong>Tracked Events</strong> page), and click the <strong>Run Query</strong> button to refresh the data in the list (it may take up to a minute before the new events appear). You will now see that the remainder of the SubmitApplication workflow activities have executed.</p>
<p class="ppNumberList">20.<span>&nbsp;&nbsp; </span>Return to the <strong>Dashboard</strong> and <strong>refresh</strong> it. You should now see no active or idle instances in the <strong>Persisted WF Instances</strong> section. In the <strong>WF Instance History</strong> section you should see that 2 workflow instances have been activated and completed first the <strong>ScreenEducation</strong> and then the <strong>SubmitApplication</strong> workflow.</p>
<p class="ppFigure">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/1732.image063.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumber"><strong>Figure 53</strong></p>
<p class="ppFigureCaption">The Dashboard showing 2 completed workflows.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Exercise 5: Troubleshooting</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177139"></a><a name="_Toc244311002">Exercise 5: Troubleshooting</a></p>
</div>
<p class="ppBodyText">What happens when a workflow encounters an error?&nbsp; If the workflow is responding to a web service message it can send a SOAP fault to let the caller know there was an error.&nbsp; But if the workflow is doing work after it sent a response you need a way to find out what went wrong so you can take action.&nbsp; What would happen if your SubmitApplication workflow was unable to send the Request Human Screening email?&nbsp; In this exercise you will force an error that simulates a mail failure then use AppFabric to troubleshoot and correct the problem.</p>
<p class="ppProcedureStart"><a name="_Toc256177140"></a><a name="_Toc244311003"></a><a name="_Toc246389220">Task 0 &ndash; Opening the Solution</a></p>
<p class="ppBodyTextIndent">To begin this exercise you can use the solution you finished from Exercise 4. Alternatively, you can follow the following steps to begin with Exercise 5.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Start <strong>Microsoft Visual Studio 2010</strong> from <strong>Start | All Programs | Microsoft Visual Studio 2010</ce message it can send a SOAP fault to let the caller know there was an error.&nbsp; But if the workflow is doing work after it sent a response you need a way to find out what went wrong so you can take action.&nbsp; What would happen if your SubmitApplication workflow was unable to send the Request Human Screening email?&nbsp; In this exercise you will force an error that simulates a mail failure then use AppFabric to troubleshoot and correct the problem.</p>
<p class="ppProcedureStart"><a name="_Toc256177140"></a><a name="_Toc244311003"></a><a name="_Toc246389220">Task 0 &ndash; Opening the Solution</a></p>
<p class="ppBodyTextIndent">To begin this exercise you can use the solution you finished from Exercise 4. Alternatively, you can follow the following steps to begin with Exercise 5.</p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open the starting solution for <strong>Exercise 5</strong> located under the <strong>\Source\Ex5\Begin</strong> folder (choosing the folder that matches the language of your preference.) Use it as the starting point for this exercise.</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>CTRL+SHIFT+B</strong> to build the solution.</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177141"></a><a name="_Toc244311004"></a><a name="_Toc246389221">Task 1 &ndash; Simulating an Error Condition</a></p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Using <strong>Windows Explorer</strong> Rename the <strong>C:\Mailbox</strong> folder to <strong>C:\Mailbox2</strong> and delete any mail messages in the folder. When the workflow tries to send the email it will now fail at this step</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to <strong>Visual Studio 2010</strong> right click on the <strong>HRClient</strong> project and select <strong>Set as StartUp Project</strong></p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Press <strong>Ctrl+F5</strong> to start the <strong>HRClient</strong> project without debugging</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the Contoso HR Tool set the <strong>Education</strong> to <strong>Masters,</strong> and click the <strong>Submit</strong> button.&nbsp; After a few moments you should see a confirmation message that the resume is being processed.&nbsp; From the client perspective it appears that everything is working.</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In <strong>IIS Manager</strong> expand the <strong>Default Web Site</strong>, and select the <strong>HRApplicationServices</strong> application in the tree.&nbsp; Double click the <strong>AppFabric Dashboard</strong> icon.</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the <strong>Persisted WF Instances</strong> section at the top of the Dashboard you should see 1 instance in the <strong>Suspended</strong> state. Click the <strong>1</strong> to go to the <strong>Persisted WF Instances</strong> page.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5808.image064.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 54</strong></p>
<p class="ppFigureCaptionIndent">You should see a suspended instance</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Select the one suspended instance in the list, and look at the <strong>Details</strong> pane at the bottom.</p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Click the <strong>Errors</strong> tab. You should see <strong>Failure sending mail</strong>.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7571.image065.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 55</strong></p>
<p class="ppFigureCaptionIndent">Errors tab explains why the workflow was suspended</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>At this point, you know the problem has something to do with a failure to send email.&nbsp; To get more information about the error right click the suspended instance, and select the <strong>View Tracked Events</strong> action.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/3731.image066.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 56</strong></p>
<p class="ppFigureCaptionIndent">To get more detail, view tracked events</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>You will see some <strong>warning</strong> and <strong>error</strong> events in the list. Click on these, and then the <strong>Errors</strong> tab to see more information about the error.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikick the suspended instance, and select the <strong>View Tracked Events</strong> action.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/3731.image066.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 56</strong></p>
<p class="ppFigureCaptionIndent">To get more detail, view tracked events</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">10.<span>&nbsp;&nbsp; </span>You will see some <strong>warning</strong> and <strong>error</strong> events in the list. Click on these, and then the <strong>Errors</strong> tab to see more information about the error.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class=is-Components-Files/00-00-00-00-05/2350.image067.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 57</strong></p>
<p class="ppFigureCaptionIndent">The WorkflowInstanceAbort record showing the cause of the failure</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">11.<span>&nbsp;&nbsp; </span>You can see from the error that the mail system could not find the path C:\Mailbox because you renamed it earlier to c:\Mailbox2.&nbsp; </p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<p class="ppProcedureStart"><a name="_Toc256177142"></a><a name="_Toc244311005">Task 2 &ndash; Correcting the Error and Resuming the Workflow</a> </p>
<p class="ppNumberList">1.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to <strong>Windows Explorer</strong>, and rename the <strong>Mailbox2</strong> folder to <strong>Mailbox</strong>.</p>
<p class="ppNumberList">2.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch to the <strong>IIS Manager</strong>, and click the back button to return to the <strong>Persisted WF Instances </strong>page</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/0871.image068.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 58</strong></p>
<p class="ppFigureCaptionIndent">Click the back button to return to the Persisted WF Instances page</p>
<p class="ppBodyTextIndent">&nbsp;</p>
<p class="ppNumberList">3.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Right click the suspended instance, and select the <strong>Resume</strong> action. This will queue the command to resume the instance from its last persist point.&nbsp; </p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/2146.image069.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 59</strong></p>
<p class="ppFigureCaptionIndent">Resume the suspended instance</p>
<p class="ppBodyText">&nbsp;</p>
<p class="ppNumberList">4.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Wait a few seconds, and click the <strong>Run Query</strong> button. You should see an empty list because the workflow resumed and completed.</p>
<p class="ppNumberList">5.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Return to the <strong>Dashboard</strong> and <strong>refresh</strong> it.&nbsp; You should now see 1 persisted WF instance in the <strong>Active</strong> or <strong>Idle</strong> state depending upon how long it takes you to view it.</p>
<p class="ppNumberList">6.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In <strong>Windows Explorer</strong> go to <strong>C:\Mailbox</strong> and find the latest message. Open it, and click the link to review the application.</p>
<p class="ppNumberList">7.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the review web page click the <strong>Hire</strong> or <strong>No hire</strong> button.&nbsp; This will send a message to the SubmitApplication workflow using the HumanScreeningCompleted operation.</p>
<p class="ppNumberList">8.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In the C:\Mailbox folder you should see another message with the result</p>
<p class="ppNumberList">9.<span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Switch back to IIS Manager, and refresh the Dashboard.&nbsp; You should see the Completions count incremented by 1.&nbsp; Click <strong>Completions:</strong> you will be able to review the statistics about the Submit Application workflow as shown.</p>
<p class="ppFigureIndent">&nbsp;</p>
<p class="ppFigureNumberIndent"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8306.image070.png" style="border-width:0px;border-style:solid;" /></p>
<p class="ppFigureNumberIndent"><strong>Figure 60</strong></p>
<p class="ppFigureCaptionIndent">The completed workflow</p>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<h1><a name="Next_Step"></a>Next Step</h1>
<div><span class="MsoHyperlink">Summary</span></div>
<div style="border-width:1pt medium medium;border-style:solid none none;border-color:silver -moz-use-text-color -moz-use-text-color;padding:1pt 0in 0in;margin-left:8.65pt;margin-right:3in;">
<p class="ppListEnd">&nbsp;</p>
</div>
<div style="border-width:medium medium 1pt;border-style:none none solid;border-color:-moz-use-text-color -moz-use-text-color #4f81bd;padding:0in 0in 4pt;">
<p class="ppTopic"><a name="_Toc256177143"></a><a name="_Toc244311006">Summary</a></p>
</div>
<p class="ppBodyText">In this lab you have learned how to build, send and receive messages using Workflow Services.&nbsp; You&rsquo;ve also seen how you can deploy, monitor and troubleshoot services using AppFabric.</p>
<div style="border:1.5pt solid #999999;padding:1pt 4pt;background:none repeat scroll 0% 0% #eaf1dd;margin-left:7.1pt;margin-right:0in;">
<p class="ppNote">&nbsp;<img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7041.image071.png" style="border-width:0px;border-style:solid;" />&nbsp; <strong>Feedback</strong></p>
<p class="ppNote">What do you think of this lab? What do you think of the new Windows Workflow 4? Your feedback is important; it will help us build the best product for you. Please take a moment to provide it. Send your comments to <strong>wfwcfhol@microsoft.com</strong></p>
</div>
<p class="ppBodyText">&nbsp;</p>
</div>
<div>
<hr align="left" class="msocomoff" />
<div>
<div id="_com_1" class="msocomtxt">
<p class="MsoCommentText">&nbsp;</p>
</div>
</div>
</div></div>
    
    
