---
layout: default
title: 'Worm&#58;Win32/Visal.B - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<p>Official Writeups at the following URLs:</p>
<ul>
<li><span style="font-size:11pt;font-family:Calibri,sans-serif;color:#1f497d;"><a href="http://www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx?Name=Worm%3aWin32%2fVisal.B">http://www.microsoft.com/security/portal/Threat/Encyclopedia/Entry.aspx?Name=Worm%3aWin32%2fVisal.B</a>
<span style="font-size:x-small;font-family:Arial;color:#000000;">MSAV Encyclopedia writeup for this threat.</span></span>
</li><li><span style="font-size:x-small;font-family:Arial;color:#000000;"><a href="http://blogs.technet.com/b/mmpc/archive/2010/09/09/emerging-malware-issue-visal-b.aspx">http://blogs.technet.com/b/mmpc/archive/2010/09/09/emerging-malware-issue-visal-b.aspx</a>&nbsp;MMPC
 blog article regarding the issue.</span> </li></ul>
<p>&nbsp;Microsoft Forefront Products</p>
<ul>
<li>FCS/FEP/MSE anything that uses the MSAV engine/signatures is currently waiting for new signature set should have signatures that address this in build 1.89.1389.0 and higher.
</li><li><span style="font-size:x-small;font-family:Arial,sans-serif;color:black;">If you are using any of the Forefront Exchange security products you can set up filtering&nbsp;rules to block messages based on content or subject line.
<a href="http://social.technet.microsoft.com/wiki/contents/articles/worm-win32-vb-wf-email-virus-defending-with-forefront-security-forefront-protection-antigen.aspx">
http://social.technet.microsoft.com/wiki/contents/articles/worm-win32-vb-wf-email-virus-defending-with-forefront-security-forefront-protection-antigen.aspx</a></span>
</li><li>FOPE blocks this threat </li><li>FOPE&nbsp;protects BPOS-S customers from receiving these. </li></ul>
<p>&nbsp;</p>
<p>If you are not a MSAV customer&nbsp;contact your AV&nbsp;vendor&nbsp;and work with them to get samples and definitions!</p>
<p><strong><span style="text-decoration:underline;font-size:small;font-family:Calibri;">Action Plan</span></strong></p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;"><strong><span style="text-decoration:underline;color:#002163;">Exchange Server 2007 / 2010</span></strong><span style="text-decoration:underline;color:#002163;"></span></span></div>
<div style="margin:0in 0in 0pt;"><strong><span style="font-size:12pt;font-family:Calibri;color:#002163;">Transport</span></strong></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Depending on the volume of incoming mail you may need to Pause all transport servers so nothing new is coming in</span></div>
<p style="text-indent:-0.25in;margin:0in 0in 0pt 0.5in;margin:0 0 .0001pt .5in;">
<span style="color:#002163;"><span style="font-size:small;font-family:Calibri;">1.</span><span style="font-style:normal;font-weight:normal;font-size:7pt;line-height:normal;font-family:&#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-size:small;font-family:Calibri;"><strong><span style="text-decoration:underline;color:#002163;">Set a Transport Rule to Delete any incoming messages</span></strong><span style="text-decoration:underline;color:#002163;"></span></span></p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">GUI - from the EMC</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Organization Configuration &gt; Hub Transport &gt; Transport Rules</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">New Transport Rule</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Fill out the rule Name and any necessary comments and leave Enable Rule checked</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Next</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Conditions: When the Subject field contains specific words &quot;Here You Have&quot;</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Actions: silently drop the message</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">click New to create the rule and restart the Transport service</span></div>
<div style="margin:0in 0in 0pt;"><span style="text-decoration:underline;font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<p style="text-indent:-0.25in;margin:0in 0in 0pt 0.5in;margin:0 0 .0001pt .5in;">
<span style="color:#002163;"><span style="font-size:small;font-family:Calibri;">2.</span><span style="font-style:normal;font-weight:normal;font-size:7pt;line-height:normal;font-family:&#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-size:small;font-family:Calibri;"><strong><span style="text-decoration:underline;color:#002163;">Delete messages in the queues</span></strong><span style="text-decoration:underline;color:#002163;"></span></span></p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;"><span style="color:#002163;">&nbsp;</span><span style="color:#1f497d;">Get-TransportServer | Get-Queue | get-message | where{$_.MessageSubject -eq &quot;Here you have&quot;} |
 remove-message</span><span style="color:#002163;"></span></span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="text-decoration:none;font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><strong><span style="font-size:12pt;font-family:Calibri;color:#002163;">Mailbox Cleanup</span></strong></div>
<p style="text-indent:-0.25in;margin:0in 0in 0pt 0.5in;margin:0 0 .0001pt .5in;">
<span style="color:#002163;"><span style="font-size:small;font-family:Calibri;">1.</span><span style="font-style:normal;font-weight:normal;font-size:7pt;line-height:normal;font-family:&#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-size:small;font-family:Calibri;"><strong><span style="text-decoration:underline;color:#002163;">Export and delete virus messages from mailboxes</span></strong><span style="text-decoration:underline;color:#002163;"></span></span></p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#1f497d;">Get-Mailbox -Server Server1 | Export-Mailbox -SubjectKeywords &quot;Here you have&quot; -DeleteContent -TargetMailbox VirusMailbox -TargetFolder VirusMsgs
</span><span style="font-size:9pt;font-family:&#39;MS Shell Dlg 2&#39;,sans-serif;color:black;">-Confirm:$false</span><span style="color:#002163;"></span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">** remember to create the target mailbox &quot;VirusMailbox&quot; first **</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">** hide this target mailbox from the GAL**</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">&nbsp;
</span></div>
<p style="text-indent:-0.25in;margin:0in 0in 0pt 0.5in;margin:0 0 .0001pt .5in;">
<span style="color:#002163;"><span style="font-size:small;font-family:Calibri;">2.</span><span style="font-style:normal;font-weight:normal;font-size:7pt;line-height:normal;font-family:&#39;Times New Roman&#39;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span style="font-size:small;font-family:Calibri;"><strong><span style="color:#002163;">Preventative Measure -
<span style="text-decoration:underline;">Disable MAPI access</span></span></strong><span style="color:#002163;"></span></span></p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Run syntax to remove MAPI access from all mailboxes in that store:</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;"><strong><span style="color:#002163;">get</span></strong><span style="color:#002163;">-mailboxdatabase &lt;name&gt; |
<strong>get</strong>-mailbox | <strong>Get</strong>-<strong>casmailbox</strong></span></span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;"><strong><span style="color:#002163;">get</span></strong><span style="color:#002163;">-mailboxdatabase &lt;name&gt; |
<strong>get</strong>-mailbox | set-<strong>casmailbox</strong> -mapienabled $FALSE</span></span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">Then enable each user as their outbox is cleaned out</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;"><strong><span style="text-decoration:underline;color:#002163;">Exchange Server 2000/2003</span></strong><span style="text-decoration:underline;color:#002163;"></span></span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;">1. Use ExMerge to remove the infected emails from mailboxes</span></div>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;"></span></div>
<p><span style="font-size:small;font-family:Calibri;color:#002163;"></span></p>
<p><span style="color:#002163;">2. Clearing queues </span></p>
<div style="margin:0in 0in 0pt;"><span style="color:#002163;">Manual:&nbsp;&nbsp; In E2K3 we can stop the SMTP Service and the do string search in Queue folder for the subject words of virus message, and we can delete it that way.
</span></div>
<p>&nbsp;</p>
<div style="margin:0in 0in 0pt;"><span style="font-size:small;font-family:Calibri;color:#002163;"></span></div>
<p>&nbsp;</p>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"><strong><span style="text-decoration:underline;">Some quick and dirty updates.</span></strong></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><strong><span style="text-decoration:underline;color:#000000;">Export-Mailbox command</span></strong></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">You can limit this command by specific folders with the –IncludeFolders option and also if your customer is afraid of deleting legitimate mail you can make use of date restriction to
 only export mail within a certain date range. Example below</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Get-Mailbox -Server Server1 | Export-Mailbox -SubjectKeywords &quot;Here you have&quot; –IncludeFolders “/Inbox” –StartDate “09/08/2010” –EndDate “09/09/2010” -DeleteContent -TargetMailbox VirusMailbox
 -TargetFolder VirusMsgs <span style="font-size:9pt;font-family:&#39;MS Shell Dlg 2&#39;,sans-serif;">
-Confirm:$false</span></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><strong><span style="text-decoration:underline;color:#000000;">Tools</span></strong></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">There is a tool that can be used to
<span style="color:#000000;">run reports against mailboxes to determine who has a large number of items in their Outbox</span>.&nbsp;&nbsp; For additional information on this contact Support.
</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"><span style="color:#000000;"><a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=9a49c22e-e0c7-4b7c-acef-729d48af7bc9&amp;DisplayLang=en">ExMon</a>
</span>can be used <span style="color:#000000;">to determine what user or workstation may be hammering
</span>the message <span style="color:#000000;">store and may need to be taken offline</span></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">See the following for instructions on using Exmon to find the offending clients
<a href="http://www.msexchange.org/tutorials/Microsoft-Exchange-Server-User-Monitor.html">
http://www.msexchange.org/tutorials/Microsoft-Exchange-Server-User-Monitor.html</a>&nbsp;This works with every supported version of Exchange currently available.</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><strong><span style="text-decoration:underline;color:#000000;">Working with Transport – new information</span></strong></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">One c<span style="color:#000000;">ustomer has almost 1.5 million messages so you may need to purge on a queue by queue basis</span></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Get-message -queue &quot;server\queue&quot; | where{$_.Subject -eq &quot;Here you have&quot;} | suspend-message</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Get-message -queue &quot;server\queue&quot; | where{$_.Subject -eq &quot;Here you have&quot;} | remove-message</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">This command only processes 1000 messages at a time so you need to change the “ –ResultSize “ to Unlimited.</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"><span style="color:#000000;">If
</span>there are <span style="color:#000000;">other transport rules they may need to be temporarily disabled.&nbsp; Remember if you</span> are
<span style="color:#000000;">running exchange 2007 PRE-SP3 they will not be able to remove messages from the submission Queue.&nbsp;&nbsp; Best bet is to pause transport and let the rule do its thing.</span></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"><strong><span style="text-decoration:underline;"></span></strong></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"><strong><span style="text-decoration:underline;">Mitigations from an Outlook client perspective:</span></strong></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">&nbsp;</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Warning this WILL break applications that utilize outlook to programmatically send/create messages!!!</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Download the Office .adm templates found here
<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=92d8519a-e143-4aee-8f7a-e4bbaeba13e7">
http://www.microsoft.com/downloads/en/details.aspx?FamilyID=92d8519a-e143-4aee-8f7a-e4bbaeba13e7</a></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Install the outlk12 template into a GPO applied to an OU where computers are located that you need&nbsp; mitigate this issue on.</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Configure the following setting&nbsp; User Configuration &gt; Administrative Templates &gt; Classic Administrative Templates &gt; Microsoft Office Outlook 2007 &gt; Security</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Select Programmatic Access Security and click Enabled,&nbsp; for Options select &quot;Always warn me about suspicious activity&quot;&nbsp; This will force outlook to always prompt when a 3rd party application
 is attempting to programmatically utilize Outlook.</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"></span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"></span></div>
<p>Changes in the Outlook 2007 Security model that allow programmatic email sending "><span style="color:#000000;">Install the outlk12 template into a GPO applied to an OU where computers are located that you need&nbsp; mitigate this issue on.</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;">Configure the following setting&nbsp; User Configuration &gt; Administrative Templates &gt; Classic Administrative Templates &gt; Microsoft Office Outlook 2007 &gt; Security</span></div>
<div style="margin:0in 0in 0pt;"><span style="color:#000000;"when the Security Center reports AV status that is up to date / running
<a href="http://msdn.microsoft.com/en-us/library/bb226709(office.12).aspx">http://msdn.microsoft.com/en-us/library/bb226709(office.12).aspx</a>&nbsp;</p>

</div>
    
    
