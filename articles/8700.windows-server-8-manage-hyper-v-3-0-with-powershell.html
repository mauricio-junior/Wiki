---
layout: default
title: 'Windows Server 8 – Manage Hyper-V 3.0 with PowerShell - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<p>One of the major features of Windows Server 8 is Hyper-V 3.0 This new version of Microsoft virtualization platform brings great improvements and features.</p>
<p>In this article we’ll cover a couple of Windows Server 8 Hyper-V PowerShell command lets. Using PowerShell cmdlet will reduce most of day-to-day administrative tasks.
</p>
<p>Open Windows PowerShell ISE and begin with the first command:</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/commapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">Windows Server 8 – Manage Hyper-V 3.0 with PowerShell</h1>
    

    <div class="post-content user-defined-markup">

<p>One of the major features of Windows Server 8 is Hyper-V 3.0 This new version of Microsoft virtualization platform brings great improvements and features.</p>
<p>In this article we’ll cover a couple of Windows Server 8 Hyper-V PowerShell command lets. Using PowerShell cmdlet will reduce most ofunityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/4111.get_2D00_vm_5F00_777A1B96.png"><img title="get-vm" alt="get-vm" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/7725.get_2D00_vm_5F00_thumb_5F00_0DECBA1E.png" width="520" height="411" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p><strong>Get-VM</strong> cmdlet outputs all virtual machines that hosted on local Hyper-V server. As you see above, it warns us about missing columns. To get more user friendly output, use Format List
</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5672.get_2D00_vm_5F00_fl_5F00_3EBF4BBC.png"><img title="get-vm_fl" alt="get-vm_fl" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/0451.get_2D00_vm_5F00_fl_5F00_thumb_5F00_14FBD0C9.png" width="296" height="395" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p><strong>Get-VM</strong> will give you a general idea about virtual machine’s state. That means you can use filters to get specific virtual machine states.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/7220.get_2D00_vm_5F00_2_5F00_112E062C.png"><img title="get-vm_2" alt="get-vm_2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3678.get_2D00_vm_5F00_2_5F00_thumb_5F00_5CAD33E3.png" width="349" height="420" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>I used <strong>Get-VM</strong> cmdlet again but with pipeline and $_. special character. It filters the output to show me only virtual machines that status fields equal<span style="color:#ff0000;"> “Operating Normally”</span></p>
<p>Another helpful command is <strong>Checkpoint-VM</strong>. This cmdlet starts snapshot process for specified virtual machine.
</p>
<p>Try <strong>get-help</strong> to learn which syntax and parameters available for
<strong>CheckPoint-VM</strong></p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8461.checkpoint_5F00_gethelp_5F00_4C51BC2A.png"><img title="checkpoint_gethelp" alt="checkpoint_gethelp" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/1106.checkpoint_5F00_gethelp_5F00_thumb_5F00_17D0E9E2.png" width="405" height="340" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>I can use <strong>–name</strong> parameter to specify virtual machine. </p>
<p>Now firstly I used <strong>Get-VM</strong> to specify virtual machine and then pipe that information to
<strong>Checkpoint-VM</strong> cmdlet.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6403.checkpoint_5F00_5DB1F735.png"><img title="checkpoint" alt="checkpoint" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6864.checkpoint_5F00_thumb_5F00_30BC945A.png" width="401" height="441" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>As you notice, snapshot process began and finished.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2677.checkpoint_5F00_status_5F00_2E9F9591.png"><img title="checkpoint_status" alt="checkpoint_status" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6283.checkpoint_5F00_status_5F00_thumb_5F00_4D09D67A.png" width="396" height="438" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Well, what about reverting Virtual Machines to the previous checkpoints? You can check all snapshots for a specific virtual machine with
<strong>Get-VMSnapshot</strong> cmdlet. Required parameter is <strong>–VMName</strong>.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6874.get_2D00_vmsnapshot_5F00_722720E6.png"><img title="get-vmsnapshot" alt="get-vmsnapshot" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2063.get_2D00_vmsnapshot_5F00_thumb_5F00_28B4CC2B.png" width="404" height="374" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Now you have all checkpoint information for a specific VM. That means you can pipe this data to the
<strong>Restore-VMSnapshot</strong> cmdlet.</p>
<p>In below example I used another method to pipe required data. As you see I use
<strong>Get-VMSnapshot</strong> cmdlet’s name property as a <strong>Restore-VMSnapshot</strong> Name parameter.</p>
<p>But it gives me a confirm popup. </p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3632.restore_2D00_vmsnapshot_5F00_3EBB37BD.png"><img title="restore-vmsnapshot" alt="restore-vmsnapshot" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/0083.restore_2D00_vmsnapshot_5F00_thumb_5F00_4ADCB1E4.png" width="400" height="90" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>If you want to automate administrative tasks through PowerShell, you need to suppress some of confirm dialogs. It is possible with
<strong>–confirm</strong> parameter. </p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8422.restore_2D00_vmsnapshot2_5F00_0D6C4D5D.png"><img title="restore-vmsnapshot2" alt="restore-vmsnapshot2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3632.restore_2D00_vmsnapshot2_5F00_thumb_5F00_0C27B47E.png" width="549" height="22" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Restoring snapshot..</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6378.restore_2D00_vmsnapshot3_5F00_38D06E57.png"><img title="restore-vmsnapshot3" alt="restore-vmsnapshot3" src="http://blogs.tecnistrative tasks through PowerShell, you need to suppress some of confirm dialogs. It is possible with
<strong>–confirm</strong> parameter. </p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8422.restore_2D00_vmsnapshot2_5F00_0D6C4D5D.png"><img title="restore-vmsnapshot2" alt="restore-vmsnapshot2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3632.restore_2D00_vmsnapshot2_5F00_thumb_5F00_0C27B47E.png" width="549" height="22" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Restoring snapshot..</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6378.restore_2D00_vmsnapshot3_5F00_38hnet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/6443.restore_2D00_vmsnapshot3_5F00_thumb_5F00_10518C43.png" width="401" height="82" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Let’s look at other cmdlets. Networking is a major component of Hyper-V. <strong>
Get-VMNetworkAdaptor</strong> gives you network interface details of virtual machines.
</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5367.get_2D00_vmnetworkadapter_5F00_2EBBCD2C.png"><img title="get-vmnetworkadapter" alt="get-vmnetworkadapter" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/7002.get_2D00_vmnetworkadapter_5F00_thumb_5F00_5A8C211B.png" width="401" height="260" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Also you can use <strong>Get-VMSwitch</strong> to get Hyper-V network switch details.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/0181.get_2D00_vmswitch_5F00_6AB7E914.png"><img title="get-vmswitch" alt="get-vmswitch" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2046.get_2D00_vmswitch_5F00_thumb_5F00_42390700.png" width="407" height="85" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Let’s try to add another switch to Hyper-V. You need to specify physical network adapter name with
<strong>–NetAdapterName</strong> parameter.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5857.new_2D00_vmswitch_5F00_hata_5F00_47A777A4.png"><img title="new-vmswitch_hata" alt="new-vmswitch_hata" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3288.new_2D00_vmswitch_5F00_hata_5F00_thumb_5F00_1326A55C.png" width="411" height="241" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>As you see above, it couldn&#39;t find any related network adapter on local host. To learn your physical network adapter names just run
<strong>Get-Netadapter</strong>.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/0243.get_2D00_networkadaptor_5F00_02CB2DA3.png"><img title="get-networkadaptor" alt="get-networkadaptor" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/0068.get_2D00_networkadaptor_5F00_thumb_5F00_0EECA7CA.png" width="410" height="85" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2210.get_2D00_networkadaptor2_5F00_1B0E21F1.png"><img title="get-networkadaptor2" alt="get-networkadaptor2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/4846.get_2D00_networkadaptor2_5F00_thumb_5F00_2486E067.png" width="416" height="62" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>I assigned net adapter name which have a “UP” status value to a variable called
<span style="color:#0000ff;"><strong>$AdapterName.</strong></span></p>
<p>Now execute <strong>New-VmSwitch</strong> cmdlet again. But I gives me another error:</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2318.new_2D00_vmswitch_5F00_hata2_5F00_10F980C6.png"><img title="new-vmswitch_hata2" alt="new-vmswitch_hata2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3771.new_2D00_vmswitch_5F00_hata2_5F00_thumb_5F00_4F129B77.png" width="419" height="92" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>It says my physical network adapter is already in use. Let me check.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8176.get_2D00_vmswitch2_5F00_38041A3B.png"><img title="get-vmswitch2" alt="get-vmswitch2" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2703.get_2D00_vmswitch2_5F00_thumb_5F00_44259462.png" width="415" height="203" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Yeap. There is already a Hyper-V switch that uses my current physical adaptor and has a “External” switch type. I can convert that Hyper-V switch type from External to Private. That will let free my physical interface.(Wi-Fi)</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2768.set_2D00_vmswitch_5F00_61B76F61.png"><img title="set-vmswitch" alt="set-vmswitch" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3660.set_2D00_vmswitch_5F00_thumb_5F00_52345D92.png" width="420" height="98" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Now creating again.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8055.new_2D00_vmswitch_5F00_ekledi_5F00_5E55D7B9.png"><img title="new-vmswitch_ekledi" alt="new-vmswitch_ekledi" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5808.new_2D00_vmswitch_5F00_ekledi_5F00_thumb_5F00_4AC87818.png" width="425" height="74" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>You can check from Virtual Switch Manager. As you see a new switch added and bind to physical network card.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3757.hyper_2D00_v_2D00_swicth_2D00_ekran_5F00_140B1D14.png"><img title="hyper-v swicth ekranı" alt="hyper-v swicth ekranı" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/1106.hyper_2D00_v_2D00_swicth_2D00_ekran_5F00_thumb_5F00_4A98C858.png" width="422" height="396" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a><span class="hps"><br />
Also</span><span>, the management of</span> <span class="hps">PVLAN and ACLs</span>&nbsp;on Windows Server 8 Beta
<span class="hps">only through</span> <span class="hps">Powershell.</span></p>
<p>PowerShell can also be used to modify other virtual machine hardware components.
<strong>Add-VMHardDisk</strong> attaches virtual hard disk files (VHD/VHDX) to a VM as additional disks.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5383.add_2D00_vmharddisk_5F00_hata_5F00_35C6CFD8.png"><img title="add-vmharddisk_hata" alt="add-vmharddisk_hata" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5700.add_2D00_vmharddisk_5F00_hata_5F00_thumb_5F00_1A41CDD5.png" width="428" height="214" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>But of course firstly you have to create vhdx file separately. Use <strong>New-VHD</strong> cmdlet.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8117.new_2D00_vmdisk_5F00_69CB495E.png"><img title="new-vmdisk" alt="new-vmdisk" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/4073.new_2D00_vmdisk_5F00_thumb_5F00_1D270CBB.png" width="437" height="219" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Now you can assign previously created virtual hard disk to a specific VM.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/4478.add_2D00_vmharddisk_5F00_tamam_5F00_3405DE37.png"><img title="add-vmharddisk_tamam" alt="add-vmharddisk_tamam" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserveave to create vhdx file separately. Use <strong>New-VHD</strong> cmdlet.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/8117.new_2D00_vmdisk_5F00_69CB495E.png"><img title="new-vmdisk" alt="new-vmdisk" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/4073.new_2D00_vmdisk_5F00_thumb_5F00_1D270CBB.png" width="437" height="219" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Now you can assign previously created virtual hard disk to a specific VM.</p>
<p><a href="http://blogs.technet.com/cfs-file.ar-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/3005.add_2D00_vmharddisk_5F00_tamam_5F00_thumb_5F00_32C14558.png" width="439" height="42" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>Here is our newly added disk on Hyper-V manager.</p>
<p><a href="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/5047.hyper_2D00_v_2D00_disk_2D00_ekran_5F00_512B8641.png"><img title="hyper-v disk ekranı" alt="hyper-v disk ekranı" src="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-79-57-metablogapi/2476.hyper_2D00_v_2D00_disk_2D00_ekran_5F00_thumb_5F00_4AD489E6.png" width="430" height="412" style="border-width:0px;border-style:solid;padding-top:0px;padding-right:0px;padding-left:0px;display:inline;" /></a></p>
<p>There are bunch of commands that helps you to manage Hyper-V 3.0 on Windows Server 8. In my next blog I’ll cover them.</p>
<p>Thanks.</p>
<p>Anıl Erduran</p>

</div>
    
    
