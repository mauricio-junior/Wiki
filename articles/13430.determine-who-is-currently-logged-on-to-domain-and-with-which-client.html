---
layout: default
title: 'Determine Who is Currently Logged on to Domain and with which Client - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

Sometimes we need just find, where is user or on which client has user logged on!!<br />
There are a lot of things, scripts or 3rd-party tools.<br />
But, I use other thing, remember in this method, I do not neediv class="content-fragment-bottom fiji-content-fragment-bottom"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">Determine Who is Currently Logged on to Domain and with which Client</h1>
    

    <div class="post-content u Log file. I need just find user real time.<br />
<br />
I use DNS server and dnscmd.exe in a batch file as a user logon and logoff script in GPO. Remember, if you use x86 clients, you need dnscmd.exe from a Windows server x86 system (work on x64 systems too).<br />
In my TestLab, I have Windows server 2008 R2 as a domain controller with DNS server function, a Windows 7 x64 client and a Windows XP x86 client. Domain name is Contoso.com.<br />
<br />
1-&nbsp; Click <strong>Start</strong>, <strong>Administrative Tools</strong>, <strong>
DNS </strong>and open DNS console.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8473.1.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8473.1.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
2- Create a <strong>New Delegation</strong> in your current zone (My new delegation name is
<strong>Users</strong>). Right click on your <strong>Zone </strong>(my zone name&nbsp; is
<strong>Contoso.com</strong>) and select <strong>New Delegation</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0336.2.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0336.2.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
3- on <strong>Welcome to the New Delegation Wizard</strong> page, click <strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8877.3.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8877.3.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
4- On <strong>Delegated Domain Name</strong> page, write your<strong> Delegated domain</strong> name (in my case Users).<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/32276.4.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/32276.4.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
5- On<strong> Name Servers</strong> page, select <strong>Add</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3058.5.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3058.5.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
6- Add your DNS server (in my case DC.Contoso.com with IP address 192.168.0.1), then click
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1205.6.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1205.6.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
7- On <strong>Completing the New Delegation Wizard</strong> page, click <strong>Finish</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3755.7.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3755.7.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
8- Now you can see new delegation name.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0647.8.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0647.8.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
9- Now, we create new Zone (in my case, new zone name is Users.Contoso.com).<br />
<br />
10- Right click on <strong>Forward Lookup Zones</strong>, select <strong>New Zone</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7633.9.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7633.9.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
11- on <strong>Welcome to the New Zone Wizard</strong> page, click <strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4130.10.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4130.10.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
12- On <strong>Zone Type</strong> page, select<strong> Primary zone</strong>, then select
<strong>Store the zone in Active Directory (available only if DNS server is a writeable domain controller)</strong>, then click
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/10123.11.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/10123.11.png" style="border-width:0page, click <strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4130.10.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4130.10.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
12- On <strong>Zone Type</strong> page, select<strong> Primary zone</strong>, then select
<strong>Store the zone in Active Directory (available only if DNS server is a writeable domain controller)</strong>, then click
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/10123.11.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/0x;border-style:solid;" /></a><br />
<br />
13- On <strong>Active Directory Zone Replication Scope</strong> page, select <strong>
To all DNS servers running on domain controllers in this domain:</strong> (in my case domain name is Contoso.com), then select
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1157.12.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1157.12.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
14- On <strong>Zone Name</strong> page, type you <strong>Zone name:</strong> (in my case is Users.Contoso.com), then select
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.13.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.13.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
15- On <strong>Dynamic Update</strong> page, select <strong>Allow only secure dynamic updates</strong>, then select
<strong>Next</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8562.14.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8562.14.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
16- On <strong>Completing the New Zone Wizard</strong> page, check your setting, then click
<strong>Finish</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7455.15.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7455.15.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
17- You can see your new Zone name in DNS console (in my case Users.Contoso.com).<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5153.16.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5153.16.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
18- Now, I create a batch file with dnscmd.exe, also we create CNAME record for every user with logon script and delete this record with logoff script.<br />
<br />
19- Here is batch file for logon (for example: DNSLogon.cmd) and I use pushd and popd because I will run Dnscmd.exe from UNC path:<br />
<br />
<span style="font-family:courier new;color:#1f497d;"><strong>pushd &quot;%~dp0&quot;<br />
Dnscmd.exe DC.Contoso.com /recordadd Users.Contoso.com %USERNAME% CNAME %COMPUTERNAME%.Contoso.com</strong></span><br />
<span style="font-family:courier new;color:#1f497d;"><strong>popd</strong></span><br />
<br />
20- Here is batch file for logoff (for example: DNSLogoff.cmd):<br />
<br />
<span style="color:#1f497d;"><strong><span style="font-family:courier new;"><span style="font-family:courier new;color:#1f497d;"><strong>pushd &quot;%~dp0&quot;</strong></span><br />
Dnscmd.exe DC.Contoso.com /recorddelete Users.Contoso.com %USERNAME% CNAME %COMPUTERNAME%.Contoso.com /f</span></strong></span><br />
<span style="font-family:courier new;color:#1f497d;"><strong>popd</strong></span><br />
<br />
21- But wait!!!, on clients we do not have Dnscmd.exe command and I will not copy Dnscmd.exe on clients, I copy Dnscmd.exe in Logon and Logoff Script folders.<br />
<br />
22- Open <strong>Group Policy Management</strong> console.<br />
<br />
23- I edit Default Domain Policy (but remember, in real environment you must create new GPO).<br />
<br />
24- Right click on Default Domain Policy and select <strong>Edit</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7115.19.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7115.19.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
25- Go to <strong>User Configuration\Polices\Windows Settings\Scripts (Logon/Logoff)</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4807.20.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4807.20.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
26- Right click on <strong>Logon </strong>and select <strong>Properties</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4035.21.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4035.21.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
27- Select <strong>Add</strong>, select <strong>Browse </strong>and add your batch file (dnslogon.cmd) and copy Dnscmd.exe in this folder too.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5305.22.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5305.22.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5165.23.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5165.23.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
28- Click <strong>OK </strong>and close Logon Properties window.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2018.24.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2018.24.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
29- Same work for Logoff properties.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1212.25.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1212.25.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
30- Now, run <strong>GPUPDATE /FORCE</strong> on Domain Controller.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5861.26.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5861.26.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
31- Now, Open your DNS console again. Right click on DNS server name and select <strong>
Properties</strong>.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3817.27.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3817.27.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
32- Select <strong>Security</strong> tab, select <strong>Add</strong>, and add <strong>
Users </strong>group and set just <strong>Read </strong>permission (<em><strong>again just Read permission</strong></em>).<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4118.28.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4118.28.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.29.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7610.29.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
32- Open Regedit.exe on Domain Controller, go to<span style="font-family:courier new;"><strong> HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DNS\Parameters</strong></span> and set&nbsp; this registry keys:<br />
<br />
<span style="font-family:courier new;color:#4f81bd;"><strong>Key: RpcAuthLevel <br />
Value: 0x00000002<br />
<br />
Key: MaxCacheTtl<br />
Value: 0x00000001</strong></span><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1854.30.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1854.30.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Now, I test that configuration work or not.<br />
<br />
I use Windows XP client and logged on with Ed Price (ed.price) account and use Windows 7 client with Richard Mueller (r.mueller) account&nbsp;(both accounts are normal domain user account) .<br />
<br />
<a href="http://social.technet.microsoft.com/wLOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DNS\Parameters</strong></span> and set&nbsp; this registry keys:<br />
<br />
<span style="font-family:courier new;color:#4f81bd;"><strong>Key: RpcAuthLevel <br />
Value: 0x00000002<br />
<br />
Key: MaxCacheTtl<br />
Value: 0x00000001</strong></span><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1854.30.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1854.30.png" style="border-width:0px;border-style:solid;"iki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6507.31.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6507.31.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7558.32.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7558.32.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Now, we show DNS console, all users that logged on in domain have CNAME record:<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.33.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.33.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
I ping user names and I can find user on which client logged on!!<br />
<br />
Ed Price use WinXP with IP 192.168.0.25<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5367.34.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5367.34.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
OR, I can find Richard Mueller on which client logged on with NSLOOKUP command:<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7266.35.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7266.35.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
When user logged off, CNAME record deleted automatic with logoff batch file and you can find out that user is not logged on to domain.<br />
<br />
Now, Ed price logged off and CNAME record delted automatic.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5850.36.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5850.36.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3441.37.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3441.37.png" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Note: If your user did not correct logoff, CNAME record does not delete automatic. You must delete manually.

</div>
    
    
