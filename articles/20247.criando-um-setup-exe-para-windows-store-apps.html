---
layout: default
title: 'Criando um setup.exe para Windows Store Apps - artigos TechNet - Brasil (Português) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<p>Depois de meses trabalhando naquele app que o cliente pediu, finalmente ele está pronto para que o cliente o veja e dê sua opinião.</p>
<p>Isso, em qualquer outro tipo de projeto Windows seria fácil: um site ou aplicativo Silverlight é só questão de publicar em um servidor qualquer, um aplicativo Windows Forms ou WPF é só criar um click-once e o cliente já pode começar a criticar… quero dizer,
 apreciar o bom trabalho que você fez no aplicativo que ele pediu.</p>
<p>Mas, e em se tratando de um aplicativo Windows 8?</p>
<p>É inviável (e às vezes até impossível) publicar um aplicativo na Windows Store só para que o cliente o veja (para quem trabalha com Scrum por exemplo, vai entregar o app em pedaços até a última sprint). O jeito é fazer o tão conhecido “sideloading”, que
 consiste em alterar um monte de configurações do Windows, rodar um script Powershell, se autenticar na Windows Store para obter uma licença de developer até que enfim o aplicativo é instalado (somente para o administrador da máquina) para que o cliente possa
 ver.</p>
<p>Não seria melhor criar um setup.exe, onde o cliente clica em Próximo, Próximo, Concluir e o app simplesmente aparece no Menu Iniciar? Este post é justamente sobre como fazer isso.</p>
<h1><a name="Ferramentas_necessárias"></a><a name="Ferramentas_necessárias"></a>Ferramentas necessárias</h1>
<p>Sempre achei as ferramentas de setup do Visual Studio demasiadamente complicadas (ainda mais agora, no VS 2012 que só tem suporte para InstallShield Lite), mas, temos uma alternativa muito boa (inclusive para outros tipos de projeto): o INNO Setup.</p>
<p>O INNO Setup é um instalador feito em Pascal (então não há a necessidade de se ter instalado nenhum tipo de dependência na máquina, como o .net framework) que, através de um script (algo parecido com um arquivo .INI), pode realizar instalações simples ou
 até mesmo instalações super complexas (inclusive com suporte para scripts em Pascal).</p>
<p>O primeiro passo é puxar o compilador do Inno Setup (que nada mais é do que um editor de textos onde iremos escrever nosso script e pedir para ele transformar em um setup.exe):&nbsp;<a href="http://www.jrsoftware.org/isinfo.php">http://www.jrsoftware.org/isinfo.php</a></p>
<p>Clique no link&nbsp;<em>Download Inno Setup</em> e pegue a última versão (geralmente é o primeiro link encontrado na página, como mostra a imagem abaixo):</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/DownloadInnoSetup.png"><img alt=" " class="size-full wp-image-551 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/DownloadInnoSetup.png" width="800" height="600" /></a></p>
<p>Após o download, basta instalá-lo utilizando o bom e velho Next, Next, Finish.&nbsp;<strong>Importante:</strong>&nbsp;em algum momento, o instalador irá perguntar se deseja instalar um componente extra sobre&nbsp;<em>Inno Setup Preprocessor Directives</em>. Permita esta
 instalação pois isso poderá ser muito útil caso deseje colocar o compilador do Inno Setup em uma tarefa de build automatizada (como o build do Team Foundation, por exemplo).</p>
<p>Para facilitar a criação do script (e até mesmo para você utilizar isso mais facilmente em outros tipos de instalações ou seguir as recomendações de melhorias que darei aqui), iremos instalar uma segunda ferramenta que é um editor visual para os scripts
 do Inno Setup. Sem ele, você irá ler muitas e muitas linhas de documentação para fazer o que quer.</p>
<p>A ferramenta visual está no mesmo site, no menu lateral esquerdo, sob o nome de Thirdy-Party Files (arquivos de terceiros). Clique neste link e em seguida procure por
<em>Inno Script Studio:</em></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/DownloadInnoScriptStudio.png"><img alt=" " class="size-full wp-image-561 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/DownloadInnoScriptStudio.png" width="800" height="600" /></a></p>
<p>Da mesma forma, instale-o utilizando o Next, Next, Finish.</p>
<h1><a name="Empacotando_seu_aplicativo"></a>Empacotando seu aplicativo</h1>
<p>Para realizar a instalação, precisamos empacotar o aplicativo em questão. Isso é feito facilmente no próprio Visual Studio: basta abrir o solução do seu projeto,&nbsp;<strong>selecionar o projeto dentro da solução referente ao Windows Store App</strong>, e utilizar
 o menu indicado abaixo:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/VSCreatePackageMenu.png"><img alt=" " class="size-full wp-image-591  alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/VSCreatePackageMenu.png" width="800" height="600" /></a></p>
<p>Lembre-se: este menu é habilitado somente se no <em>Solution Explorer,&nbsp;</em>um projeto Windows Store App estiver selecionado! (Se o projeto atualmente selecionado for, por exemplo, uma biblioteca, este menu permanecerá desabilitado).</p>
<p>Ao clicar nesta opção, a seguinte janela será apresentada:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage1.png"><img alt=" " class="size-full wp-image-611 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage1.png" width="800" height="650" /></a></p>
<p>Basta selecionar a opção <em>No </em>(pois não estamos querendo criar um pacote que será submetido à Windows Store) e clicar em Next.</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage2.png"><img alt=" " class="size-full wp-image-621 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage2.png" width="800" height="650" /></a></p>
<p>O pacote será criado na pasta especificada neste segundo passo no assistente. Guarde bem o local desta pasta pois precisaremos destes arquivos depois.</p>
<p>Abaixo, você pode selecionar uma ou mais arquiteturas de processadores, bem como o tipo de build (release ou debug). Quando utilizamos alguma biblioteca exótica, o aplicativo deixa de funcionar no modo Neutral (Any CPU) e, como estamos fazendo um instalador
 para um Windows “normal”, podemos descartar a arquitetura ARM (pois esta é utilizada apenas em Tablets).</p>
<p>Eu pessoalmente fecho os pacotes para testes em clientes em modo Release (para ficar um pouco mais rápido) e em x64 (a menos que o cliente especificamente peça um pacote para rodar em um destes híbridos com processador x86 ATOM). Fica a seu critério aqui
 (incluindo a opção de incluir símbolos públicos, o que pode auxiliar na depuração e logs para encontrar problemas quando o aplicativo os apresentar).</p>
<p>O Inno Setup poderia facilmente criar uma opção no instalador para que o usuário selecionasse se deseja x86 ou x64, mas, para um usuário leigo (nosso cliente), isso é uma informação inútil e acarretaria em um setup com o dobro do tamanho (uma vez que temos
 2 releases sendo empacotados).</p>
<p>Ao clicar em&nbsp;<em>Create</em>, um build será invocado e, após concluído, seu pacote estará disponível na pasta especificada (e o assistente terminará com esta tela:)</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage3.png"><img alt=" " class="size-full wp-image-641 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/CreatePackage3.png" width="800" height="650" /></a></p>
<p>Neste momento, você poderá apenas clicar em OK para fechar a janela ou iniciar o&nbsp;<em>Windows App Certification Kit.</em> Irei comentar sobre ele no futuro, mas, basicamente, é um sistema que realiza uma série de testes em seu aplicativo para certificar que
 alguns pontos que provocam rejeições pela Windows Store estejam OK. Vale a pena rodar isso ao fechar uma release para saber se está tudo bem e evitar ter que realizar muito trabalho quando enviar o seu aplicativo para a Windows Store e ele ser rejeitado por
 um detalhe simples.</p>
<p>Lembra do caminho que pedi para que lembrasse? Pois é. Nele estão todos os arquivos de instalação de seu aplicativo e são estes arquivos que iremos incluir no setup:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/AppPackages.png"><img alt=" " class="size-full wp-image-651 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/AppPackages.png" width="657" height="404" /></a></p>
<h1><a name="Criando_o_script"></a>Criando o script</h1>
<p>Localize em seu menu iniciar o Inno Script Studio e inicie-o. Basta pressionar a tecla Windows e digitar “script studio” e você o verá facilmente (mas você já sabia como utilizar este atalho do Windows 8, não é?)</p>
<p>Ao abrir o Inno Script Studio, a janela de novo projeto será aberta. Neste ponto, basta dar OK para iniciar:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/NewScript.png"><img alt=" " class="size-full wp-image-581 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/NewScript.png" width="517" height="559" /></a></p>
<p>Agora um assistente iniciará um script básico com algumas informações sobre nosso aplicativo.</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno1.png"><img alt=" " class="size-full wp-image-681  alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno1.png" width="513" height="394" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno2.png"><img alt=" " class="size-full wp-image-691  alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno2.png" width="513" height="394" /></a></p>
<p>Neste passo podemos incluir algumas informações sobre nosso aplicativo (é sempre bom ler a documentação do Inno Setup, pois este editor visual é bem resumido).</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno3.png"><img alt=" " class="size-full wp-image-701  alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno3.png" width="513" height="394" /></a></p>
<p>Este passo é importante: um aplicativo Windows 8 deve ser instalado em uma pasta especial (e, na verdade, nem é o Inno Setup que irá fazer isso). Neste caso especial, não queremos criar nenhum tipo de pasta em Arquivos de Programas, então devemos selecionar
 a opção&nbsp;<em>O aplicativo não requer uma pasta.</em></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno4.png"><img alt=" " class="size-full wp-image-711  alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno4.png" width="513" height="394" /></a></p>
<p>Este passo serve para que você insira os arquivos que fazem parte do aplicativo, mas não iremos fazer isto neste momento. Basta clicar em
<em>Next</em> para ir para o próximo passo.</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno5.png"><img alt=" " class="size-full wp-image-721 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno5.png" width="513" height="394" /></a></p>
<p>Este é um passo interessante. Aqui, há 3 arquivos que podemos inserir como passos de nosso instalador para mostrar algumas informações para quem está instalando, como arquivo de licença (aqueles arquivos chatos que ninguém lê) e mensagens que podem ser inseridas
 antes e após a instalação do aplicativo.</p>
<p>Fica ao critério do desenvolvedor colocar o que desejar aqui (ou até mesmo ignorar isso). Eu pessoalmente colocaria um termo de uso (coisas como não fornecer o instalador a terceiros, estar ciente de que é uma versão beta, etc.).</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno6.png"><img alt=" " class="size-full wp-image-731 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno6.png" width="513" height="394" /></a></p>
<p>Neste passo, podemos escolher uma ou mais línguas em que o instalador irá operar. No contexto atual (dar um pacote instalável de um app Windows 8 para um cliente), creio que utilizar português seja o mais apropriado, mas você pode escolher quantas línguas
 desejar aqui (o instalador irá perguntar ao usuário em qual língua quer que a instalação prossiga, você já deve ter visto este tipo de instalação inúmeras vezes).</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno7.png"><img alt=" " class="size-full wp-image-741 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno7.png" width="513" height="394" /></a></p>
<p>Aqui podemos configurar onde nosso setup.exe será criado (<em>Custom compiler output directory</em>), o nome do instalador (setup irá gerar setup.exe) e podemos definir um ícone customizado e até mesmo proteger o setup com uma senha (para, por exemplo, certificar
 que apenas usuários com a senha possam instalar o aplicativo).</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Inno8.png"><img alt=" " class="size-full wp-image-751 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Inno8.png" width="513" height="394" /></a></p>
<p>Lembra o pacote adicional sobre diretivas de pré-processamento que a instalação do Inno Setup nos perguntou? Ele serve para criar algo como variáveis, o que facilita a edição do script (por exemplo, supondo que o nome do aplicativo seja repetido diversas
 vezes dentro do script, podemos criar uma diretiva com o nome do aplicativo e utilizar esta referência em diversos pontos. Ao mudar a definição, não precisamos nos preocupar em mudar o restante do script). Isto funciona exatamente como constantes nas linguagens
 de programação (const em C#).</p>
<p>Depois de todo este processo, temos um script básico para criar nosso instalador:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/InnoScriptStudio.png"><img alt=" " class="size-full wp-image-761 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/InnoScriptStudio.png" width="800" height="601" /></a></p>
<p>Agora precisamos refinar este script e inserir nosso aplicativo empacotado. Fique à vontade em ler a documentação do Inno Setup e explorar as opções disponíveis, pois irei explicar aqui somente o básico para montarmos nosso instalador.</p>
<p>Clique na seção <em>Files</em> do Inno Script Studio e clique no botão <em>New Item:</em></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/AddFile.png"><img alt=" " class="size-full wp-image-801 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/AddFile.png" width="530" height="555" /></a></p>
<p>Escolha o único arquivo que está na pasta que você escolheu para o Visual Studio criar o pacote da sua aplicação (hrocesso, temos um script básico para criar nosso instalador:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/InnoScriptStudio.png"><img alt=" " class="size-full wp-image-761 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/InnoScriptStudio.png" width="800" height="601" /></a></p>
<p>Agora precisamos refinar este script e inserir nosso aplicativo empacotado. Fique à vontade em ler a documentação do Inno Setup e explorar as opções disponíveis, pois irei explicar aqui somente o básico para montarmos nosso instalador.</p>
<p>Clique na seção <em>Files</em> do Inno Script Studio e á um arquivo com extensão .appxupload e uma pasta com vários arquivos, selecione apenas o arquivo .appxupload).</p>
<p>Certifique-se de que o caminho de destino (onde o instalador irá “instalar” este arquivo) seja {tmp} (na verdade, iremos apenas copiar o pacote do aplicativo para uma pasta temporária, utilizar os mecanismos apropriados para instalá-lo no Windows e depois
 apagar este pacote, então os arquivos não ficarão instalados de fato na máquina destino).</p>
<p>Precisamos colocar aquela pasta que está junto com o arquivo .appxupload. Para não deixar o script muito grande e confuso, podemos adicionar todo o conteúdo da pasta com apenas uma linha. Infelizmente, este procedimento não é muito fácil de fazer visualmente,
 então, clique na seção&nbsp;<em>Inno Setup Script</em> e altere o seu script conforme a imagem abaixo (note que os nomes das pastas e do aplicativo obviamente diferem do meu script nesta imagem do que você está fazendo em sua máquina agora):</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/FolderScript.png"><img alt=" " class="size-full wp-image-811 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/FolderScript.png" width="1880" height="793" /></a></p>
<p>O que fizemos aqui foi incluir a seguinte linha na seção [Files] do script:</p>
<pre class="prettyprint "><span class="typ">Source</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;C:TempAppInstalavelAppInstalavelAppPackagesAppInstalavel_1.0.0.0_x64_Test*.*&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">DestDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}AppInstalavel_1.0.0.0_x64_Test&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> ignoreversion recursesubdirs createallsubdirs</span></pre>
<p>Note que incluímos todos os arquivos e pastas do pacote, mas sem precisar criar uma linha para cada uma das pastas e arquivos, o que facilita a leitura e manutenção do script.</p>
<p>Agora temos que realizar uma configuração no Windows para que aplicativos possam ser instalados sem passar pela Windows Store. Normalmente, este passo implica em entrar como administrador e editar as políticas de segurança do Windows (usando o gpedit.msc).
 O instalador irá realizar a mesma função, mas alterando diretamente uma chave no registro do Windows.</p>
<p><strong>O instalador poderá ser utilizado mesmo por usuários que não sejam administradores da máquina</strong>, porém, há ao menos 2 passos que requerem esta elevação, o que não é um grande problema, visto que agora (finalmente) o Windows pode elevar um
 usuário comum à administrador temporariamente. Quando um usuário comum tentar utilizar este instalador, o Windows irá mostrar uma janela pedindo a senha de um usuário administrativo (que é o seu usuário normal, mesmo que seja um usuário com autenticação via
 internet (live)).</p>
<p>Você pode, depois que este instalador rodar ao menos uma vez em uma máquina, remover estes passos que requerem acesso administrativo, pois eles apenas preparam o ambiente. Fica ao seu critério facilitar ao máximo a vida do usuário ou proceder da forma mais
 segura (e precisar de uma autenticação de um administrador durante a instalação).</p>
<p>Há um outro detalhe neste ponto: quando uma máquina está sob um domínio (via Active Directory), esta configuração de segurança fica no AD e não na máquina local. Neste caso, você deverá seguir os procedimentos normais de habilitação de instalação de aplicativos
 sem a Windows Store através do domínio (a documentação sobre isso encontra-se aqui:
<a href="http://technet.microsoft.com/en-us/library/hh852635.aspx">http://technet.microsoft.com/en-us/library/hh852635.aspx</a>)</p>
<p>Para habilitarmos esta política de segurança no instalador, devemos criar ou alterar uma chave do registro do Windows (mais precisamente: HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Appx\AllowAllTrustedApps. Isso pode ser feito automaticamente
 pelo instalador (por isso a permissão administrativa) criando a chave na seção&nbsp;<em>Registry</em> do Inno Script Studio:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Registry.png"><img alt=" " class="size-full wp-image-841 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Registry.png" width="530" height="510" /></a></p>
<p>Esta linha de script se encarregará de criar a chave no registro para habilitar a política de segurança necessária. Certifique-se de clicar em
<em>createvalueifdoesntexist</em>, pois esta chave não existe no registro do Windows caso a política nunca tenha sido alterada antes.</p>
<p>Só para fins de comparação, esta chave de registro habilita uma política de segurança que é possível monitorar e alterar utilizando o comando
<em>gpedit.msc,</em>&nbsp;como abaixo:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/GPEnglish.png"><img alt=" " class="size-full wp-image-851 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/GPEnglish.png" width="866" height="537" /></a></p>
<p>Ou caso seu Windows esteja em português:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/GPPortuguese.png"><img alt=" " class="size-full wp-image-861 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/GPPortuguese.png" width="866" height="537" /></a></p>
<p>Agora precisamos criar dois arquivos&nbsp;<em>batch</em> para realizar duas funções separadas utilizando o PowerShell.</p>
<p>Em primeiro lugar, o PowerShell não executa scripts, por segurança. Aproveitando que estamos em um contexto de usuário elevado (administrador), vamos pedir ao PowerShell que libere esta função.</p>
<p>A razão dos dois scripts é que, caso a instalação do aplicativo ocorresse com o usuário administrativo, o aplicativo iria ser instalado somente para aquele usuário. O script que de fato instala o pacote no Windows 8 irá ser executado com o mesmo usuário
 que está autenticado na máquina (com as elevações administrativas removidas), permitindo assim que mesmo um usuário não administrativo possa rodar o aplicativo sem problemas.</p>
<p>Vamos então criar primeiramente um arquivo chamado PreparePS.cmd com o seguinte conteúdo:</p>
<pre class="prettyprint "><span class="tag">&lt;code</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">&quot;language-bat&quot;</span><span class="tag">&gt;</span><span class="pln">@Echo OFF<br />ECHO PREPARANDO AMBIENTE POWERSHELL<br />ECHO ==============================<br />CD %1<br />POWERSHELL -command set-executionpolicy unrestricted<br />ECHO Aguardando finalizacao do processo...<br />PING localhost &amp;gt; NULL<br /></span><span class="tag">&lt;/code&gt;</span></pre>
<p>Este comando, quando executado de forma elevada, remove as restrições de segurança de execução do PowerShell, executando o comando Set-ExecutionPolicy Unrestricted. (Maiores detalhes aqui:
<a href="http://go.microsoft.com/fwlink/?LinkID=135170">http://go.microsoft.com/fwlink/?LinkID=135170</a>)</p>
<p>O segundo arquivo se chama RunPS.cmd e será o responsável por instalar o aplicativo de fato:</p>
<pre class="prettyprint "><span class="tag">&lt;code</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">&quot;language-bat&quot;</span><span class="tag">&gt;</span><span class="pln">@Echo OFF<br />ECHO INSTALANDO APLICATIVO<br />ECHO =====================<br />CD %1<br />POWERSHELL .Add-AppDevPackage.ps1<br />ECHO Aguardando finalizacao do processo...<br />PING localhost &amp;gt; NULL<br /></span><span class="tag">&lt;/code&gt;</span></pre>
<p>Aqui apenas executamos um script PowerShell que foram criados automaticamente pelo Visual Studio durante o empacotamento do aplicativo, junto com uma pequena pausa no final, caso algum erro ocorra.</p>
<p>Salve estes dois arquivos na mesma pasta do seu pacote (no mesmo nível do arquivo .appxupload) e arraste-o para dentro da seção
<em>Files</em> do Inno Script Studio. Certifique-se de especificar como destino a pasta {tmp}, exatamente como foi feito para o arquivo .appxupload.</p>
<p>Agora vá até a seção&nbsp;<em>Install Run</em> e mande executar estes dois scripts com as configurações abaixo:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Run1.png"><img alt=" " class="size-full wp-image-911 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Run1.png" width="530" height="521" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Run2.png"><img alt=" " class="alignnone size-full wp-image-921" src="http://kodel.com.br/wp-content/uploads/2013/10/Run2.png" width="530" height="521" /></a></p>
<p>Preste atenção no&nbsp;<em>Working Directory</em>, que é o caminho da pasta temporária onde o script deverá ser executado e também na área roxa: o primeiro script roda como&nbsp;<em>runascurrentuser</em>, que significa rodar com o mesmo usuário que o instalador está
 utilizando (no nosso caso, um usuário administrativo elevado). O segundo script, no entanto, é importante rodar com o usuário originalmente autenticado na máquina (<em>runasoriginaluser</em>), afinal, estamos instalando o aplicativo para este usuário (e não
 para o administrador). Obviamente, se os dois usuários forem o mesmo, nada muda e tudo funciona normalmente.</p>
<h1><a name="Passos_finais"></a>Passos finais</h1>
<p>Tudo já está praticamente pronto, só precisamos agora dos procedimentos de limpeza e algum refinamento para evitar que exista um desinstalador do nosso aplicativo (lembrando: o setup não irá de fato instalar nada, serve apenas como um suporte para instalar
 um aplicativo da forma mais fácil possível para um usuário comum).</p>
<p>Na seção&nbsp;<em>Install Delete</em>, inclua todos os arquivos que foram adicionados pelo instalador na pasta {tmp}, para que não fique nenhum arquivo do pacote sujando a pasta temporária do usuário:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/DeleteInstall.png"><img alt=" " class="size-full wp-image-871 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/DeleteInstall.png" width="530" height="472" /></a></p>
<p>E, finalmente, as opções finais do instalador (acessíveis no botão&nbsp;<em>Setup Options</em> na barra de ferramentas do Inno Script Studio):</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Setup1.png"><img alt=" " class="size-full wp-image-881 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Setup1.png" width="720" height="521" /></a></p>
<p>Esta opção irá elevar o instalador ao ser executado (necessário para mudar a chave de registro e configurar as restrições de scripts do PowerShell).</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Setup2.png"><img alt=" " class="size-full wp-image-891 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Setup2.png" width="720" height="521" /></a></p>
<p>Finalmente, esta opção irá restringir a criação do desinstalador do nosso aplicativo (porque, na verdade, não instalamos nada na máquina, apenas copiamos o pacote, instalamos via powershell e depois o excluímos).</p>
<p>Você pode também criar um desinstalador que execute o comando de remoção do aplicativo via PowerShell (Remove-AppxPackage
<em>NomeDoPacote</em>) e que reverta as duas configurações de segurança que mudamos (uma no registro e outra no PowerShell). Com este editor visual, fica muito simples fazer isso.</p>
<h1><a name="O_script_final"></a>O script final</h1>
<p>Nosso script final ficou assim:</p>
<pre class="prettyprint "><span class="pun">;</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> generated </span><span class="kwd">by</span><span class="pln"> the </span><span class="typ">Inno</span><span class="pln"> </span><span class="typ">Setup</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="typ">Wizard</span><span class="pun">.</span><span class="pln"><br /></span><span class="pun">;</span><span class="pln"> SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES</span><span class="pun">!</span><span class="pln"><br /><br /></span><span class="com">#define</span><span class="pln"> </span><span class="typ">MyAppName</span><span class="pln"> </span><span class="str">&quot;App InstalÃ¡vel&quot;</span><span class="pln"><br /></span><span class="com">#define</span><span class="pln"> </span><span class="typ">MyAppVersion</span><span class="pln"> </span><span class="str">&quot;1.0&quot;</span><span class="pln"><br /></span><span class="com">#define</span><span class="pln"> </span><span class="typ">MyAppPublisher</span><span class="pln"> </span><span class="str">&quot;J.C.KÃ¶del&quot;</span><span class="pln"><br /></span><span class="com">#define</span><span class="pln"> </span><span class="typ">MyAppURL</span><span class="pln"> </span><span class="str">&quot;http://kodel.com.br/&quot;</span><span class="pln"><br /></span><span class="com">#define</span><span class="pln"> </span><span class="typ">MyAppExeName</span><span class="pln"> </span><span class="str">&quot;MyProg.exe&quot;</span><span class="pln"><br /><br /></span><span class="pun">[</span><span class="typ">Setup</span><span class="pun">]</span><span class="pln"><br /></span><span class="pun">;</span><span class="pln"> NOTE</span><span class="pun">:</span><span class="pln"> </span><span class="typ">The</span><span class="pln"> value of </span><span class="typ">AppId</span><span class="pln"> uniquely identifies </span><span class="kwd">this</span><span class="pln"> application</span><span class="pun">.</span><span class="pln"><br /></span><span class="pun">;</span><span class="pln"> </span><span class="typ">Do</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">use</span><span class="pln"> the same </span><span class="typ">AppId</span><span class="pln"> value </span><span class="kwd">in</span><span class="pln"> installers </span><span class="kwd">for</span><span class="pln"> other applications</span><span class="pun">.</span><span class="pln"><br /></span><span class="pun">;</span><span class="pln"> </span><span class="pun">(</span><span class="typ">To</span><span class="pln"> generate a </span><span class="kwd">new</span><span class="pln"> GUID</span><span class="pun">,</span><span class="pln"> click </span><span class="typ">Tools</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">Generate</span><span class="pln"> GUID inside the IDE</span><span class="pun">.)</span><span class="pln"><br /></span><span class="typ">AppId</span><span class="pun">=&#123;&#123;</span><span class="lit">74CF4D5B</span><span class="pun">-</span><span class="lit">59B2</span><span class="pun">-</span><span class="lit">45E0</span><span class="pun">-</span><span class="pln">ADD2</span><span class="pun">-</span><span class="lit">91DB59AB90E0</span><span class="pun">}</span><span class="pln"><br /></span><span class="typ">AppName</span><span class="pun">={</span><span class="com">#MyAppName}</span><span class="pln"><br /></span><span class="typ">AppVersion</span><span class="pun">={</span><span class="com">#MyAppVersion}</span><span class="pln"><br /></span><span class="pun">;</span><span class="typ">AppVerName</span><span class="pun">={</span><span class="com">#MyAppName} {#MyAppVersion}</span><span class="pln"><br /></span><span class="typ">AppPublisher</span><span class="pun">={</span><span class="com">#MyAppPublisher}</span><span class="pln"><br /></span><span class="typ">AppPublisherURL</span><span class="pun">={</span><span class="com">#MyAppURL}</span><span class="pln"><br /></span><span class="typ">AppSupportURL</span><span class="pun">={</span><span class="com">#MyAppURL}</span><span class="pln"><br /></span><span class="typ">AppUpdatesURL</span><span class="pun">={</span><span class="com">#MyAppURL}</span><span class="pln"><br /></span><span class="typ">CreateAppDir</span><span class="pun">=</span><span class="kwd">no</span><span class="pln"><br /></span><span class="typ">OutputDir</span><span class="pun">=</span><span class="pln">C</span><span class="pun">:</span><span class="typ">UsersJCKodelDesktopAppInstalavel</span><span class="pln"><br /></span><span class="typ">OutputBaseFilename</span><span class="pun">=</span><span class="pln">setup<br /></span><span class="typ">Compression</span><span class="pun">=</span><span class="pln">lzma<br /></span><span class="typ">SolidCompression</span><span class="pun">=</span><span class="pln">yes<br /></span><span class="typ">AllowCancelDuringInstall</span><span class="pun">=</span><span class="kwd">False</span><span class="pln"><br /></span><span class="typ">Uninstallable</span><span class="pun">=</span><span class="kwd">no</span><span class="pln"><br /><br /></span><span class="pun">[</span><span class="typ">Languages</span><span class="pun">]</span><span class="pln"><br /></span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;brazilianportuguese&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">MessagesFile</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;compiler:LanguagesBrazilianPortuguese.isl&quot;</span><span class="pln"><br /><br /></span><span class="pun">[</span><span class="typ">Files</span><span class="pun">]</span><span class="pln"><br /></span><span class="typ">Source</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;C:TempAppInstalavelAppInstalavelAppPackagesAppInstalavel_1.0.0.0_x64.appxupload&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">DestDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> ignoreversion<br /></span><span class="typ">Source</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;C:TempAppInstalavelAppInstalavelAppPackagesAppInstalavel_1.0.0.0_x64_Test*&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">DestDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}Cinemark_1.0.2.20_x64_Test&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> ignoreversion recursesubdirs createallsubdirs<br /></span><span class="typ">Source</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;C:TempAppInstalavelAppInstalavelAppPackagesRunPS.cmd&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">DestDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> ignoreversion<br /></span><span class="typ">Source</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;C:TempAppInstalavelAppInstalavelAppPackagesPreparePS.cmd&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">DestDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> ignoreversion<br /><br /></span><span class="pun">[</span><span class="typ">Registry</span><span class="pun">]</span><span class="pln"><br /></span><span class="typ">Root</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;HKLM&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Subkey</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;SoftwarePoliciesMicrosoftWindowsAppx&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">ValueType</span><span class="pun">:</span><span class="pln"> dword</span><span class="pun">;</span><span class="pln"> </span><span class="typ">ValueName</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;AllowAllTrustedApps&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">ValueData</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;1&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> createvalueifdoesntexist<br /><br /></span><span class="pun">[</span><span class="typ">Run</span><span class="pun">]</span><span class="pln"><br /></span><span class="typ">Filename</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}PreparePS.cmd&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">WorkingDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}AppInstalavel_1.0.0.0_x64_Test&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> waituntilterminated shellexec runascurrentuser</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Description</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Instalando app&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">StatusMsg</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Aguarde enquanto o aplicativo Ã© instalado&quot;</span><span class="pln"><br /></span><span class="typ">Filename</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}RunPS.cmd&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Parameters</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}AppInstalavel_1.0.0.0_x64_Test&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">WorkingDir</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}AppInstalavel_1.0.0.0_x64_Test&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Flags</span><span class="pun">:</span><span class="pln"> runasoriginaluser waituntilterminated shellexec</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Description</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Instalando app&quot;</span><span class="pun">;</span><span class="pln"> </span><span class="typ">StatusMsg</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;Aguarde enquanto o aplicativo Ã© instalado&quot;</span><span class="pln"><br /><br /></span><span class="pun">[</span><span class="typ">InstallDelete</span><span class="pun">]</span><span class="pln"><br /></span><span class="typ">Type</span><span class="pun">:</span><span class="pln"> filesandordirs</span><span class="pun">;</span><span class="pln"> </span><span class="typ">Name</span><span class="pun">:</span><span class="pln"> </span><span class="str">&quot;{tmp}&quot;</span></pre>
<h1><a name="Compilando_e_Testando"></a>Compilando e Testando</h1>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/CompileAndRun.png"><img alt=" " class="size-full wp-image-941 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/CompileAndRun.png" width="737" height="572" /></a></p>
<p>Agora é só clicar no primeiro botão destacado na imagem acima para compilar o script e no segundo botão para iniciar o setup para testes.</p>
<p>O primeiro botão apenas envia este script para o compilador de linha de comando do Inno Setup (percebeu que podemos colocar aqui um passo em um MSBUILD para gerar um pacote automaticamente durante um build?).</p>
<p>O segundo botão apenas roda o setup.exe que está na pasta que você configurou (no meu caso, no Desktop).</p>
<h1><a name="Instalação"></a><a name="Instalação"></a>Instalação</h1>
<p>A instalação geral começa de forma muito familiar:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install1.png"><img alt=" " class="size-full wp-image-951 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install1.png" width="513" height="399" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install2.png"><img alt=" " class="size-full wp-image-961 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install2.png" width="513" height="399" /></a></p>
<p>Depois dos arquivos copiados para a pasta temporária, o PowerShell assume. Você deve acompanhar o usuário na primeira instalação, caso ele não esteja acostumado ou confortável em utilizar um console para responder algumas perguntas:</p>
<p><a href="http://kodel.com.br/wp-content/uild?).</p>
<p>O segundo botão apenas roda o setup.exe que está na pasta que você configurou (no meu caso, no Desktop).</p>
<h1><a name="Instalação"></a><a name="Instalação"></a>Instalação</h1>
<p>A instalação geral começa de forma muito familiar:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install1.png"><img alt=" " class="size-full wp-image-951 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install1.png" width="513" height="399" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install2.png"><img alt=" " class="size-full wp-image-961 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install2.png" width="513" height="399" /></a></p>
<p>Depois dos arquivos copiados para a pasta uploads/2013/10/Install3.png"><img alt=" " class="alignnone size-full wp-image-971" src="http://kodel.com.br/wp-content/uploads/2013/10/Install3.png" width="997" height="643" /></a></p>
<p>Neste passo, o PowerShell irá instalar o certificado do aplicativo no armazém de certificados do Windows. O certificado é automaticamente criado pelo Visual Studio quando você cria um projeto Windows Store App, porém, é um certificado não reconhecido (também
 conhecido como&nbsp;<em>self-signed certificate</em>, o que significa que você mesmo está certificando que o aplicativo é válido, o que funciona somente em modo de desenvolvimento (daí aquela configuração de política de segurança para permitir a instalação de aplicativos
 com certificados inválidos)).</p>
<p>Note que aplicativos neste estado funcionam baseados em uma licença de desenvolvedor da Windows Store (exatamente a mesma que você utiliza para criar o aplicativo no Visual Studio). Certamente o seu cliente já está adiantado e já deu entrada na criação da
 conta da empresa na Windows Store e já tem um login live válido para obter uma licença de desenvolvedor. Caso não tenha feito isso, você poderá utilizar sua própria conta para obter uma licença de uso temporária para seu cliente (ou criar uma para ele):</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/get-developer-license-for-windows-8.png"><img alt=" " class="size-full wp-image-1001 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/get-developer-license-for-windows-8.png" width="650" height="402" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/developer-license-account-details.png"><img alt=" " class="size-full wp-image-1011 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/developer-license-account-details.png" width="650" height="402" /></a></p>
<p>E, finalmente (sério, finalmente mesmo desta vez), o PowerShell nos diz que tudo está OK e nosso aplicativo está instalado:</p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install4.png"><img alt=" " class="size-full wp-image-981 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install4.png" width="997" height="643" /></a></p>
<p><a href="http://kodel.com.br/wp-content/uploads/2013/10/Install5.png"><img alt=" " class="size-full wp-image-991 alignnone" src="http://kodel.com.br/wp-content/uploads/2013/10/Install5.png" width="301" height="311" /></a></p>
<h1><a name="Aprimoramentos"></a>Aprimoramentos</h1>
<p>Este script é um script bem simples que até pode ser utilizado para envios de releases para seus clientes, mas há muito o que fazer para aprimorá-lo e por isso é importante ler a documentação do Inno Setup, se familiarizar com o seu editor visual para criar
 uma experiência melhor para o usuário final.</p>
<p>Um dos aprimoramentos imediatos que pode ser feito facilmente é incluir o InnoSetup em seu processo de compilação (seja via MsBuild ou Team Foundation) para gerar o pacote automaticamente e disponibilizar isso em um FTP (ou mesmo versionado no TFS, que seu
 cliente tem acesso ao portal).</p>
<p>[Fonte:&nbsp;<a href="http://www.kodel.com.br/criando-instaladores-para-instalar-manualmente-windows-store-apps/">http://www.kodel.com.br/criando-instaladores-para-instalar-manualmente-windows-store-apps/</a>]</p>

</div>
    
    
