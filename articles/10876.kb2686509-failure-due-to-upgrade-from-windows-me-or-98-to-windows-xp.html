---
layout: default
title: KB2686509 - Failure Due to Upgrade from Windows ME or 98 to Windows XP - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

<strong><span style="text-decoration:line-through;">EDIT OF 6/19/2012:<br />
New Instructions:<br />
<span style="font-family:arial,sans-serif;coloer"></div></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom fiji-content-fragment-bottom"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">KB2686509 - Failure Due to Upgrade from Windows ME or 98 to Windows XP</h1>
    

    <div class="post-content user-defined-markup">r:#000000;">The FIX-ITâ€™s for this KB have been released today for this Security update. They are available for download at :&nbsp;</span></span><a href="http://support.microsoft.com/kb/2686509" style="font-family:arial,sans-serif;"><span style="text-decoration:line-through;">http://support.microsoft.com/kb/2686509</span></a><span style="text-decoration:line-through;"><span style="font-family:arial,sans-serif;color:#000000;">&nbsp;</span><br style="color:#000000;font-family:arial,sans-serif;" />
</span></strong><span style="text-decoration:line-through;"></span>
<ul style="color:#000000;font-family:arial,sans-serif;">
<span style="text-decoration:line-through;"></span>
<li><strong><span style="text-decoration:line-through;">To perform steps 1 through 3 in the &quot;</span><a href="http://support.microsoft.com/kb/2686509#LetMeFixItMyselfAlways" target="_blank"><span style="text-decoration:line-through;">Let me fix it myself</span></a><span style="text-decoration:line-through;">&quot;
 section, run&nbsp;Microsoft Fix it 50882. &nbsp;(&nbsp;</span><a href="http://go.microsoft.com/?linkid=9812279" target="_blank"><span style="text-decoration:line-through;">http://go.microsoft.com/?linkid=9812279</span></a><span style="text-decoration:line-through;">&nbsp;&nbsp;)</span></strong>
<span style="text-decoration:line-through;"></span></li><li><strong><span style="text-decoration:line-through;">To perform step 5 in the&nbsp;&quot;</span><a href="http://support.microsoft.com/kb/2686509#LetMeFixItMyselfAlways" target="_blank"><span style="text-decoration:line-through;">Let me fix it myself</span></a><span style="text-decoration:line-through;">&quot;
 section, run Microsoft Fix it 50883. &nbsp;(</span><a href="http://go.microsoft.com/?linkid=9812280" target="_blank"><span style="text-decoration:line-through;">http://go.microsoft.com/?linkid=9812280</span></a><span style="text-decoration:line-through;">)</span></strong>
</li></ul>
<p>Fixits do not appear to work with this particular update failure.&nbsp; Please continue to use the manual instructions below.</p>
<ul style="color:#000000;font-family:arial,sans-serif;">
</ul>
<hr />
<br />
<br />
For those people posting to the <a href="http://answers.microsoft.com/thread/0deeacb6-115c-419d-ac37-03ff8927b79c" target="_blank">
<span style="color:#00749e;">http://answers.microsoft.com/thread/0deeacb6-115c-419d-ac37-03ff8927b79c
<img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" style="border-width:0px;border-style:solid;" />
</span></a>thread who upgraded from Windows ME or 98 to XP, this action left behind leftovers of keyboard mappings that are Windows ME or 98 related.&nbsp; As a result the patch will fail.&nbsp; I&#39;ve typed up this visual how-to to make it a bit easier. Please note this
 is only one of three different errors types I&#39;ve seen so if this doesn&#39;t fit your exact failure type, I will be attempting to document all three I&#39;ve seen people report.<br />
<br />
If you remapped a keyboard key, review <a href="http://social.technet.microsoft.com/wiki/contents/articles/10829.kb2686509-failure-due-to-remapping-of-a-key.aspx">
this post</a>.&nbsp; If you can&#39;t find the dll&#39;s mentioned in the faultykeyboard.log file, review
<a href="http://social.technet.microsoft.com/wiki/contents/articles/10880.kb2686509-failure-due-to-missing-dll-files.aspx">
this post</a>.<br />
<br />
You have a Windows XP that was once a Windows ME or Windows 98.&nbsp; You go to install&nbsp;<a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;2686509">KB2686509</a> it fails with 0x8007F0F4 error.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8765.Winxpfail.PNG"><img alt=" " width="406" height="305" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8765.Winxpfail.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
Or you may see a message like this:<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.setupfail.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7180.setupfail.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
<br />
You DO have a log file anywhere on your PC called faultykeyboard.log file.&nbsp; This should be in the c:\windows folder.&nbsp;
<br />
The contents of the log file looks like this:<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8867.faultylog.PNG"><img alt=" " width="307" height="662" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8867.faultylog.PNG" style="border-width:0px;border-style:solid;width:213px;height:301px;" /></a><br />
<br />
And the details of the log file are (or are similar with the .kbd file extension)<br />
kbdsp.kbd<br />
kbdsp.kbd<br />
kbdno.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdus.kbd<br />
kbdla.kbd<br />
kbdus.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdla.kbd<br />
kbdycl.kbd<br />
<br />
If this is your symptoms, see if following this will get KB2686509 installed.<br />
<br />
Step one, go to your Windows XP and click on the start button, then on run<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8306.startrun.PNG"><img alt=" " width="329" height="135" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8306.startrun.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Then in the run box type in regedit.<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6708.regedit.PNG"><img alt=" " width="418" height="216" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6708.regedit.PNG" style="border-width:0px;border-style:solid;" /></a><br />
Now drill down the listing you see there and find a specific registry key.<br />
<br />
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts<br />
<br />
Go to HKEY_LOCAL_MACHINE.&nbsp; Under there find System and click on the &quot;&#43;&quot; to expand the location.&nbsp; Now find a key called Curr9" height="135" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8306.startrun.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Then in the run box type in regedit.<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6708.regedit.PNG"><img alt=" " width="418" height="216" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6708.regedit.PNG" style="border-width:0px;border-style:solid;" /></a><br />
Now drill down the listing you see there and find a specific registry key.<br />
<br />
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts<br />
<br />
Go to HKEY_LOCentControlSet and expand that by clicking the &quot;&#43;&quot; .&nbsp; Now scroll down and find the registry key Control and again click on the &quot;&#43;&quot;.&nbsp; Now
 find the key called Keyboard Layouts.<br />
Right mouse click and export this file to a place on your computer like My documents.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2308.exportreg.PNG"><img alt=" " width="406" height="502" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2308.exportreg.PNG" style="border-width:0px;border-style:solid;width:292px;height:367px;" /></a><br />
Save this key in a place where you can find it again, like My documents<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2388.keyboard2.PNG"><img alt=" " width="503" height="391" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2388.keyboard2.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Now that you&#39;ve exported this value, open up the file in notepad.<br />
Right mouse click the file, and click on open with notepad.&nbsp; Click on Edit, then on Find Next (or hit f3) and put in one at a time, the listing of the kbd files found in your faultykeyboard registry file.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2425.kbdfind.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2425.kbdfind.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
Delete the entire entry that contains this kbd file in this registry file and delete them. Notice that some are there multiple times, and you have to delete each instance.<br />
<br />
Go back to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layouts
<p>And save the original keyboard layouts file with a different name.&nbsp; You can, for example, add a 1 to the registry file name so you have a backup.&nbsp; Now delete everything under the keyboard layouts key.&nbsp; Now save the edited regsitry file of Keyboard Layouts
 (the original file name)&nbsp;into&nbsp;to the registry.&nbsp; You can click on the file and it will reimport it into the registry replacing the kbd files in the registry.&nbsp; (Please note that you may see this under Keyboard Layout (singular) - as well).</p>
<p>Now reboot your Windows XP.<br />
Now attempt to install KB2686509 again either via manual download going to <a href="http://www.microsoft.com/en-us/download/details.aspx?id=29804">
http://www.microsoft.com/en-us/download/details.aspx?id=29804</a>&nbsp;and downloading from there or using Windows update again.&nbsp; It now should complete successfully.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3426.kbin.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3426.kbin.PNG" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6708.regedit.PNG"></a><br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8306.startrun.PNG"></a>If these instructions do not work for a Windows ME or Windows 98 upgraded to a Windows XP, please post back on
 the <a href="http://answers.microsoft.com/thread/0deeacb6-115c-419d-ac37-03ff8927b79c">
http://answers.microsoft.com/thread/0deeacb6-115c-419d-ac37-03ff8927b79c</a>&nbsp;thread with your exact problem.<br />
<br />
<br />
</p>

</div>
    
    