---
layout: default
title: BizTalk, Work Flow (WF) & Windows Communication Foundation (WCF)&#58; Combining functionality - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

<hr />
<p>&nbsp;</p>
<p><img width="378" height="188" alt="BizTalk Server 2010" src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6153.BTS2010Logo.png" /></p>
<h1><a name="Summary"></a>Summary</h1>
<p>All versions of BizTalk Server use a publish/subscribe messaging engine architecture. In a publish/subscribe architecture, all messages that flow through BizTalk Server are first published to the MessageBox database and subsequently picked up by Send Ports,
 Receive Ports, or Orchestrations that are decorated with matching subscription information. One of the primary advantages of a publish/subscribe architecture is that receiving of messages is loosely coupled from sending of messages and messages can be published
 even if there are no subscribers available to process messages when they are published. Other advantages include the ability to track message properties, messages bodies, and to resubmit messages that initially failed delivery to subscribers.</p>
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4442.image1.png" style="border:0px solid currentcolor;" /></p>
<p><strong>Figure 1 - BizTalk Server Publish Subscribe architecture</strong></p>
<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Summary">Summary</a></li><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#Who_Should_Read_This_Whitepaper">Who Should Read This Whitepaper?</a></li><li class="hierarchy-item"><a href="#Software_installed_for_the_BizTalk_WF_WCF_walkthrough">Software installed for the BizTalk/WF/WCF walkthrough</a></li><li class="hierarchy-item"><a href="#B">Building a WCF solution that uses the BizTalk WCF SQL Adapter and the BizTalk Mapper to copy records from one database to another</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Install_all_prerequisite_software_and_install_the_NorthWind_database">Install all prerequisite software and install the NorthWind database</a></li><li class="hierarchy-item"><a href="#A">Create the WCF Solution and a WCF Workflow Service Application in Visual Studio 2010</a></li><li class="hierarchy-item"><a href="#Create_variables_to_contain_the_SQL_query_results_and_BizTalk_Map_output">Create variables to contain the SQL query results and BizTalk Map output</a></li><li class="hierarchy-item"><a href="#Apply_properties_to_the_SelectActivity_and_InsertActivity_items">Apply properties to the SelectActivity and InsertActivity items</a></li><li class="hierarchy-item"><a href="#Add_a_BizTalk_Map_to_the_WCF_BTS_APP_Project">Add a BizTalk Map to the WCF_BTS_APP Project</a></li><li class="hierarchy-item"><a href="#Publish_the_WCF_Solution_to_IIS">Publish the WCF Solution to IIS</a></li><li class="hierarchy-item"><a href="#Create_and_launch_a_console_application_to_test_the_published_WCF_Service_and_verify_that_the_WCF_SQL_Adapter_is_updating_the_NorthWind_database_as_expected">Create and launch a console application to test the published WCF Service and verify
 that the WCF SQL Adapter is updating the NorthWind database as expected.</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#See_Also">See Also</a></li></ul><div class="hierarchy-list-footer"> </div></div>
<p>One potential drawback of the BizTalk Server Publish/Subscribe architecture is that because all messages flow through the MessageBox database, under high load scenarios the MessageBox database(s) may encounter file I/O contention which can negatively impact
 performance.&nbsp; While this is not problematic for most BizTalk Server scenarios, this may become an issue for BizTalk Server scenarios where low latency is a desirable attribute of the solution.</p>
<p>This document provides .NET/WorkFlow developers with techniques for utilizing AppFabric and BizTalk Server 2010 together to develop low latency connectivity solutions to LOB systems.&nbsp; Such solutions allow front end applications built on ASP.NET, SharePoint,
 or Web Services to exchange messages with multiple backend systems and respond to user initiated requests quickly.</p>
<h1><a name="Introduction"></a>Introduction</h1>
<p>This whitepaper provides information on using BizTalk Server and WF/WCF together by illustrating to BizTalk and Workflow developers how to combine functionality from both in a Visual Studio 2010 project.&nbsp; The project is a simple workflow that leverages the
 BizTalk Server Mapper and LOB Adapter functionality.&nbsp; </p>
<p>Because this project does not use the BizTalk Messaging Engine it will provide improved latency over a pure BizTalk Server solution while still utilizing BizTalk Server functionality.
</p>
<p>Since Visual Studio 2010 can access the BizTalk Mapping and WCF LOB connectivity APIs, this whitepaper also illustrates how WorkFlow developers can now access BizTalk Mapper functionality to implement document transformations and complete WCF LOB connectivity
 without having to first configure a BizTalk Server environment.</p>
<h1><a name="Who_Should_Read_This_Whitepaper"></a>Who Should Read This Whitepaper?</h1>
<p>The following users should read this guide:</p>
<ul>
<li>.NET and WF developers that would like to leverage BizTalk Server Mapper and LOB Adapter functionality in their workflows.
</li><li>BizTalk Developers that seek alternatives to currently available techniques for developing certain optimal latency solutions.&nbsp;
</li></ul>
<h1><a name="Software_installed_for_the_BizTp>Because this project does not use the BizTalk Messaging Engine it will provide improved latency over a pure BizTalk Server solution while still utilizing BizTalk Server functionality.
</p>
<p>Since Visual Studio 2010 can access the BizTalk Mapping and WCF LOB connectivity APIs, this whitepaper also illustrates how WorkFlow developers can now access BizTalk Mapper functionality to implement document transformations and complete WCF LOB connectivity
 without having to first configure a BizTalk Server environment.</p>
<h1><a name="Who_Should_Read_This_Whitepaper"></a>Who Should Read This Whitepaper?</h1>
<p>The following users should read this guide:</p>
<ul>
<li>.NET and WF developers that would like to leverage BizTalk Server Mapper and LOB Adapter functionality in their workflows.
</li><li>Bialk_WF_WCF_walkthrough"></a>Software installed for the BizTalk/WF/WCF walkthrough</h1>
<p>All software was installed on a single machine using the steps provided at <a href="http://social.technet.microsoft.com/wiki/contents/articles/installing-the-biztalk-server-2010-appfabric-connect-feature.aspx#InstDev">
Installing the BizTalk Server 2010 AppFabric Connect feature on a developer computer</a> (http://social.technet.microsoft.com/wiki/contents/articles/installing-the-biztalk-server-2010-appfabric-connect-feature.aspx#InstDev). For purposes of this walkthrough,
 both the <a href="http://social.technet.microsoft.com/wiki/contents/articles/installing-the-biztalk-server-2010-appfabric-connect-feature.aspx#InstDevReq">
Required</a> and <a href="http://social.technet.microsoft.com/wiki/contents/articles/installing-the-biztalk-server-2010-appfabric-connect-feature.aspx#InstDevOpt">
Optional</a> components were installed.</p>
<h1><a name="B"></a>Building a WCF solution that uses the BizTalk WCF SQL Adapter and the BizTalk Mapper to copy records from one database to another</h1>
<p>This section provides a walkthrough of using Visual Studio 2010 with BizTalk Server 2010 and the BizTalk Adapter Pack to develop a simple WCF solution which uses the WCF SQL Adapter to retrieve some records from the &quot;Customers&quot; table in the &quot;NorthWind&quot; database,
 apply a simple map to the selected records, and then update a modified version of the &quot;Customers&quot; table (&quot;Customers2&quot;) in a modified version of the &quot;Northwind&quot; database (&quot;Northwind2&quot;).&nbsp; To build and run the solution, follow these steps:</p>
<h2><a name="Install_all_prerequisite_software_and_install_the_NorthWind_database"></a>Install all prerequisite software and install the NorthWind database</h2>
<p>After installing all software, download the scripts to install the NorthWind database on your SQL Server instance from
<a href="http://go.microsoft.com/fwlink/?LinkID=62009">http://go.microsoft.com/fwlink/?LinkID=62009</a>.</p>
<p class="auto-style11"><span class="auto-style2"><strong>Note</strong></span> Ensure that your user account is member of the serveradmin role on this instance of SQL Server.</p>
<p>After following the instructions to install the NorthWind database on your SQL Server instance, paste the following script into the SQL Query Editor to add a &quot;Customers2&quot; table to the NorthWind database:</p>
<div class="reCodeBlock">
<div style="background-color:white;"><span><code style="color:black;">USE [Northwind]</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:black;">GO</code></span></div>
<div style="background-color:white;"><span><code style="color:black;">/****** Object:&nbsp;
</code><code style="color:cornflowerblue;font-weight:bold;">Table</code> <code style="color:black;">
[dbo].[Customers2]******/</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:cornflowerblue;font-weight:bold;">SET</code>
<code style="color:black;">ANSI_NULLS </code><code style="color:cornflowerblue;font-weight:bold;">ON</code></span></div>
<div style="background-color:white;"><span><code style="color:black;">GO</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:cornflowerblue;font-weight:bold;">SET</code>
<code style="color:black;">QUOTED_IDENTIFIER </code><code style="color:cornflowerblue;font-weight:bold;">ON</code></span></div>
<div style="background-color:white;"><span><code style="color:black;">GO</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:cornflowerblue;font-weight:bold;">CREATE</code>
<code style="color:cornflowerblue;font-weight:bold;">TABLE</code> <code style="color:black;">
[dbo].[Customers2](</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:black;">[CompanyName] [nvarchar](100)
</code><code style="color:gray;">NOT</code> <code style="color:gray;">NULL</code><code style="color:black;">,</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">[Address] [nvarchar](100)
</code><code style="color:gray;">NULL</code><code style="color:black;">)</code></span></div>
<div style="background-color:white;"><span><code style="color:black;">GO</code></span></div>
</div>
<h2><a name="A"></a>Create the WCF Solution and a WCF Workflow Service Application in Visual Studio 2010</h2>
<ol>
<li>Click <strong>Start</strong> and then click <strong>Microsoft Visual Studio 2010</strong>.
</li><li>Click the <strong>File</strong> menu, click <strong>New</strong> and then click
<strong>Project</strong> to display the <strong>New Project</strong> dialog box. </li><li>In the left-hand pane of the <strong>New Project</strong> dialog box select <strong>
Workflow</strong> and in the middle pane click to select <strong>WCF Workflow Service Application</strong>.
</li><li>Enter a name for the solution and project such as <strong>WCF_BTS_APP</strong> and then click
<strong>OK</strong>.
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/8712.image2.png" style="border:0px solid currentcolor;" />
</p>
<p><strong>Figure 2 - Visual Studio 2010 New Project Dialog Box</strong></p>
</li><li>Select the Sequential Service that is displayed in the designer pane and delete it as it will be replaced with a new Sequence shape.
</li><li>Drag and drop a <strong>Sequence</strong> shape from the toolbox to the center of Service1.xamlx, the result should look similar to the following:
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/0257.image3.png" style="border:0px solid currentcolor;" />
</p>
<p><strong>Figure 3 - Visual Studio 2010 Service1.xamlx as viewed in Designer</strong></p>
</li><li>Drag and drop a <strong>Receive</strong> shape from the toolbox onto the Sequence shape that is displayed in the designer pane, the Receive shape is available on the Messaging tab of the toolbox.
</li><li>Right-click the Receive shape and select <strong>Properties</strong> from the context menu.
</li><li>In the Properties for the Receive shape set the <strong>OperationName</strong> to
<strong>ExtractTransformLoad</strong>, the <strong>ServiceContractName</strong> property to
<strong>IinitializeSvc, </strong>verify that the <strong>CanCreateInstance</strong> checkbox is selected and verify that the
<strong>SerializerOption</strong> is set to <strong>DataContractSerializer</strong>.
</li><li>Click to select the <strong>WCF_BTS_APP</strong> project in the Solution Explorer, right-click to display the context menu and click to select
<strong>Add Adapter Service Reference</strong> to display the Add Adapter Service Reference dialog box.&nbsp; This is where the code to invoke the WCF SQL Adapter is added to the project.&nbsp; Enter the following values to populate the Add Adapter Service Reference
 dialog box and click <strong>OK</strong>.
<ol>
<li>For <strong>Select a binding</strong>: choose <strong>sqlBinding</strong> </li><li>For <strong>Configure a URI</strong>: enter <strong>mssql://localhost//NorthWind</strong>
</li><li>Click the <strong>Connect</strong> button to establish a connection to the NorthWind database
</li><li>Under <strong>Select contract type</strong> verify that <strong>Client (Outbound operations)</strong> is selected
</li><li>In the <strong>Select a category:</strong> section click to expand <strong>Tables</strong> and select the
<strong>[dbo].[Customers]</strong> table </li><li>In the <strong>Available categories and operations:</strong> section, select the
<strong>Select</strong> operation and then click the <strong>Add</strong> button </li><li>In the <strong>Select a category:</strong> section select the <strong>[dbo].[Customers2]
</strong>table </li><li>In the <strong>Available categories and operations:</strong> section, select the
<strong>Insert</strong> category and then click the <strong>Add </strong>button </li></ol>
</li><li>
<p>Verify that the <strong>Add Adapter Service Reference</strong> dialog box is populated with the following values and click the
<strong>OK</strong> button.</p>
<p><span style="font-size:small;"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/3582.image4.png" style="border:0px solid currentcolor;" /></span></p>
<p><strong>Figure 4 - Visual Studio 2010 Add Adapter Service Reference dialog box</strong></p>
<p><strong></strong></p>
<p><strong>Note </strong>If you installed the BizTalk&nbsp;Adapter Pack 2.0 on a 64-bit machine and you received the error message &quot;No valid adapters installed on the machine&quot;,&nbsp;then ensure that the 32-bit version of the BizTalk Adapter Pack 2.0 is also installed.
 Both the 64-bit and 32-bit versions of the BizTalk Adapter Pack 2.0 are available for download at
<a href="http://go.microsoft.com/fwlink/?LinkId=194572">http://go.microsoft.com/fwlink/?LinkId=194572</a> (<a href="http://go.microsoft.com/fwlink/?LinkId=194572">http://go.microsoft.com/fwlink/?LinkId=194572</a>).</p>
</li><li>
<p>In the Solution Explorer, right-click the <strong>WCF_BTS_APP</strong> project and select
<strong>Build</strong> from the context menu. After building this project with the new adapter service references the Visual Studio 2010 toolbox should expose two additional tabs;
<strong>mssql:TableOp_dbo_Customers</strong> and <strong>mssql:TableOp_dbo_Customers2</strong>. The mssql:TableOp_dbo_Customers tab will expose a
<strong>SelectActivity</strong> and the mssql:TableOp_dbo_Customers2 tab will expose an
<strong>InsertActivity</strong>:</p>
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4670.image5.png" style="border:0px solid currentcolor;" /></p>
<p><stref="http://go.microsoft.com/fwlink/?LinkId=194572">http://go.microsoft.com/fwlink/?LinkId=194572</a> (<a href="http://go.microsoft.com/fwlink/?LinkId=194572">http://go.microsoft.com/fwlink/?LinkId=194572</a>).</p>
</li><li>
<p>In the Solution Explorer, right-click the <strong>WCF_BTS_APP</strong> project and select
<strong>Build</strong> from the context menu. After building this project with the new adapter service references the Visual Studio 2010 toolbox should expose two additional tabs;
<strong>mssql:TableOp_dbo_Customers</strong> and <strong>mssql:TableOp_dbo_Customers2</strong>. The mssql:TableOp_dbo_Customers tab will expose a
<strong>SelectActivity</strong> and the mssql:TableOp_dbo_Customers2 tab will expose an
<strong>InsertActivity</strong>:</p>
<p><img alt=" " src="http://ong>Figure 5 - Visual Studio 2010 Toolbox Tabs added after adding SQL Adapter service references</strong></p>
</li><li>Click and drag the SelectActivity and the InsertActivity from the toolbox onto the
<strong>Sequence</strong> shape that is displayed in the designer pane:
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6327.image6.png" style="border:0px solid currentcolor;" /></p>
<p><strong>Figure 6 - Sequence shape with Receive shape, SelectActivity shape and InsertActivity shape as viewed in the Designer</strong></p>
<p>These activities are visual representations of the logic that will be used to select records from the Customers table in the NorthWind database and after performing a BizTalk mapping operation on the selected records, insert the result set into the Customers2
 table in the NorthWind database. Before we can apply any operations to the selected data or insert the result set we must first define a query for the select activity, and define variables to contain both the selected data as input into a BizTalk map as well
 as the data that is output from the BizTalk map.</p>
</li></ol>
<h2><a name="Create_variables_to_contain_the_SQL_query_results_and_BizTalk_Map_output"></a>Create variables to contain the SQL query results and BizTalk Map output</h2>
<ol>
<li>Click <strong>Variables</strong> in the bottom right-hand corner of the Designer to invoke the
<strong>Create Variable</strong> option in the Designer. </li><li>Click <strong>Create Variable</strong> to display a row in the Designer that accepts inputs for Name, Variable type, Scope, and Default. Create two variables with the following values:
<table class="telerik-reTable-2" cellspacing="0" cellpadding="0" style="width:650px;height:128px;">
<tbody>
<tr class="telerik-reTableHeaderRow-2">
<td align="center" class="telerik-reTableHeaderEvenCol-2" style="width:50px;"><span style="font-family:&#39;Segoe UI&#39;;"><strong>Name</strong></span></td>
<td align="center" class="telerik-reTableHeaderOddCol-2" style="width:375px;"><span style="font-family:&#39;Segoe UI&#39;;"><strong>Variable Type</strong></span></td>
<td align="center" class="telerik-reTableHeaderEvenCol-2" style="width:131px;"><span style="font-family:&#39;Segoe UI&#39;;"><strong>Scope</strong></span></td>
<td align="center" class="telerik-reTableHeaderOddCol-2" style="width:160px;"><span style="font-family:&#39;Segoe UI&#39;;"><strong>Default</strong></span></td>
</tr>
<tr class="telerik-reTableOddRow-2">
<td class="telerik-reTableEvenCol-2" valign="top" style="width:50px;height:70px;">
<span style="font-family:&#39;Segoe UI&#39;;">data1</span></td>
<td class="telerik-reTableOddCol-2" valign="top" style="width:375px;"><span style="font-family:&#39;Segoe UI&#39;;">Click to select Array of &lt;T&gt; and from the
<strong>Select Types</strong> dialog box browse to select the <strong>Type Name:</strong> of schemas.microsoft.com.Sql._2008._05.Types.Tables.dbo.Customers</span></td>
<td class="telerik-reTableEvenCol-2" valign="top" style="width:131px;height:70px;">
<span style="font-family:&#39;Segoe UI&#39;;">Leave at default value</span></td>
<td class="telerik-reTableOddCol-2" valign="top" style="width:160px;height:70px;">
<span style="font-family:&#39;Segoe UI&#39;;">Leave at default value</span></td>
</tr>
<tr class="telerik-reTableEvenRow-2">
<td class="telerik-reTableEvenCol-2" valign="top" style="width:50px;height:71px;">
<span style="font-family:&#39;Segoe UI&#39;;">data2</span></td>
<td class="telerik-reTableOddCol-2" valign="top" style="width:375px;height:71px;">
<span style="font-family:&#39;Segoe UI&#39;;">Click to select Array of &lt;T&gt; and from the <strong>
Select Types</strong> dialog box browse to select the <strong>Type Name:</strong> of schemas.microsoft.com.Sql._2008._05.Types.Tables.dbo.Customers2</span></td>
<td class="telerik-reTableEvenCol-2" valign="top" style="width:131px;height:71px;">
<span style="font-family:&#39;Segoe UI&#39;;">Leave at default value</span></td>
<td class="telerik-reTableOddCol-2" valign="top" style="width:160px;height:71px;">
<span style="font-family:&#39;Segoe UI&#39;;">Leave at default value</span></td>
</tr>
</tbody>
</table>

<div></div>
</li></ol>
<p><span style="font-family:arial,helvetica,sans-serif;">After</span> creating the variables data1 and data2 the Designer should look as follows:
</p>
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/600x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/4426.variables.png" style="border:0px solid currentcolor;" /></p>
<p><strong>Figure 7 - Variables defined in the Visual Studio 2010 Designer</strong></p>
<h2><a name="Apply_properties_to_the_SelectActivity_and_InsertActivity_items"></a>Apply properties to the SelectActivity and InsertActivity items</h2>
<p>After creating variables apply properties to the SelectActivity and InsertActivity items as follows:</p>
<ol>
<li>
<p class="auto-style12">Right-click to select the <strong>SelectActivity</strong> item in the Visual Studio Designer and select
<strong>Properties</strong> from the context menu. Enter the following values for the SelectActivity item properties&nbsp;<strong>:</strong></p>
<table class="telerik-reTable-2" cellspacing="0" cellpadding="0" style="width:600px;">
<tbody>
<tr class="telerik-reTableHeaderRow-2" style="height:18.05pt;">
<td align="center" class="telerik-reTableHeaderEvenCol-2" style="padding:0.75pt;border:1pt solid windowtext;width:63.75pt;height:18.05pt;">
<strong><span class="auto-style2">Columns</span></strong></td>
<td align="center" class="telerik-reTableHeaderOddCol-2" style="border-width:1pt 1pt 1pt medium;border-style:solid solid solid none;border-color:windowtext windowtext windowtext currentcolor;padding:0.75pt;width:96pt;height:18.05pt;">
<strong><span class="auto-style2">DisplayName</span></strong></td>
<td align="center" class="telerik-reTableHeaderEvenCol-2"class="auto-style12">Right-click to select the <strong>SelectActivity</strong> item in the Visual Studio Designer and select
<strong>Properties</strong> from the context menu. Enter the following values for the SelectActivity item properties&nbsp;<strong>:</strong></p>
<table class="telerik-reTable-2" cellspacing="0" cellpadding="0" style="width:600px;">
<tbody>
<tr class="telerik-reTableHeaderRow-2" style="height:18.05pt;">
<td align="center" class="telerik-reTableHeaderEvenCol-2" style="padding:0.75pt;border:1pt solid windowtext;width:63.75pt;height:18.05pt;">
<strong><span class="auto-style2">Columns</span></strong></td>
<td align="center" class="telerik-reTableHeaderOddCol-2" style="border-width:1pt 1pt 1pt medium;border-style:solid solid solid none;border-color:windowtext windowtext windowtext currentcolor;padding:0.75pt;width:96pt;height:18.05pt;">
<strong><span class="auto-style2"> valign="top" style="border-width:1pt 1pt 1pt medium;border-style:solid solid solid none;border-color:windowtext windowtext windowtext currentcolor;padding:0.75pt;width:120pt;height:18.05pt;">
<strong><span class="auto-style2">EndPointConfigurationName</span></strong></td>
<td align="center" class="telerik-reTableHeaderOddCol-2" valign="top" style="border-width:1pt 1pt 1pt medium;border-style:solid solid solid none;border-color:windowtext windowtext windowtext currentcolor;padding:0.75pt;width:0.68in;height:18.05pt;">
<strong><span class="auto-style2">Query</span></strong></td>
<td align="center" class="telerik-reTableHeaderEvenCol-2" valign="top" style="border-width:1pt 1pt 1pt medium;border-style:solid solid solid none;border-color:windowtext windowtext windowtext currentcolor;padding:0.75pt;width:85pt;height:18.05pt;">
<strong><span class="auto-style2">SelectResult</span></strong></td>
</tr>
<tr class="telerik-reTableOddRow-2" style="height:34.15pt;">
<td class="telerik-reTableEvenCol-2" valign="top" style="border-width:medium 1pt 1pt;border-style:none solid solid;border-color:currentcolor windowtext windowtext;padding:0.75pt;width:63.75pt;height:34.15pt;">
&quot;*&quot;</td>
<td class="telerik-reTableOddCol-2" valign="top" style="border-width:medium 1pt 1pt medium;border-style:none solid solid none;border-color:currentcolor windowtext windowtext currentcolor;padding:0.75pt;width:96pt;height:34.15pt;">
Leave at default </td>
<td class="telerik-reTableEvenCol-2" valign="top" style="border-width:medium 1pt 1pt medium;border-style:none solid solid none;border-color:currentcolor windowtext windowtext currentcolor;padding:0.75pt;width:120pt;height:34.15pt;">
Leave at default </td>
<td class="telerik-reTableOddCol-2" valign="top" style="border-width:medium 1pt 1pt medium;border-style:none solid solid none;border-color:currentcolor windowtext windowtext currentcolor;padding:0.75pt;width:0.68in;height:34.15pt;">
Leave at default </td>
<td class="telerik-reTableEvenCol-2" valign="top" style="border-width:medium 1pt 1pt medium;border-style:none solid solid none;border-color:currentcolor windowtext windowtext currentcolor;padding:0.75pt;width:85pt;height:34.15pt;">
data1</td>
</tr>
</tbody>
</table>
</li><li><span class="auto-style13">Right-click to select the </span><strong><span class="auto-style13">InsertActivity</span></strong><span class="auto-style13"> item in the Visual Studio Designer and select
</span><span class="auto-style17">Properties</span><span class="auto-style12"> from the context menu. Leave all values at their default except for Rows, set the value for the Rows property to
</span><span class="auto-style17">data2</span><span class="auto-style12">. </span>
</li></ol>
<h2><a name="Add_a_BizTalk_Map_to_the_WCF_BTS_APP_Project"></a>Add a BizTalk Map to the WCF_BTS_APP Project</h2>
<p>Follow these steps to add a BizTalk Map to the WCF_BTS_APP project:</p>
<ol>
<li>Locate the Mapper item in the BizTalk category of the Toolbox, click to select it and drag it between the SelectActivity and the InsertActivity.
</li><li>When you release the left mouse button to drop it onto the Designer surface a
<strong>Select Types</strong> dialog box will be displayed. Specify an <strong>InputDataContractType</strong> of
<strong>schemas.microsoft.com.Sql._2008._05.Types.Tables.dbo.Customers[]</strong> and specify an
<strong>OutputDataContractType</strong> of <strong>schemas.microsoft.com.Sql._2008._05.Types.Tables.dbo.Customers2[]</strong>, then click
<strong>OK</strong>. </li><li>Click the <strong>Edit</strong> option that is displayed for the Mapper item to display the
<strong>Select a Map</strong> dialog box. </li><li>Verify that the <strong>Create a new Map</strong> radio button is selected, enter a name of
<strong>TestMap</strong>, verify that <strong>Launch the Map</strong> is checked and click
<strong>OK</strong> to launch the BizTalk Mapper. A new map surface should be displayed that contains the input and output schemas:
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/7103.image8.png" style="border:0px solid currentcolor;" />
</p>
<p><strong>Figure 8 - New map surface displayed in Visual Studio</strong></p>
</li><li>Drag and drop two String Concatenate functoids onto the surface of the Map and click to fully expand the Input1.xsd and Output1.xsd schemas.
</li><li>Drag and drop the following nodes from the Input1.xsd schema onto the first String Concatenate functoid:
<ul>
<li>CompanyName </li><li>ContactName </li><li>ContactTitle </li></ul>
</li><li>Drag and drop the output of the first String Concatenate functoid to the CompanyName node of the Output1.xsd schema.
</li><li>Drag and drop the following nodes from the Input1.xsd schema onto the second String Concatenate functoid:
<ul>
<li>Address </li><li>City </li><li>Region </li></ul>
</li><li>Drag and drop the output of the second String Concatenate functoid to the Address node of the Output1.xsd schema.
</li><li>The BizTalk mapper should look similar to the following now:
<p><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/5415.image9.png" style="border:0px solid currentcolor;" />
</p>
<p><strong>Figure 9 - Map connecting input schema to output schema</strong></p>
</li><li>Double-click Service1.xamlx in the Solution Explorer to display the Designer surface, right-click the Mapper item and select
<strong>Properties</strong> from the context menu to display the Visual Studio properties for the Mapper item.
</li><li>Enter an Input value of <strong>data1</strong> in the Visual Studio properties for the Mapper item.
</li><li>Enter an Output value of <strong>data2</strong> in the Visual Studio properties for the Mapper item.
</li><li>Click the Visual Studio 2010 <strong>File</strong> menu and select <strong>Save All</strong> to save the solution and project.
</li><li>In Solution Explorer, right-click the WCF_BTS_APP project and click <strong>Build</strong>.
</li></ol>
<h2><a name="Publish_the_WCF_Solution_to_IIS"></a>Publish the WCF Solution to IIS</h2>
<p>Complete the following steps to publish the WCF_BTS_APP project to IIS:</p>
<ol>
<li>In the Solution Explorer, right-click the <strong>WCF_BTS_APP</strong> project and select
<strong>Properties</strong> from the context menu to display the properties page for the project.
</li><li>On the Web tab of the project properties page select <strong>Use Local IIS Web server</strong>.
</li><li>In the Solution Explorer, right-click the <strong>WCF_BTS_APP</strong> project and select
<strong>Publish</strong> from the context menu to display the <strong>Publish Web</strong> dialog box.
</li><li>Enter the following values into the Publish Web dialog box (assuming that IIS 7.0 is running locally) and then click the
<strong>Publish</strong> button:
<p><a title="Publish Web" href="http://social.technet.microsoft.com/wiki/contents/articles/biztalk-appfabric-better-together/edit.aspx/%3Cimg%20src=%22/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6521.image10.png%22%20mce_src=%22/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6521.image10.png%22%20border=%220%22%20/%3E"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/CommunityServer-Wikis-Components-Files/00-00-00-00-05/6521.image10.png" style="border:0px solid currentcolor;" /></a>
</p>
<p><strong>Figure 9 - Publish Web dialog box displayed in Visual Studio</strong></p>
</li><li>Open a browser and navigate to <a href="http://localhost/WCF_BTS_APP/Service1.xamlx">
http://localhost/WCF_BTS_APP/Service1.xamlx</a> to verify that the service has been created.
</li><li>Click on the link <a href="http://localhost/WCF_BTS_APP/Service1.xamlx?wsdl">
http://localhost/WCF_BTS_APP/Service1.xamlx?wsdl</a> to verify that the WSDL is displayed correctly.
</li><li>Since this WCF application will use the WCF SQL Adapter to connect to the NorthWind database, either configure the DefaultAppPool Identity with an account that has permissions to read from and write to the NorthWind database or else configure the WCF_BTS_APP
 application in IIS to run in a different Application Pool that is using an identity with an account that has permissions to read from and write to the NorthWind database.
</li></ol>
<h2><a name="Create_and_launch_a_console_application_to_test_the_published_WCF_Service_and_verify_that_the_WCF_SQL_Adapter_is_updating_the_NorthWind_database_as_expected"></a>Create and launch a console application to test the published WCF Service and verify
 that the WCF SQL Adapter is updating the NorthWind database as expected.</h2>
<p>To create a console application to test the published WCF Service and verify that the WCF SQL Adapter is updating the NorthWind database as expected, follow these steps:</p>
<ol>
<li>Select the WCF_BTS_APP solution in Solution Explorer, then click the <strong>
File</strong> menu, click <strong>Add</strong>, and then click <strong>New Project</strong> to display the
<strong>Add New Project</strong> dialog box. </li><li>In the <strong>Add New Project</strong> dialog box, under <strong>Installed Templates</strong>, click to expand
<strong>Visual C#</strong>, select <strong>Windows</strong>, and select <strong>Console Application</strong>.
</li><li>Type <strong>ConsoleAppTest</strong> for the Name of the project and click <strong>
OK</strong>. </li><li>In Solution Explorer, right-click the <strong>ConsoleAppTest</strong> project and click
<strong>Set as StartUp Project</strong>. </li><li>In Solution Explorer, right-click the ConsoleAppTest project again and click Add Service Reference to display the Add Service Reference dialog box.
</li><li>Enter <a href="http://localhost/WCF_BTS_APP/Service1.xamlx">http://localhost/WCF_BTS_APP/Service1.xamlx</a> into the
<strong>Address:</strong> and click <strong>Go</strong>. </li><li>Under <strong>Services:</strong> click to expand <strong>Service1</strong>, select
<strong>IinitializeSvc</strong> and then click <strong>OK</strong>. </li><li>Replace the code that currently exists in Program.cs with the following code:&nbsp;
<div class="reCodeBlock">
<div style="background-color:white;"><span><code style="color:cornflowerblue;font-weight:bold;">using</code>
<code style="color:black;">System;</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:cornflowerblue;font-weight:bold;">using</code>
<code style="color:black;">System.Collections.Generic;</code></span></div>
<div style="background-color:white;"><span><code style="color:cornflowerblue;font-weight:bold;">using</code>
<code style="color:black;">System.Linq;</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:cornflowerblue;font-weight:bold;">using</code>
<code style="color:black;">System.Text;</code></span></div>
<div style="background-color:white;"><span><code style="color:cornflowerblue;font-weight:bold;">using</code>
<code style="color:black;">ConsoleAppTest.ServiceReference1;</code></span></div>
<div style="background-color:whitesmoke;"><span>&nbsp;</span></div>
<div style="background-color:white;"><span><code style="color:cornflowerblue;font-weight:bold;">namespace</code>
<code style="color:black;">ConsoleAppTest</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:black;">{</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:cornflowerblue;font-weight:bold;">class</code>
<code style="color:black;">Program</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">{</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:cornflowerblue;font-weight:bold;">static</code>
<code style="color:cornflowerblue;font-weight:bold;">void</code> <code style="color:black;">
Main(</code><code style="color:cornflowerblue;font-weight:bold;">string</code><code style="color:black;">[] args)</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">{</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:black;">Console.WriteLine(</code><code style="color:blue;">&quot;Invoking WCF Service to transform selected rows from Customers table and insert result set
 into Customers2 table&quot;</code><code style="color:black;">);</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">IinitializeSvcClient client =
</code><code style="color:cornflowerblue;font-weight:bold;">new</code> <code style="color:black;">
IinitializeSvcClient();</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:black;">client.ExtractTransformLoad();</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">Console.WriteLine(</code><code style="color:blue;">&quot;Done&quot;</code><code style="color:black;">);</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:black;">Console.WriteLine(</code><code style="color:blue;">&quot;Please press &lt;Enter&gt; to close program.&quot;</code><code style="color:black;">);</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">Console.ReadLine();</code></span></div>
<div style="background-color:white;"><code>&nbsp;</code><span><code style="color:black;">}</code></span></div>
<div style="background-color:whitesmoke;"><code>&nbsp;</code><span><code style="color:black;">}</code></span></div>
<div style="background-color:white;"><span><code style="color:black;">}</code></span></div>
</div>
</li><li>Press <strong>F5</strong> to execute the console application. </li><li>Open Microsoft SQL Server Management Studio to verify that rows have been added to the Customers2 table in the Northwind database.
</li></ol>
<div><br />
<div style="text-align:right;"><span style="font-size:12.1px;"><strong></strong></span></div>
<a href="#Summary">
<div style="text-align:right;"><span style="font-size:12.1px;"><strong>Return to Top</strong></span></div>
<div style="text-align:right;"></div>
</a>
<div style="text-align:right;"><br />
</div>
</div>
<h1><a name="See_Also"></a>See Also</h1>
Read suggested related topics:
<ul>
<li><a href="http://social.technet.microsoft.com/wiki/contents/articles/1281.work-with-biztalk-appfabric-connect.aspx" target="_blank">Work with BizTalk AppFabric Connect</a>
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/1266.install-the-biztalk-server-2010-appfabric-connect-feature.aspx" target="_blank">Install the BizTalk Server 2010 AppFabric Connect Feature</a>
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/1275.biztalk-server-2010-appfabric-connect-feature-frequently-asked-questions.aspx" target="_blank">BizTalk Server 2010 AppFabric Connect Feature Frequently Asked Questions</a>
</li></ul>
Another important place to find a huge amount of BizTalk related articles is the TechNet Wiki itself. The best entry point is
<a href="http://social.technet.microsoft.com/wiki/contents/articles/2240.biztalk-server-resources-on-the-technet-wiki.aspx" target="_blank">
BizTalk Server Resources on the TechNet Wiki</a>
<p>&nbsp;</p>
<hr />

</div>
    
    