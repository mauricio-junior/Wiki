---
layout: default
title: Management Pack Health Model Exercise #5 - Creating a WMI Event Monitor - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

<p>This document is part of the <a href="http://go.microsoft.com/fwlink/?LinkID=275         </li>
        
</ul>
<div class="navigation-list-footer"></div></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom fiji-content-fragment-bottom"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div 817" target="_blank">
<span>Operations Manager Management Pack Authoring Guide
<img title="This link is external to TechNet Wiki. It will open in a new window." alt=" " src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" style="border-width:0px;border-style:solid;" />
</span></a>.&nbsp; </p>
<hr />
<p><div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Overview">Overview</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Versions">Product Versions</a></li><li class="hierarchy-item"><a href="#Prerequisites">Prerequisites</a></li><li class="hierarchy-item"><a href="#Revisions">Revisions</a></li><li class="hierarchy-item"><a href="#Sample_Code">Sample Code</a></li><li class="hierarchy-item"><a href="#Details">Details</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Procedures"></a></li><li class="hierarchy-item"><a href="#Using_the_Authoring_Console">Authoring Console Procedure</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Using_Visual_Studio_Authoring_Extensions"></a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Using_Visual_Studio_Authoring_Extensions">Visual Studio Authoring Extensions Procedure</a></li><li class="hierarchy-item"><a href="#See_Also">See Also</a></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<br />
</p>
<hr />
<h1><a name="Overview"></a>Overview</h1>
<p>The following procedure shows how to create a WMI event&nbsp;monitor based on a monitoring script using&nbsp; the Operations Manager 2007 Authoring console and Visual Studio Authoring Extensions.</p>
<h2>Product <a name="Versions"></a>Versions</h2>
<p>This exercise applies to the following products:</p>
<ul>
<li>System Center Operations Manager 2007 R2 </li><li>System Center 2012 Operations Manager </li><li>System Center 2012 Operations Manager SP1 </li></ul>
<h2><a name="Prerequisites"></a>Prerequisites</h2>
<p>Before you perform this procedure, you must first complete the following prerequisite procedures:</p>
<ul>
<li><a href="http://social.technet.microsoft.com/wiki/contents/articles/14273.how-to-create-a-new-management-pack-in-operations-manager.aspx"><span>Creating a New Management Pack
</span></a>- Create the management pack. </li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/14274.management-pack-service-model-exercise-1-creating-a-class-in-operations-manager-en-us.aspx"><span>Creating a Class</span></a>&nbsp;- Create the class that
 is the target for the monitor. </li></ul>
<h2><a name="Revisions"></a>Revisions</h2>
<p>The Microsoft System Center team has validated this procedure as of <strong>Revision #1</strong>.&nbsp; We will continue to review any changes and periodically provide validations on later revisions as they are made.&nbsp; Please feel free to make any corrections
 or additions to this procedure that you think would assist other users</p>
<h2><a name="Sample_Code"></a>Sample Code</h2>
<p>A sample of the completed code for each exercise is available in the <a href="http://gallery.technet.microsoft.com/Operations-Manager-0bdbdac7">
<span>TechNet Gallery</span></a>.&nbsp; There is a separate sample for each exercise that includes the management pack completed at the end of that exercise and each preceding exercise.&nbsp; This strategy allows you to work through each
 exercise in order and then compare your results.&nbsp; For VSAE, this also includes the Visual Studio solution.&nbsp;
</p>
<h2><a name="Details"></a>Details</h2>
<p class="heading">The event monitor created in this procedure has the following characteristics:
</p>
<ul>
<li class="unordered">Runs on any computer that has an instance of <strong>MyComputerRole1</strong>.
</li><li class="unordered">Sets the monitor to a <strong>critical</strong> state when Notepad is started on the agent computer.
</li><li class="unordered">Sets the monitor to a <strong>healthy</strong> state when Notepad is ended on the agent computer.
</li></ul>
<hr />
<h1 class="heading"><a name="Procedures"></a></h1>
<h1 class="heading"><a name="Using_the_Authoring_Console"></a>Authoring Console Procedure</h1>
<ol class="ordered">
<li>In the Authoring Console, select <strong>Health Model</strong>, and then select
<strong>Monitors</strong>. </li><li>In the <strong>Monitors</strong> pane, expand <strong>Computer Role 1</strong> and then expand
<strong>System.Health.EntityState</strong>. </li><li>Right-click <strong>System.Health.AvailabilityState</strong>, select <strong>
New</strong>, select <strong>WMI Events</strong>, select <strong>Simple</strong>, and then select
<strong>Event Reset</strong>. </li><li>On the <b>General</b> page, do the following:
<ol class="ordered">
<li>In the <strong>ElementID</strong> box<strong>,</strong> type <strong>MyMP.Monitor.MyApplicationWMIEventError.</strong>
<b></b></li><li>In the <strong>Display Name</strong> box, type <strong>MyApplication WMI Event Error</strong>.
</li><li>In the <b>Target</b> box, select <b>MyMP.<strong>MyComputerRole1</strong></b>.
</li><li>In the <strong>Parent Monitor</strong> box, select <strong>System.Health.AvailabilityState</strong>.
</li><li>In the <strong>Category</strong> box, select <strong>AvailabilityHealth</strong>. Click
<strong>Next</strong>. </li></ol>
</li><li>On the <strong>First WMI Event Provider</strong> page, do the following:
<ol>
<li>In the <strong>WMI Namespace</strong> box, type <strong>root\cimv2</strong>. </li><li>In the <strong>Query</strong> box, paste the following WMI query:<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">Select</code>
<code>* From __InstanceCreatioeral</b> page, do the following:
<ol class="ordered">
<li>In the <strong>ElementID</strong> box<strong>,</strong> type <strong>MyMP.Monitor.MyApplicationWMIEventError.</strong>
<b></b></li><li>In the <strong>Display Name</strong> box, type <strong>MyApplication WMI Event Error</strong>.
</li><li>In the <b>Target</b> box, select <b>MyMP.<strong>MyComputerRole1</strong></b>.
</li><li>In the <strong>Parent Monitor</strong> box, select <strong>System.Health.AvailabilityState</strong>.
</li><li>In the <strong>Category</strong> box, select <strong>AvailabilityHealth</strong>. Click
<strong>Next</strong>. </li></ol>
</li><li>On the <strong>First WMI Event Provider</strong> page, do the following:
<ol>
<li>In the <strong>WMI Namespace</strong> box, type <strong>root\cimv2</strong>. </li><li>In the <strong>Query</strong> box, paste the following WMI query:<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">Select</code>
<code>* FronEvent WITHIN 60 Where TargetInstance ISA
</code><code>&#39;Win32_Process&#39; and TargetInstance.Name = &#39;notepad.exe&#39;<br />
<br />
</code></span></div>
</div>
</li><li>In the <strong>Poll Interval</strong> box, type <strong>60.</strong> </li><li><strong>Click <strong>Next</strong>.</strong> </li></ol>
</li><li>On the <strong>First Expression</strong> page, do the following:
<ol>
<li>Click <strong>Insert</strong>. </li><li>In the <strong>Parameter Name</strong> box type <strong>Dummy</strong>. </li><li>In the <strong>Operator</strong> box select <strong>Equals.</strong> </li><li>In the <strong>Value</strong> box type <strong>Dummy</strong>. </li><li>Click <strong>Next</strong>. </li></ol>
</li><li>On the <strong>Second WMI Event Provider</strong> page, do the following:
<ol>
<li>In the <strong>WMI Namespace</strong> box, type <strong>root\cimv2</strong>.&nbsp;
</li><li>In the <strong>Query</strong> box, paste the following WMI query:<br />
<br />
<div class="reCodeBlock">
<div><span><code style="font-weight:bold;">Select</code>
<code>* From __InstanceDeletionEvent WITHIN 60 Where TargetInstance ISA
</code><code>&#39;Win32_Process&#39; and TargetInstance.Name = &#39;notepad.exe&#39;<br />
<br />
</code></span></div>
</div>
</li><li>In the <strong>Poll Interval</strong> box, type <strong>60</strong>. </li><li>Click <strong>Next</strong>. </li></ol>
</li><li>On the <strong>Second Expression</strong> page, do the following:
<ol>
<li>Click <strong>Insert</strong>. </li><li>In the <strong>Parameter Name</strong> box type <strong>Dummy</strong>. </li><li>In the <strong>Operator</strong> box select <strong>Equals</strong>. </li><li>In the <strong>Value</strong> box type <strong>Dummy</strong>. </li><li>Click <b>Finish</b>. </li></ol>
</li><li>Expand <strong>System.Health.AvailabilityState</strong>. </li><li>Right-click <strong>MyMP.Monitor.</strong><strong>MyApplicationWMIEventError</strong> and select
<strong>Properties</strong>. </li><li>On the <strong>Configuration</strong> tab, do the following:
<ol>
<li>Click <strong>Configure</strong>. </li><li>Select the <strong>First Expression</strong> tab. </li><li>Click <strong>Delete</strong>. </li><li>Select the <strong>Second Expression</strong> tab. </li><li>Click <strong>Delete</strong>. </li><li>Click <strong>OK</strong>. </li></ol>
</li><li>On the <strong>Health</strong> tab, for <strong>FirstEventRaised</strong>, change the
<strong>Health State</strong> to <strong>Critical</strong>. </li><li>On the <strong>Alerting</strong> page, do the following:
<ol>
<li>Check <strong>Generate alerts for this monitor</strong>. </li><li>In the <strong>Alert description</strong> box, type&nbsp;<strong>Stopped process: $Data/Context/Collection[&#39;TargetInstance&#39;]/Property[@Name=&#39;Caption&#39;]$</strong>&nbsp;
</li></ol>
</li><li>Click <strong>OK</strong>. </li></ol>
<hr />
<h2 class="heading"><a name="Using_Visual_Studio_Authoring_Extensions"></a></h2>
<h1 class="heading"><a name="Using_Visual_Studio_Authoring_Extensions"></a>Visual Studio Authoring Extensions Procedure</h1>
<ol>
<li>Create the Monitor:
<ol>
<li>In Solution Explorer, right click&nbsp;<strong>Monitors.mptg </strong>and then select
<strong>Open</strong>. </li><li>Right click in the&nbsp; template window and select <strong>Add Template</strong>.
</li><li>Change the name of the template to <strong>Monitors.mptg </strong>and click <strong>
Add</strong>. </li><li>Select <b>Monitor (Unit)</b> and click <b>OK</b>. </li></ol>
</li><li>Configure the Monitor Properties:<br />
<ol>
<li>Right click the entry for <b>NewUnitMonitor </b>and select <b>Properties Window</b>.
</li><li>Change the <b>ID </b>to <strong>Monitor.<strong>MyApplicationWMIEventError</strong></strong>.
</li><li>Change the <b>Display Name </b>to <strong>My Application WMI Event Monitor</strong>.
</li></ol>
</li><li>Select the Monitor Target:<br />
<ol>
<li>Select Target and click the ellipse (...) button on the right of the field.&nbsp; </li><li>Select <b><b>MyMP.</b></b><strong>MyComputerRole1</strong>and click <b>OK</b>.
</li></ol>
</li><li>Select the Monitor Type:<br />
<ol>
<li>Select <b>Monitor Type ID </b>and click the ellipse (...) button on the right of the field.&nbsp;
</li><li>Select&nbsp;<strong>Microsoft.Windows.WmiEventProvider.2SingleEvent2StateMonitorType</strong> and click
<b>OK</b>. </li><li>Select <b>Parent Monitor ID </b>and click the ellipse (...) button on the right of the field.
</li><li>Select&nbsp;<strong>System.Health.AvailabilityState</strong> and click <b>OK</b>. </li></ol>
</li><li>Configure the Monitor:<br />
<ol>
<li>Select <b>Monitor Configuration</b> and click the ellipse (...) button on the right of the field.&nbsp;
</li><li>Copy the following XML into the configuration window between the &lt;Configuration&gt; tags.&nbsp; Note that you can use Intellisense to manually type in each entry.<br />
<br />
<div class="reCodeBlock">
<div><span><code>
<div class="reCodeBlock">
<div><span><code>&lt;</code><code style="font-weight:bold;">FirstNameSpace</code><code>&gt;root\cimv2&lt;/</code><code style="font-weight:bold;">FirstNameSpace</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">FirstQuery</code><code>&gt;Select * From __InstanceCreationEvent
 WITHIN 60 Where TargetInstance ISA &#39;Win32_Process&#39; and TargetInstance.Name = &#39;notepad.exe&#39;&lt;/</code><code style="font-weight:bold;">FirstQuery</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">FirstPollInterval</code><code>&gt;60&lt;/</code><code style="font-weight:bold;">FirstPollInterval</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">FirstExpression</code>
<code>/&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">SecondNameSpace</code><code>&gt;root\cimv2&lt;/</code><code style="font-weight:bold;">SecondNameSpace</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">SecondQuery</code><code>&gt;Select * From __InstanceDeletionEvent
 WITHIN 60 Where TargetInstance ISA &#39;Win32_Process&#39; and TargetInstance.Name = &#39;notepad.exe&#39;&lt;/</code><code style="font-weight:bold;">SecondQuery</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">SecondPollInterval</code><code>&gt;60&lt;/</code><code style="font-weight:bold;">SecondPollInterval</code><code>&gt;</code></span></div>
<div><span><code>&lt;</code><code style="font-weight:bold;">SecondExpression</code>
<code>/&gt;</code></span></div>
</div>
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></span></div>
</div>
</li><li>Select <b>Monitor Operational States </b>and click the ellipse (...) button on the right of the field.
</li><li>Next to <strong>FirstEventRaised</strong>, select <strong>Critical</strong>. </li><li>Next to <strong>SecondEventRaised</strong>, select <strong>Healthy</strong>. </li><li>Click <strong>OK</strong>, </li></ol>
</li><li>Save and Compile the Project:
<ol>
<li>Select <b>File</b>, and then click <b>Save Monitors.mptg</b>. </li><li>Select <b>Build </b>and then <b>Build Solution</b>. </li><li>Ensure that you don&#39;t receive any errors. </li></ol>
</li></ol>
<h1><a name="See_Also"></a>See Also</h1>
<ul>
<li><a href="http://social.technet.microsoft.com/wiki/contents/articles/15207.operations-manager-management-pack-authoring-unit-monitors.aspx"><span>Unit Monitors</span></a>
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/15203.operations-manager-management-pack-authoring-events.aspx">Events</a>
</li></ul>
<br />

</div>
    
    