---
layout: default
title: 'Operations Manager Management Pack Authoring - Aggregate and Dependency Monitors - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

This document is part of the <a href="http://social.technet.microsoft.com/w        </li>
        
</ul>
<div class="iki/contents/articles/14255.system-center-operations-manager-management-pack-authoring-center.aspx#Management_Pack_Authoring_Guide">
Operations Manager Management Pack Authoring Guide</a>.&nbsp; The Microsoft System Center team has validated this procedure as of
<strong>the original version</strong>.&nbsp; We will continue to review any changes and periodically provide validations on later revisions as they are made.&nbsp; Please feel free to make any corrections or additions to this procedure that you think would assist other
 users.<br />
<br />
<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Aggregate_Monitors">Aggregate Monitors</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Standard_Aggregate_Monitors">Standard Aggregate Monitors</a></li><li class="hierarchy-item"><a href="#Custom_Aggregate_Monitors">Custom Aggregate Monitors</a></li><li class="hierarchy-item"><a href="#Health_Rollup_Policy">Health Rollup Policy</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Worst_state">Worst state</a></li><li class="hierarchy-item"><a href="#Best_state">Best state</a></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#Dependency_Monitors">Dependency Monitors</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Health_Rollup_Policy">Health Rollup Policy</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Worst_state_policy">Worst state policy</a></li><li class="hierarchy-item"><a href="#Best_state_policy">Best state policy</a></li><li class="hierarchy-item"><a href="#Percentage_policy"></a></li><li class="hierarchy-item"><a href="#Percentage_Policy">Percentage Policy</a></li><li class="hierarchy-item"><a href="#Health_Rollup_between_Agents">Health Rollup between Agents</a></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<h1><a name="Aggregate_Monitors"></a>Aggregate Monitors</h1>
<p><em>Aggregate monitors</em> group multiple monitors to provide a single health aggregated health state. This provides an organization to all of the monitors targeted at a particular class and provides a consolidated health state for specific categories of
 operation.<br />
<br />
</p>
<h2 class="heading"><a name="Standard_Aggregate_Monitors"></a>Standard Aggregate Monitors</h2>
<div id="sectionSection0" class="section">
<p>Every class has four standard aggregate monitors: Availability, Configuration, Performance, and Security. These are in the System.Health.Library management pack and targeted at the
<strong>Entity</strong> class. Because all classes inherit from the <strong>Entity</strong> class, all classes inherit these standard monitors. The standard set of aggregate monitors will be sufficient for most classes.</p>
<p>Most monitors will fall into one of the four categories represented by the standard aggregate monitors. Because of this, custom aggregate monitors will typically use one of the standard aggregate monitors as their parent instead of being positioned alongside
 them directly under the entity health. Unit monitors and dependency monitors will similarly use either a custom aggregate monitor or one of the standard aggregate monitors as their parent.</p>
</div>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1440.AuthGuide_5F00_06_5F00_StandardAggregateMonitors.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1440.AuthGuide_5F00_06_5F00_StandardAggregateMonitors.jpg" height="209" width="488" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h2 class="heading"><a name="Custom_Aggregate_Monitors"></a>Custom Aggregate Monitors</h2>
<div id="sectionSection1" class="section">
<p>Management packs can include custom aggregate monitors specific to the requirements of classes in a particular application. These monitors may use another aggregate monitor for their parent or the top level Entity State similar to the standard aggregate
 monitors use. Custom aggregate monitors can be configured underneath another aggregate monitor or attached directly to the entity state.</p>
<p>For example, the Windows Server 2008 Operating System (Monitoring) management pack includes an aggregate monitor called Microsoft.Windows.Server.2008.OperatingSystem.CoreServicesRollup that is used to combine the health of the different services that are
 monitored by this management pack. There are nine services that the management pack considers critical to the operation of a computer running Windows Server 2008. Instead of positioning these directly under the Availability aggregate monitor alongside other
 unit monitors, the aggregate monitor provides a combined health measurement for all the related services.</p>
<p>This aggregate monitor is illustrated in the following diagram.</p>
</div>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6012.AuthGuide_5F00_07_5F00_CustomAggregateMonitors.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6012.AuthGuide_5F00_07_5F00_CustomAggregateMonitors.jpg" height="285" width="408" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
<h2 class="heading"><a name="Health_Rollup_Policy"></a>Health Rollup Policy</h2>
<div id="sectionSection2" class="section">
<p>Each aggregate monitor must define a health rollup policy which is the logic that is used to determine the health of the aggregate monitor based on the health of the monitors under it. The possible health rollup policies for an aggregate monitor are as follows:</p>
<h3 class="subHeadd services.</p>
<p>This aggregate monitor is illustrated in the following diagram.</p>
</div>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6012.AuthGuide_5F00_07_5F00_CustomAggregateMonitors.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6012.AuthGuide_5F00_07_5F00_CustomAggregateMonitors.jpg" height="285" width="408" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<br />
<h2 class="heading"><a name="Health_Rollup_Policy"></a>Health Rollup Policy</h2>
ing"><a name="Worst_state"></a>Worst state</h3>
<div class="subSection">
<p>The state of the aggregate monitor matches the state of the child monitor with the worst health state. This is the most common policy used by aggregate monitors.</p>
</div>
</div>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4370.AuthGuide_5F00_08_5F00_AggregateWorstOfPolicy.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4370.AuthGuide_5F00_08_5F00_AggregateWorstOfPolicy.jpg" height="119" width="245" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h3 class="subHeading"><a name="Best_state"></a>Best state</h3>
<div class="subSection">
<p>The state of the aggregate monitor matches the state of the child monitor with the best health state.</p>
</div>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3250.AuthGuide_5F00_09_5F00_AggregateBestOfPolicy.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3250.AuthGuide_5F00_09_5F00_AggregateBestOfPolicy.jpg" height="126" width="262" style="border-width:0px;border-style:solid;" /></a><br />
<h1><a name="Dependency_Monitors"></a>Dependency Monitors</h1>
<p><em>Dependency monitors</em> let the health of one object be affected by the health of another object. This allows for health rollup between specific related instances of different classes.</p>
<p>Each dependency monitor is based on a specific hosting or containment relationship. Just creating a relationship between two objects does not alone provide rollup between their health states. A dependency monitor must be associated with the relationship
 for rollup of health to be performed.</p>
<p>The source and target class for a dependency monitor are defined by the relationship that the monitor is based on. The monitor must additionally specify a specific unit monitor or aggregate monitor on the target class and an aggregate monitor on the source
 class. Only the health of the target monitor is considered when calculating the health of the dependency monitor, and it only affects the health of the specified aggregate monitor on the target object.<br />
<br />
<strong>Dependency monitor based on unit monitor</strong> </p>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8738.AuthGuide_5F00_10_5F00_DependencyMonitorUnit.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8738.AuthGuide_5F00_10_5F00_DependencyMonitorUnit.jpg" height="282" width="409" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<strong>Dependency monitor based on aggregate monitor</strong><br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1856.AuthGuide_5F00_11_5F00_DependencyMonitorAggregate.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1856.AuthGuide_5F00_11_5F00_DependencyMonitorAggregate.jpg" height="298" width="439" style="border-width:0px;border-style:solid;" /></a><br />
<p>Multiple dependency monitors can be created on a single relationship if the health of the source class should be affected by multiple unit or aggregate monitors on the target class. For example, a dependency monitor might be created for each standard aggregate
 monitor as shown in the following image.</p>
<p><strong>Multiple dependency monitors for a single class</strong> </p>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4300.AuthGuide_5F00_12_5F00_DependencyMonitorMutiple.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4300.AuthGuide_5F00_12_5F00_DependencyMonitorMutiple.jpg" height="325" width="448" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h2 class="heading"><a name="Health_Rollup_Policy"></a>Health Rollup Policy</h2>
<div id="sectionSection0" class="section">
<p>There may be multiple instances of the target class, each with a different health state. Each dependency monitor must define a health rollup policy to define the logic that is used to determine the health of the dependency monitor based on the health of
 the instances of its target monitor. The possible health rollup policies for a dependency monitor are as follows:</p>
<h3 class="subHeading"><a name="Worst_state_policy"></a>Worst state policy</h3>
<div class="subSection">
<p>The source object matches the state of the target object that has the worst health state. This is used when the source object should only be healthy if all the target objects are healthy. This is the most common policy used by dependency monitors.</p>
</div>
</div>
<strong>Worst state health policy</strong> <br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5238.AuthGuide_5F00_13_5F00_DependencyWorstOf.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5238.AuthGuide_5F00_13_5F00_DependencyWorstOf.jpg" height="202" width="152" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h3><a name="Best_state_policy"></a>Best state policy</h3>
<p>The source object matches the state of the target object that has the best health state. This policy is used when only one of the source objects has to be healthy for the target object to be healthy.</p>
<p>For example, the <strong>Microsoft Windows Hyper-V 2008 Monitoring</strong> management pack has a dependency monitor on the hosting relationship from
<strong>Microsoft.Windows.HyperV.ServerRole</strong> to <strong>Microsoft.Windows.HyperV.VirtualNetwork</strong> that uses a best state policy. This is because the Hyper-V server is functional as long as it has one functional virtual network. The logic defined
 by this management pack is that the server class should show an error state if no virtual networks are available.</p>
<p><strong>Best state health policy<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2816.AuthGuide_5F00_14_5F00_DependencyBestOf.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2816.AuthGuide_5F00_14_5F00_DependencyBestOf.jpg" height="203" width="153" style="border-width:0px;border-style:solid;" /></a></strong></p>
<h3><a name="Percentage_policy"></a><strong><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2816.AuthGuide_5F00_14_5F00_DependencyBestOf.jpg"></a></strong></h3>
<h3><a name="Percentage_Policy"></a>Percentage Policy</h3>
<p>The source object matches the worst state of a single member of a specified percentage of target objects in the best state. This policy is used when a certain percentage of target objects must be healthy for the target object to be considered healthy.</p>
<p>For example an application might run on a web farm that includes multiple Web servers. Because of the redundancy offered in this kind of deployment, the application might be considered healthy if a particular percentage of servers is available. The farm
 itself could be represented in the management pack by a health rollup class based on System.ApplicationComponent with a containment relationship to the Web servers. A dependency monitor could be created on this containment relationship with a health rollup
 policy specifying a percentage. Even if one or more Web servers had a problem, as long as the specified percentage were in a healthy state then the class representing the web farm would also be healthy.</p>
<strong>Percentage Health Policy</strong><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8535.AuthGuide_5F00_15_5F00_DependencyPercentage.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8535.AuthGuide_5F00_15_5F00_DependencyPercentage.jpg" height="210" width="341" style="border-width:0px;border-style:solid;" /></a><br />
<br />
<h3><a name="Health_Rollup_between_Agents"></a>Health Rollup between Agents</h3>
<br />
Health state can only be rolled up between objects managed by the same agent unless the source object is managed by the Root Management Server. Groups and classes used for health rollup are typically unhosted. This means that they are managed by the RMS so
 that they can roll up health from objects managed by different agents. A relationship can be discovered between objects managed by different agents, but any dependency monitor associated with that relationship will not work as expected.<br />
<br />
<strong>Health rollup between agents</strong><br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6087.AuthGuide_5F00_16_5F00_RollupBetweenAgents.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6087.AuthGuide_5F00_16_5F00_RollupBetweenAgents.jpg" height="357" width="351" style="border-width:0px;border-style:solid;" /></a>

<olled up between objects managed by the same agent unless the source object is managed by the Root Management Server. Groups and classes used for health rollup are typically unhosted. This means that they are managed by the RMS so
 that they can roll up health from objects managed by different agents. A relationship can be discovered between objects managed by different agents, but any dependency monitor associated with that relationship will not work as expected.<br />
<br />
<strong>Health rollup between agents</strong><br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6087.AuthGuide_5F00_16_5F00_RollupBetweenAgents.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6087.AuthGuide_5F00_16_5F00_RollupBetweenAgents.jpg" height="357" width="351" styl/div>
    
    
