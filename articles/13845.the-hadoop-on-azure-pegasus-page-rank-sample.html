---
layout: default
title: 'The Hadoop on Azure Pegasus Page Rank Sample - TechNet Articles - United States (English) - TechNet Wiki'
weight: 3
---

<div class="post-content user-defined-markup">

<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#title">Overview</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Pegasus">Pegasus</a></li><li class="hierarchy-item"><a href="#Goals">Goals</a></li><li class="hierarchy-item"><a href="#technologies">Key technologies</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#setup">Setup and configuration</a></li><li class="hierarchy-item"><a href="#Tutorial">Tutorial< fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">The Hadoop on Azure Pegasus Page Rank Sample</h1>
    

    <div class="post-content user-defined-markup">

<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#title">Overview</a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Pegasus">Pegasus</a></li><li class="hierarchy-item"><a href="#Goals">Goals</a></li><li class="hierarchy-item"><a href="#technologies">Key technologies</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#setup">Setup and configuration</a></li><li class="hierarchy-ite/a><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#segment1">How to clean up a previous deployment of the Pegasus Pagerank algorithm from Hadoop on Azure</a></li><li class="hierarchy-item"><a href="#segment2">How to deploy the Pagerank algorithm in Pegasus from Hadoop on Azure</a></li><li class="hierarchy-item"><a href="#segment3">How to inspect the output from the Pegasus Pagerank algorithm in the Interactive Console of Hadoop on Azure</a></li></ul><div class="hierarchy-list-footer"> </div></li><li class="hierarchy-item"><a href="#summary">Summary</a></li></ul><div class="hierarchy-list-footer"> </div></div>
<p><a name="title"></a></p>
<a name="title">
<h1></h1>
</a>
<p><a name="title"></a><a name="Overview"></a></p>
<a name="Overview"></a>
<h1>Overview</h1>
<p>This tutorial shows how to deploy Pegasus from the Hadoop on Azure portal to compute the page rank for a simple 16-node graph. The rank calculated for a node is a measure of how well connected it is to the other nodes in the graph structure.</p>
<p>A graph is type of abstract mathematical structure that consists of a collection of nodes and a collection of edges that connect a subset of these nodes, pairwise. The Web is a model of a graph structure, where pages are nodes and hyperlinks are (directed)
 edges. The page rank of a page (node) is a measure of how many other pages have hyperlinks (direct edges) that target that page (node). The higher the value of a page&#39;s rank, the more highly connected it is to other pages on the Web. A high page rank typically
 indicates an important page. The page rank of a page is defined recursively, so highly ranked pages that link to it increase its rank more that poorly ranked pages do.</p>
<h3><a name="Pegasus"></a>Pegasus</h3>
<a name="pegasus"></a>
<p>Pegasus is an open source graph mining library implemented in a distributed manner on top of Hadoop. Pegasus provides large scale algorithms for various graph mining tasks:</p>
<ul>
<li>Degree </li><li>PageRank </li><li>Random Walk with Restart </li><li>Radius </li><li>Connected Components </li></ul>
<p>This form of analysis is applicable to many networked structures other than the Web, such as computer and social networks, that model a graph. People from School of Computer Science, Carnegie Mellon University developed Pegasus. For more information, see
 the <a href="http://www.cs.cmu.edu/~pegasus/">Pegasus Project</a> site.</p>
<p><a id="goals"></a></p>
<a id="goals"></a>
<h2><a id="goals"></a><a name="Goals"></a>Goals</h2>
<p>In this tutorial you see three things:</p>
<ol>
<li>
<p>How Pegasus input and output files are structured.</p>
</li><li>
<p>How to use the Hadoop on Azure to deploy a Pegasus page rank analysis.</p>
</li><li>
<p>How to use the Interactive Console in Hadoop on Azure to examine the results computated by Pegasus for the page rankings of the nodes.</p>
</li></ol>
<p><a id="goals"></a><a name="technologies"></a></p>
<a name="technologies"></a>
<h2><a name="technologies"></a><a name="Key_technologies"></a>Key technologies</h2>
<ul>
<a name="technologies"></a>
<li><a name="technologies"></a><a href="http://www.cs.cmu.edu/~pegasus/index.htm">Pegasus</a>
</li><li><a href="http://www.hadooponazure.com/">Hadoop on Azure</a> </li></ul>
<p><a name="setup"></a></p>
<a name="setup"></a>
<h1><a name="setup"></a><a name="Setup_and_configuration"></a>Setup and configuration</h1>
<p>You must have an account to access Hadoop on Azure and have created a cluster to work through this tutorial. To obtain an account and create an Hadoop cluster, follow the instructions outlined in the
<em>Getting started with Microsoft Hadoop on Azure</em> section of the <em>Introduction to Hadoop on Azure</em> topic.</p>
<hr />
<p><a name="setup"></a><a name="Tutorial"></a></p>
<a name="Tutorial"></a>
<h1><a name="Tutorial"></a><a name="Tutorial"></a>Tutorial</h1>
<p>This tutorial is composed of the following segments:</p>
<ol>
<a name="Tutorial"></a>
<li><a name="Tutorial"></a><a href="http://social.technet.microsoft.com/wiki/contents/articles/13845.the-hadoop-on-azure-pegasus-page-rank-sample/edit.aspx#segment1">How to clean up a previous deployment of the Pegasus Pagerank algorithm from Hadoop on Azure</a>.
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/13845.the-hadoop-on-azure-pegasus-page-rank-sample/edit.aspx#segment2">How to deploy the Pagerank algorithm in Pegasus from Hadoop on Azure</a>.
</li><li><a href="http://social.technet.microsoft.com/wiki/contents/articles/13845.the-hadoop-on-azure-pegasus-page-rank-sample/edit.aspx#segment3">How to inspect the output from the Pegasus Pagerank algorithm in the Interactive Console of Hadoop on Azure</a>.
</li></ol>
<p><a name="segment1"></a></p>
<a name="segment1"></a>
<h2><a name="segment1"></a><a name="How_to_clean_up_a_previous_deployment_of_the_Pegasus_Pagerank_algorithm_from_Hadoop_on_Azure"></a>How to clean up a previous deployment of the Pegasus Pagerank algorithm from Hadoop on Azure</h2>
<p>This segment is only needed if you have already completed a deployment of the Pegasus page rank algorithm on the current Hadoop cluster.
</p>
<p>From your Account page, scroll down to the <strong>Interactive Console</strong> icon in the
<strong>Your cluster</strong> section and click the icon to open the console.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.accountpageyourcluster.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.accountpageyourcluster.png" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>Enter the following commands at the js&gt; prompt to delete the output directories from the previous job. If these directories exist, a new job fails.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0624.InteractiveJsPage.PNG"><img alt=" " src="http://social.technet.micro
</p>
<p>From your Account page, scroll down to the <strong>Interactive Console</strong> icon in the
<strong>Your cluster</strong> section and click the icon to open the console.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.accountpageyourcluster.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8664.accountpageyourcluster.png" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>Enter the following commands at the js&gt; prompt to delete the output directories from the previoussoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0624.InteractiveJsPage.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<pre><code>js&gt; #rmr pr_tempmv  
js&gt; #rmr pr_output  
js&gt; #rmr pr_minmax  
js&gt; #rmr pr_distr   
</code></pre>
<p><a name="segment1"></a><a name="segment2"></a></p>
<a name="segment2"></a>
<h2><a name="segment2"></a><a name="How_to_deploy_the_Pagerank_algorithm_in_Pegasus_from_Hadoop_on_Azure"></a>How to deploy the Pagerank algorithm in Pegasus from Hadoop on Azure</h2>
<p>From your Account page, scroll down to the <strong>Samples</strong> icon in the
<strong>Manage your account</strong> section and click it to get to the Samples Gallery.&nbsp;<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1222.HadoopSamplesGallery.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1222.HadoopSamplesGallery.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>Click the <strong>Pegasus Pagerank</strong> sample icon in the Hadoop Sample Gallery to open the Deployment page for the sample.&nbsp;<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1016.PegasusPagerankDeployment.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1016.PegasusPagerankDeployment.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>The catepillar_star.edge file is the input file that contains the graph to be analyzed by Pegasus. Download it and open it with Notepad or any other program that opens text files. Each line specifies an edge in the graph. The format for a line is: source
 node Id followed by TAB followed by destination node Id. So if this file was for a graph of Web pages, the first line says that there is a hyperlink from the page with Id = 0 to the page with Id = 1.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8176.pegasuspagerankinput.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8176.pegasuspagerankinput.png" style="border-top:0px solid;height:342px;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;width:400px;" /></a></p>
<p>Click the <strong>Deploy to your cluster</strong> to deploy the sample and bring up the
<strong>Create Job</strong> page.&nbsp;<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/6278.PegasusPagerankCreateJob.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/6278.PegasusPagerankCreateJob.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>The <strong>Final Command</strong>, which begins with<br />
&quot;Hadoop jar pegasus-2.0.jar&quot;, takes 9 parameters. To run the <em>runpr.sh</em> command, Pegasus shell uses only the parameters that are highlighted in bold in the following parameter list. The first (pegasus.PagerankNaive) parameter specifies the PageRank-plain
 algorithm that uses <em>runpr.sh</em> command. The Hadoop on Azure portal require the others parameters.</p>
<ul>
<li><strong><em>pegasus.PagerankNaive</em></strong> - the Pegasus algorithm </li><li><strong><em>/user/SYSTEM/graph</em></strong> - HDFS directory where the input edge file is located.
</li><li><strong><em>pr_tempmv</em></strong> - temp output directory. </li><li><strong><em>pr_output</em></strong> - output directory. </li><li><strong><em>16</em></strong> - the number of nodes. </li><li><strong><em>1</em></strong> - the number of reducers. </li><li><strong><em>1024</em></strong> - the number of iterations. </li><li><strong><em>nosym</em></strong> - for directed edges, use <em>makesym</em> for undirected edges.
</li><li><strong><em>new</em></strong> - <em>new</em> to start a calculation, <em>contNN</em> to continue one.
</li></ul>
<p>Click the Execute job button to start the job. When the job finishes, the <strong>
Status</strong> at the <strong>Job Info</strong> section at the top of the page has the value &quot;completed Successfully&quot;.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.PegasusPagerankStatusCompleted.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.PegasusPagerankStatusCompleted.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p><a name="segment2"></a><a name="segment3"></a></p>
<a name="segment3"></a>
<h2><a name="segment3"></a><a name="How_to_inspect_the_output_from_the_Pegasus_Pagerank_algorithm_in_the_Interactive_Console_of_Hadoop_on_Azure"></a>How to inspect the output from the Pegasus Pagerank algorithm in the Interactive Console of Hadoop on Azure</h2>
<p>Return to your Account page, scroll down to the <strong>Interactive Console</strong> icon in the
<strong>Your cluster</strong> section and click on the icon to open the console. </p>
<p>The output directories for the Pegasus Pagerank job are <em>pr_vector</em>, <em>
pr_minmax</em>, and <em>pr_dist</em>. The <em>pr_vector</em> contains the page rank for each node. Each line has the format: node Id followed by a TAB followed by a &quot;v&quot; followed by a pagerank value. To locate the directory, use the list command #ls. Then to
 see the files in the <em>pr_vector</em> directory use the #ls /user/bradsev/pr_vector. The results are in the part-00000 file, so use the #cat pr_vector/part-00000 command to see the pagerank value for each node. Node 6 has the highest value.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2211.PegasusPagerankResults.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2211.PegasusPagerankResults.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>The <em>Pr_minmax</em> output directory contains the minimum and the maximum PageRanks for the graph and may be similarly inspected. The minimum PageRank is the second column of the line that starts with &quot;0&quot;. The maximum PageRank is the second column of
 the line that starts with &quot;1&quot;. So the minimum value found here is 0.009374998509883881 and the maximum value is 0.024460836507193662, as shown in the following screenshot.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8831.PegasusPagerankMinMaxOutput.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8831.PegasusPagerankMinMaxOutput.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></p>
<p>The <em>Pr_distr</em> output directory contains a histogram of the Pageranks for the graph. The histogram of Pagerank. It divides the range of (min_PageRank, max_PageRank) into bins and shows the number of nodes which have Pageranks that belong to such bins.
 The bins are defined in the first column and number of nodes in the second column. You can inspect the output file be using the #cat pr_distr/part-00000 command.</p>
<h2><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1050.PegasusPagerankHistogramOutput.PNG"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1050.PegasusPagerankHistogramOutput.PNG" style="border-top:0px solid;border-right:0px solid;border-bottom:0px solid;border-left:0px solid;" /></a></h2>
<p><a name="segment3"></a><a name="summary"></a></p>
<a name="summary"></a>
<h1><a name="summary"></a><a name="Summary"></a>Summary</h1>
<p>In this tutorial, you have seen how Pegasus input and output files for a page rank computation are structured, how to use the Hadoop on Azure to deploy a Pegasus page rank analysis, and how to use the Interactive Console in Hadoop on Azure to examine the
 results.</p>

</div>
    
    
