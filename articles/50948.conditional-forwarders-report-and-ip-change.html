---
layout: default
title: Conditional Forwarders - Report and IP Change - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Get_the_IPs">Get the IPs</a></li><li class="hierarchy-item"><a href="#Modify_the_IPs">Modify the IPs</a></li></ul><div class="hierarchy-list-footer"> </div></div><br />
<br />
<h3><a name="Get_the_IPs"></a>Get the IPs</h3>
<div class="reCodeBlock" style="border:1px solid #7f9db9;overflow-y:auto;">
<div style="background-color:#ffffff;"><span><code style="color:#0content-fragment-inner"><div clas00000;">$DNSServers = cat C:\scripts\DCs.txt</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">$ErrorActionPreference =
</code><code style="color:blue;">&quot;Stop&quot;</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">foreach ($DNSServer in $DNSServers)</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#006699;font-weight:bold;">Try</code><code style="color:#000000;">{</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">[PSCustomObject]@{</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:gray;">#Get-DnsServerZone -ComputerName $DNSServer -Name test.com,test.net | Select-Object Masterservers,Zonename</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">DNSServer = $DNSServer</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">Zone_Name =
</code><code style="color:#006699;font-weight:bold;">Get</code><code style="color:#000000;">-DnsServerZone -ComputerName $DNSServer -Name test.com |
</code><code style="color:#006699;font-weight:bold;">Select</code><code style="color:#000000;">-</code><code style="color:#006699;font-weight:bold;">Object</code>
<code style="color:#000000;">-ExpandProperty Zonename</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;"><span style="color:#000000;font-family:monospace;font-size:12.1px;background-color:#ffffff;">Master_Servers</span> =
</code><code style="color:#006699;font-weight:bold;">Get</code><code style="color:#000000;">-DnsServerZone -ComputerName $DNSServer -Name test.com |
</code><code style="color:#006699;font-weight:bold;">Select</code><code style="color:#000000;">-</code><code style="color:#006699;font-weight:bold;">Object</code>
<code style="color:#000000;">-ExpandProperty Masterservers</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">catch</code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;">{</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">Write-Host
</code><code style="color:blue;">&quot;That Conditional forwarder is not availablle in $DNSServer&quot;</code>
<code style="color:#000000;">-ForegroundColor White -BackgroundColor Red</code></span></div>
<div style="background-color:#f8f8f8;"><span>&nbsp;</span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;">}</code></span></div>
<div style="background-color:#f8f8f8;"><span><code>&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
</div>
<br />
<br />
<h3><a name="Modify_the_IPs_lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="Modify_the_IPs_lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="Modify_the_IPs_lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a></h3>
<h3><a name="Modify_the_IPs"></a>Modify the IPs</h3>
<h3><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a>
<div class="reCodeBlock" style="border:1px solid #7f9db9;overflow-y:auto;">
<div style="backg_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_56_99_99_99_13_quot_gt_Servers_Import-csv_C_Scripts_servers_csv_foreach_server_in_Servers_Set_DnsServerConditionalForwarderZone_ComputerName_Server_server_Name_Server_zone_MasterServers_server_ip_split_quot_quot_Verbose"></a><a name="lt_CSV_Format_server_zone_ip_ANA-DC01_Contoso_com_test_com_quot_99_99_99_10_99_99_99_98_quot_ANA-DC03_Contoso_com_test_com_quot_89_89_89_round-color:#ffffff;"><code style="color:#000000;">
<p><span style="font-size:12px;">&lt;#CSV Format</span></p>
</code></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;"><span style="font-size:12px;">server,zone,ip</span></code></span></div>
<div style="background-color:#ffffff;"><span style="font-size:12px;"><code style="color:#000000;">ANA-DC01.Contoso.com,test.com,</code><code style="color:blue;">&quot;99.99.99.10,99.99.99.98&quot;</code></span></div>
<div style="background-color:#f8f8f8;"><span style="font-size:12px;"><code style="color:#000000;">ANA-DC03.Contoso.com,test.com,</code><code style="color:blue;">&quot;89.89.89.56,99.99.99.13&quot;</code></span></div>
<div style="background-color:#ffffff;"><span><code style="color:gray;"><span style="font-size:12px;">#&gt;</span></code></span></div>
<div style="background-color:#f8f8f8;"><span style="font-size:12px;">&nbsp;</span></div>
<div style="background-color:#ffffff;"><span><code style="color:#000000;"><span style="font-size:12px;">$Servers = Import-csv C:\Scripts\servers.csv</span></code></span></div>
<div style="background-color:#f8f8f8;"><span><code style="color:#000000;"><span style="font-size:12px;">foreach ($server in $Servers)
</span></code></span></div>
<div style="background-color:#ffffff;"><span style="font-size:12px;"><code>&nbsp;</code><span><code style="color:#000000;">{
</code></span></span></div>
<div style="background-color:#f8f8f8;"><span style="font-size:12px;"><code>&nbsp;</code><span><code style="color:#006699;font-weight:bold;">Set</code><code style="color:#000000;">-DnsServerConditionalForwarderZone -ComputerName $Server.server
 -Name $Server.zone -MasterServers ($server.ip -split </code><code style="color:blue;">&quot;,&quot;</code><code style="color:#000000;">) -Verbose</code></span></span></div>
<div style="background-color:#ffffff;"><span style="font-size:12px;"><code>&nbsp;</code><span><code style="color:#000000;">}</code></span></span></div>
</div>
</h3>
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.Cond.PNG"><img alt=" " src="https://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3324.Cond.PNG" style="border-width:0px;border-style:solid;" /></a><br />

</div>
    
    