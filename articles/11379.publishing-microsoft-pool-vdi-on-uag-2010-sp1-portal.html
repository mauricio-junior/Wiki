---
layout: default
title: Publishing Microsoft Pool VDI on UAG 2010 SP1 Portal - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup"><p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">Virtual Desktop Infrastructure is becoming a hot issue nowadays with many companies adopting this technology due to its flexibility, machines density, mobility, security, manageability and overall tom fiji-content-fragment-bottom"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div class="r1 fiji-r1"></div><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
    <h1 class="post-name">Publishing Microsoft Pool VDI tal cost of ownership. VDI can be either dedicated/Personal desktop assigned for specific user or pool of desktops available for all users (First come is first served); both flavors have their own benefits/drawbacks depending on your exact need and infrastructure. Microsoft allows you to publish the VDI solution on its UAG portal/Trunk however it&rsquo;s not straight forward and not well explained/documented.</span></p>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;"><br />
For an introduction to VDI components, please check the following link.</span> </p>
<p><span style="color:#0000ff;font-size:12pt;text-decoration:underline;"><a href="http://technet.microsoft.com/en-us/video/microsoft-virtual-desktop-infrastructure-vdi-explained.aspx" target="_blank"><span style="color:#0000ff;font-family:calibri;">http://technet.microsoft.com/en-us/video/microsoft-virtual-desktop-infrastructure-vdi-explained.aspx</span><span style="color:#00749e;"> <img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." style="border-width:0px;border-style:solid;" src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" /> </span></a></span></p>
<p><span style="color:#00749e;"></span></p>
<div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">To publish your VDI Pool on UAG for External users, you need to do the following:</span></p>
</div>
<p>&nbsp;</p>
<div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">1. </span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">Ensure the UAG server is fully updated and patched with latest UAG Service Pack and Rollups.</span></p>
</div>
<p><span style="font-family:calibri;font-size:12pt;">2. </span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">From the UAG 2010 Server Copy the file ...\Microsoft Forefront Unified Access Gateway\common\conf\rd-template.txt to ...\Microsoft Forefront Unified Access Gateway\common\conf\Custom Update\rd-template.txt. This is needed to modify some RDP Parameters to make the VDI redirection work. For more information please check the attached link</span> </p>
<p>&nbsp;</p>
<div style="margin:0in 0in 10pt 0.5in;">
<p><span style="font-size:12pt;"> <a href="http://technet.microsoft.com/en-us/library/ff607422.aspx" target="_blank"><span style="color:#0000ff;font-family:calibri;">http://technet.microsoft.com/en-us/library/ff607422.aspx</span><span style="color:#00749e;"> <img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." style="border-width:0px;border-style:solid;" src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" /> </span></a></span></p>
</div>
<p><span style="color:#00749e;"></span></p>
<div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">For more information on the UAG Custom Update mechanism and a detailed example please check the following articles</span></p>
</div>
<p><span style="color:#1f497d;font-family:&#39;times new roman&#39;,&#39;serif&#39;;font-size:12pt;"><a href="http://technet.microsoft.com/en-us/library/ee861168.aspx#Customizing" target="_blank"><span style="color:#0000ff;font-family:&#39;calibri&#39;,&#39;sans-serif&#39;;"> http://technet.microsoft.com/en-us/library/ee861168.aspx#Customizing</span><span style="color:#00749e;"> <img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." style="border-width:0px;border-style:solid;" src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" /> </span></a></span></p>
<p><span style="color:#00749e;"></span></p>
<div style="margin:0in 0in 10pt 0.5in;">
<p><span style="color:#0000ff;font-size:12pt;"><a href="http://itcalls.blogspot.com/2012/03/uag-portal-home-page-customization-left.html" target="_blank"><span style="color:#0000ff;font-family:calibri;">http://itcalls.blogspot.com/2012/03/uag-portal-home-page-customization-left.html</span><span style="color:#00749e;"> <img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." style="border-width:0px;border-style:solid;" src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" /> </span></a></span></p>
</div>
<p><span style="color:#00749e;"></span></p>
<div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">3. </span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">Add the below two lines to rd-template.txt and save it in Custom Update folder (mentioned in previous steps). </span></p>
</div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">use redirection server name:i:1</span></p>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">loadbalanceinfo:s:tsv://vmresource.1.1</span></p>
<p> </p>
<div style="margin:0in 0in 10pt 0.5in;">
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">use redirection server name =&gt; Specifies whether a redirection server is allowed.</span></p>
</div>
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;"> loadbalanceinfo =&gt; Contains the load balancing cookie used to choose the best server for the client computer. If you know your VDI Pool ID then you can change this command to be loadbalanceinfo:s:tsv://vmresource.1.PoolID</span></p>
<p> </p>
<div style="margin:0in 0in 10pt 0.5in;">
<p><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;text-decoration:underline;">To get your VDI Pool ID</span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">, you need to connect to your Internal Connection Broker server then open the Server Manager &ndash; Roles &ndash; Remote Desktop Services &ndash; Remote Desktop Connection Manager &ndash; RD Virtualization Host servers&ndash; Pooled Virtual Desktops and then you can see all the properties including the Pool ID.</span></p>
</div>
<p>&nbsp;</p>
<div>
<p><span style="font-family:&#39;times new roman&#39;,&#39;serif&#39;;font-size:12pt;">4. </span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">From your UAG Portal/Trunk add new Application &ndash; Terminal Services&ndash; Remote Desktop (Predefined).</span><span style="font-family:calibri;"> <br />
<br />
<br />
<br />
<span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">5. </span><span style="font-family:&#39;arial&#39;,&#39;sans-serif&#39;;">In the Server Settings add the VDI Redirector session Host IP or Full Address and in the below space make sure to add all IP addresses or names of any system in your VDI solution (Session Broker, Gateway, Redirector, Session Host Virtualization and Virtual machines subnet). This is very critical step for t; Remote Desktop Connection Manager &ndash; RD Virtualization Hoshe publishing rule to work fine. The Easiest thing is to add the full IP range for your VDI subnet. Then Activate your UAG.<br />
<br />
<br />
<br />
<br />
<br />
<span style="font-family:arial;"><span style="text-decoration:underline;">Note: If you already created the VDI publishing application and it wasn&rsquo;t working, make sure to delete this application, apply all previous changes and then add the application again, the Custom update changes won&rsquo;t work for existing published applications.<br />
<br />
<br />
<br />
<br />
</span>For more information check my blog <a href="http://itcalls.blogspot.com/2012/05/publishing-microsoft-pool-vdi-on-uag.html" target="_blank"><span style="color:#00749e;">http://itcalls.blogspot.com/2012/05/publishing-microsoft-pool-vdi-on-uag.html <img alt=" " title="This link is external to TechNet Wiki. It will open in a new window." style="border-width:0px;border-style:solid;" src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" /> </span></a><br />
<br />
For more Microsoft UAG Portal and DirectAccess articles, please check my blog <a href="http://itcalls.blogspot.com/">http://itcalls.blogspot.com/</a><br />
<br />
</span></span></span></p>
</div></div>
    
    