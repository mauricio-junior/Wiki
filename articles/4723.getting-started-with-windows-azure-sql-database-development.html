---
layout: default
title: Getting Started with Windows Azure SQL Database Development - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

<p>Microsoft Windows Azure offers several choices for data stora class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragment page no-wrapper" id="fragment-6615">
<div class="content-fragment-inner fiji-content-fragment-inner"><div class="content-fragment-top fiji-content-fragment-top"><div ge. These include
<a href="http://www.microsoft.com/windowsazure/features/storage/">Windows Azure Storage</a> and Windows Azure
<a href="http://www.microsoft.com/windowsazure/features/database/">SQL Database</a>. You may choose to use one or both in your particular project. Windows Azure Storage currently contains three types of storage structures: tables, queues or blobs (which can
 optionally be virtual machines). For more information, see <a class="ExistingPageLink" href="/wiki/contents/articles/1674.data-storage-offerings-on-the-azure-platform.aspx" title="Click to view the page titled: Understanding Data Storage Offerings on the Windows Azure Platform">Understanding Data Storage Offerings on the Windows Azure Platform</a>.</p>
<div class="table-of-contents"><h2 class="title">Table of Contents</h2><div class="hierarchy-list-header"> </div><ul class="hierarchy-list"><li class="hierarchy-item"><a href="#Introduction">Introduction</a></li><li class="hierarchy-item"><a href="#Getting_Started_with_SQL_Azure">Getting Started with SQL Database</a></li><li class="hierarchy-item"><a href="#Setting_up_Databases">Setting up Databases</a></li><li class="hierarchy-item"><a href="#Creating_Your_Application">Creating Your Application</a></li><li class="hierarchy-item"><a href="#Using_SQL_Azure">Using SQL Database</a></li><li class="hierarchy-item"><a href="#Data_Migration_and_Loading">Data Migration and Loading</a></li><li class="hierarchy-item"><a href="#Data_Access_and_Programmability">Data Access and Programmability</a></li><li class="hierarchy-item"><a href="#Database_Administration">Database Administration</a></li><li class="hierarchy-item"><a href="#Learn_More_and_Roadmap">Learn More and Roadmap</a></li><li class="hierarchy-item"><a href="#See_Also">See Also</a></li></ul><div class="hierarchy-list-footer"> </div></div>
<h2><a name="Introduction"></a>Introduction</h2>
<p>SQL&nbsp;Database is a relational data storage service in the cloud. Some of the benefits of this offering are the ability to use a familiar relational development model that includes most of the standard SQL Server language (T-SQL), tools and utilities. Of course,
 working with well-understood relational structures in the cloud, such as tables, views and stored procedures also results in increased developer productivity when working in this new platform type. Other benefits include a reduced need for physical database
 administration tasks to server setup, maintenance and security as well as built-in support for reliability, high availability and scalability.
</p>
<p>The article will not cover Windows Azure Storage or make a comparison between the two storage modes here. You can read
<a href="http://msdn.microsoft.com/magazine/ff796231">Windows Azure Table Storage -- Not Your Father&#39;s Database</a> to get more information about these storage options. It is important to note that Windows Azure tables are NOT relational tables. Another way
 to think about the two storage offerings is that Windows Azure includes Microsoft’s NoSQL cloud solutions and SQL Azure is the RDMS-cloud offering. The focus of this article is on understanding the capabilities included in SQL Database.</p>
<p>This article will explain differences between SQL Server and SQL Database. You need to understand these differences in detail so that<br />
you can appropriately leverage your current knowledge of SQL Server as you work<br />
on projects that use SQL Database as a data source. </p>
<p>If you are new to cloud computing you’ll want to do some background reading on Windows Azure before reading this article. A good place to start is the
<a href="http://msdn.microsoft.com/ff380142" target="_blank">MSDN Developer Cloud Center</a>.</p>
<h2><a name="Getting_Started_with_SQL_Azure"></a>Getting Started with SQL Database
</h2>
<p>To start working with SQL Database, you’ll first need to set up<br />
an account. If you are a MSDN subscriber, then you can use up to three SQL&nbsp;Databases<br />
&nbsp;(maximum size 1 GB each) for up to 16 months (<a href="http://www.microsoft.com/windowsazure/msdn-benefits/" target="_blank">details</a>) at as a developer sandbox. You may prefer to sign up for a regular SQL Database<br />
account (storage and data transfer fees apply) at<br />
<a href="http://www.microsoft.com/windowsazure/offers">http://www.microsoft.com/windowsazure/offers</a>. Yet another option is to get a trial 30-day account (no credit card required) at
<a href="http://windowsazurepass.com/">http://windowsazurepass.com/</a>, and use signup code -
<strong>DPEWR02</strong>. For the detail steps, see <a href="http://www.microsoft.com/online/help/en-us/helphowto/a90fe5d2-0886-40c8-8e01-a65bbd2c6b2b.htm">
Acquire and Activate a Trial or Subscription: A Step-by-Step Guide</a>.</p>
<p>After you’ve signed up for your SQL Database account, the<br />
simplest way to initially access it is via the<br />
<a href="http://windows.azure.com/">Windows Azure Platform Management Portal</a>. You must first sign in with the Windows Live ID that you’ve associated to your Windows Azure account. After you sign in, you can create your server installation and get started
 developing your application. The number of servers and/or databases you are allowed to create will be dependent on the type of account you’ve signed up for.</p>
<p>An example of the <em>Windows Azure Platform Management Portal</em> is shown in Figure 1. Here you can see a server and its associated databases. You’ll note that there is also a tab on this portal for managing the Firewall Settings for this particular SQL
 Database installation.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5226.SQL-Azure-Server.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5226.SQL-Azure-Server.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 1 Summary Information for a SQL Database Server</em></p>
<p>As you initially create your SQL Database server installation,<br />
it will be assigned a random string for the server name. You’ll generally also<br />
set the administrator username, password, geographic server location and<br />
firewall rules at the time of server creation. You can select the physical (data<br />
center) location for your SQL Database installation at the time of server creation.<br />
You will be presented with a list ofmanaging the Firewall Settings for this particular SQL
 Database installation.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5226.SQL-Azure-Server.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5226.SQL-Azure-Server.png" style="bord locations to choose from. If your application front-end is built in Windows Azure, you have the<br />
option to locate both that installation and your SQL Database installation in the<br />
same geographic location by associating the two installations together by using<br />
an <em>Affinity Group</em>. For more information, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=How-to-Create-a-SQL-Database-Server" title="Click to create new page titled: How to Create a SQL Database Server">How to Create a SQL Database Server</a>.
</p>
<p>By default there is no client access to your newly-created server, so you’ll first have to create <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-firewall" title="Click to create new page titled: SQL Database firewall">SQL Database firewall</a> rules for all client IPs. SQL<br />
Azure uses port 1433, so make sure that that port is open for your client<br />
application as well. When connecting to SQL Database you’ll use the <em>username@servername</em> format for your username. SQL Database only supports SQL<br />
Authentication; Windows authentication is not supported. Multiple Active<br />
Result Set (MARS) connections are supported. </p>
<p>Open connections will ‘time out’ after 30 minutes of inactivity. Also connections can be dropped for long-running queries or transactions or excessive resource usage. Development best practices in your applications around connections are to open, use and
 then close those connections manually, to include retry connection logic for dropped connections and to avoid caching connections because of these behaviors. Another best practice is to encrypt your connection string to prevent man-in-the-middle attacks. For
 best practices and code samples for SQL Database connections<br />
(including a suggested library which includes patterned connection retry logic),<br />
see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-Connection-Management" title="Click to create new page titled: SQL Database Connection Management">SQL Database Connection Management</a>.</p>
<p>You will be connected to the master database by if you don’t specify a database name in the connection string. In SQL Database the T-SQL<br />
statement USE is not supported for <strong>changing</strong> databases, so you will generally specify the database you want to connect to in the connection string (assuming you want to connect to a database other than master). Figure 2 below, shows an example
 of an ADO.NET connection:</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4431.ADONETConnectionString.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/300x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4431.ADONETConnectionString.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 2 Format for SQL Database connection string</em></p>
<h2><a name="Setting_up_Databases"></a>Setting up Databases</h2>
<p>After you’ve successfully created and connected to your SQL Azure server, then you’ll usually want to create one or more databases. Although you can create databases using the
<em>Windows Azure Platform Management Portal</em>, you may prefer to do so using some of the other tools, such as SQL Server Management Studio 2008 R2 (SSMS). By default, you can create up to 149 databases for each SQL Database server<br />
installation, if you need more databases than that; you must call the Azure<br />
business desk to have this limit increased.</p>
<p>When creating a database you must select the maximum size. The current options for sizing (and billing) are Web or Business Edition. Web Edition, the default, supports databases of 1 or 5 GB total. Business Edition supports databases of up to 50 GB, sized
 in increments of 10 GB – in other words, 10, 20, 30, 40 and 50 GB. Currently, both editions are feature-equivalent.</p>
<p>You set the size limit for your database when you create it by using the MAXSIZE keyword. You can change the size limit or the edition (Web or Business) after the initial creation using the
<em>ALTER DATABASE</em> statement. If you reach your size or capacity limit for the edition you’ve selected, then you will see the error code
<em>40544</em>. The database size measurement does NOT include the master database, or any database logs. For more detail about sizing and pricing, see
<a href="http://www.microsoft.com/windowsazure/pricing/#sql">Pricing Overview</a>. Although you set a maximum size, you are billed based on actual storage used.</p>
<p>It’s important to realize that when you are creating a new database on SQL Database, you are actually creating
<strong>three</strong> replicas of that database. This is done to ensure high availability. These replicas are completely transparent to you. Currently, these replicas are in the same data center. The new database appears as a single unit for your purposes.
 Failover is transparent and part of the service you are paying for is a SLA of 99.9% uptime.</p>
<p>After you’ve created a database, you can test connectivity via the portal by clicking the ‘Test Connectivity’ button for the selected database. For this test to succeed you must enable the ‘Allow Microsoft Services to Connect to this Server’ option on the
 Firewall Rules tab of the Windows Azure Platform Management Portal. </p>
<h2><a name="Creating_Your_Application"></a>Creating Your Application</h2>
<p>After you’ve set up your account, created your server, created at least one database and set a firewall rule so that you can connect to the database (from your development computer), then you can start developing your application using this data source.
</p>
<p>Unlike using Windows Azure Storage, there is nothing to install in your development environment. If you are using Visual Studio 2010, you can just get started – no additional SDKs, tools or anything else are needed.
</p>
<p>Although many developers will choose to use a Windows Azure front-end with a SQL Database back-end, this configuration is NOT required. You can<br />
use ANY front-end client with a supported connection library such as ADO.NET or<br />
ODBC. This could include, for example, an application written in Java or PHP.<br />
For more information, see<br />
<a href="http://msdn.microsoft.com/en-us/library/ee621787.aspx">Development: How-to Topics</a>. Connecting to SQL Database via OLE DB is currently not supported.</p>
<p>If you are using Visual Studio 2010 to develop your application, then you can take advantage of the included ability to view or create many types of objects in your selected SQL Database&nbsp;installation<br />
directly from the Visual Studio Server Explorer View. These objects are Tables,<br />
Views, Stored Procedures, Functions or Synonyms. You can also see the data<br />
associated with these objects using this viewer. For many developers using<br />
Visual Studio 2010 as their primary tool to view and manage SQL Database data will<br />
be sufficient. The Server Explorer View window is shown in Figure 3. Both a<br />
local installation of a database and a cloud-based instance are shown. You’ll<br />
note that the tree nodes differ slightly in the two views. For example there is<br />
no Assemblies node in the cloud installation because custom assemblies are not<br />
supported in SQL Database.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0334.ServerExplorer.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/250x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0334.ServerExplorer.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 3 Viewing Data Connections in Visual Studio</em></p>
<p>Using the Entity Framework with SQL Database is supported. Also you may choose to use Data-Tier<br />
application packages (or DACPACs) in Visual Studio. You can create, import and /<br />
or modify DACPACS for SQL Database schemas in VS2010.</p>
<p>Another developer tool that can now use to create applications which use SQL Database as a data source is<br />
<a href="http://www.microsoft.com/visualstudio/lightswitch">Visual Studio Light Switch</a>. This is a light-weight developer environment, based on the idea of ‘data and screens’ created for those who are tasked with part-time coding, most especially those who
 create ‘departmental applications. Shown below (Figure 4) is connecting to a SQL Database data source<br />
using the Light Switch IDE.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8345.LightSwitch.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/500x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8345.LightSwitch.png" style="border-width:0px;border-style:solid;" /></a></p>
<em>Figure 4 Connecting to SQL Database in Visual Studio Light Switch</em>
<p>If you are wish to use SQL Database as a data source for<br />
Business Intelligence projects, then you’ll use <em>Visual Studio Business Intelligence Development Studio 2008</em> (the R2 version needed to connect to SQL Azure). In addition, Microsoft has begun a limited (invite-only) customer beta of Windows Azure
<a href="http://www.microsoft.com/windowsazure/features/reporting/">SQL Repwho
 create ‘departmental applications. Shown below (Figure 4) is connecting to a SQL Database data source<br />
using the Light Switch IDE.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-compoorting Services</a>, a version of SQL Server Reporting Services for Azure. Microsoft has announced that on the longer-term roadmap for SQL Database,<br />
they are working to cloud-enable versions of the entire BI stack, that is<br />
Analysis Services, Integration Services and Reporting Services. </p>
<p>More forward-looking, Microsoft has announced that in vNext of Visual Studio the BI toolset will be integrated into the core product with full SQL Database<br />
compatibility and intellisense. This project is code-named ‘<a href="http://blogs.msdn.com/b/ssdt/archive/2010/12/07/juneauvideos.aspx">Juneau</a>’ and is expected to go into public beta later this year.</p>
<p>Another tool you may want to use to work with SQL Database is <em>SQL Server Management Studio 2008 R2
</em>(SSMS). Using SSMS, you actually have access to a fuller set of operations for SQL Database<br />
databases using SSMS than in Visual Studio 2010. You may use both tools,<br />
depending on which operation you are trying to complete. An example of an operation<br />
available in SSMS (and not in Visual Studio 2010) is creating a new database<br />
using a T-SQL script. Another example is the ability to easily performance index<br />
operations (create, maintain, delete and so on). An example is shown in Figure 5<br />
below. </p>
<p>Although working with SQL Databases in SSMS 2008 R2 is quite similar to<br />
working with an on-premises SQL Server instance, tasks and functionality are NOT<br />
identical. This is due mostly due to product differences. For example, you may<br />
remember that in SQL Database the USE statement to CHANGE databases is NOT<br />
supported. A common way to do this when working in SSMS it is to right click an<br />
open query window, then click ‘Connection’&gt;’Change connection’ on the<br />
context-sensitive menu and then to enter the next database connection<br />
information in the ‘Connect to Database Engine’ dialog box that pops up.</p>
<p>Generally when working in SSMS, if an option isn’t supported in SQL Database either, you simply can’t see it such as folders in the Explorer<br />
tree not present; context-sensitive menu-options not available when connected to<br />
a SQL Database instance, or you are presented with an error when you try to execute<br />
a command this isn’t supported in this version of SQL Server. You’ll also note<br />
that many of the features available with GUI interfaces for SQL Server with SSMS<br />
are exposed only via T-SQL script windows for SQL Database. These include common<br />
features, such as CREATE DATABASE, CREATE LOGIN, CREATE TABLE, CREATE USER, etc…</p>
<p>One tool that SQL Server DBAs often ‘miss’ in SQL Database is SQL Server Agent.<br />
This functionality is NOT supported. However, there are 3<sup>rd</sup> party tools as well as community projects, such as
<a href="http://sqlazureagent.codeplex.com/">SQL Database Agent</a> which provide examples of using alternate technologies to create ‘SQL-Agent-like’ functionality for SQL Database.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4428.SSMS.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4428.SSMS.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 5 Using SQL Server Management Studio 2008 R2 to Manage SQL Database</em></p>
<p>As mentioned in the discussion of Visual Studio 2010 support, newly released in SQL Server 2008 R2 is a data-tier application or DAC. DAC pacs are objects that combine SQL Server or SQL Database schemas and objects<br />
into a single entity. </p>
<p>You can use either Visual Studio 2010 (to build) or SQL Server 2008 R2 SSMS (to extract) to create a DAC from an existing database. If you wish to use Visual Studio 2010 to work with a DAC, then you’d start by selecting the SQL Server Data-Tier Application
 project type in Visual Studio 2010. Then, on the Solution Explorer, right-click your project name and click ‘Import Data Tier Application’. A wizard opens to guide you through the import process. If you are using SSMS, start by right-clicking on the database
 you want to use in the Object Explorer, click Tasks, and then click ‘Extract Data-tier Application’ to create the DAC. The generated DAC is a compressed file that contains multiple T-SQL and XML files. You can work with the contents by right-clicking the .dacpac
 file and then clicking Unpack. SQL Database supports<br />
deleting, deploying, extracting, and registering DAC pacs, but does <strong>not</strong> support upgrading them. Figure 6 below, shows the template in Visual Studio 2010 for working with DACPACs</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2541.DACPACs.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/450x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2541.DACPACs.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 6 The ‘SQL Server Data-tier Application’ template in Visual Studio 2010 (for DACPACs)</em></p>
<p>Microsoft has released a CTP version of enhanced DACPACs, called BACPACs, that support import/export of schema AND data (via BCP). Another name for this set of functionality is
<a href="http://www.sqlazurelabs.com/ImportExport.aspx">Database Import and Export for SQL Database</a>.</p>
<p>Another tool you can use to connect to SQL Database is the<br />
Silverlight-based Web tool called <em><a href="http://msdn.microsoft.com/en-us/library/gg442309.aspx">Management Portal for SQL&nbsp;Azure</a></em> shown in Figure 7 below. It’s intended as a zero-install client to manage SQL Database installations. To access this
 tool<br />
navigate to the <a href="http://windows.azure.com/">Windows Azure Platform Management Portal</a>, then click the &#39;Database&#39; node in the tree view on the left pane. You will next click on the database that you wish to work with and then click on the ‘Manage’
 button on the ribbon. This will open the login box for the web client. After you enter the login credentials, then a new web page will open which will allow you to work with that databases’ Tables, Views, Queries an (via BCP). Another name for this set of functionality is
<a href="http://www.sqlazurelabs.com/ImportExport.aspx">Database Import and Export for SQL Database</a>.</p>
<p>Another tool you can use to connect to SQL Database is the<br />
Silverlight-based Web tool called <em><a href="http://msdn.microsoft.com/en-us/library/gg442309.aspx">Management Portal for SQL&nbsp;Azure</a></em> shown in Figure 7 below. It’s intended as a zero-install client to manage SQL Database installations. To access this
 tool<br />
navigate to the <a href="http://windows.azure.cd Stored Procedures in a SQL Database<br />
database installation. </p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2480.SQLAzureManagementPortal.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2480.SQLAzureManagementPortal.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 7 Using the Silverlight Web Portal to manage a SQL Azure Database</em></p>
<p>Of course, because the portal is built on Silverlight, you can view, monitor and manage the exposed aspects of SQL Database with
<strong>any</strong> browser using the web management tool. Shown below in Figure 8 is the portal running on a MacOS with Google Chrome.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5224.Chrome.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/450x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5224.Chrome.jpg" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 8 Using the Silverlight Web Portal to manage a SQL Azure Database on a Mac with Google Chrome</em></p>
<p>Still another tool you can use to connect to a SQL Database<br />
database is <a href="http://msdn.microsoft.com/library/ee336280">SQLCMD</a>. Even though SQLCMD is supported, the OSQL command-line tool is not supported by SQL Database.</p>
<h2><a name="Using_SQL_Azure"></a>Using SQL Database</h2>
<p>So now you’ve connected to your SQL Database installation and<br />
have created a new, empty database. So what exactly can you do with SQL Database?<br />
Specifically you may be wondering what are the limits on creating objects? And<br />
after those objects have been created, how do you populate those objects with<br />
data? As mentioned at the beginning of this article, SQL Database provides<br />
relational cloud data storage, but it does have some subtle feature differences<br />
to an on premise SQL Server installation. Starting with object creation, let’s<br />
look at some of the key differences between the two. </p>
<p>You can create the most commonly used objects in your SQL Azure database using familiar methods. The most commonly used relational objects (which include tables, views, stored procedures, indices, and functions) are all available. There are some differences
 around object creation. SQL Database tables MUST contain a clustered index.<br />
Non-clustered indices CAN be subsequently created on selected tables. You CAN<br />
create spatial indices; you can NOT create XML indices. Heap tables are NOT<br />
supported. CLR types of Geo-spatial only types (such as Geography and Geometry)<br />
ARE supported. Also Support for the HierachyID data type IS included. Other CLR<br />
types are NOT supported. View creation MUST be the first statement in a batch.<br />
Also view (or stored procedure) creation with encryption is NOT supported.<br />
Functions CAN be scalar, inline or multi-statement table-valued functions, but<br />
can NOT be any type of CLR function. </p>
<p>There is a complete reference of partially supported T-SQL statements for SQL Database on
<a href="http://msdn.microsoft.com/library/ee336267">MSDN</a>.</p>
<p>Before you get started creating your objects, remember that you will connect to the master database if you do not specify a different one in your connection string. In SQL Database, the USE (database) statement is
<strong>not</strong> supported for changing databases, so if you need to connect to a database other than the master database, then you must explicitly specify that database in your connection string.</p>
<h2><a name="Data_Migration_and_Loading"></a>Data Migration and Loading</h2>
<p>If you plan to create SQL Database objects using an existing,<br />
on-premises database as your source data and structures, then you can simply use<br />
SSMS to script an appropriate DDL to create those objects on SQL Database. Use the<br />
<a href="http://msdn.microsoft.com/en-us/library/windowsazure/ee621790.aspx">Generate Scripts Wizard</a> and set the ‘Script for the database engine type’ option to ‘for SQL Database’.
</p>
<p>An even easier way to generate a script is to use the <a href="http://sqlazuremw.codeplex.com/">
SQL Azure Migration Wizard</a> available as a download from CodePlex. With this handy tool you can generate a script to create the objects and can also load the data via bulk copy using bcp.exe.
</p>
<p>You could also design a SQL Server Integration Services (SSIS) package to extract and run a DML or DDL script. If you are using SSIS, you’d most commonly design a package that extracts the DDL from the source database, scripts that DDL for SQL Database and
 then executes that script on one or<br />
more SQL Database installations. You might also choose to load the associated data<br />
as part of this package’s execution path. For more information, see<br />
<a href="http://msdn.microsoft.com/library/ms141026">SQL Server Integraiton Services
</a>on MSDN.</p>
<p><a href="http://www.sqlazurelabs.com/">SQL Data Sync</a> enables creating and scheduling regular synchronizations between SQL Database and either<br />
SQL Server or other SQL Databases.&nbsp; You can see this service in<br />
action in<br />
<a href="http://channel9.msdn.com/blogs/zachskylesowens/using-sql-azure-data-sync-service-to-provide-geo-replication-of-sql-azure-databases">a Channel 9 video</a>. Currently SQL Data Sync services works via Synchronization Groups (HUB and MEMBER servers) and
 then via scheduled synchronization at the level of individual tables in the databases selected for synchronization. For even more about Data Sync, listen in to
<a href="http://www.microsoft.com/events/podcasts/default.aspx?seriesID=Series-fe9e2afe-a51c-4edf-95f2-05069672a074.xml&amp;audience=Audience-e5381407-359f-4922-97d0-0237af790eee&amp;pageId=x8968&amp;source=Microsoft-Podcasts-about-geekSpeak:-Join-a-Discussion-Like-No-Other-for-Developers&amp;WT.rss_ev=a">
geekSpeak: Data Sync in SQL Database with Ike Ellis</a>.</p>
<p>What if your source database is larger than the maximum size for the SQL Database installation? This could be greater than the absolute<br />
maximum of 50 GB for the Business Edition or some smaller limit based on the<br />
other program options. </p>
<p>Currently, customers must partition (or shard) their data manually if their database size exceeds the program limits. Microsoft has announced that it will be providing a federation (or auto-partitioning utility) for SQL Database around<br />
November 2011. For more information, see <a href="http://social.technet.microsoft.com/wiki/contents/articles/2281.aspx">
SQL Database Federations: Building Scalable, Elastic, and Multi-tenant Database Solutions</a>. To support federations, new T-SQL syntax will be introduced. From the blog post referenced above, Figure 9, below, shows a conceptual representation of that new syntax.
</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5621.Federation.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5621.Federation.jpg" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 9 SQL Database Federation (conceptual syntax)</em></p>
<p>It’s important to note that T-SQL table partitioning is NOT supported in SQL Database. There is also a free utility called<br />
<a href="http://enzosqlshard.codeplex.com/">Enzo SQL Shard</a> that you can use for partitioning your data source.
</p>
<p>You’ll want to take note of some other differences between SQL Server and SQL Database regarding data loading and data access. Added recently<br />
is the ability to copy a SQL Database&nbsp;via the Database copy command. The<br />
syntax for a cross-server copy is as follows: </p>
<pre>CREATE DATABASE DB2A AS COPY OF Server1.DB1A
</pre>
<p>The T-SQL INSERT statement IS supported (with the exceptions of updating with views or providing a locking hint inside of an INSERT statement). Related further to data migration is that T-SQL DROP DATABASE and other DDL commands have additional limits when
 executed against a SQL Database<br />
installation. Also the T-SQL RESTORE and ATTACH DATABASE commands are not<br />
supported. Finally, the T-SQL statement EXECUTE AS (login) is not supported.</p>
<p>If you are migrating from a data source other than SQL Server, there are also some free tools and wizards available to make the job easier. Specifically there is an Access to SQL Database Migration wizard and a<br />
MySQL to SQL Database Migration wizard. Both work similarly to the SQL Database<br />
Migration wizard in that they allow you to map the source schema to a<br />
destination schema, then create the appropriate DDL, then they allow you to<br />
configure and to execute the data transfer via bcp. A screen from the MySQL to<br />
SQL Database Migration wizard is shown in Figure 10 below.</p>
<p>Here are links for some of these tools:</p>
<ul>
<li>&nbsp;<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=5abe098d-c7e1-46c6-994a-09a2856eef0b&amp;displaylang=en">Access to SQL Database Migration Wizard</a>
</li><li>&nbsp;<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=69739C8C-AC82-41DE-B9E6-8FA5AE2594D9">MySQL to SQL Database Migration Wizard</a>
</li><li>&nbsp;<a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=9DFB1773-5594-44A9-869F-A891629F80A5">Oracle to SQL Server Migration Wizard</a> (you will have to manually set the target version to ‘SQL Database’ for<br />
&nbsp;&nbsp;&nbsp; appropriate DDL script generation) </li></ul>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/0728.MySQLMigration.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/0728.MySQLMigration.jpg" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 10 Migration from MySQL to SQL Database wizard screen</em></p>
<p>For even more information about migration, you may want to listen in to a recently recorded a 90 minute
<a href="https://www106.livemeeting.com/cc/mseventsbmo/view">webcast</a> with more details (and demos!) for Migration scenarios to SQL Database.
</p>
<h2><a name="Data_Access_and_Programmability"></a>Data Access and Programmability
</h2>
<p>Now let’s take a look at common programming concerns when working with cloud data.
</p>
<p>First you’ll want to consider where to set up your development environment. If you are an MSDN subscriber and can work with a database under 1 GB, then it may well make sense to develop using only a cloud installation (sandbox). In this way there will be
 no issue with migration from local to cloud. Using a regular (i.e. not MSDN subscriber) SQL Database account you<br />
could develop directly against your cloud instance (most probably a using a<br />
cloud-located copy of your production database). Of course developing directly<br />
from the cloud is not practical for all situations. </p>
<p>If you choose to work with an on-premises SQL Server database as your development data source, then you must develop a mechanism for synchronizing your local installation with the cloud installation. You could do that using any of the methods discussed earlier,
 and tools like Data Sync Services and Sync Framework are being developed with this scenario in mind.</p>
<p>As long as you use only the supported features, the method for having your application switch from an on-premise SQL Server installation to a SQL Database&nbsp;is simple – you need only to change the connection string<br />
in your application.</p>
<p>Regardless of whether you set up your development installation locally or in the cloud, you’ll need to understand some programmability differences between SQL Server and SQL Database. The article has<br />
covered the T-SQL and connection string differences. In addition all tables must<br />
have a clustered index at minimum (heap tables are not supported). As previously<br />
mentioned, the USE statement for changing databases isn’t supported. This also<br />
means that there is no support for distributed (cross-database) transactions or<br />
queries, and linked servers are not supported.</p>
<p>Other options <strong>not</strong> available when working with a SQL Azure database include:</p>
<p>- Full-text indexing <br />
- CLR custom types (however the built-in Geometry and Geography CLR types are supported)
<br />
- RowGUIDs (use the unique identifier type with the NEWID function instead) <br />
- XML column indices <br />
- Filestream datatype <br />
- Sparse columns</p>
<p>Default collation is always used for the database. To make collation adjustments, set the column-level collation to the desired value using the T-SQL COLLATE statement. And finally, you cannot currently use SQL Profiler or the Database Tuning Wizard on your
 SQL Database.</p>
<p>Some important tools that you CAN use with SQL Database for<br />
tuning and monitoring are the following:</p>
<p>- SSMS Query Optimizer to view estimated or actual query execution plan details and client statistics
<br />
- Select Dynamic Management views to monitor health and status <br />
- Entity Framework to connect to SQL Database after the initial model and mapping<br />
files have been created by connecting to a local copy of your SQL Database<br />
database.</p>
<p>Depending of what type of application you are developing, you may be using SSAS, SSRS, SSIS or Power Pivot. You CAN also use any of these products as CONSUMERS of SQL Database&nbsp;data. Simply connect to your SQL<br />
Azure server and selected database using the methods already described in this<br />
article.</p>
<p>Another developer consideration is in understanding the behavior of transactions. As mentioned, only local (within the same database) transactions are supported. Also it is important to understand that the only transaction isolation level available for a
 database hosted on SQL Database is READ<br />
COMMITTED SNAPSHOT. Using this isolation level, readers get the latest<br />
consistent version of data that was available when the statement STARTED. SQL<br />
Azure does not detect update conflicts. This is also called an optimistic<br />
concurrency model, because lost updates, non-repeatable reads and phantoms can<br />
occur. Of course, dirty reads cannot occur.</p>
<p>Yet another method of accessing SQL Database data<br />
programmatically is via <a href="https://www.sqlazurelabs.com/">OData</a>, currently in CTP, you can try out exposing SQL Database data via an OData interface by configuring this at the<br />
CTP portal. For more information, see<br />
<a href="http://msdn.microsoft.com/en-us/data/hh237663">Introduction OData</a>. Shown in Figure 11 below is one of the (CTP) configuration screens for exposing SQL Database data as OData.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/5241.oData.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/5241.oData.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 11 SQL OData (CTP) configuration </em></p>
<h2><a name="Database_Administration"></a>Database Administration</h2>
<p>Generally, the SQL Database administrator role<br />
is logical installation management. Physical management is handled<br />
by the platform. From a practical standpoint this means there are no physical<br />
servers to buy, install, patch, maintain or secure. There is no ability to<br />
physically place files, logs, tempdb and so on in specific physical locations.<br />
Because of this, there is no support for the T-SQL commands USE &lt;database&gt;,<br />
FILEGROUP, BACKUP, RESTORE or SNAPSHOT.</p>
<p>There is no support for the SQL Agent on SQL Database. Also,<br />
there is no ability (or need) to configure replication, log shipping, database<br />
mirroring or clustering. If you need to maintain a local, synchronized copy of<br />
SQL Database schemas and data, then you can use any of the tools discussed earlier<br />
for data migration and synchronization – they work both ways. You can also use<br />
the DATABASE COPY command. Other than keeping data synchronized, what are some<br />
other tasks that administrators may need to perform on a SQL Database installation?</p>
<p>Most commonly, there will still be a need to perform logical administration. This includes tasks related to security and performance management. Of note is that in SQL Database only there are two new database roles<br />
in the master database which are intended for security management. These roles<br />
are <em>dbmanager</em> (similar to SQL Server’s dbcreator role) and <em>loginmanager (similar to SQL Server’s securityadmin role)</em>. Also certain common usernames are not permitted. These include ‘sa’, ‘admin’, ‘administrator’, ‘root’ and ‘guest’. Finally
 passwords must meet complexity requirements. For more information, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=Inside-SQL-Database" title="Click to create new page titled: Inside SQL Database">Inside SQL Database</a> and<br />
<a href="http://msdn.microsoft.com/en-us/library/windowsazure/ee336235.aspx">Managing Databases and Logins in SQL Database</a>.
</p>
<p>Additionally, you may be involved in monitoring for capacity usage and associated costs. To help you with these tasks, SQL Database provides a<br />
public<br />
<a href="http://www.microsoft.com/windowsazure/support/status/servicedashboard.aspx">Status History dashboard</a> that shows current service status and recent history (an example of history is shown in Figure 12).</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8004.SQLAzureStatus.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/450x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8004.SQLAzureStatus.jpg" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 12 SQL Database Status History</em></p>
<p>There is a <strong>new</strong> set of <a href="http://msdn.microsoft.com/en-us/library/ff394106.aspx">
error codes</a> that both administrators and developers should be aware of when working with SQL Azure. These are shown in Figure 13 below. The article,
<a href="http://msdn.microsoft.com/en-us/library/gg491230.aspx?wa=wsignin1.0">How-to: Decode Reason Codes in SQL Database</a>, shows how to programmatically decode error messages.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/2251.ErrorCode.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/2251.ErrorCode.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 13 SQL Database error codes</em></p>
<p>SQL Database provides a high security bar by default. It forces<br />
SSL encryption with all permitted (via firewall rules) client connections.<br />
Server-level logins and database-level users and roles are also secured. There<br />
are no server-level roles in SQL Database. Encrypting the connection string is a<br />
best practice. Also, you may wish to use Windows Azure certificates for<br />
additional security. For more detail, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-Connection-Security" title="Click to create new page titled: SQL Database Connection Security">SQL Database Connection Security</a>. For<br />
more information on SQL Database security, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=Overview-of-Security-in-SQL-Database" title="Click to create new page titled: Overview of Security in SQL Database">Overview of Security in SQL Database</a>.</p>
<p>In the area of performance, SQL Database includes features such<br />
as automatically killing long running transactions and idle connections that<br />
have been idle for 30 minutes or longer. Although you cannot use SQL Profiler or trace flags for performance<br />
tuning, you can use SQL Query Optimizer to view query execution plans and client<br />
statistics. A sample query to SQL Database with Query Optimizer output is shown in<br />
Figure 14 below. For more information, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=Troubleshoot-and-Optimize-Queries-with-SQL-Database" title="Click to create new page titled: Troubleshoot and Optimize Queries with SQL Database">Troubleshoot and Optimize Queries with SQL Database</a>. You can also perform statistics management and index tuning<br />
using the standard T-SQL methods. For more information, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-Performance-and-Elasticity-Guide" title="Click to create new page titled: SQL Database Performance and Elasticity Guide">SQL Database Performance and Elasticity Guide</a>.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3223.ExecutionPlan.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3223.ExecutionPlan.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 15 SQL Database query with execution plan output shown</em></p>
<p>There is a select list of <a href="http://msdn.microsoft.com/library/ee336238.aspx#dmv">
dynamic management views</a> (covering database, execution or transaction information) available for database administration as well. These include
<em>sys.dm_exec_connections</em>, <em>_requests</em>, <em>_sessions</em>, <em>_tran_database_transactions</em>,
<em>_active_transactions</em>, and <em>_partition_stats</em>. </p>
<p>There are also some <a href="http://msdn.microsoft.com/en-us/library/ee336238.aspx">
new system views</a> such as <em>sys.database_usage</em> and <em>sys.bandwidth_usage</em>. These show the number, type and size of the databases and the bandwidth usage for each database so that administrators can understand SQL Azure billing. For a sample
 of how you can use T-SQL to calculate estimated cost of service, see <a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-Billing-Numbers-Directly-From-Transaction_2D00_SQL" title="Click to create new page titled: SQL Database Billing Numbers Directly From Transaction-SQL">SQL Database Billing Numbers Directly From Transaction-SQL</a>.<br />
<a href="http://debugmode.net/2011/05/28/billing-in-sql-azure/" target="_blank">Here</a> is yet another MVP’s view of how to calculate billing based on using these views. A sample is shown in Figure 16. In this view, quantity is listed in KB. You can monitor
 space used via this command: </p>
<pre>SELECT SUM(reserved_page_count) * 8192 FROM sys.dm_db_partition_stats</pre>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7536.BandwidthUsage.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7536.BandwidthUsage.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 16 Bandwidth Usage in SQL Query</em></p>
<p>Further around SQL Database performance monitoring, Microsoft<br />
has released an installable tool called<br />
<a href="http://blogs.msdn.com/b/psssql/archive/2011/04/25/css-sql-azure-diagnostics-tool-released.aspx">CSS SQL Database Diagnostics</a>, which will help you to better understand performance. It produces reports on ‘longest running queries’, ‘max CPU usage’
 and ‘max IO usage’. Shown in Figure 17 below is a sample report screen for the first metric.
</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/3250.CPUConsuming.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3250.CPUConsuming.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 17 Top 10 CPU consuming queries for a SQL Database<br />
workload</em></p>
<h2><a name="Learn_More_and_Roadmap"></a>Learn More and Roadmap</h2>
<p>For the SQL Database August 2011 release enhancements, see<br />
<a href="http://msdn.microsoft.com/en-us/library/ff602419.aspx">What&#39;s New in SQL Database</a>.</p>
<p>Microsoft has announced that is it is working to implement database backup and restore, including point-in-time restore for SQL Azure databases. This is a much-requested feature for DBAs and Microsoft has said that they are prioritizing the implementation
 of this feature set due to demand.</p>
<p>To learn more about SQL Database, you can download the<br />
<a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=8396">Windows Azure Training Kit</a>. This includes SQL Database hands-on 0x0/__key/communityserver-wikis-components-files/00-00-00-00-05/3250.CPUConsuming.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 17 Top 10 CPU consuming queries for a SQL Database<br />
workload</em></p>
<h2><a name="Learn_More_and_Roadmap"></a>Learn More and Roadmap</h2>
<p>For the SQL Database August 2011 release enhancements, see<br />
<a href="http://msdn.microsoft.com/en-us/library/ff602419.aspx">What&#39;s New in SQL Database</a>.</p>
<p>Microsoft has announced that is it is working to implement database backup and restore, including point-in-time restore for SQL Azure databases. This is a much-requested feature for DBAs and Microsoft has said that they are prioritizing the implementation
 of this feature set due to demand.</p>
<p>To learn more alearning,<br />
whitepapers, videos and more. There is also<br />
<a href="http://sqlazure.codeplex.com/">a project on Codeplex</a> which includes downloadable code, sample videos and more. Also you will want to read the
<a href="http://www.windowsazureblog.com/">Windows Azure/SQL Database Team Blog</a>, and check out
<a href="http://www.windowsazure.com/">windowsazure.com</a> for learning materials.</p>
<p>If you want to continue to preview upcoming features for SQL Azure, then you’ll want to visit
<a href="http://sqlazurelabs.com/">SQL Database Labs</a>. Show below in Figure 19, is a list our current CTP programs. As of this writing, those programs include – OData, Data Sync and Import/Export. SQL Database Federations has been<br />
announced, but is not open to invited customers.</p>
<p><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/8865.SQLAzureLabs.png"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/400x0/__key/communityserver-wikis-components-files/00-00-00-00-05/8865.SQLAzureLabs.png" style="border-width:0px;border-style:solid;" /></a></p>
<p><em>Figure 19 SQL Database CTP programs </em></p>
<p>A final area you may want to check out is the <a href="https://datamarket.azure.com/" target="_blank">
Windows Azure Data Market</a>. This is a place for you to make data sets that you choose to host on SQL Database publicly available. This can be at no cost or for a fee. Access is&nbsp;via Windows Live ID. You can connect via existing clients, such as the latest&nbsp;version
 of the Power Pivot add-in for Excel, or programmatically. In any case,&nbsp;this is a place for you to ‘advertise’ (and sell) access to data you’ve chosen&nbsp;to host on SQL Database.</p>
<h2><a name="See_Also"></a>See Also</h2>
<ul>
<li><a class="internal-link new-page" href="/wiki/contents/articles/add.aspx?WikiParentPageID=4723&WikiPageKey=SQL-Database-TechNet-Wiki-Articles-Index" title="Click to create new page titled: SQL Database TechNet Wiki Articles Index">SQL Database TechNet Wiki Articles Index</a> </li></ul>
<p><em>The author of the original information contained in this article is </em><a href="http://blogs.msdn.com/b/socaldevgal/"><em>Lynn Langit</em></a><em>.</em></p>
<p><em><br />
</em></p>

</div>
    
    