---
layout: default
title: Dynamics CRM 2011 Portal Development – CrmSiteMap Expression - TechNet Articles - United States (English) - TechNet Wiki
weight: 3
---

<div class="post-content user-defined-markup">

This document was originally published as <span style="color:darkcyan;"><a title="Permalink to Dynamics CRM 2011 Portal Development – CrmSiteMap Expression" href="http://zhongchenzhou.wordpress.com/2012/04/03/dynamics-crm-2011-portal-development-crsitemap-expression/" rel="bookmark">Dynamics
 CRM 2011 Portal Deiv><div class="r2 fiji-r2"></div><div class="r3 fiji-r3"></div><div class="r4 fiji-r4"></div></div></div></div>
<div class="content-fragmentvelopment – CrmSiteMap Expression</a><a title="Permalink to Dynamics CRM 2011 Portal Development – Hello World" href="http://zhongchenzhou.wordpress.com/2012/04/02/getting-started-for-microsoft-dynamics-crm-2011-portal-hello-world/" rel="bookmark" target="_blank"><img title="This link is external to TechNet Wiki. It will open in a new window." alt=" " src="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-components-sitefiles/10_5F00_external.png" style="border-width:0px;border-style:solid;" />
</a></span><a title="Permalink to Dynamics CRM 2011 Portal Development – Hello World" href="http://zhongchenzhou.wordpress.com/2012/04/02/getting-started-for-microsoft-dynamics-crm-2011-portal-hello-world/" rel="bookmark" target="_blank"></a>and has been reproduced
 here to allow the community to correct any inaccuracies or provide other enhancements before updating the original version of this topic.<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/contents/articles/9103.dynamics-crm-2011-portal-development.aspx" target="_blank">Dynamics CRM 2011 Portal Development<br />
</a><br />
CrmSiteMap expression require ASP.NET sitemap feature enabled and Microsoft.Xrm.Portal.Web.CrmSiteMapProvider to be the default sitemap provider. CrmSiteMapProvider use Site Marker entity (adx_sitemarker) contained in portalbase solution as persistent store.This
 can be set up in web.config<br />
<div class="reCodeBlock" style="border:1px solid lightslategray;overflow-y:auto;">
<div style="background-color:white;"><span><code style="color:black;">&lt;?</code><code style="color:teal;font-weight:bold;">xml</code>
<code style="color:gray;">version</code><code style="color:black;">=</code><code style="color:blue;">&quot;1.0&quot;</code><code style="color:black;">?&gt;</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">configuration</code><code style="color:black;">&gt;</code></span></div>
<div style="background-color:white;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">system.web</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:whitesmoke;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">siteMap</code>
<code style="color:gray;">enabled</code><code style="color:black;">=</code><code style="color:blue;">&quot;true&quot;</code>
<code style="color:gray;">defaultProvider</code><code style="color:black;">=</code><code style="color:blue;">&quot;Crm&quot;</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:white;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">providers</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:whitesmoke;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">clear</code><code style="color:black;">/&gt;</code></span></span></div>
<div style="background-color:white;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">add</code>
<code style="color:gray;">name</code><code style="color:black;">=</code><code style="color:blue;">&quot;Crm&quot;</code>
<code style="color:gray;">type</code><code style="color:black;">=</code><code style="color:blue;">&quot;Microsoft.Xrm.Portal.Web.CrmSiteMapProvider, Microsoft.Xrm.Portal&quot;</code>
<code style="color:gray;">securityTrimmingEnabled</code><code style="color:black;">=</code><code style="color:blue;">&quot;true&quot;</code><code style="color:black;">/&gt;</code></span></span></div>
<div style="background-color:whitesmoke;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;/</code><code style="color:teal;font-weight:bold;">providers</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:white;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;/</code><code style="color:teal;font-weight:bold;">siteMap</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:whitesmoke;"><span><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">system.web</code><code style="color:black;">&gt;</code></span></span></div>
<div style="background-color:white;"><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">configuration</code><code style="color:black;">&gt;</code></span></div>
</div>
<br />
More information regarding to <a title="ASP.NET Site Maps" href="http://msdn.microsoft.com/en-us/library/yy2ykkab(v=vs.110).aspx">
ASP.NET Site Maps</a> and <a title="SiteMapProvider Class" href="http://msdn.microsoft.com/en-us/library/e52te4hd(v=vs.110).aspx">
SiteMapProvider Class</a><br />
<br />
Syntax:<br />
<div class="reCodeBlock" style="border:1px solid lightslategray;overflow-y:auto;">
<div style="background-color:white;"><span><code style="color:black;">&lt;%$ CrmSiteMap: SiteMarker=siteMarker, Return=return, Eval=eval, Format=format, Portal=portal%&gt;</code></span></div>
<div style="background-color:whitesmoke;"><span><code style="color:black;">&lt;%$ CrmSiteMap: siteMarker, return, eval, format, portal%&gt;</code></span></div>
</div>
<br />
Snippet Expression takes a format of comma separated name value pairs, any pair is optional and the name of the pair is optional as well. If name is omitted, then the sequence is significant.
<p>The first name value pair (<strong>SiteMarker</strong>) is the value of Name attribute (adx_name) of Site Marker entity (adx_sitemarker) contained in portalbase solution.</p>
<p>One instance of CrmSiteMapNode will be created for the rest of expression evaluation.</p>
<p>CrmSiteMapNode contains four more extra properties than base ASP.NET SiteMapNode object: Entity, LastModified, RewriteUrl and StatusCode. The entity will be the Web Page (adx_webpage) entity instance related to the Site Marker entity (adx_sitemarker) with
 the name specified.</p>
<p>The Web Page (adx_webpage) entity will be retrieved from CRM first, and the Partial Url (adx_partialurl) attribute value will be used to find CrmSiteMapNode within sitemap. If
<strong>special value “Current”</strong> is specified, the current web page path will be used to find CrmSiteMapNode within sitemap.</p>
<p>CrmSiteMapProvider use Site Marker entity (adx_sitemarker) contained in portalbase solution as persistent store. SiteMap is defined as a view of Site Marker entity for the specified web site. If the partial url/web page path from the previous description
 is found in this list of Site Marker entities. A corresponding CrmSiteMapNode will be created otherwiset of expression evaluation.</p>
<p>CrmSiteMapNode contains four more extra properties than base ASP.NET SiteMapNode object: Entity, LastModified, RewriteUrl and StatusCode. The entity will be the Web Page (adx_webpage) entity instance related to the Site Marker entity (adx_sitemarker) with
 the name specified.</p>
<p>The Web Page (adx_webpage) entity will be retrieved from CRM first, and the Partial Url (adx_partialurl) attribute value will be used to find CrmSiteMapNode within sitemap. If
<strong>special value “Current”</strong> is specified, the current web page path will be used one CrmSiteMapNode instance with “Page Not Found” Site Marker will be created. If “Page Not Found” Site Marker does not exist in CRM, null will be returned.</p>
<p>The second name value pair (<strong>Return</strong>) can be set to either “<strong>Entity</strong>” or “<strong>Url</strong>“, if it is not specified the value of Eval and Format will determine the expression value, if any other value is specified an instance
 of CrmSiteMapNode will be returned.</p>
<p>If it is set to “Entity”, the value of the expression will be the Web Page (adx_webpage) entity instance related to the Site Marker entity (adx_sitemarker) with the name specified for the first name value pair.</p>
<p>If it is set to “Url”, the value of the expression will be the Partial Url (adx_partialurl) attribute value of the Web Page (adx_webpage) entity instance related to the Site Marker entity (adx_sitemarker) with the name specified for the first name value
 pair.</p>
<p>If we have the following web page created within CRM (Name=”View Scheduled Services” Partial Url=”view-scheduled-services”)</p>
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/7563.page.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/7563.page.jpg" style="border-width:0px;border-style:solid;" /></a><br />
<br />
the following Site Marker created within CRM which related to the previous web page (Name=”View Scheduled Services” Page=”View Scheduled Services”)<br />
<br />
<a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/1263.sitemarker.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/1263.sitemarker.jpg" style="border-width:0px;border-style:solid;" /></a><br />
<a href="http://zhongchenzhou.files.wordpress.com/2012/04/sitemarker.jpg"></a><br />
The following expression<br />
<div class="reCodeBlock" style="border:1px solid lightslategray;overflow-y:auto;">
<div style="background-color:white;"><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">asp:Literal</code>
<code style="color:gray;">ID</code><code style="color:black;">=</code><code style="color:blue;">&quot;Literal1&quot;</code>
<code style="color:gray;">runat</code><code style="color:black;">=</code><code style="color:blue;">&quot;server&quot;</code>
<code style="color:black;">Text=&quot;&lt;%$ CrmSiteMap: </code><code style="color:gray;">SiteMarker</code><code style="color:black;">=</code><code style="color:blue;">View</code>
<code style="color:black;">Scheduled Services, </code><code style="color:gray;">Return</code><code style="color:black;">=</code><code style="color:blue;">Entity</code><code style="color:black;">%&gt;&quot; /&gt;</code></span></div>
</div>
<br />
will produce the following error, this verify that the value of the CrmSiteMap expression is an Entity with logical name “adx_webpage”<br />
<br />
<a href="http://zhongchenzhou.files.wordpress.com/2012/04/returnentity.jpg"></a><a href="http://social.technet.microsoft.com/wiki/cfs-file.ashx/__key/communityserver-wikis-components-files/00-00-00-00-05/4428.returnentity.jpg"><img alt=" " src="http://social.technet.microsoft.com/wiki/resized-image.ashx/__size/550x0/__key/communityserver-wikis-components-files/00-00-00-00-05/4428.returnentity.jpg" style="border-width:0px;border-style:solid;" /></a><br />
<br />
The following CrmSiteMap expression will be evaluated to “/view-scheduled-services”<br />
<div class="reCodeBlock" style="border:1px solid lightslategray;overflow-y:auto;">
<div style="background-color:white;"><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">asp:Literal</code>
<code style="color:gray;">ID</code><code style="color:black;">=</code><code style="color:blue;">&quot;Literal1&quot;</code>
<code style="color:gray;">runat</code><code style="color:black;">=</code><code style="color:blue;">&quot;server&quot;</code>
<code style="color:black;">Text=&quot;&lt;%$ CrmSiteMap: </code><code style="color:gray;">SiteMarker</code><code style="color:black;">=</code><code style="color:blue;">View</code>
<code style="color:black;">Scheduled Services, </code><code style="color:gray;">Return</code><code style="color:black;">=</code><code style="color:blue;">Url</code><code style="color:black;">%&gt;&quot; /&gt;</code></span></div>
</div>
<p>The third and fourth name value pair (<strong>Eval</strong> &amp; <strong>Format</strong>) will only be taken into consideration when second name value pair (<strong>Return</strong>) is not specified. The value then will be passed as parameters to System.Web.UI.DataBinder.Eval(CrmSiteMapNode,
 eval, format) and the value is substituted for the expression syntax when the second name value pair is not specified.</p>
<p>The following expression will product “Partial Url is: /view-scheduled-services”</p>
<div class="reCodeBlock" style="border:1px solid lightslategray;overflow-y:auto;">
<div style="background-color:white;"><span><code style="color:black;">&lt;</code><code style="color:teal;font-weight:bold;">asp:Literal</code>
<code style="color:gray;">ID</code><code style="color:black;">=</code><code style="color:blue;">&quot;Literal1&quot;</code>
<code style="color:gray;">runat</code><code style="color:black;">=</code><code style="color:blue;">&quot;server&quot;</code>
<code style="color:black;">Text=&quot;&lt;%$ CrmSiteMap: </code><code style="color:gray;">SiteMarker</code><code style="color:black;">=</code><code style="color:blue;">View</code>
<code style="color:black;">Scheduled Services, </code><code style="color:gray;">Eval</code><code style="color:black;">=</code><code style="color:blue;">Url</code><code style="color:black;">,
</code><code style="color:gray;">Format</code><code style="color:black;">=</code><code style="color:blue;">Partial</code>
<code style="color:black;">Url is {0}%&gt;&quot; /&gt;</code></span></div>
</div>

</div>
    
    