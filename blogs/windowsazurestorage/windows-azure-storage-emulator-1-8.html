---
layout: windowsazurestorage
title: Windows Azure Storage Emulator 1.8
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-114" class="post-114 post type-post status-publish format-standard hentry category-uncategorized tag-releases tag-windows-azure-storage-client-library">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage Emulator 1.8</h1>		<div class="rating-wrap">
		<div id="star-rating-114" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="114" data-container="body" data-toggle="tooltip" title="1 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2012-10-30T03:00:00+00:00">October 30, 2012</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comments">6</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Emulator 1.8&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Emulator 1.8&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>In our continuous endeavor to enrich the development experience, we are extremely pleased to announce the new Storage Emulator, which has much improved parity with the Windows Azure Storage cloud service.</p>
<h4>What is Storage Emulator?</h4>
<p>Storage Emulator emulates the Windows Azure Storage blob, table and queue cloud services on local machine which helps developers in getting started and basic testing of their storage applications locally without incurring the cost associated with cloud service. This version of Windows Azure Storage emulator supports Blob, Tables and Queues up until <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dd894041.aspx">REST version 2012-02-12</a>.</p>
<p><b>How it works?</b></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/5277.emulator_0834001C.jpg" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/5277.emulator_5F00_0834001C.jpg"><img style="display: inline; background-image: none;" title="emulator" border="0" alt="emulator" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/6266.emulator_thumb_5EDCB81D.jpg" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/6266.emulator_5F00_thumb_5F00_5EDCB81D.jpg" width="515" height="572"/></a></p>
<p>Storage Emulator exposes different http end points (port numbers: 10000 for blob, 10001 for queue and 10002 for table services) on local host to receive and serve storage requests. Upon receiving a request, the emulator validates the request for its correctness, authenticates it, authorizes (if necessary) it, works with the data in SQL tables and file system and finally sends a response to the client.</p>
<p>Delving deeper into the internals, Storage Emulator efficiently stores the data associated with queues and tables in SQL tables. However, for blobs, it stores the metadata in SQL tables and actual data on local disk one file for each blob, for better performance. When deleting blobs, the Storage Emulator does not synchronously clean up unreferenced blob data on disk while performing blob operations. Instead it compacts and garbage collects such data in the background for better scalability and concurrency. </p>
<h4>Storage Emulator Dependencies:</h4>
<ul>
<li>SQL Express or LocalDB</li>
<li>.NET 4.0 or later with SQL Express or .NET 4.0.2 or later with LocalDB</li>
</ul>
<p><b>Installing Storage Emulator</b></p>
<p>Storage Emulator can work with <a href="http://blogs.msdn.com/b/sqlexpress/archive/2011/07/12/introducing-localdb-a-better-sql-express.aspx">LocalDB</a>, SQL express or even a full blown SQL server as its SQL store. </p>
<p>The following steps would help in getting started with emulator using LocalDB. </p>
<ol>
<li>Install .NET framework 4.5 from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=30653">here</a>.</li>
<li>Install X64 or X86 LocalDB from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=29062">here</a>. </li>
<li>Install the Windows Azure Emulator from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=35448">here</a>.</li>
</ol>
<p>Alternatively, if you have storage emulator 1.7 installed, you can do an in place update to the existing emulator. Please note that storage emulator 1.8 uses a new SQL schema and hence a DB reset is required for doing an in place update, which would result in loss of your existing data.</p>
<p>The following steps would help in performing an in place update.</p>
<ol>
<li>Shutdown the storage emulator, if running</li>
<li>Replace the binaries ‘Microsoft.WindowsAzure.DevelopmentStorage.Services.dll’, ‘Microsoft.WindowsAzure.DevelopmentStorage.Store.dll’ and ‘Microsoft.WindowsAzure.DevelopmentStorage.Storev4.0.2.dll’, located at storage emulator installation path (Default path is &quot;%systemdrive%\Program Files\Microsoft SDKs\Windows Azure\Emulator\devstore&quot;) with those available <a href="https://github.com/downloads/WindowsAzure/azure-sdk-downloads/StorageEmulator.zip">here</a>.</li>
<li>Open up the command prompt in admin mode and run ‘dsinit /forceCreate’ to recreate the DB. You can find the ‘dsinit’ tool at the storage emulator installation path. </li>
<li>Start the storage emulator</li>
</ol>
<h4>What’s new in 1.8?</h4>
<p>Storage emulator 1.8 supports the REST version 2012-02-12, along with earlier versions. Below are the service specific enhancements.</p>
<h4>Blob Service Enhancements:</h4>
<p>In <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/teched-2012-new-windows-azure-storage-features-improved-manageability-and-lower-prices.aspx">2012-02-12 REST version</a>, Windows Azure Storage cloud service introduced support for container leases, improved blob leases and asynchronous copy blob across different storage accounts. Also, there were enhancements for blob shared access signatures and blob leases in the 2012-02-12 version. All those new features are supported in Storage Emulator 1.8.</p>
<p>Since the emulator has just one built in account, one can initiate cross account copy blob by providing a valid cloud based URL. Emulator serves such cross account copy blob requests, asynchronously, by downloading the blob data, in chunks of 4MB, and updating the copy status. </p>
<p>To know more about the new features in general, the following links would be helpful:</p>
<ul>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx">Updated Shared Access Signatures</a></li>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/new-blob-lease-features-infinite-leases-smaller-lease-times-and-more.aspx">Container Leases and improved blob leases</a></li>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-asynchronous-cross-account-copy-blob.aspx">Asynchronous copy blob with ability to copy across accounts</a></li>
</ul>
<p>Storage Emulator 1.8 also garbage collects the unreferenced page blob files which may be produced as a result of delete blob requests, failed copy blob requests etc.</p>
<h4>Queue Service Enhancements:</h4>
<p>In 2012-02-12 REST version, Windows Azure Storage cloud service introduced support for Queue shared access signatures (SAS). Storage Emulator 1.8 supports <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx">Queue SAS</a>. </p>
<h4>Table Service Enhancements:</h4>
<p>In 2012-02-12 REST version, Windows Azure Storage cloud service introduced support for table shared access signatures (SAS). Storage Emulator 1.8 supports <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx">Table SAS</a>.</p>
<p>In order to achieve full parity with Windows Azure Storage table service APIs, the table service in emulator is completely rewritten from scratch to support truly schema less tables and expose data for querying and updating using ODATA protocol. As a result, Storage Emulator 1.8 fully supports the below table operations which were not supported in Emulator 1.7.</p>
<ul>
<li>Query Projection: You can read more about it <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/09/15/windows-azure-tables-introducing-upsert-and-query-projection.aspx">here</a>.</li>
<li>Upsert operations: You can read more about it <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/09/15/windows-azure-tables-introducing-upsert-and-query-projection.aspx">here</a>.</li>
</ul>
<h4>Known Issues/Limitations</h4>
<ul>
<li>The storage emulator supports only a single fixed account and a well-known authentication key. They are: Account name: devstoreaccount1, Account key: Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==</li>
<li>The URI scheme supported by the storage emulator differs from the URI scheme supported by the cloud storage services. The development URI scheme specifies the account name as part of the hierarchical path of the URI, rather than as part of the domain name. This difference is due to the fact that domain name resolution is available in the cloud but not on the local computer. For more information about URI differences in the development and production environments, see “Using storage service URIs” section in <a href="http://msdn.microsoft.com/en-us/library/windowsazure/gg432983.aspx">Overview of Running a Windows Azure Application with the Storage Emulator</a>.</li>
<li>The storage emulator does not support Set Blob Service Properties or SetServiceProperties for blob, queue and table services.</li>
<li>Date properties in the Table service in the storage emulator support only the range supported by SQL Server 2005 (For example, they are required to be later than January 1, 1753). All dates before January 1, 1753 are changed to this value. The precision of dates is limited to the precision of SQL Server 2005, meaning that dates are precise to 1/300th of a second.</li>
<li>The storage emulator supports partition key and row key property values of less than 900 bytes. The total size of the account name, table name, and key property names together cannot exceed 900 bytes.</li>
<li>The storage emulator does not validate that the size of a batch in an entity group transaction is less than 4 MB. Batches are limited to 4 MB in Windows Azure, so you must ensure that a batch does not exceed this size before transitioning to the Windows Azure storage services.</li>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/05/28/partitionkey-or-rowkey-containing-the-percent-character-causes-some-windows-azure-tables-apis-to-fail.aspx">Avoid using ‘PartitionKey’ or ‘RowKey’ that contains ‘%’ character</a> due to the double decoding bug</li>
<li>Get messages from queue might not return messages in the strict increasing order of message’s ‘Insertion TimeStamp’ + ‘visibilitytimeout’</li>
</ul>
<h4>Summary</h4>
<p>Storage Emulator 1.8 has a great extent of parity with the Windows Azure Storage cloud service in terms of API support and usability and we will continue to improve it. We hope you all like it and please share your feedback with us to make it better.</p>
<p>Nagarjun Guraja</p>
<p>Windows Azure Storage</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/releases/" rel="tag">Releases</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-storage-client-library/" rel="tag">Windows Azure Storage Client Library</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (6)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-180">
				<div id="div-comment-180" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Manish</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-180">
			October 30, 2012 at 2:23 pm</a>		</div>

		<p>This is extremely useful. Thank you !!!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-181">
				<div id="div-comment-181" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Jabe</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-181">
			October 30, 2012 at 3:23 pm</a>		</div>

		<p>Congrats on your new release!</p>
<p>After&nbsp;upgrading to 1.8, my app crashed while writing to the emulated table storage. I&#39;ve tracked this down to _A TRAILING WHITESPACE_.</p>
<p>Have a look at this simple LINQPad query:</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<p>void Main()</p>
<p>{</p>
<p>var account = CloudStorageAccount.DevelopmentStorageAccount;</p>
<p>var client = account.CreateCloudTableClient();</p>
<p>var table = client.GetTableReference(&quot;test&quot;);</p>
<p>table.DeleteIfExists();</p>
<p>table.CreateIfNotExists();</p>
<p>var foo = new Foo { Str = &quot;foo &quot;, PartitionKey = &quot;A&quot;, RowKey = &quot;A&quot; };</p>
<p>table.Execute(TableOperation.Insert(foo));</p>
<p>}</p>
<p>class Foo : TableEntity</p>
<p>{</p>
<p>public string Str { get; set; }</p>
<p>}</p>
<p>// results in: 400 Bad Request &#8211; One of the request inputs is not valid</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<p>New or legacy (context stuff) API does not matter. Same result.</p>
<p>Str = &quot;foo &quot; will crash</p>
<p>Str = &quot;foo&quot; will not</p>
<p>Please look into this.</p>
<p>Cheers</p>
<p>Jabe</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-186">
				<div id="div-comment-186" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">jaidevh1@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-186">
			November 3, 2012 at 10:12 pm</a>		</div>

		<p>@Jabe, this is a known issue and we are looking at fixing this. Sorry for the inconvenience this has caused.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-207">
				<div id="div-comment-207" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a58f9ddbfde4d65451a037e13ccfc3d1?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a58f9ddbfde4d65451a037e13ccfc3d1?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">dongfu@outlook.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-207">
			November 18, 2012 at 11:58 pm</a>		</div>

		<p>Storage Emulator 1.8 does not support request URL with more than 300 characters, DataServiceRequestException will be thrown in this case: (Azure SDK 1.7)</p>
<p>System.Data.Services.Client.DataServiceRequestException: An error occurred while processing this request. &#8212;&gt; System.Data.Services.Client.DataServiceClientException:</p>
<p>&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;&quot;<a rel="nofollow" target="_new" href="http://www.w3.org/TR/html4/strict.dtd&quot;>"></a><a href="http://www.w3.org/.../strict.dtd&quot;&amp;gt" rel="nofollow">http://www.w3.org/&#8230;/strict.dtd&quot;&#038;gt</a>;</p>
<p>&lt;HTML&gt;&lt;HEAD&gt;</p>
<p>&lt;META HTTP-EQUIV=&quot;Content-Type&quot; Content=&quot;text/html; charset=us-ascii&quot;&gt;&lt;/HEAD&gt;</p>
<p>&lt;BODY&gt;&lt;h2&gt;Bad Request &#8211; Invalid URL&lt;/h2&gt;</p>
<p>&lt;hr&gt;&lt;p&gt;HTTP Error 400. The request URL is invalid.&lt;/p&gt;</p>
<p>&lt;/BODY&gt;&lt;/HTML&gt;</p>
<p> &nbsp; at System.Data.Services.Client.DataServiceContext.SaveResult.&lt;HandleBatchResponse&gt;d__1e.MoveNext()</p>
<p> &nbsp; &#8212; End of inner exception stack trace &#8212;</p>
<p> &nbsp; at System.Data.Services.Client.DataServiceContext.SaveResult.HandleBatchResponse()</p>
<p> &nbsp; at System.Data.Services.Client.DataServiceContext.SaveResult.EndRequest()</p>
<p> &nbsp; at System.Data.Services.Client.DataServiceContext.SaveChanges(SaveChangesOptions options)</p>
<p>Test code:</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;public class TestEntity : TableServiceEntity</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public TestEntity(string pk, string rk) : base(pk, rk) { }</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;static void TestUrlLimit(int urlLength)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var myAccount = CloudStorageAccount.DevelopmentStorageAccount;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var tableClient = myAccount.CreateCloudTableClient();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string table = &quot;TestTable&quot;;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tableClient.CreateTableIfNotExist(table);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var context = tableClient.GetDataServiceContext();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string pk = &quot;0&quot;;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string rk = new string(&#39;0&#39;, urlLength &#8211; 77); // Set the length of row key to build a url with &quot;urlLength&quot; characters</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var entity = new TestEntityX(pk, rk);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;context.AttachTo(table, entity);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;context.UpdateObject(entity);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Uri uri;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;context.TryGetUri(entity, out uri);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;URL length: {0}&quot;, uri.AbsoluteUri.Length);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;context.SaveChanges();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Success&quot;);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;catch (Exception e)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(&quot;Error: {0}&quot;, e);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;static void Test()</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TestUrlLimit(300); // Success</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TestUrlLimit(301); // Error</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p>I&#39;m not sure whether it is a known issue/limitation of Azure Storage Emualtor. Currently, I just use &quot;context.SaveChanges(SaveChangesOptions.Batch)&quot; to avoid the exception in this case.</p>
<p>Is there any way to solve this problem?</p>
<p>Thanks,</p>
<p>Dong</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-jeanghanemhotmail-com even thread-even depth-1" id="comment-208">
				<div id="div-comment-208" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/c3abcc1816f2adf731b21a5aa17df03b?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/c3abcc1816f2adf731b21a5aa17df03b?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">jeanghanem@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-208">
			November 19, 2012 at 9:53 pm</a>		</div>

		<p>Hi Dong,</p>
<p>You need to set http.sys regkeys in order to allow larger URLs.</p>
<p>[HKEY_LOCAL_MACHINESYSTEMCurrentControlSetservicesHTTPParameters]</p>
<p>&quot;MaxFieldLength&quot;=dword:00010000</p>
<p>&quot;MaxRequestBytes&quot;=dword:00010000</p>
<p>The above maps to 64KB.</p>
<p>Please refer to <a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/820129">support.microsoft.com/&#8230;/820129</a> for more details.</p>
<p>I hope this helps.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-211">
				<div id="div-comment-211" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a58f9ddbfde4d65451a037e13ccfc3d1?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a58f9ddbfde4d65451a037e13ccfc3d1?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">dongfu@outlook.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/10/30/windows-azure-storage-emulator-1-8/#comment-211">
			November 21, 2012 at 12:44 am</a>		</div>

		<p>Hi Jean,</p>
<p>I have checked the values under HKEY_LOCAL_MACHINESYSTEMCurrentControlSetservicesHTTPParameters and found the root cause of URL length issue:</p>
<p>The default value of UrlSegmentMaxLength is 260 (<a rel="nofollow" target="_new" href="http://support.microsoft.com/kb/820129">support.microsoft.com/&#8230;/820129</a>), so the max length of Azure request url to emulator is 40 (&quot;<a rel="nofollow" target="_new" href="http://127.0.0.1:10002/devstoreaccount1/&quot;">127.0.0.1/&#8230;/&quot;</a>) + 260 (segment of pk &amp; rk) = 300.</p>
<p>I changed value of UrlSegmentMaxLength to 0 (length that is bounded by the maximum value of a ULONG) and there&#39;s no URL issue now.</p>
<p>Many thanks for your help!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F10%2F30%2Fwindows-azure-storage-emulator-1-8%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->