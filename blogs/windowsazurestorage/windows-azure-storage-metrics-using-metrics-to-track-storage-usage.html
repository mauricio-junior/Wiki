---
layout: windowsazurestorage
title: Windows Azure Storage Metrics&#58; Using Metrics to Track Storage Usage
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-56" class="post-56 post type-post status-publish format-standard hentry category-uncategorized tag-analytics-logging-metrics">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage Metrics: Using Metrics to Track Storage Usage</h1>		<div class="rating-wrap">
		<div id="star-rating-56" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="56" data-container="body" data-toggle="tooltip" title="1 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2011-08-03T00:18:00+00:00">August 3, 2011</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comments">7</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Metrics: Using Metrics to Track Storage Usage&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Metrics: Using Metrics to Track Storage Usage&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>Windows Azure Storage Metrics allows you to track your aggregated storage usage for Blobs, Tables and Queues. The details include capacity, per service request summary, and per API level aggregates. The metrics information is useful to see aggregate view of how a given storage account&rsquo;s blobs, tables or queues are doing over time.&nbsp; It makes it very easy to see the types of errors that are occurring to help tune your system and diagnose problems and the ability to see daily trends of its usage.&nbsp; For example, the metrics data can be used to understand the request breakdown (by hour).&nbsp;&nbsp;</p>
<p>The metrics data can be categorized as:</p>
<ul>
<li>Capacity: Provides information regarding the storage capacity consumed for the blob service, the number of containers and total number of objects stored by the service. In the current version, this is available only for the blob service. We will provide table and queue capacity information in a future version. This data is updated daily and it provides separate capacity information for data stored by user and the data stored for $logs.</li>
<li>Requests: Provides summary information of requests executed against the service. It provides total number of requests, total ingress/egress, average E2E latency and server latency, total number of failures by category, etc. at an hourly granularity. The summary is provided at service level and it also provides aggregates at an API level for the APIs that have been used for the hour. This data is available for all the three services provided &ndash; Blobs, Tables, and Queues.</li>
</ul>
<h3>Finding your metrics data</h3>
<p>Metrics are stored in tables in the storage account the metrics are for. The capacity information is stored in a separate table from the request information. These tables are automatically created when you opt in for metrics analytics and once created the tables cannot be deleted, though their contents can be.</p>
<p>As mentioned above, there are two types of tables which store the metrics details:</p>
<ol>
<li>Capacity information.&nbsp; When turned on, the system creates $MetricsCapacityBlob table to store capacity information for blobs. This includes the number of objects and capacity consumed by Blobs for the storage account.&nbsp; This information will be recorded in $MetricsCapacityBlob table once per day (see PartitionKey column in Table 1).&nbsp; We report capacity separately for the amount of data stored by the user and the amount of data stored for analytics.&nbsp;&nbsp;&nbsp; <b></b></li>
<li>Transaction metrics.&nbsp; This information is available for all the services &ndash; Blobs, Tables and Queues. Each service gets a table for itself and hence the 3 tables are:</li>
</ol>
<ul>
<ul>
<li>$MetricsTransactionsBlob: This table will contain the summary &ndash; both at a service level and for each API issued to the blob service.</li>
<li>$MetricsTransactionsTable: This table will contain the summary &ndash; both at a service level and for each API issued to the table service.</li>
<li>$MetricsTransactionsQueue: This table will contain the summary &ndash; both at a service level and for each API issued to the queue service.</li>
</ul>
</ul>
<p>A transaction summary row is stored for each service that depicts the total request count, error counts, etc., for all requests issued for the service at an hour granularity.&nbsp; Aggregated request details are stored per service and for each API issued in the service per hour.</p>
<p>Requests will be categorized separately for:</p>
<ul>
<li>Requests issued by the user (authenticated, SAS and anonymous) to access both user data and analytics data in their storage account.</li>
<li>Requests issued by Windows Azure Storage to populate the analytics data.</li>
</ul>
<p>It is important to note that the system stores a summary row for each service every hour even if no API was issued for the service in that hour, which would result in a row showing that there were 0 requests during the hour.&nbsp; This helps applications in issuing point queries when monitoring the data to perform analysis.&nbsp; For APIs level metrics the behavior is different; the system stores a summary row for individual APIs only if the API was utilized in that hour.<b></b></p>
<p>These tables can be read from like any other user created Windows Azure Table. The REST URI for the metrics table is http://&lt;accountname&gt;.table.core.windows.net/Tables(&ldquo;$MetricsTransactionsBlob&rdquo;) to access the Blob Transaction table and http://&lt;accountname&gt;.table.core.windows.net/$MetricsTransactionsBlob() to access rows stored for Blob service in the transaction table.</p>
<h3>What does my metrics data contain?</h3>
<p>As mentioned, there are two different types of tables for the metrics data.&nbsp; In this section we will review the details contained in each table.</p>
<h4>Blob capacity metrics data</h4>
<p>This is stored in the $MetricsCapacityBlob Table.&nbsp;&nbsp; Two records with capacity information will be stored in this table for each day. The two records are used to track the capacity consumed by the data that the user has stored separately from the logging data in $logs container.</p>
<table border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top" width="535" colspan="2">
<p align="center"><b>Metrics </b><b>($MetricsCapacityBlob Table)</b></p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>Column Name</b></p>
</td>
<td valign="top" width="359">
<p><b>Description</b></p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>PartitionKey (string)</b></p>
</td>
<td valign="top" width="359">
<p>&lt;Timestamp&gt;</p>
<p>Timestamp is of the form: YYYYMMddThhmm where hhmm is the starting hour in 24 hour format. The hour and minutes is always stored as 0000 (i.e. a single record is stored once a day for 00:00 hours UTC).</p>
<p>NOTE: This represents the day for which the capacity is calculated and not when the record is inserted into the table.</p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>RowKey (string)</b></p>
</td>
<td valign="top" width="359">
<p>It can have one of the two possible values:</p>
<p><b>data</b>: The capacity row represents the capacity consumed by data stored by the user in blobs</p>
<p><b>analytics</b>: The capacity row represents the analytics data stored in blobs, which is all of the capacity consumed by logs stored in $logs</p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>Capacity (long)</b></p>
</td>
<td valign="top" width="359">
<p>The capacity in bytes utilized by the account for the blob service.</p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>ContainerCount (long)</b></p>
</td>
<td valign="top" width="359">
<p>The total number of containers.</p>
</td>
</tr>
<tr>
<td valign="top" width="177">
<p><b>ObjectCount (long)</b></p>
</td>
<td valign="top" width="359">
<p>The total number of blobs.</p>
</td>
</tr>
</tbody>
</table>
<p align="center">Table 1 Capacity Metrics table</p>
<h4>Transaction metrics data</h4>
<p>This is stored in the $MetricsTransactions&lt;service&gt; tables.<b>&nbsp; </b>All three (blob, table, queue) of the services have the same table schema, outlined below.&nbsp; At the highest level, these tables contain two kinds of records:</p>
<ul>
<li>Service Summary &ndash; This record contains hourly aggregates for the entire service. A record is inserted for each hour even if the service has not been used. The aggregates include request count, success count, failure counts for certain error categories, average E2E latency, average Server latency etc.</li>
<li>API Summary &ndash; This record contains hourly aggregates for the given API. The aggregates include request count, success count, failure count by category, average E2E latency, average server latency, etc. A record is stored in the table for an API only if the API has been issued to the service in that hour.</li>
</ul>
<p>We track user and Windows Azure Storage Analytics (system) requests in different categories.</p>
<p>User Requests to access any data under the storage account (including analytics data) are tracked under &ldquo;user&rdquo; category. These requests types are:</p>
<ul>
<li>Authenticated Requests</li>
<li>Authenticated SAS requests. All failures after a successful authentication will be tracked including authorization failures. An example of Authorization failure in SAS scenario is trying to write to a blob when only read access has been provided.</li>
<li>Anonymous Requests - Only successful anonymous requests are tracked. The only exception to this are the following which are tracked:
<ul>
<li>Server errors &ndash; Typically seen as InternalServerError</li>
<li>Client and Server Timeout errors</li>
<li>Requests that fail with 304 i.e. Not Modified</li>
</ul>
</li>
</ul>
<p>Internal Windows Azure Storage Analytics requests are tracked under the &ldquo;system&rdquo; category:</p>
<ul>
<li>Requests to write logs&nbsp; under the $logs container</li>
<li>Requests to write to metrics table</li>
</ul>
<p>These are tracked as &ldquo;system&rdquo; so that they are separated out from the actual requests that users issue to access their data or analytics data.</p>
<p>Note that if a request fails before the service can deduce the type of request (i.e. the API name of the request), then the request is recorded under the API name of &ldquo;Unknown&rdquo;.</p>
<p>Before we go over the schema for the metrics transaction tables (the table columns and their definitions), we will define some terms used in this table:</p>
<ul>
<li>For service summary row, the column represents the aggregate data at a service level. For API summary row, the same column represents data at an API level granularity.</li>
<li>Counted For Availability:&nbsp; If we have listed an operation result count in the below table as &ldquo;Counted For Availability&rdquo;, then it implies that the result category is accounted for in the availability calculation.&nbsp; Availability is defined as (&lsquo;billable requests)/(total requests).&nbsp; These requests are counted in both the numerator and denominator of that calculation. Examples: Success, ClientOtherError etc.</li>
<li>Counted Against Availability: These requests are counted in the Availability denominator only (were not considered as &lsquo;billable requests).&nbsp; This implies that requests are counted only in the denominator and will impact the availability (for example, server timeout errors).</li>
<li>Billable: These are the requests that are billable.&nbsp; <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx">See this post for more information on understanding Windows Azure Storage billing. </a>&nbsp;&nbsp; Example: ServerTimeoutError, ServerOtherError.</li>
</ul>
<p>NOTE: If a result category is not listed as &ldquo;Counted For/Against Availability&rdquo;, then it implies that those requests are not considered in the availability calculations. Examples: ThrottlingError</p>
<table style="width: 637px;" border="1" cellspacing="0" cellpadding="0" sizcache="8" sizset="0">
<tbody sizcache="8" sizset="0">
<tr>
<td valign="top" width="637" colspan="2">
<p><b>Metrics tables schema&nbsp; </b><b>($MetricsTransactionsBlob, $MetricsTransactionsTable, </b></p>
<p><b>$MetricsTransactionsQueue Tables)</b><b></b></p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Column Name</b></p>
</td>
<td valign="top" width="378">
<p><b>Description</b></p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Time in UTC is the PartitionKey (string)</b></p>
</td>
<td valign="top" width="378">
<p>&lt;Timestamp&gt;</p>
<p>Basic timestamp format described in ISO 8601: YYYYMMddThhmm. The timestamp represents the starting hour for the metrics information, The minutes will always be &ldquo;00&rdquo;</p>
<p>This can be used to search for request statistics for a given time period.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Request Type and Transaction type make up the RowKey (string)</b></p>
</td>
<td valign="top" width="378">
<p>&lt;user|system&gt;;&lt;API-Name&gt;</p>
<p>The prefix signifies whether the summary/API represents requests issued by user or system.</p>
<ul>
<li>user: Tracks&nbsp; summary for all requests issued by clients i.e. authenticated, SAS or anonymous requests</li>
<li>system: Requests issued by Windows Azure Storage to populate analytics data</li>
</ul>
<p>The API-Name suffix can be one of the following:</p>
<ul>
<li>&ldquo;All&rdquo; for service summary rows containing a summary of requests made to the service.&nbsp;</li>
<li>The API name is used to indicate the api summary for the given API. See below for the list of names.</li>
</ul>
<p>NOTE: Under &ldquo;system&rdquo; category we will only have summary metrics and not&nbsp; API granularity.</p>
<h5><span style="font-size: small;"><a href="http://msdn.microsoft.com/en-us/library/dd135733.aspx">Blob Service APIs</a></span></h5>
<ul>
<li>AcquireLease</li>
<li>BreakLease</li>
<li>ClearPage</li>
<li>CopyBlob</li>
<li>CreateContainer</li>
<li>DeleteBlob</li>
<li>DeleteContainer</li>
<li>GetBlob</li>
<li>GetBlobMetadata</li>
<li>GetBlobProperties</li>
<li>GetBlockList</li>
<li>GetContainerACL</li>
<li>GetContainerMetadata</li>
<li>GetContainerProperties</li>
<li>GetLeaseInfo</li>
<li>GetPageRegions</li>
<li>LeaseBlob</li>
<li>ListBlobs</li>
<li>ListContainers</li>
<li>PutBlob</li>
<li>PutBlockList</li>
<li>PutBlock</li>
<li>PutPage</li>
<li>ReleaseLease</li>
<li>RenewLease</li>
<li>SetBlobMetadata</li>
<li>SetBlobProperties</li>
<li>SetContainerACL</li>
<li>SetContainerMetadata</li>
<li>SnapshotBlob</li>
<li>SetBlobServiceProperties</li>
<li>GetBlobServiceProperties</li>
</ul>
<p>&nbsp; <span style="font-size: small;"><a href="http://msdn.microsoft.com/en-us/library/dd179363.aspx">Queue Service APIs</a></span></p>
<ul>
<li>ClearMessages</li>
<li>CreateQueue</li>
<li>DeleteQueue</li>
<li>DeleteMessage</li>
<li>GetQueueMetadata</li>
<li>GetQueue</li>
<li>GetMessage</li>
<li>GetMessages</li>
<li>ListQueues</li>
<li>PeekMessage</li>
<li>PeekMessages</li>
<li>PutMessage</li>
<li>SetQueueMetadata</li>
<li>SetQueueServiceProperties</li>
<li>GetQueueServiceProperties</li>
<li>EntityGroupTransaction</li>
<li>CreateTable</li>
<li>DeleteTable</li>
<li>DeleteEntity</li>
<li>InsertEntity</li>
<li>QueryEntity</li>
<li>QueryEntities</li>
<li>QueryTable</li>
<li>QueryTables</li>
<li>UpdateEntity</li>
<li>MergeEntity</li>
<li>SetTableServiceProperties</li>
<li>GetTableServiceProperties</li>
</ul>
<h5><span style="font-size: small;"><a href="http://msdn.microsoft.com/en-us/library/dd179423.aspx">Table Service APIs</a></span></h5>
<ul>
<li>EntityGroupTransaction</li>
<li>CreateTable</li>
<li>DeleteTable</li>
<li>DeleteEntity</li>
<li>InsertEntity</li>
<li>QueryEntity</li>
<li>QueryEntities</li>
<li>QueryTable</li>
<li>QueryTables</li>
<li>UpdateEntity</li>
<li>MergeEntity</li>
<li>SetTableServiceProperties</li>
<li>GetTableServiceProperties</li>
</ul>
<p>In addition &ldquo;Unknown&rdquo; may be used if the failure occurred before the exact API was detected</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>TotalIngress (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total ingress in bytes utilized by the service/ API.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>TotalEgress (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total egress in bytes utilized by the service/API.</p>
<p>This is not the same as billable egress and is just a sum total of egress from all requests. Customers do not get charged for bandwidth within the same datacenter, which is counted in this metric.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>TotalRequests (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total requests issued to the service/ API.</p>
<p>This includes throttled requests, expected and unexpected timeouts, all anonymous failures and all SAS failures.</p>
<p>= &sum;( <br/>Success, <br/>AnonymousSuccess, <br/>SASSuccess,</p>
<p>ThrottlingError, <br/>AnonymousThrottlingError, <br/>SASThrottlingError,</p>
<p>NetworkError, <br/>AnonymousNetworkError, <br/>SASNetworkError,</p>
<p>ClientOtherError, <br/>AnonymousClientOtherError, <br/>SASClientOtherError,</p>
<p>ServerOtherError, <br/>AnonymousServerOtherError, <br/>SASServerOtherError,</p>
<p>ClientTimeoutError, <br/>AnonymousClientTimeoutError, <br/>SASClientTimeoutError,</p>
<p>ServerTimeoutError, <br/>AnonymousServerTimeoutError, <br/>SASServerTimeoutError,</p>
<p>AuthorizationError, <br/>AnonymousAuthorizationError <br/>SASAuthorizationError)</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>TotalBillableRequests (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total requests that are billable. This is used to calculate availability.</p>
<p>NOTE: we do not bill anonymous failures (except network errors), throttled requests, server timeout errors and unknown errors.</p>
<p>= &sum;( <br/>Success, <br/>AnonymousSuccess, <br/>SASSuccess,</p>
<p>NetworkError, <br/>AnonymousNetworkError, <br/>SASNetworkError,</p>
<p>ClientOtherError, <br/>AnonymousClientOtherError, <br/>SASOtherError,</p>
<p>ClientTimeoutError, <br/>SASClientTimeoutError, <br/>AnonymousClientTimeoutError,</p>
<p>AuthorizationError, <br/>SASAuthorizationError)</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Availability (double)</b></p>
</td>
<td valign="top" width="378">
<p>This is the availability of the storage account as determined by the service for a given hour.&nbsp;</p>
<p>The Availability considers ServerTimeoutError and ServerOtherError as failures.</p>
<p>Availability = (X/Y) * 100</p>
<p>Where X = TotalBillableRequests and</p>
<p>Y&nbsp; = &sum;( <br/>Success, <br/>AnonymousSuccess, <br/>SASSuccess,</p>
<p>NetworkError, <br/>AnonymousNetworkError, <br/>SASNetworkError,</p>
<p>ClientOtherError, <br/>SASClientOther, <br/>AnonymousClientOtherError,</p>
<p>ServerOtherError, <br/>AnonymousServerOtherError, <br/>SASServerOtherError,</p>
<p>ClientTimeoutError, <br/>SASClientTimeoutError, <br/>AnonymousClientTimeoutError,</p>
<p>ServerTimeout, <br/>AnonymousServerTimeout, <br/>SASServerTimeout,</p>
<p>AuthorizationError, <br/>SASAuthorizationError)</p>
<p>Please note that the SLA for a storage account is the average availability for all requests across all hours across all services (blobs, tables and queues) for an entire month.&nbsp; Whereas, this availability metric is just for the specific service or API for a specific hour.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AverageE2ELatency (double)</b></p>
</td>
<td valign="top" width="378">
<p>The average end-to-end latency of successful requests made to a storage service or the specified API operation. This value includes the required processing time within Windows Azure Storage to read the request, send the response, and receive acknowledgement of the response.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AverageServerLatency (double)</b></p>
</td>
<td valign="top" width="378">
<p>The average latency used by Windows Azure Storage to process a request, excluding failed requests. This value does not include the network latency which is included in AverageE2ELatency.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentSuccess (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that succeeded.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentThrottlingError (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with throttling.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentTimeoutError (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with timeout errors (client and server timeouts). This does not differentiate between server and client timeouts.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentServerOtherError (double)</b></p>
<p align="center"><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with status code 500 i.e. Internal Server Error where the storage error code is not Timeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentClientOtherError (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with errors such as NotFound, Precondition Failed etc.</p>
<p>Most 3XX and 4XX failures fall under this category.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentAuthorizationError (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with authorization errors.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>PercentNetworkError (double)</b></p>
</td>
<td valign="top" width="378">
<p>The percentage of requests that failed with network errors.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Success (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of requests that were successful against the service/API.</p>
<p>These will also include all conditional GET requests that did not return because the condition did not succeed.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousSuccess (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that were successful against the service/ API.</p>
<p>These will also include all conditional GET requests that did not return because the condition did not succeed.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASSuccess (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that were successful against the service/API.</p>
<p>These will also include all conditional GET requests that did not return because the condition did not succeed.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ThrottlingError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The number of authenticated requests that returned ServerBusy i.e. 503 status code.</p>
<p>These are not billable and are not counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousThrottlingError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The number of anonymous requests that returned ServerBusy i.e. 503 status code.</p>
<p>These are not billable and are not counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASThrottlingError (long)</b></p>
<p><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </b></p>
</td>
<td valign="top" width="378">
<p>The number of SAS requests that returned ServerBusy i.e. 503 status code.</p>
<p>These are not billable and are not counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ClientTimeoutError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that timed out against the service/API.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>This happens when timeout value provided is not sufficient for the IO over the network. For example, if the read/write/etc. request completes in the expected time on the server but it takes a long time to return to the client due to network latency, this is considered as a client timeout.&nbsp;</p>
<p>Any other timeout will be deemed as ServerTimeout.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousClientTimeoutError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that timed out against the service/API.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>This happens when timeout value provided is not sufficient for the IO of the network. For example, if the read/write/etc. request completes in the expected time on the server but it takes a long time to return to the client due to network latency, this is considered as a client timeout.&nbsp;</p>
<p>Any other timeout will be deemed as AnonymousServerTimeout.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASClientTimeoutError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that timed out against the service/API.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>This happens when timeout value provided is not sufficient for the IO of the network. For example, if the read/write/etc. request completes in the expected time on the server but it takes a long time to return to the client due to network latency, this is considered as a client timeout.&nbsp;</p>
<p>Any other timeout will be deemed as SASServerTimeout.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ServerTimeoutError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that timed out against the service/API because the service took a longer time to process the request. The time taken by service excludes the time to read/write from/to client over the network.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousServerTimeoutError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that timed out against the service/API because the service took a longer time to process the request. The time taken by service excludes the time to read/write from/to client over the network.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASServerTimeoutError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of requests that timed out against the service/API because the service took a longer time to process the request. The time taken by service excludes the time to read/write from/to client over the network.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as &ldquo;Timeout&rdquo;.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ClientOtherError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that failed as expected against the service/API.</p>
<p>Examples are Resource already exists, Resource not found etc.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASClientOtherError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that failed as expected against the service/API.</p>
<p>Examples are Resource already exists, Resource not found etc.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousClientOtherError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that failed precondition checks (like If- Modified etc.) for GET requests.</p>
<p>Examples: Conditional GET requests that fail the check.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ServerOtherError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that failed due to unknown server errors.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousServerOtherError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that failed due to unknown server errors.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASServerOtherError (long)</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that failed due to unknown server errors.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
<p>These are not billable requests and counted against availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AuthorizationError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that failed because authorization failed or anonymous access against objects that are not public.</p>
<p>Example: write requests from users to&nbsp; logs under $logs will be treated as Authorization error.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousAuthorizationError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that failed because authorization failed or anonymous access against objects that are not public.</p>
<p>Example: only authenticated write requests are allowed.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASAuthorizationError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that failed because authorization failed or anonymous access against objects that are not public.</p>
<p>Example: write requests using SAS when only read access was provided Authorization error.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>NetworkError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of authenticated requests that failed because of network errors.</p>
<p>Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousNetworkError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of anonymous requests that failed because of network errors.</p>
<p>Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASNetworkError (long)</b><b></b></p>
<p><b>&nbsp;</b></p>
</td>
<td valign="top" width="378">
<p>The total number of SAS requests that failed because of network errors.</p>
<p>Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
<p>These are billable requests and counted for availability.</p>
</td>
</tr>
</tbody>
</table>
<p align="center">Table 2 Schema for transaction metrics tables for Blobs, Tables and Queues</p>
<h3>How do I cleanup old Metrics data?</h3>
<p>As described above, we highly recommend you set a retention policy for your analytics data. If set, the maximum retention policy allowed is 365 days. Once a retention policy is set, the system will delete the records in the metrics tables and log blobs from the $logs container.&nbsp; The retention period can be set different for logs from metrics data. For example: If a user sets the retention policy for metrics to be 100 days and 30 days for logs, then all the logs for queue, blob, and table services will be deleted after 30 days and records stored in the associated tables will be deleted if the content is &gt; 100 days. Retention policy is enforced even if analytics is turned off but retention policy is enabled.&nbsp; If you do not set a retention policy you can manage your data by manually deleting entities (like you delete entities in regular tables) whenever you wish to do so.</p>
<h3>Searching your analytics metrics data</h3>
<p>Your metrics can be retrieved using the Query Tables and Query Entities APIs.&nbsp; You have the ability to query and/or delete records in the tables.&nbsp; Note that the tables themselves cannot be deleted.&nbsp; These tables can be read from like any other user created Windows Azure Table. The REST URI for the metrics table is http://&lt;accountname&gt;.table.core.windows.net/Tables(&ldquo;$MetricsTransactionsBlob&rdquo;) to access the Blob Transaction table and http://&lt;accountname&gt;.table.core.windows.net/$MetricsTransactionsBlob() to access rows stored in them.&nbsp; To filter the data you can use the $filter=&lt;query expression&gt; extension of the <a href="http://msdn.microsoft.com/en-us/library/dd179363.aspx">Query Entities API</a>.</p>
<p>The metrics are stored on an hour granularity.&nbsp; The time key represents the starting hour in which the requests were executed.&nbsp;&nbsp; For example, the metrics with a key of 1:00, represent the requests that started between 1:00 and 2:00.&nbsp; The metrics data is optimized to get historical data based on a time range.&nbsp;</p>
<p><i>Scenario</i>: I want to retrieve capacity details for blob service starting from 2011/05/20 05:00a.m until 2011/05/30 05:00a.m</p>
<p>GET&nbsp; http://sally.table.core.windows.net/$MetricsCapacityBlob()?$filter=PartitionKey ge &lsquo;20110520T0500&rsquo;and PartitionKey le &lsquo;20110530T0500&rsquo;</p>
<p><i>Scenario</i>: I want to view request details (including API details) for table service starting from 2011/05/20 05:00a.m until 2011/05/30 05:00a.m only for requests made to user data</p>
<p>GET http://sally.table.core.windows.net/$MetricsTransactionsTable()?$filter= PartitionKey ge &lsquo;20110520T0500&rsquo;and PartitionKey le &lsquo;20110530T0500&rsquo;and RowKey ge &lsquo;user;&rsquo; and RowKey lt &lsquo;user&lt;&rsquo;</p>
<p>To collect trending data you can view historical information (up to the point of your retention policy) which gives you insights into usage, capacity, and other trends.</p>
<h3>What charges occur due to metrics?</h3>
<p>The billable operations listed below are charged at the same rates applicable to all Windows Azure Storage operations. For more information on how these transactions are billed, see <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx">Understanding Windows Azure Storage Billing - Bandwidth, Transactions, and Capacity</a>.</p>
<p>The following actions performed by Windows Azure Storage are billable:</p>
<ul>
<li>Write requests to create table entities for metrics</li>
</ul>
<p class="BulletedList1">Read and delete requests by the application/client to metrics data are also billable. If you have configured a data retention policy, you are not charged when Windows Azure Storage deletes old metrics data. However, if you delete analytics data, your account is charged for the delete operations.</p>
<p>The capacity used by $metrics tables are billable.</p>
<p>The following can be used to estimate the amount of capacity used for storing metrics data:</p>
<ul>
<li>If a service each hour utilizes every API in every service, then approximately 148KB of data may be stored every hour in the metrics transaction tables if both service and API level summary are enabled.</li>
<li>If a service each hour utilizes every API in every service, then approximately 12KB of data may be stored every hour in the metrics transaction tables if just service level summary is enabled.</li>
<li>The capacity table for blobs will have 2 rows each day (provided user has opted in for logs) and that implies that every day approximately up to 300 bytes may be added.</li>
</ul>
<h3>Turning Metrics On</h3>
<p>A REST API call, as shown below, is used to turn Analytics on for Metrics. In this example, logging is turned on for deletes and writes, but not for reads. The retention policy is enabled and set to ten days - so the analytics service will take care of deleting data older than ten days for you at no additional cost.</p>
<pre class="code">Request: 
PUT <a href="http://sally.blob.core.windows.net/?restype=service&amp;comp=properties">http:<span style="color: green;">//sally.blob.core.windows.net/?restype=service&amp;comp=properties</span></a> <br/>HTTP/1.1
x-ms-version: 2009-09-19
x-ms-date: Fri, 25 Mar 2011 23:13:08 GMT
Authorization: SharedKey sally:zvfPm5cm8CiVP2VA9oJGYpHAPKxQb1HD44IWmubot0A=
Host: sally.blob.core.windows.net

&lt;?xml version=<span style="color: #a31515;">"1.0" </span>encoding=<span style="color: #a31515;">"utf-8"</span>?&gt;
&lt;StorageServiceProperties&gt;

    &lt;Logging&gt;
        &lt;<span style="color: #2b91af;">Version</span>&gt;1.0&lt;/<span style="color: #2b91af;">Version</span>&gt;
        &lt;Delete&gt;<span style="color: blue;">true </span>&lt;/Delete&gt;
        &lt;Read&gt; <span style="color: blue;">false</span>&lt;/Read&gt;
        &lt;Write&gt;<span style="color: blue;">true </span>&lt;/Write&gt;
        &lt;RetentionPolicy&gt;
        &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
        &lt;Days&gt;7&lt;/Days&gt;
    &lt;/RetentionPolicy&gt;
    &lt;/Logging&gt;

    &lt;Metrics&gt;
        &lt;<span style="color: #2b91af;">Version</span>&gt;1.0&lt;/<span style="color: #2b91af;">Version</span>&gt;
        &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
        &lt;IncludeAPIs&gt;<span style="color: blue;">true</span>&lt;/IncludeAPIs&gt;
        &lt;RetentionPolicy&gt;
            &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
            &lt;Days&gt;10&lt;/Days&gt;
        &lt;/RetentionPolicy&gt;
    &lt;/Metrics&gt;

&lt;/StorageServiceProperties &gt;

Response:
HTTP/1.1 202 
<span style="color: #2b91af;">Content</span>-Length: 0
Server: Windows-Azure-Metrics/1.0 Microsoft-HTTPAPI/2.0
x-ms-request-id: 4d02712a-a68a-4763-8f9b-c2526625be68
x-ms-version: 2009-09-19
Date: Fri, 25 Mar 2011 23:13:08 GMT</pre>
<p>The logging and metrics sections allow you to configure what you want to track in your analytics logs and metrics data.&nbsp; The metrics configuration values are described here:</p>
<ul>
<li>Version - The version of Analytics Logging used to record the entry.</li>
<li>Enabled (Boolean) &ndash; set to true if you want track metrics data via analytics</li>
<li>IncludedAPIs (Boolean) &ndash; set to true if you want to track metrics for the individual APIs accessed</li>
<li>Retention policy &ndash; this is where you set the retention policy to help you manage the size of your analytics data
<ul>
<li>Enabled (Boolean) &ndash; set to true if you want to enable a retention policy. We recommend that you do this.</li>
<li>Days (int) &ndash; the number of days you want to keep your analytics logging data. This can be a max of 365 days and a min of 1 day</li>
</ul>
</li>
</ul>
<p>For more information, please see the <a href="http://msdn.microsoft.com/en-us/library/hh343270.aspx">MSDN Documentation</a>. (this link will be live later today)</p>
<p>To turn on analytics, here are extensions to StorageClient library&rsquo;s CloudBlobClient, CloudTableClient and CloudQueueClient. The extension methods and utility methods that accomplish this is just sample code in which error handling has been removed for brevity.</p>
<p>Let us start by listing a sample code that uses the extension samples:</p>
<pre class="code">AnalyticsSettings settings = <span style="color: blue;">new </span>AnalyticsSettings()
    {
        LogType = LoggingLevel.Delete | LoggingLevel.Read | LoggingLevel.Write,
        IsLogRetentionPolicyEnabled = <span style="color: blue;">true</span>,
        LogRetentionInDays = 1,
        IsMetricsRetentionPolicyEnabled = <span style="color: blue;">true</span>,
        MetricsRetentionInDays = 7,
        MetricsType = MetricsType.All
    };

<span style="color: green;">// set the settings for each service </span>blobClient.SetServiceSettings(settings);
queueClient.SetServiceSettings(account.QueueEndpoint, settings);
tableClient.SetServiceSettings(settings);

<span style="color: green;">// get the settings from each service </span>AnalyticsSettings blobSettings = blobClient.GetServiceSettings();
AnalyticsSettings tableSettings = tableClient.GetServiceSettings();
AnalyticsSettings queueSettings = queueClient.GetServiceSettings(account.QueueEndpoint);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>We have added here a new self-explanatory settings class called AnalyticsSettings to contain the settings that can be set / retrieved. Each property listed in settings above has a property representing it.</p>
<pre class="code"><span style="color: blue;">using </span>System;

<span style="color: blue;">namespace </span>AnalyticsSamples
{

    [<span style="color: #2b91af;">Flags</span>]
    <span style="color: blue;">public enum </span><span style="color: #2b91af;">LoggingLevel </span>{
        None = 0,
        Delete = 2,
        Write = 4,
        Read = 8,
    }

    [<span style="color: #2b91af;">Flags</span>]
    <span style="color: blue;">public enum </span><span style="color: #2b91af;">MetricsType </span>{
        None = 0x0,
        ServiceSummary = 0x1,
        ApiSummary = 0x2,
        All = ServiceSummary | ApiSummary,
    }

    <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The analytic settings that can set/get </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public class </span><span style="color: #2b91af;">AnalyticsSettings </span>{
        <span style="color: blue;">public static string </span>Version = <span style="color: #a31515;">"1.0"</span>;

        <span style="color: blue;">public </span>AnalyticsSettings()
        {
            <span style="color: blue;">this</span>.LogType = LoggingLevel.None;
            <span style="color: blue;">this</span>.LogVersion = AnalyticsSettings.Version;
            <span style="color: blue;">this</span>.IsLogRetentionPolicyEnabled = <span style="color: blue;">false</span>;
            <span style="color: blue;">this</span>.LogRetentionInDays = 0;

            <span style="color: blue;">this</span>.MetricsType = MetricsType.None;
            <span style="color: blue;">this</span>.MetricsVersion = AnalyticsSettings.Version;
            <span style="color: blue;">this</span>.IsMetricsRetentionPolicyEnabled = <span style="color: blue;">false</span>;
            <span style="color: blue;">this</span>.MetricsRetentionInDays = 0;
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The type of logs subscribed for </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public </span>LoggingLevel LogType { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The version of the logs </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public string </span>LogVersion { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Flag indicating if retention policy is set for logs in $logs </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public bool </span>IsLogRetentionPolicyEnabled { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The number of days to retain logs for under $logs container </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public int </span>LogRetentionInDays { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The metrics version </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public string </span>MetricsVersion { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">A flag indicating if retention policy is enabled for metrics </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public bool </span>IsMetricsRetentionPolicyEnabled { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The number of days to retain metrics data </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public int </span>MetricsRetentionInDays { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: blue;">private </span>MetricsType metricsType = MetricsType.None;

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">The type of metrics subscribed for </span><span style="color: gray;">/// &lt;/summary&gt; </span><span style="color: blue;">public </span>MetricsType MetricsType
        {
            <span style="color: blue;">get </span>{
                <span style="color: blue;">return </span>metricsType;
            }

            <span style="color: blue;">set </span>{
                <span style="color: blue;">if </span>(<span style="color: blue;">value </span>== MetricsType.ApiSummary)
                {
                    <span style="color: blue;">throw new </span><span style="color: #2b91af;">ArgumentException</span>(<span style="color: #a31515;">"Including just ApiSummary is invalid."</span>);
                }

                <span style="color: blue;">this</span>.metricsType = <span style="color: blue;">value</span>;
            }
        }
    }
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>Now that we have covered the basic class, let us go over the extension class that provides the ability to set/get settings. This class provides extension methods SetServicesettings and GetServiceSettings on each one of the client objects. The rest is self-explanatory as the extension method takes the settings and then calls a single method to dispatch the settings by serializing/deserializing the settings class.</p>
<p>NOTE: Because CloudQueueClient does not expose the BaseUri property, the extension takes the base Uri explicitly.</p>
<pre class="code"><span style="color: blue;">using </span>System;
<span style="color: blue;">using </span>System.Text;
<span style="color: blue;">using </span>Microsoft.WindowsAzure.StorageClient;
<span style="color: blue;">using </span>System.Globalization;
<span style="color: blue;">using </span>System.Net;
<span style="color: blue;">using </span>Microsoft.WindowsAzure;
<span style="color: blue;">using </span>System.IO;
<span style="color: blue;">using </span>System.Xml;

<span style="color: blue;">namespace </span>AnalyticsSamples
{
    <span style="color: blue;">public static class </span><span style="color: #2b91af;">AnalyticsSettingsExtension </span>{
        <span style="color: blue;">static string </span>RequestIdHeaderName = <span style="color: #a31515;">"x-ms-request-id"</span>;
        <span style="color: blue;">static string </span>VersionHeaderName = <span style="color: #a31515;">"x-ms-version"</span>;
        <span style="color: blue;">static string </span>Sep2009Version = <span style="color: #a31515;">"2009-09-19"</span>;
        <span style="color: blue;">static </span><span style="color: #2b91af;">TimeSpan </span>DefaultTimeout = <span style="color: #2b91af;">TimeSpan</span>.FromSeconds(30);

        <span style="color: blue;">#region </span>Analytics
        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Set blob analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudBlobClient client, AnalyticsSettings settings)
        {
            SetSettings(client.BaseUri, client.Credentials, settings, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Set queue analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;param name="baseUri"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudQueueClient client, Uri baseUri, AnalyticsSettings settings)
        {
            SetSettings(baseUri, client.Credentials, settings, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Set blob analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudTableClient client, AnalyticsSettings settings)
        {
            SetSettings(client.BaseUri, client.Credentials, settings, <span style="color: blue;">true </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Set analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="baseUri"&gt;&lt;/param&gt; /// &lt;param name="credentials"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; /// &lt;param name="useSharedKeyLite"&gt;&lt;/param&gt; </span><span style="color: blue;">public static void </span>SetSettings(Uri baseUri, StorageCredentials credentials, AnalyticsSettings settings, <span style="color: blue;">bool </span>useSharedKeyLite)
        {
            UriBuilder builder = <span style="color: blue;">new </span>UriBuilder(baseUri);
            builder.Query = <span style="color: blue;">string</span>.Format(
                <span style="color: #2b91af;">CultureInfo</span>.InvariantCulture,
                <span style="color: #a31515;">"comp=properties&amp;restype=service&amp;timeout={0}"</span>, 
                DefaultTimeout.TotalSeconds);

            HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(builder.Uri);
            request.Headers.Add(VersionHeaderName, Sep2009Version);
            request.Method = <span style="color: #a31515;">"PUT"</span>;

            StorageCredentialsAccountAndKey accountAndKey = credentials <span style="color: blue;">as </span>StorageCredentialsAccountAndKey;
            <span style="color: blue;">using </span>(<span style="color: #2b91af;">MemoryStream </span>buffer = <span style="color: blue;">new </span><span style="color: #2b91af;">MemoryStream</span>())
            {
                XmlTextWriter writer = <span style="color: blue;">new </span>XmlTextWriter(buffer, <span style="color: #2b91af;">Encoding</span>.UTF8);
                SettingsSerializerHelper.SerializeAnalyticsSettings(writer, settings);
                writer.Flush();
                buffer.Seek(0, <span style="color: #2b91af;">SeekOrigin</span>.Begin);
                request.ContentLength = buffer.Length;

                <span style="color: blue;">if </span>(useSharedKeyLite)
                {
                    credentials.SignRequestLite(request);
                }
                <span style="color: blue;">else </span>{
                    credentials.SignRequest(request);
                }

                <span style="color: blue;">using </span>(<span style="color: #2b91af;">Stream </span>stream = request.GetRequestStream())
                {
                    stream.Write(buffer.GetBuffer(), 0, (<span style="color: blue;">int</span>)buffer.Length);
                }

                <span style="color: blue;">try </span>{
                    <span style="color: blue;">using </span>(HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                    {
                        <span style="color: #2b91af;">Console</span>.WriteLine(<span style="color: #a31515;">"Response Request Id = {0} Status={1}"</span>, response.Headers[RequestIdHeaderName], response.StatusCode);
                        <span style="color: blue;">if </span>(HttpStatusCode.Accepted != response.StatusCode)
                        {
                            <span style="color: blue;">throw new </span><span style="color: #2b91af;">Exception</span>(<span style="color: #a31515;">"Request failed with incorrect response status."</span>);
                        }
                    }
                }
                <span style="color: blue;">catch </span>(WebException e)
                {
                    <span style="color: #2b91af;">Console</span>.WriteLine(
                        <span style="color: #a31515;">"Response Request Id={0} Status={1}"</span>,
                        e.Response != <span style="color: blue;">null </span>? e.Response.Headers[RequestIdHeaderName] : <span style="color: #a31515;">"Response is null"</span>,
                        e.Status);
                    <span style="color: blue;">throw</span>;
                }

            }
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Get blob analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudBlobClient client)
        {
            <span style="color: blue;">return </span>GetSettings(client.BaseUri, client.Credentials, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Get queue analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;param name="baseUri"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudQueueClient client, Uri baseUri)
        {
            <span style="color: blue;">return </span>GetSettings(baseUri, client.Credentials, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Get table analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="client"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudTableClient client)
        {
            <span style="color: blue;">return </span>GetSettings(client.BaseUri, client.Credentials, <span style="color: blue;">true </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Get analytics settings </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="baseUri"&gt;&lt;/param&gt; /// &lt;param name="credentials"&gt;&lt;/param&gt; /// &lt;param name="useSharedKeyLite"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static </span>AnalyticsSettings GetSettings(Uri baseUri, StorageCredentials credentials, <span style="color: blue;">bool </span>useSharedKeyLite)
        {
            UriBuilder builder = <span style="color: blue;">new </span>UriBuilder(baseUri);
            builder.Query = <span style="color: blue;">string</span>.Format(
                <span style="color: #2b91af;">CultureInfo</span>.InvariantCulture,
                <span style="color: #a31515;">"comp=properties&amp;restype=service&amp;timeout={0}"</span>,
                DefaultTimeout.TotalSeconds);

            HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(builder.Uri);
            request.Headers.Add(VersionHeaderName, Sep2009Version);
            request.Method = <span style="color: #a31515;">"GET"</span>;

            StorageCredentialsAccountAndKey accountAndKey = credentials <span style="color: blue;">as </span>StorageCredentialsAccountAndKey;

            <span style="color: blue;">if </span>(useSharedKeyLite)
            {
                credentials.SignRequestLite(request);
            }
            <span style="color: blue;">else </span>{
                credentials.SignRequest(request);
            }

            <span style="color: blue;">try </span>{
                <span style="color: blue;">using </span>(HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                {
                    <span style="color: #2b91af;">Console</span>.WriteLine(<span style="color: #a31515;">"Response Request Id={0} Status={1}"</span>, response.Headers[RequestIdHeaderName], response.StatusCode);

                    <span style="color: blue;">if </span>(HttpStatusCode.OK != response.StatusCode)
                    {
                        <span style="color: blue;">throw new </span><span style="color: #2b91af;">Exception</span>(<span style="color: #a31515;">"expected HttpStatusCode.OK"</span>);
                    }

                    <span style="color: blue;">using </span>(<span style="color: #2b91af;">Stream </span>stream = response.GetResponseStream())
                    {
                        <span style="color: blue;">using </span>(<span style="color: #2b91af;">StreamReader </span>streamReader = <span style="color: blue;">new </span><span style="color: #2b91af;">StreamReader</span>(stream))
                        {
                            <span style="color: blue;">string </span>responseString = streamReader.ReadToEnd();
                            <span style="color: #2b91af;">Console</span>.WriteLine(responseString);

                            XmlReader reader = XmlReader.Create(<span style="color: blue;">new </span><span style="color: #2b91af;">MemoryStream</span>(<span style="color: #2b91af;">ASCIIEncoding</span>.UTF8.GetBytes(responseString)));
                            <span style="color: blue;">return </span>SettingsSerializerHelper.DeserializeAnalyticsSettings(reader);
                        }
                    }
                }
            }
            <span style="color: blue;">catch </span>(WebException e)
            {
                <span style="color: #2b91af;">Console</span>.WriteLine(
                    <span style="color: #a31515;">"Response Request Id={0} Status={1}"</span>,
                    e.Response != <span style="color: blue;">null </span>? e.Response.Headers[RequestIdHeaderName] : <span style="color: #a31515;">"Response is null"</span>,
                    e.Status);
                <span style="color: blue;">throw</span>;
            }
        }
        <span style="color: blue;">#endregion </span>}
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>Now to the crux of the code which handles serialization/deserialization. This code provides a SerializeAnalyticsSettings method that serializes AnalyticsSettings class into the format expected by the service and provides DeserializeAnalyticsSettings to reconstruct the AnalyticsSettings class from the response for GET REST method.</p>
<pre class="code"><span style="color: blue;">using </span>System.Xml;

<span style="color: blue;">namespace </span>AnalyticsSamples
{
    <span style="color: blue;">public static class </span><span style="color: #2b91af;">SettingsSerializerHelper </span>{
        <span style="color: blue;">private const string </span>RootPropertiesElementName = <span style="color: #a31515;">"StorageServiceProperties"</span>;
        <span style="color: blue;">private const string </span>VersionElementName = <span style="color: #a31515;">"Version"</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyElementName = <span style="color: #a31515;">"RetentionPolicy"</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyEnabledElementName = <span style="color: #a31515;">"Enabled"</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyDaysElementName = <span style="color: #a31515;">"Days"</span>;

        <span style="color: blue;">private const string </span>LoggingElementName = <span style="color: #a31515;">"Logging"</span>;
        <span style="color: blue;">private const string </span>ApiTypeDeleteElementName = <span style="color: #a31515;">"Delete"</span>;
        <span style="color: blue;">private const string </span>ApiTypeReadElementName = <span style="color: #a31515;">"Read"</span>;
        <span style="color: blue;">private const string </span>ApiTypeWriteElementName = <span style="color: #a31515;">"Write"</span>;

        <span style="color: blue;">private const string </span>MetricsElementName = <span style="color: #a31515;">"Metrics"</span>;
        <span style="color: blue;">private const string </span>IncludeApiSummaryElementName = <span style="color: #a31515;">"IncludeAPIs"</span>;
        <span style="color: blue;">private const string </span>MetricsEnabledElementName = <span style="color: #a31515;">"Enabled"</span>;

        <span style="color: blue;">private const int </span>MaximumRetentionDays = 365;

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Reads the settings provided from stream </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="xmlReader"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static </span>AnalyticsSettings DeserializeAnalyticsSettings(XmlReader xmlReader)
        {
            <span style="color: green;">// Read the root and check if it is empty or invalid </span>xmlReader.Read();
            xmlReader.ReadStartElement(SettingsSerializerHelper.RootPropertiesElementName);

            AnalyticsSettings settings = <span style="color: blue;">new </span>AnalyticsSettings();

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.LoggingElementName))
                {
                    DeserializeLoggingElement(xmlReader, settings);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.MetricsElementName))
                {
                    DeserializeMetricsElement(xmlReader, settings);
                }
                <span style="color: blue;">else </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement();

            <span style="color: blue;">return </span>settings;
        }


        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Write the settings provided to stream </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="inputStream"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">public static void </span>SerializeAnalyticsSettings(XmlWriter xmlWriter, AnalyticsSettings settings)
        {
            xmlWriter.WriteStartDocument();
            xmlWriter.WriteStartElement(SettingsSerializerHelper.RootPropertiesElementName);

            <span style="color: green;">//LOGGING STARTS HERE </span>xmlWriter.WriteStartElement(SettingsSerializerHelper.LoggingElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.VersionElementName);
            xmlWriter.WriteValue(settings.LogVersion);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isReadEnabled = (settings.LogType &amp; LoggingLevel.Read) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeReadElementName);
            xmlWriter.WriteValue(isReadEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isWriteEnabled = (settings.LogType &amp; LoggingLevel.Write) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeWriteElementName);
            xmlWriter.WriteValue(isWriteEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isDeleteEnabled = (settings.LogType &amp; LoggingLevel.Delete) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeDeleteElementName);
            xmlWriter.WriteValue(isDeleteEnabled);
            xmlWriter.WriteEndElement();

            SerializeRetentionPolicy(xmlWriter, settings.IsLogRetentionPolicyEnabled, settings.LogRetentionInDays);
            xmlWriter.WriteEndElement(); <span style="color: green;">// logging element //METRICS STARTS HERE </span>xmlWriter.WriteStartElement(SettingsSerializerHelper.MetricsElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.VersionElementName);
            xmlWriter.WriteValue(settings.MetricsVersion);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isServiceSummaryEnabled = (settings.MetricsType &amp; MetricsType.ServiceSummary) != MetricsType.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.MetricsEnabledElementName);
            xmlWriter.WriteValue(isServiceSummaryEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">if </span>(isServiceSummaryEnabled)
            {
                <span style="color: blue;">bool </span>isApiSummaryEnabled = (settings.MetricsType &amp; MetricsType.ApiSummary) != MetricsType.None;
                xmlWriter.WriteStartElement(SettingsSerializerHelper.IncludeApiSummaryElementName);
                xmlWriter.WriteValue(isApiSummaryEnabled);
                xmlWriter.WriteEndElement();
            }

            SerializeRetentionPolicy(
                xmlWriter,
                settings.IsMetricsRetentionPolicyEnabled,
                settings.MetricsRetentionInDays);
            xmlWriter.WriteEndElement(); <span style="color: green;">// metrics </span>xmlWriter.WriteEndElement(); <span style="color: green;">// root element </span>xmlWriter.WriteEndDocument();
        }

        <span style="color: blue;">private static void </span>SerializeRetentionPolicy(XmlWriter xmlWriter, <span style="color: blue;">bool </span>isRetentionEnabled, <span style="color: blue;">int </span>days)
        {
            xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyEnabledElementName);
            xmlWriter.WriteValue(isRetentionEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">if </span>(isRetentionEnabled)
            {
                xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyDaysElementName);
                xmlWriter.WriteValue(days);
                xmlWriter.WriteEndElement();
            }

            xmlWriter.WriteEndElement(); <span style="color: green;">// Retention policy for logs </span>}

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Reads the logging element and fills in the values in Analyticssettings instance </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="xmlReader"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; </span><span style="color: blue;">private static void </span>DeserializeLoggingElement(
            XmlReader xmlReader,
            AnalyticsSettings settings)
        {
            <span style="color: green;">// Read logging element </span>xmlReader.ReadStartElement(SettingsSerializerHelper.LoggingElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.VersionElementName))
                {
                    settings.LogVersion = xmlReader.ReadElementString(SettingsSerializerHelper.VersionElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeReadElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeReadElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Read;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeWriteElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeWriteElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Write;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeDeleteElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeDeleteElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Delete;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyElementName))
                {
                    <span style="color: green;">// read retention policy for logging </span><span style="color: blue;">bool </span>isRetentionEnabled = <span style="color: blue;">false</span>;
                    <span style="color: blue;">int </span>retentionDays = 0;
                    DeserializeRetentionPolicy(xmlReader, <span style="color: blue;">ref </span>isRetentionEnabled, <span style="color: blue;">ref </span>retentionDays);
                    settings.IsLogRetentionPolicyEnabled = isRetentionEnabled;
                    settings.LogRetentionInDays = retentionDays;
                }
                <span style="color: blue;">else </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement();<span style="color: green;">// end Logging element </span>}

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Reads the metrics element and fills in the values in Analyticssettings instance </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="xmlReader"&gt;&lt;/param&gt; /// &lt;param name="settings"&gt;&lt;/param&gt; </span><span style="color: blue;">private static void </span>DeserializeMetricsElement(
            XmlReader xmlReader,
            AnalyticsSettings settings)
        {
            <span style="color: blue;">bool </span>includeAPIs = <span style="color: blue;">false</span>;

            <span style="color: green;">// read the next element - it should be metrics. </span>xmlReader.ReadStartElement(SettingsSerializerHelper.MetricsElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.VersionElementName))
                {
                    settings.MetricsVersion = xmlReader.ReadElementString(SettingsSerializerHelper.VersionElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.MetricsEnabledElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.MetricsEnabledElementName))
                    {
                        <span style="color: green;">// only if metrics is enabled will we read include API </span>settings.MetricsType = settings.MetricsType | MetricsType.ServiceSummary;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.IncludeApiSummaryElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.IncludeApiSummaryElementName))
                    {
                        includeAPIs = <span style="color: blue;">true</span>;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyElementName))
                {
                    <span style="color: green;">// read retention policy for metrics </span><span style="color: blue;">bool </span>isRetentionEnabled = <span style="color: blue;">false</span>;
                    <span style="color: blue;">int </span>retentionDays = 0;
                    DeserializeRetentionPolicy(xmlReader, <span style="color: blue;">ref </span>isRetentionEnabled, <span style="color: blue;">ref </span>retentionDays);
                    settings.IsMetricsRetentionPolicyEnabled = isRetentionEnabled;
                    settings.MetricsRetentionInDays = retentionDays;
                }
                <span style="color: blue;">else </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            <span style="color: blue;">if </span>((settings.MetricsType &amp; MetricsType.ServiceSummary) != MetricsType.None)
            {
                <span style="color: green;">// If Metrics is enabled, IncludeAPIs must be included. </span><span style="color: blue;">if </span>(includeAPIs)
                {
                    settings.MetricsType = settings.MetricsType | MetricsType.ApiSummary;
                }
            }

            xmlReader.ReadEndElement();<span style="color: green;">// end metrics element </span>}


        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Reads the retention policy in logging and metrics elements </span><span style="color: gray;">/// </span><span style="color: green;">and fills in the values in Analyticssettings instance. </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="xmlReader"&gt;&lt;/param&gt; /// &lt;param name="isRetentionEnabled"&gt;&lt;/param&gt; /// &lt;param name="retentionDays"&gt;&lt;/param&gt; </span><span style="color: blue;">private static void </span>DeserializeRetentionPolicy(
            XmlReader xmlReader,
            <span style="color: blue;">ref bool </span>isRetentionEnabled,
            <span style="color: blue;">ref int </span>retentionDays)
        {
            xmlReader.ReadStartElement(SettingsSerializerHelper.RetentionPolicyElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyEnabledElementName))
                {
                    isRetentionEnabled = DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.RetentionPolicyEnabledElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyDaysElementName))
                {
                    <span style="color: blue;">string </span>intValue = xmlReader.ReadElementString(
                        SettingsSerializerHelper.RetentionPolicyDaysElementName);
                    retentionDays = <span style="color: blue;">int</span>.Parse(intValue);
                }
                <span style="color: blue;">else </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement(); <span style="color: green;">// end reading retention policy </span>}

        <span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Read a boolean value for xml element </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="xmlReader"&gt;&lt;/param&gt; /// &lt;param name="elementToRead"&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; </span><span style="color: blue;">private static bool </span>DeserializeBooleanElementValue(
            XmlReader xmlReader,
            <span style="color: blue;">string </span>elementToRead)
        {
            <span style="color: blue;">string </span>boolValue = xmlReader.ReadElementString(elementToRead);
            <span style="color: blue;">return bool</span>.Parse(boolValue);
        }
    }
}</pre>
<p>&nbsp;</p>
<h3>Download Metrics Data</h3>
<p>Since listing normal tables does not list out metrics tables, existing tools will not be able to display these tables. In absence of existing tools, we wanted to provide a quick reference application with source code to make this data accessible.</p>
<p>The following application takes the service to download the capacity/request aggregates for, the start time and end time and a file to export to. It then exports all metric entities from the selected table to the file in a csv format. This csv format can then be consumed by say excel to study various trends on availability, errors seen by application, latency etc.</p>
<p>For example the following command will download all the ($MetricsTransactionsBlob) table entities for blob service between the provided time range into a file called MyMetrics.txt</p>
<p>DumpMetrics blob requests .\MyMetrics.txt&nbsp; &ldquo;2011-07-26T22:00Z&rdquo; &ldquo;2011-07-26T23:30Z&rdquo;</p>
<pre class="code"><span style="color: blue;">const string </span>ConnectionStringKey = <span style="color: #a31515;">"ConnectionString"</span>;

<span style="color: blue;">static void </span>Main(<span style="color: blue;">string</span>[] args)
{
    <span style="color: blue;">if </span>(args.Length &lt; 4 || args.Length &gt; 5)
    {
        Console.WriteLine(<span style="color: #a31515;">"Usage: DumpMetrics &lt;service to search - blob|table|queue&gt; &lt;capacity|requests&gt; &lt;file name to export to&gt; &lt;Start time in UTC for report&gt; &lt;Optional End time in UTC for report&gt;."</span>);
        Console.WriteLine(<span style="color: #a31515;">"Example: DumpMetrics blob capacity test.txt \"2011-06-26T20:30Z\" \"2011-06-28T22:00Z\""</span>);
        <span style="color: blue;">return</span>;
    }

    <span style="color: blue;">string </span>connectionString = ConfigurationManager.AppSettings[ConnectionStringKey];

    CloudStorageAccount account = CloudStorageAccount.Parse(connectionString);

    CloudTableClient tableClient = account.CreateCloudTableClient();

    DateTime startTimeOfSearch = DateTime.Parse(args[3]);
    DateTime endTimeOfSearch = DateTime.UtcNow;

    <span style="color: blue;">if </span>(args.Length == 5)
    {
        endTimeOfSearch = DateTime.Parse(args[4]);
    }

    <span style="color: blue;">if </span>(<span style="color: blue;">string</span>.Equals(args[1], <span style="color: #a31515;">"requests"</span>, StringComparison.OrdinalIgnoreCase))
    {
        DumpTransactionsMetrics(tableClient, args[0], startTimeOfSearch.ToUniversalTime(), endTimeOfSearch.ToUniversalTime(), args[2]);
    }
    <span style="color: blue;">else if </span>(<span style="color: blue;">string</span>.Equals(args[1], <span style="color: #a31515;">"capacity"</span>, StringComparison.OrdinalIgnoreCase) &amp;&amp; <span style="color: blue;">string</span>.Equals(args[0], <span style="color: #a31515;">"Blob"</span>, StringComparison.OrdinalIgnoreCase))
    {
        DumpCapacityMetrics(tableClient, args[0], startTimeOfSearch, endTimeOfSearch, args[2]);
    }
    <span style="color: blue;">else </span>{
        Console.WriteLine(<span style="color: #a31515;">"Invalid metrics type. Please provide Requests or Capacity. Capacity is available only for blob service"</span>);
    }
}


<span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Given a service, start time, end time search for, this method retrieves the metrics rows for requests and exports it to CSV file </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="tableClient"&gt;&lt;/param&gt; /// &lt;param name="serviceName"&gt;</span><span style="color: green;">The name of the service interested in</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="startTimeForSearch"&gt;</span><span style="color: green;">Start time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="endTimeForSearch"&gt;</span><span style="color: green;">End time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="fileName"&gt;</span><span style="color: green;">The file to write the report to</span><span style="color: gray;">&lt;/param&gt; </span><span style="color: blue;">static void </span>DumpTransactionsMetrics(CloudTableClient tableClient, <span style="color: blue;">string </span>serviceName, DateTime startTimeForSearch, DateTime endTimeForSearch, <span style="color: blue;">string </span>fileName)
{
    <span style="color: blue;">string </span>startingPK = startTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddTHH00"</span>);
    <span style="color: blue;">string </span>endingPK = endTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddTHH00"</span>);

    <span style="color: green;">// table names are case insensitive </span><span style="color: blue;">string </span>tableName = <span style="color: blue;">string</span>.Format(<span style="color: #a31515;">"$MetricsTransactions{0}"</span>, serviceName);

    Console.WriteLine(<span style="color: #a31515;">"Querying table '{0}' for PartitionKey &gt;= '{1}' and PartitionKey &lt;= '{2}'"</span>, tableName, startingPK, endingPK);

    TableServiceContext context = tableClient.GetDataServiceContext();

    <span style="color: green;">// turn off merge option as we only want to query and not issue deletes etc. </span>context.MergeOption = MergeOption.NoTracking;

    CloudTableQuery&lt;MetricsTransactionsEntity&gt; query = (from entity <span style="color: blue;">in </span>context.CreateQuery&lt;MetricsTransactionsEntity&gt;(tableName)
                                            where entity.PartitionKey.CompareTo(startingPK) &gt;= 0
                                            &amp;&amp; entity.PartitionKey.CompareTo(endingPK) &lt;= 0
                                            select entity).AsTableServiceQuery&lt;MetricsTransactionsEntity&gt;();

    <span style="color: green;">// now we have the query set. Let us iterate over all entities and store into an output file. // Also overwrite the file </span>Console.WriteLine(<span style="color: #a31515;">"Writing to '{0}'"</span>, fileName);
    <span style="color: blue;">using </span>(StreamWriter writer = <span style="color: blue;">new </span>StreamWriter(fileName))
    {
        <span style="color: green;">// write the header </span>writer.Write(<span style="color: #a31515;">"Time, Category, Request Type, Total Ingress, Total Egress, Total Requests, Total Billable Requests,"</span>);
        writer.Write(<span style="color: #a31515;">"Availability, Avg E2E Latency, Avg Server Latency, % Success, % Throttling Errors, % Timeout Errors, % Other Server Errors, % Other Client Errors, % Authorization Errors, % Network Errors, Success,"</span>);
        writer.Write(<span style="color: #a31515;">"Anonymous Success, SAS Success, Throttling Error, Anonymous Throttling Error, SAS ThrottlingError, Client Timeout Error, Anonymous Client Timeout Error, SAS Client Timeout Error,"</span>);
        writer.Write(<span style="color: #a31515;">"Server Timeout Error, Anonymous Server Timeout Error, SAS Server Timeout Error, Client Other Error, SAS Client Other Error, Anonymous Client Other Error,"</span>);
        writer.Write(<span style="color: #a31515;">"Server Other Errors, SAS Server Other Errors, Anonymous Server Other Errors, Authorization Errors, Anonymous Authorization Error, SAS Authorization Error,"</span>);
        writer.WriteLine(<span style="color: #a31515;">"Network Error, Anonymous Network Error, SAS Network Error"</span>);

        <span style="color: blue;">foreach </span>(MetricsTransactionsEntity entity <span style="color: blue;">in </span>query)
        {
            <span style="color: blue;">string</span>[] rowKeys = entity.RowKey.Split(<span style="color: #a31515;">';'</span>);
            writer.WriteLine(<span style="color: #a31515;">"{0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}"</span>,
                entity.PartitionKey,
                rowKeys[0], <span style="color: green;">// category - user | system </span>rowKeys[1], <span style="color: green;">// request type is the API name (and "All" for service summary rows) </span>entity.TotalIngress,
                entity.TotalEgress,
                entity.TotalRequests,
                entity.TotalBillableRequests,
                entity.Availability,
                entity.AverageE2ELatency,
                entity.AverageServerLatency,
                entity.PercentSuccess,
                entity.PercentThrottlingError,
                entity.PercentTimeoutError,
                entity.PercentServerOtherError,
                entity.PercentClientOtherError,
                entity.PercentAuthorizationError,
                entity.PercentNetworkError,
                entity.Success,
                entity.AnonymousSuccess,
                entity.SASSuccess,
                entity.ThrottlingError,
                entity.AnonymousThrottlingError,
                entity.SASThrottlingError,
                entity.ClientTimeoutError,
                entity.AnonymousClientTimeoutError,
                entity.SASClientTimeoutError,
                entity.ServerTimeoutError,
                entity.AnonymousServerTimeoutError,
                entity.SASServerTimeoutError,
                entity.ClientOtherError,
                entity.SASClientOtherError,
                entity.AnonymousClientOtherError,
                entity.ServerOtherError,
                entity.SASServerOtherError,
                entity.AnonymousServerOtherError,
                entity.AuthorizationError,
                entity.AnonymousAuthorizationError,
                entity.SASAuthorizationError,
                entity.NetworkError,
                entity.AnonymousNetworkError,
                entity.SASNetworkError);
        }
    }
}

<span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Given a service, start time, end time search for, this method retrieves the metrics rows for capacity and exports it to CSV file </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="tableClient"&gt;&lt;/param&gt; /// &lt;param name="serviceName"&gt;</span><span style="color: green;">The name of the service interested in</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="startTimeForSearch"&gt;</span><span style="color: green;">Start time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="endTimeForSearch"&gt;</span><span style="color: green;">End time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="fileName"&gt;</span><span style="color: green;">The file to write the report to</span><span style="color: gray;">&lt;/param&gt; </span><span style="color: blue;">static void </span>DumpCapacityMetrics(CloudTableClient tableClient, <span style="color: blue;">string </span>serviceName, DateTime startTimeForSearch, DateTime endTimeForSearch, <span style="color: blue;">string </span>fileName)
{
    <span style="color: blue;">string </span>startingPK = startTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddT0000"</span>);
    <span style="color: blue;">string </span>endingPK = endTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddT0000"</span>);

    <span style="color: green;">// table names are case insensitive </span><span style="color: blue;">string </span>tableName = <span style="color: blue;">string</span>.Format(<span style="color: #a31515;">"$MetricsCapacity{0}"</span>, serviceName);

    Console.WriteLine(<span style="color: #a31515;">"Querying table '{0}' for PartitionKey &gt;= '{1}' and PartitionKey &lt;= '{2}'"</span>, tableName, startingPK, endingPK);

    TableServiceContext context = tableClient.GetDataServiceContext();

    <span style="color: green;">// turn off merge option as we only want to query and not issue deletes etc. </span>context.MergeOption = MergeOption.NoTracking;

    CloudTableQuery&lt;MetricsCapacityEntity&gt; query = (from entity <span style="color: blue;">in </span>context.CreateQuery&lt;MetricsCapacityEntity&gt;(tableName)
                                            where entity.PartitionKey.CompareTo(startingPK) &gt;= 0
                                            &amp;&amp; entity.PartitionKey.CompareTo(endingPK) &lt;= 0
                                                    select entity).AsTableServiceQuery&lt;MetricsCapacityEntity&gt;();

    <span style="color: green;">// now we have the query set. Let us iterate over all entities and store into an output file. // Also overwrite the file </span>Console.WriteLine(<span style="color: #a31515;">"Writing to '{0}'"</span>, fileName);
    <span style="color: blue;">using </span>(StreamWriter writer = <span style="color: blue;">new </span>StreamWriter(fileName))
    {
        <span style="color: green;">// write the header </span>writer.WriteLine(<span style="color: #a31515;">"Time, Category, Capacity (bytes), Container count, Object count"</span>);

        <span style="color: blue;">foreach </span>(MetricsCapacityEntity entity <span style="color: blue;">in </span>query)
        {
            writer.WriteLine(<span style="color: #a31515;">"{0}, {1}, {2}, {3}, {4}"</span>,
                entity.PartitionKey,
                entity.RowKey,
                entity.Capacity,
                entity.ContainerCount,
                entity.ObjectCount);
        }
    }
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>The definitions for entities used are:</p>
<pre class="code">[DataServiceKey(<span style="color: #a31515;">"PartitionKey"</span>, <span style="color: #a31515;">"RowKey"</span>)]
<span style="color: blue;">public class </span><span style="color: #2b91af;">MetricsCapacityEntity </span>{
    <span style="color: blue;">public string </span>PartitionKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public string </span>RowKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>Capacity { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ContainerCount { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ObjectCount { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
}

[DataServiceKey(<span style="color: #a31515;">"PartitionKey"</span>, <span style="color: #a31515;">"RowKey"</span>)]
<span style="color: blue;">public class </span><span style="color: #2b91af;">MetricsTransactionsEntity </span>{
    <span style="color: blue;">public string </span>PartitionKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public string </span>RowKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalIngress { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalEgress { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalRequests { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalBillableRequests { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>Availability { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>AverageE2ELatency { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>AverageServerLatency { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentSuccess { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentThrottlingError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentServerOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentClientOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentAuthorizationError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentNetworkError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>Success { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousSuccess { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASSuccess { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ThrottlingError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousThrottlingError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASThrottlingError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ClientTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousClientTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASClientTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ServerTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousServerTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASServerTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ClientOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousClientOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASClientOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>ServerOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousServerOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASServerOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AuthorizationError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousAuthorizationError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASAuthorizationError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>NetworkError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>AnonymousNetworkError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>SASNetworkError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
}</pre>
<h3>Case Study</h3>
<p>Let us walk through a sample scenario how these metrics data can be used.&nbsp; As a Windows Azure Storage customer, I would like to know how my service is doing and would like to see the request trend between any two time periods.</p>
<p>Description: The following is a console program that takes as input: service name to retrieve the data for, start time for the report, end time for the report and the file name to export the data to in csv format.</p>
<p>We will start with the method &ldquo;ExportMetrics&rdquo;. The method will use the time range provided as input arguments to create a query filter. Since the PartitionKey is of the format &ldquo;YYYYMMDDTHH00&rdquo; we will create the starting and ending PartitionKey filters. The table name is $MetricsTransactions appended by the service to search for. Once we have these parameters, it is as simple as creating a normal table query using the TableServiceDataContext. We use the extension AsTableServiceQuery as it takes care of continuation tokens. The other important optimization is we turn off merge tracking in which the context tracks all the entities returned in the query response. We can do this here since the query is solely used for retrieval rather than subsequent operations like Delete on these entities. The class used to represent each row in the response is MetricsEntity and its definition is given below. It is a plain simple CSharp class definition exception for the DataServcieKey required by WCF Data Services .NET and has only subset of properties that we would be interested in.</p>
<p>Once we have the query, all we do is to iterate over this query which results in executing the query. Behind the scenes, this CloudTableQuery instance may lazily execute multiple queries if needed to handle continuation tokens. We then write this in csv format. But one can imagine importing this into Azure table or SQL to perform more reporting like services.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>NOTE: Exception handling and parameter validation is omitted for brevity.</p>
<pre class="code"><span style="color: gray;">/// &lt;summary&gt; /// </span><span style="color: green;">Given a service name, start time, end time search for, this method retrieves the metrics rows for requests </span><span style="color: gray;">/// </span><span style="color: green;">and exports it to CSV file </span><span style="color: gray;">/// &lt;/summary&gt; /// &lt;param name="tableClient"&gt;&lt;/param&gt; /// &lt;param name="serviceName"&gt;</span><span style="color: green;">The name of the service interested in</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="startTimeForSearch"&gt;</span><span style="color: green;">Start time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="endTimeForSearch"&gt;</span><span style="color: green;">End time for reporting</span><span style="color: gray;">&lt;/param&gt; /// &lt;param name="fileName"&gt;</span><span style="color: green;">The file to write the report to</span><span style="color: gray;">&lt;/param&gt; </span><span style="color: blue;">static void </span>ExportMetrics(CloudTableClient tableClient, <span style="color: blue;">string </span>serviceName, DateTime startTimeForSearch, DateTime endTimeForSearch, <span style="color: blue;">string </span>fileName)
{
    <span style="color: blue;">string </span>startingPK = startTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddTHH00"</span>);
    <span style="color: blue;">string </span>endingPK = endTimeForSearch.ToString(<span style="color: #a31515;">"yyyyMMddTHH00"</span>);

    <span style="color: green;">// table names are case insensitive </span><span style="color: blue;">string </span>tableName = <span style="color: #a31515;">"$MetricsTransactions"</span>+ serviceName;

    Console.WriteLine(<span style="color: #a31515;">"Querying table '{0}' for PartitionKey &gt;= '{1}' and PartitionKey &lt;= '{2}'"</span>, tableName, startingPK, endingPK);

    TableServiceContext context = tableClient.GetDataServiceContext();

    <span style="color: green;">// turn off merge option as we only want to query and not issue deletes etc. </span>context.MergeOption = MergeOption.NoTracking;

    CloudTableQuery&lt;MetricsEntity&gt; query = (from entity <span style="color: blue;">in </span>context.CreateQuery&lt;MetricsEntity&gt;(tableName)
                                            where entity.PartitionKey.CompareTo(startingPK) &gt;= 0
                                            &amp;&amp; entity.PartitionKey.CompareTo(endingPK) &lt;= 0
                                            select entity).AsTableServiceQuery&lt;MetricsEntity&gt;();

    <span style="color: green;">// now we have the query set. Let us iterate over all entities and store into an output file. // Also overwrite the file </span><span style="color: blue;">using </span>(Stream stream= <span style="color: blue;">new </span>FileStream(fileName, FileMode.Create, FileAccess.ReadWrite))
    {
        <span style="color: blue;">using </span>(StreamWriter writer = <span style="color: blue;">new </span>StreamWriter(stream))
        {
            <span style="color: green;">// write the header </span>writer.WriteLine(<span style="color: #a31515;">"Time, Category, Request Type, Total Ingress, Total Egress, Total Requests, Total Billable Requests, Availability, Avg E2E Latency, Avg Server Latency, % Success, % Throttling, % Timeout, % Misc. Server Errors, % Misc. Client Errors, % Authorization Errors, % Network Errors"</span>);

            <span style="color: blue;">foreach </span>(MetricsEntity entity <span style="color: blue;">in </span>query)
            {
                <span style="color: blue;">string</span>[] rowKeys = entity.RowKey.Split(<span style="color: #a31515;">';'</span>);
                writer.WriteLine(<span style="color: #a31515;">"{0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15}, {16}"</span>,
                    entity.PartitionKey,
                    rowKeys[0], <span style="color: green;">// category - user | system </span>rowKeys[1], <span style="color: green;">// request type is the API name (and "All" for service summary rows) </span>entity.TotalIngress,
                    entity.TotalEgress,
                    entity.TotalRequests,
                    entity.TotalBillableRequests,
                    entity.Availability,
                    entity.AverageE2ELatency,
                    entity.AverageServerLatency,
                    entity.PercentSuccess,
                    entity.PercentThrottlingError,
                    entity.PercentTimeoutError,
                    entity.PercentServerOtherError,
                    entity.PercentClientOtherError,
                    entity.PercentAuthorizationError,
                    entity.PercentNetworkError);
            }
        }
    }
}

 [DataServiceKey(<span style="color: #a31515;">"PartitionKey"</span>, <span style="color: #a31515;">"RowKey"</span>)]
<span style="color: blue;">public class </span>MetricsEntity
{
    <span style="color: blue;">public string </span>PartitionKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public string </span>RowKey { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalIngress { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalEgress { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalRequests { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public long </span>TotalBillableRequests { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>Availability { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>AverageE2ELatency { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>AverageServerLatency { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentSuccess { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentThrottlingError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentTimeoutError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentServerOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentClientOtherError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentAuthorizationError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
    <span style="color: blue;">public double </span>PercentNetworkError { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>The main method is simple enough to parse the input.</p>
<pre class="code"><span style="color: blue;">static void </span>Main(<span style="color: blue;">string</span>[] args)
{
    <span style="color: blue;">if </span>(args.Length &lt; 4)
    {
        Console.WriteLine(<span style="color: #a31515;">"Usage: MetricsReporter &lt;service to search - blob|table|queue&gt; &lt;Start time in UTC for report&gt; &lt;End time in UTC for report&gt; &lt;file name to export to&gt;."</span>);
        Console.WriteLine(<span style="color: #a31515;">"Example: MetricsReporter blob \"2011-06-26T20:30Z\" \"2011-06-28T22:00Z\""</span>);
        <span style="color: blue;">return</span>;
    }

    CloudStorageAccount account = CloudStorageAccount.Parse(ConnectionString);
    CloudTableClient tableClient = account.CreateCloudTableClient();

    DateTime startTimeOfSearch = DateTime.Parse(args[1]).ToUniversalTime();
    DateTime endTimeOfSearch = DateTime.Parse(args[2]).ToUniversalTime();

    <span style="color: green;">//ListTableRows(tableClient, timeOfRequest); </span>ExtractMetricsToReports(tableClient, args[0], startTimeOfSearch, endTimeOfSearch, args[3]);
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>Once we have the data exported as CSV files, once can use Excel to import the data and create required important charts.</p>
<p>For more information, please see the <a href="http://msdn.microsoft.com/en-us/library/hh343270.aspx">MSDN Documentation</a>.</p>
<p>Jai Haridas, Monilee Atkinson, and Brad Calder</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/analytics-logging-metrics/" rel="tag">Analytics - Logging &amp; Metrics</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (7)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-105">
				<div id="div-comment-105" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/019f93f6dbeb3d3b0be553d044a951a0?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/019f93f6dbeb3d3b0be553d044a951a0?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">rogerj</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-105">
			August 23, 2011 at 4:46 pm</a>		</div>

		<p>Hi,</p>
<p>What are the chances of getting a TotalBillableEgress metric? This would be of great interest when attempting to forecast costs, similiar to TotalBillableRequests.</p>
<p>All in all, the new Storage Analytics feature is great. See a description and link to my live implementation at <a rel="nofollow" target="_new" href="http://oakleafblog.blogspot.com/2011/08/oakleaf-systems-windows-azure-table.html">oakleafblog.blogspot.com/&#8230;/oakleaf-systems-windows-azure-table.html</a>.</p>
<p>Thanks in advance and cheers,</p>
<p>&#8211;rj</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-106">
				<div id="div-comment-106" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a79a1b675acd535552dd5817613979ab?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a79a1b675acd535552dd5817613979ab?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">shop.calder@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-106">
			August 23, 2011 at 10:46 pm</a>		</div>

		<p>Hi Roger</p>
<p>We originally wanted to provide that, but we generate the metrics information very early in the data processing pipeline, and the business logic that classifies what egress is billable vs non-billable is done farther downstream in the workflow pipeline. &nbsp;Having said that, it would be nice to provide TotalBillableEgress, so it is still something we will continue to investigate in the future.</p>
<p>Brad</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-162">
				<div id="div-comment-162" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Prakash</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-162">
			August 15, 2012 at 11:11 am</a>		</div>

		<p>This is great information. How can I verify if Storage Analytics is enabled or not without turning it on or off?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-168">
				<div id="div-comment-168" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Monilee Atkinson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-168">
			August 19, 2012 at 7:28 pm</a>		</div>

		<p>Hi Prakash,</p>
<p>You can verify the Storage Analytics settings by viewing the Storage Configuration page in the Portal. For specific steps and more information, please review this How To: <a rel="nofollow" target="_new" href="http://www.windowsazure.com/en-us/manage/services/storage/how-to-monitor-a-storage-account/">http://www.windowsazure.com/&#8230;/how-to-monitor-a-storage-account</a></p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-382">
				<div id="div-comment-382" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/dd480048cfa484a4c5d25029a2ddbf60?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/dd480048cfa484a4c5d25029a2ddbf60?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">david.wood@actian.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-382">
			January 30, 2014 at 8:30 am</a>		</div>

		<p>Is there a way to get the number of messages in a queue at a given time once monitoring/logging is turned on? &nbsp;If so, how exactly?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-442">
				<div id="div-comment-442" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Lakshmi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-442">
			May 13, 2014 at 1:36 pm</a>		</div>

		<p>The Azure account capacity is 200TB at present. </p>
<p>If the Storage Analytics is turned on, will it be part of 200TB i.e. Data + Analytics.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-449">
				<div id="div-comment-449" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">jaidevh1@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/03/windows-azure-storage-metrics-using-metrics-to-track-storage-usage/#comment-449">
			May 15, 2014 at 1:24 pm</a>		</div>

		<p>@Lakshmi, the account limit is 500TB and it includes analytics capacity. See <a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/azure/dn249410.aspx">msdn.microsoft.com/&#8230;/dn249410.aspx</a> for more details.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F03%2Fwindows-azure-storage-metrics-using-metrics-to-track-storage-usage%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->