---
layout: windowsazurestorage
title: Client-Side Encryption in Java Client Library for Microsoft Azure Storage – Preview
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-1471" class="post-1471 post type-post status-publish format-standard hentry category-uncategorized">

	<header class="entry-header single">
		<h1 class="entry-title">Client-Side Encryption in Java Client Library for Microsoft Azure Storage &ndash; Preview</h1>		<div class="rating-wrap">
		<div id="star-rating-1471" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="1471" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2015-10-14T10:32:00+00:00">October 14, 2015</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/&quot;, &quot;text&quot;: &quot;Client-Side Encryption in Java Client Library for Microsoft Azure Storage – Preview&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/&quot;, &quot;text&quot;: &quot;Client-Side Encryption in Java Client Library for Microsoft Azure Storage – Preview&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>We are excited to announce preview availability of the client side encryption feature in the Azure&nbsp;Storage Java Client Library. This preview enables you to encrypt and decrypt your data inside client applications before uploading to and after downloading from Azure Storage. The feature is available for Blobs, Queues and Tables. We also support integration with Azure <a href="http://azure.microsoft.com/en-us/services/key-vault/" target="_blank">Key Vault</a> in order to let you store and manage your keys. We recently made Client-side encryption generally available in the <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-client-side-encryption/" target="_blank">Storage .Net library</a> and now we are happy to provide the same capability in the Java client library as a preview.</p>
<h3>Why use client-side encryption?</h3>
<p>Client-side encryption is helpful in scenarios where customers want to encrypt the data at source such as encrypting surveillance data from cameras before uploading to Storage. In this scenario, the user controls the keys and the Azure Storage service never sees the keys used for cryptographic operations. You can additionally inspect exactly how the library is encrypting your data to ensure that it meets your standards since the library is open source and available on <a href="https://github.com/Azure/azure-storage-java" target="_blank">GitHub</a>. The feature is helpful in scenarios such as encrypting surveillance data from cameras before uploading to Storage.</p>
<h3>Benefits of the Java Client Library</h3>
<p>We wanted to provide a library that would accomplish the following:</p>
<ul>
<li>Implement Security Best Practices.&nbsp; This library has been reviewed for its security so that you can use it with confidence. Encrypted data is not decipherable even if the storage account keys are compromised. Additionally, we&rsquo;ve made it simple and straightforward for users to rotate keys themselves. i.e. multiple keys will be supported during the key rotation timeframe.</li>
<li>Interoperability across languages and platforms.&nbsp; Many users use more than one of our client libraries. Given our goal to use the same technical design across implementations, data encrypted using the .NET library can be decrypted using the Java library and vice versa.&nbsp; Support for other languages is planned for the future. Similarly, we support cross platform encryption. For instance, data encrypted in the Windows platform can be decrypted in Linux and vice versa.</li>
<li>Design for Performance.&nbsp; We&rsquo;ve designed the library for both throughput and memory footprint. We have used a technique where there is a fixed overhead so that your encrypted data will have a predictable size based on the original size.</li>
<li>Self-contained encryption &ndash; Every blob, table entity, or queue message has all encryption metadata stored in either the object or its metadata.&nbsp; There is no need to get any additional data from anywhere else, except for the key you used.</li>
<li>Full blob uploads/ Full and range blob downloads: Upload for blobs such as files like documents, photos and videos that are going to be uploaded in entirety is supported. But sometimes, files like mp3 are downloaded in ranges depending on the part that is to be played. To support this, range downloads are allowed and are entirely taken care of by the SDK.</li>
</ul>
<h3>How to use it?</h3>
<p>Using client-side encryption is easy. The client library will internally take care of encrypting data on the client when uploading to Azure Storage, and automatically decrypts it when data is retrieved. All you need to do is specify the appropriate encryption policy and pass it to data upload/download APIs.</p>
<div id="codeSnippetWrapper">
<div id="codeSnippet" style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;"><span style="color: #008000;">// Create the IKey used for encryption</span></pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">RsaKey key = <span style="color: #0000ff;">new</span> RsaKey(<span style="color: #006080;">"private:key1"</span> <span style="color: #008000;">/* key identifier */</span>);</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;">&nbsp;</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;"><span style="color: #008000;">// Create the encryption policy to be used for upload and download.</span></pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;">BlobEncryptionPolicy policy = <span style="color: #0000ff;">new</span> BlobEncryptionPolicy(key, <span style="color: #0000ff;">null</span>);</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">&nbsp;</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;"><span style="color: #008000;">// Set the encryption policy on the request options.</span></pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">BlobRequestOptions options = <span style="color: #0000ff;">new</span> BlobRequestOptions();</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;">options.setEncryptionPolicy(policy);</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">&nbsp;</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;"><span style="color: #008000;">// Upload the encrypted contents to the blob.</span></pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;">blob.upload(stream, size, <span style="color: #0000ff;">null</span>, options, <span style="color: #0000ff;">null</span>);</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;">&nbsp;</pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: #f4f4f4; border-style: none; padding: 0px;"><span style="color: #008000;">// Download and decrypt the encrypted contents from the blob.</span></pre>
<!--CRLF-->
<pre style="font-size: 8pt; overflow: visible; font-family: 'Courier New', courier, monospace; width: 100%; color: black; direction: ltr; text-align: left; margin: 0em; line-height: 12pt; background-color: white; border-style: none; padding: 0px;">ByteArrayOutputStream outputStream = <span style="color: #0000ff;">new</span> ByteArrayOutputStream(); blob.DownloadToStream(outputStream, <span style="color: #0000ff;">null</span>, options, <span style="color: #0000ff;">null</span>);</pre>
<!--CRLF--></div>
</div>
<p>You can find more details and code samples in the <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-client-side-encryption-java/" target="_blank">Getting Started with Client-Side Encryption for Microsoft Azure Storage</a> article.</p>
<h3>Key considerations</h3>
<ul>
<li>This is a preview!&nbsp; It should not be used for production data.&nbsp; Schema impacting changes can be made and data written with the first preview may not be readable in the GA version.</li>
<li>With client side encryption, we support full uploads and full/ range downloads only. As such if you perform operations that update parts of a blob after you have written an encrypted blob, you may end up making it unreadable.</li>
<li>Avoid performing a SetMetadata operation on the encrypted blob or specifying metadata while creating a snapshot of an encrypted blob as this may render the blob unreadable. If you must update, then be sure to call the downloadAttributes method first to get the current encryption metadata, and avoid concurrent writes while metadata is being set.</li>
</ul>
<p>We look forward to your <a href="https://github.com/Azure/azure-storage-java/issues" target="_blank">feedback</a> on design, ease of use and any additional scenarios you would like to tell us about.&nbsp; This will enable us to deliver a great GA release of the library. While some requests for additional functionality may not be reflected in the first release, these will be strongly considered for the future.</p>
<p>Thank you.</p>
<p> Dinesh Murthy<br/> Emily Gerner<br/> Microsoft Azure Storage Team</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2015/10/14/client-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2015%2F10%2F14%2Fclient-side-encryption-in-java-client-library-for-microsoft-azure-storage-preview%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->