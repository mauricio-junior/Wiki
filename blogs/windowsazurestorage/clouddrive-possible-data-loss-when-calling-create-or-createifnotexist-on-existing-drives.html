---
layout: windowsazurestorage
title: CloudDrive&#58; Possible Data Loss when calling Create() or CreateIfNotExist() on existing drives
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-74" class="post-74 post type-post status-publish format-standard hentry category-uncategorized tag-issues-known tag-windows-azure-drives">

	<header class="entry-header single">
		<h1 class="entry-title">CloudDrive: Possible Data Loss when calling Create() or CreateIfNotExist() on existing drives</h1>		<div class="rating-wrap">
		<div id="star-rating-74" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="74" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2012-04-26T18:59:06+00:00">April 26, 2012</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/&quot;, &quot;text&quot;: &quot;CloudDrive: Possible Data Loss when calling Create() or CreateIfNotExist() on existing drives&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/&quot;, &quot;text&quot;: &quot;CloudDrive: Possible Data Loss when calling Create() or CreateIfNotExist() on existing drives&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>Windows Azure Drive is in Preview, and we recently identified a timing bug in the CloudDrive Client Library (SDK 1.6 and earlier) which can cause your CloudDrive to be accidentally deleted when you call ‘Create()’ or ‘CreateIfNotExist()’ on an existing drive. For your existing drive to be accidently deleted, there must be a period of unavailability of your Windows Azure Storage account during the call to ‘Create()’ or ‘CreateIfNotExist()’. </p>
<p>Your service is more likely to hit this bug if you frequently call ‘Create()’, which is sometimes done if you use the following pattern where you call ‘Create()’ before you call ‘Mount()’ to ensure that the drive exists before you try to mount it:</p>
<pre class="code"><span style="color: blue">try
</span>{
    drive.Create(...);
}
<span style="color: blue">catch</span>(CloudDriveException)
{
    ...
}

drive.Mount(...);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>Another common pattern can occur when using the new ‘CreateIfNotExist()’ API followed by a ‘Mount()’ call:</p>
<pre class="code">drive.CreateIfNotExist(...);
drive.Mount(...);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><strong><em>We will fix this timing bug in SDK 1.7.</em></strong></p>
<p>To avoid this timing bug now, you should add a test for the existence of the blob before attempting to create it using the following code:</p>
<pre class="code">CloudPageBlob pageBlob =
    <span style="color: blue">new </span>CloudPageBlob(drive.Uri.AbsoluteUri, drive.Credentials);

<span style="color: blue">try
</span>{
    pageBlob.FetchAttributes();
}
<span style="color: blue">catch </span>(StorageClientException ex)
{
    <span style="color: blue">if </span>(ex.ErrorCode.Equals(StorageErrorCode.ResourceNotFound))
    {
        <span style="color: green">// Blob not found, try to create it
        </span>drive.Create(...);
    }
}</pre>
<p>Andrew Edwards</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/issues-known/" rel="tag">Issues - Known</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-drives/" rel="tag">Windows Azure Drives</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/04/26/clouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F04%2F26%2Fclouddrive-possible-data-loss-when-calling-create-or-createifnotexist-on-existing-drives%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->