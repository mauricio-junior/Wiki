---
layout: windowsazurestorage
title: Breaking Change for Windows Azure Drive Beta in Guest OS 1.8 and 2.0
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-40" class="post-40 post type-post status-publish format-standard hentry category-uncategorized tag-issues-known tag-releases tag-windows-azure-drives">

	<header class="entry-header single">
		<h1 class="entry-title">Breaking Change for Windows Azure Drive Beta in Guest OS 1.8 and 2.0</h1>		<div class="rating-wrap">
		<div id="star-rating-40" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="40" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2010-11-10T12:28:00+00:00">November 10, 2010</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/&quot;, &quot;text&quot;: &quot;Breaking Change for Windows Azure Drive Beta in Guest OS 1.8 and 2.0&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/&quot;, &quot;text&quot;: &quot;Breaking Change for Windows Azure Drive Beta in Guest OS 1.8 and 2.0&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>Windows Azure drives support the use of a local cache to improve performance of drives. With the upcoming Guest OS 1.8 and 2.0 releases, there&rsquo;s a breaking change in the way this local cache is allocated.</p>
<h4>Background</h4>
<p>A Windows Azure application can request local storage in its service definition (.csdef).&nbsp; Here&rsquo;s an example:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;LocalResources&gt; <br/>&nbsp;&nbsp;&nbsp; &lt;LocalStorage name="DriveCache" cleanOnRoleRecycle="true" sizeInMB="1000" /&gt; <br/>&nbsp;&nbsp;&nbsp; &lt;/LocalResources&gt;</p>
<p>This example ensures that Windows Azure allocates 1000MB to a local storage resource called &ldquo;DriveCache&rdquo; for each role instance. When an application uses Windows Azure Drives, it can use such a local storage resource to allocate a cache for all Drives that are mounted.&nbsp; Here&rsquo;s a typical snippet of code that does that:</p>
<p>&nbsp;&nbsp;&nbsp; LocalResource localCache = RoleEnvironment.GetLocalResource("DriveCache"); <br/>&nbsp;&nbsp;&nbsp; CloudDrive.InitializeCache(localCache.RootPath, localCache.MaximumSizeInMegabytes);<i></i></p>
<p>Finally, when mounting a Windows Azure Drive, the instance can specify the amount of space to be allocated for that Drive, as follows:</p>
<p>&nbsp;&nbsp;&nbsp; driveLetter = drive.Mount(driveCacheSize, DriveMountOptions.None);</p>
<h4>The Breaking Change</h4>
<p>Prior to Windows Azure Guest OS 1.8 and 2.0, the Windows Azure Drive cache was allocated as lazily as Drives were used.&nbsp; With these new Guest OS releases, the entire cache is allocated up-front, and if there isn&rsquo;t enough space in the local resource for the cache, the call to Mount() will fail with the error D000007F.</p>
<p>Due to an issue with how local storage resources are allocated, some of the requested space is unavailable for cache usage. <b>That means that if your application declares a 1000MB local resource and then tries to allocate the full 1000MB across your Windows Azure Drive caches, the allocation will likely fail.</b></p>
<p>The workaround is to specify a local resource that&rsquo;s 20MB larger than what the application uses. Here&rsquo;s an example of allocating space for a Windows Azure Drive that uses 1000MB of cache space:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;LocalResources&gt; <br/>&nbsp;&nbsp;&nbsp; &lt;LocalStorage name="DriveCache" cleanOnRoleRecycle="true" sizeInMB="<b>1020</b>" /&gt; <br/>&nbsp;&nbsp;&nbsp; &lt;/LocalResources&gt;</p>
<p>&nbsp;&nbsp;&nbsp; LocalResource localCache = RoleEnvironment.GetLocalResource("DriveCache"); <br/>&nbsp;&nbsp;&nbsp; CloudDrive.InitializeCache(localCache.RootPath, localCache.MaximumSizeInMegabytes); <br/>&nbsp;&nbsp;&nbsp; driveLetter = drive.Mount(<b>1000</b>, DriveMountOptions.None);</p>
<p>Applications that would like to preserve the previous cache allocation behavior can specify an earlier Guest OS version. Here&rsquo;s an example to specify Guest OS version 1.7:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;ServiceConfiguration serviceName="MyService" osVersion=" WA-GUEST-OS-1.7_201009-01 "&gt; <br/>&nbsp;&nbsp;&nbsp;&nbsp; &lt;Role name="MyRole"&gt; <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &hellip; <br/>&nbsp;&nbsp;&nbsp; &lt;/Role&gt; <br/>&nbsp;&nbsp;&nbsp; &lt;/ServiceConfiguration&gt;</p>
<p><em>&nbsp;<b><span style="FONT-FAMILY: 'Calibri','sans-serif'; COLOR: #1f497d; FONT-SIZE: 11pt; mso-fareast-font-family: 'Times New Roman'">2/23/2011 - Update for OS 1.9, 2.1 and beyond</span></b><span style="FONT-FAMILY: 'Calibri','sans-serif'; COLOR: black; FONT-SIZE: 11pt; mso-fareast-font-family: 'Times New Roman'"><o:p></o:p></span></em></p>
<p class="MsoNormal" style="TEXT-ALIGN: justify; MARGIN: 0in 0in 0pt"><span style="FONT-FAMILY: 'Calibri','sans-serif'; COLOR: #1f497d; FONT-SIZE: 11pt; mso-fareast-font-family: 'Times New Roman'">Beginning with OS versions 1.9 and 2.1, if there is insufficient space on the local storage resource to accommodate the Azure Drive Cache specified in the <i>mount </i>call, Windows Azure will create a smaller cache to fit in the available space. That means you will no longer see cache allocation failures due to insufficient space as was the case with OS versions 1.8 and 2.0.</span><span style="FONT-FAMILY: 'Calibri','sans-serif'; COLOR: black; FONT-SIZE: 11pt; mso-fareast-font-family: 'Times New Roman'"><o:p></o:p></span></p>
<p>&nbsp;</p>
<p>Windows Azure Storage Team</p>
<p>&nbsp;</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/issues-known/" rel="tag">Issues - Known</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/releases/" rel="tag">Releases</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-drives/" rel="tag">Windows Azure Drives</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/10/breaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2010%2F11%2F10%2Fbreaking-change-for-windows-azure-drive-beta-in-guest-os-1-8-and-2-0%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->