---
layout: windowsazurestorage
title: Changes in Windows Azure Storage Client Library – Windows Azure SDK 1.3
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-43" class="post-43 post type-post status-publish format-standard hentry category-uncategorized tag-issues-known tag-releases tag-windows-azure-storage-client-library">

	<header class="entry-header single">
		<h1 class="entry-title">Changes in Windows Azure Storage Client Library &ndash; Windows Azure SDK 1.3</h1>		<div class="rating-wrap">
		<div id="star-rating-43" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="43" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2010-11-30T03:39:00+00:00">November 30, 2010</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/#comments">2</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/&quot;, &quot;text&quot;: &quot;Changes in Windows Azure Storage Client Library – Windows Azure SDK 1.3&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/&quot;, &quot;text&quot;: &quot;Changes in Windows Azure Storage Client Library – Windows Azure SDK 1.3&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>We recently released an update to the Storage Client library in <a href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=7a1089b6-4050-4307-86c4-9dadaa5ed018">SDK 1.3</a>. We wanted to take this opportunity to go over some breaking changes that we have introduced and also list some of the bugs we have fixed (compatible changes) in this release. </p>
<p>Thanks for all the feedback you have been providing us via forums and this site, and as always please continue to do so as it helps us improve the client library.</p>
<p>Note: We have used Storage Client Library v1.2 to indicate the library version shipped with Windows Azure SDK 1.2 and v1.3 to indicate the library shipped with Windows Azure SDK 1.3</p>
<h3>Breaking Changes</h3>
<p><b>1. </b><b>Bug: FetchAttributes ignores blob type and lease status properties </b></p>
<p>In Storage Client Library v1.2, a call to FetchAttributes never checks if the blob instance is of valid type since it ignores the BlobType property. For example, if a CloudPageBlob instance refers to a block blob in the blob service, then FetchAttributes will not throw an exception when called.</p>
<p>In Storage Client Library v1.3, FetchAttributes records the BlobType and LeaseStatus properties. In addition, it will throw an exception when the blob type property returned by the service does not match with type of class being used (i.e. when CloudPageBlob is used to represent block blob or vice versa).</p>
<p><b>2. </b><b>Bug: ListBlobsWithPrefix can display same blob Prefixes multiple times</b></p>
<p>Let us assume we have the following blobs in a container called photos:</p>
<ul>
<li>photos/Brazil/Rio1.jpg </li>
<li>photos/Brazil/Rio2.jpg </li>
<li>photos/Michigan/Mackinaw1.jpg </li>
<li>photos/Michigan/Mackinaw2.jpg </li>
<li>photos/Seattle/Rainier1.jpg </li>
<li>photos/Seattle/Rainier2.jpg </li>
</ul>
<p>Now to list the photos hierarchically, I could use the following code to get the list of folders under the container &ldquo;photos&rdquo;. I would then list the photos depending on the folder that is selected.</p>
<pre class="code"><span style="color: #2b91af">IEnumerable</span>&lt;<span style="color: #2b91af">IListBlobItem</span>&gt; blobList = client.ListBlobsWithPrefix(<span style="color: #a31515">"photos/"</span>);

<span style="color: blue">foreach </span>(<span style="color: #2b91af">IListBlobItem </span>item <span style="color: blue">in </span>blobList)
{
    <span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">"Item Name = {0}"</span>, item.Uri.AbsoluteUri);
}</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>The expected output is:</p>
<ul>
<li>photos/Brazil/ </li>
<li>photos/Michigan/ </li>
<li>photos/Seattle/ </li>
</ul>
<p>However, assume that the blob service returns Rio1.jpg through Mackinaw1.jpg along with a continuation marker which an application can use to continue listing. The client library would then continue the listing with the server using this continuation marker, and with the continuation assume that it receives the remaining items. Since the prefix photos/Michigan is repeated again for Mackinaw2.jpg, the client library incorrectly duplicates this prefix. If this happens, then the result of the above code in Storage Client v1.2 is:</p>
<ul>
<li>photos/Brazil/ </li>
<li>photos/Michigan/ </li>
<li>photos/Michigan/ </li>
<li>photos/Seattle/ </li>
</ul>
<p>Basically, Michigan would be repeated twice. In Storage Client Library v1.3, we collapse this to always provide the same result for the above code irrespective of how the blobs may be returned in the listing.</p>
<p><b>3. </b><b>Bug: CreateIfNotExist on a table, blob or queue container does not handle container being deleted</b></p>
<p>In Storage Client Library v1.2, when a deleted container is recreated before the service&rsquo;s garbage collection finishes removing the container, the service returns HttpStatusCode.Conflict with StorageErrorCode as ResourceAlreadyexists with extended error information indicating that the container is being deleted. This error code is not handled by the Storage Client Library v1.2, and it instead returns false giving a perception that the container exists. </p>
<p>In Storage Client Library v1.3, we throw a StorageClientException exception with ErrorCode = ResourceAlreadyExists and exception&rsquo;s ExtendedErrorInformation&rsquo;s error code set to XXXBeingDeleted (ContainerBeingDeleted, TableBeingDeleted or QueueBeingDeleted). This exception should be handled by the client application and retried after a period of 35 seconds or more. </p>
<p>One approach to avoid this exception while deleting and recreating containers/queues/tables is to use dynamic (new) names when recreating instead of using the same name. </p>
<p><b>4. </b><b>Bug: CloudTableQuery retrieves up to 100 entities with Take rather than the 1000 limit</b></p>
<p>In Storage Client Library v1.2, using CloudTableQuery limits the query results to 100 entities when Take(N) is used with N &gt; 100. We have fixed this in Storage Client Library v1.3 by setting the limit appropriately to Min(N, 1000) where 1000 is the server side limit. </p>
<p><b>5. </b><b>Bug: CopyBlob does not copy metadata set on destination blob instance</b></p>
<p>As noted in <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/05/25/updating-metadata-during-copy-blob-and-snapshot-blob.aspx">this post</a>, Storage Client Library v1.2 has a bug in which metadata set on the destination blob instance in the client is ignored, so it is not recorded with the destination blob in the blob service. We have fixed this in Storage Client Library v1.3, and if the metadata is set, it is stored with the destination blob. If no metadata is set, the blob service will copy the metadata from the source blob to the destination blob.</p>
<p><b>6. </b><b>Bug: Operations that returned PreConditionfailure and NotModified returns BadRequest as the StorageErrorCode</b></p>
<p>In Storage Client Library v1.2, PreConditionfailure and NotModified errors lead to StorageClientException with StorageErrorCode mapped to BadRequest. </p>
<p>In Storage Client Library v1.3, we have correctly mapped the StorageErrorCode to ConditionFailed</p>
<p><b>7. </b><b>Bug: CloudBlobClient.ParallelOperationThreadCount &gt; 64 leads to NotSupportedException </b></p>
<p>ParallelOperationThreadCount controls the number of concurrent block uploads. In Storage Client Library v1.2, the value can be between 1, int.MaxValue. But when a value greater than 64 was set, UploadByteArray, UploadFile, UploadText methods would start uploading blocks in parallel but eventually fail with NotSupported exception. In Storage Client Library v1.3, we have reduced the max limit to 64. A value greater than 64 will cause ArgumentOutOfRangeException exception right upfront when the property is set.</p>
<p><b>8. </b><b>Bug: DownloadToStream implementation always does a range download that results in md5 header not returned</b></p>
<p>In Storage Client Library v1.2, DownloadToStream, which is used by other variants &ndash; DownloadText, DownloadToFile and DownloadByteArray, always does a range GET by passing the entire range in the range header &ldquo;x-ms-range&rdquo;. However, in the service, using range for GETs does not return content-md5 headers even if the range encapsulates the entire blob. </p>
<p>In Storage Client Library v1.3, we now do not send the &ldquo;x-ms-range&rdquo; header in the above mentioned methods which allows the content-md5 header to be returned.</p>
<p><b>9. </b><b>CloudBlob retrieved using container&rsquo;s GetBlobReference, GetBlockBlobReference or GetPageBlobReference creates a new instance of the container.</b></p>
<p>In Storage Client Library v1.2, the blob instance always creates a new container instance that is returned via the Container property in CloudBlob class. The Container property represents the container that stores the blob. </p>
<p>In Storage Client Library v1.3, we instead use the same container instance which was used in creating the blob reference. Let us explain this using an example: </p>
<pre class="code"><span style="color: #2b91af">CloudBlobClient </span>client = account.CreateCloudBlobClient();
<span style="color: #2b91af">CloudBlobContainer </span>container = client.GetContainerReference(<span style="color: #a31515">"blobtypebug"</span>);
container.FetchAttributes();
container.Attributes.Metadata.Add(<span style="color: #a31515">"SomeKey"</span>, <span style="color: #a31515">"SomeValue"</span>);

<span style="color: #2b91af">CloudBlob </span>blockBlob = container.GetBlockBlobReference(<span style="color: #a31515">"blockblob.txt"</span>);

<span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">"Are instances same={0}"</span>, blockBlob.Container == container);
<span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">"SomeKey value={0}"</span>, blockBlob.Container.Attributes.Metadata[<span style="color: #a31515">"SomeKey"</span>]);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>For the above code, in Storage Client Library v1.2, the output is:</p>
<blockquote>
<p>Are instances same=False <br/>SomeKey metadata value=</p>
</blockquote>
<p>This signifies that the blob creates a new instance that is then returned when the Container property is referenced. Hence the metadata &ldquo;SomeKey&rdquo; set is missing on that instance until FetchAttributes is invoked on that particular instance.</p>
<p>In Storage Client Library v1.3, the output is:</p>
<blockquote>
<p>Are instances same=True <br/>SomeKey metadata value=SomeValue</p>
</blockquote>
<p>We set the same container instance that was used to get a blob reference. Hence the metadata is already set. </p>
<p>Due to this change, any code relying on the instances to be different may break.</p>
<p><b>10. </b><b>Bug: CloudQueueMessage is always Base64 encoded allowing less than 8KB of original message data.</b></p>
<p>In Storage Client Library v1.2, the queue message is Base64 encoded which increases the message size by 1/3<sup>rd</sup> (approximately). The Base64 encoding ensures that message over the wire is valid XML data. On retrieval, the library decodes this and returns the original data.</p>
<p>However, we want to provide an alternate where that data which is already valid XML data is transmitted and stored in the raw format, so an application can store a full size 8KB message. </p>
<p>In Storage Client Library v1.3, we have provided a flag &ldquo;EncodeMessage&rdquo; on the CloudQueue that indicates if it should encode the message using Base64 encoding or send it in raw format. By default, we still Base64 encode the message. To store the message without encoding one would do the following: </p>
<pre class="code"><span style="color: #2b91af">CloudQueue </span>queue = client.GetQueueReference(<span style="color: #a31515">"workflow"</span>);
queue.EncodeMessage = <span style="color: blue">false</span>;</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>One should be careful when using this flag, so that your application does not turn off message encoding on an existing queue with encoded messages in it. The other thing to ensure when turning off encoding is that the raw message has only valid XML data since <a href="http://msdn.microsoft.com/en-us/library/dd179346.aspx">PutMessage</a> is sent over the wire in XML format, and the message is delivered as part of that XML.</p>
<p>Note: When turning off message encoding on an existing queue, one can prefix the raw message with a fixed version header. Then when a message is received, if the application does not see the new version header, then it knows it has to decode it. Another option would be to start using new queues for the un-encoded messages, and drain the old queues with encoded messages with code that does the decoding.</p>
<p><b>11. </b><b>Inconsistent escaping of blob name and prefixes when relative URIs are used.</b></p>
<p>In Storage Client Library v1.2, the rules used to escape a blob name or prefix provided in the APIs like constructors, GetBlobReference, ListBlobXXX etc, are inconsistent when relative URIs are used. The relative Uri name for the blob or prefix to these methods are treated as escaped or un-escaped string based on the input. </p>
<p>For example:</p>
<blockquote>
<p>a) CloudBlob blob1 = new CloudBlob("container/space test", service); <br/>b) CloudBlob blob2 = new CloudBlob("container/space%20test", service); <br/>c) ListBlobsWithPrefix("container/space%20test");</p>
</blockquote>
<p>In the above cases, v1.2 treats the first two as "container/space test". However, in the third, the prefix is treated as "container/space%20test". To reiterate, relative URIs are inconsistently evaluated as seen when comparing (b) with (c). (b) is treated as already escaped and stored as "container/space test". However, (c) is escaped again and treated as "container/space%20test".</p>
<p>In Storage Client Library v1.3, we treat relative URIs as literal, basically keeping the exact representation that was passed in. In the above examples, (a) would be treated as "container/space test" as before. The latter two i.e. (b) and (c) would be treated as "container/space%20test". Here is a table showing how the names are treated in v1.2 compared to in v1.3.</p>
<table cellpadding="0" cellspacing="0" border="1">
<tbody>
<tr>
<td width="226" valign="top">
<p>Method</p>
</td>
<td width="124" valign="top">
<p>BlobName Or Prefix</p>
</td>
<td width="110" valign="top">
<p>V1.2</p>
</td>
<td width="125" valign="top">
<p>V1.3</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlobClient::GetBlobReference</p>
<p>CloudBlodDirectory::GetBlobReference</p>
<p>CloudBlodContainer::GetBlobReference</p>
</td>
<td width="124" valign="top">
<p>space test/blob1</p>
</td>
<td width="110" valign="top">
<p>space test/blob1</p>
</td>
<td width="125" valign="top">
<p>space test/blob1</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlobClient::GetBlobReference</p>
<p>CloudBlodDirectory::GetBlobReference</p>
<p>CloudBlodContainer::GetBlobReference</p>
</td>
<td width="124" valign="top">
<p>space%20test/blob1</p>
</td>
<td width="110" valign="top">
<p>space test/blob1</p>
</td>
<td width="125" valign="top">
<p>space%20test/blob1</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlobClient::ListBlobWithPrefix</p>
</td>
<td width="124" valign="top">
<p>space test/</p>
</td>
<td width="110" valign="top">
<p>space test/</p>
</td>
<td width="125" valign="top">
<p>space test/</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlobClient::ListBlobWithPrefix</p>
</td>
<td width="124" valign="top">
<p>space%20test/</p>
</td>
<td width="110" valign="top">
<p>space%20test/</p>
</td>
<td width="125" valign="top">
<p>space%20test/</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlodDirectory::ListBlob</p>
</td>
<td width="124" valign="top">
<p>space test/</p>
</td>
<td width="110" valign="top">
<p>space test/</p>
</td>
<td width="125" valign="top">
<p>space test/</p>
</td>
</tr>
<tr>
<td width="226" valign="top">
<p>CloudBlodDirectory::ListBlob</p>
</td>
<td width="124" valign="top">
<p>space%20test/</p>
</td>
<td width="110" valign="top">
<p>space test/</p>
</td>
<td width="125" valign="top">
<p>space%20test/</p>
</td>
</tr>
</tbody>
</table>
<p><b>12. </b><b>Bug: ListBlobsSegmented does not parse the blob names with special characters like &lsquo; &lsquo;, #, : etc.</b></p>
<p>In Storage Client Library v1.2, folder names with certain special characters like #, &lsquo; &lsquo;, : etc. are not parsed correctly for list blobs leading to files not being listed. This gave a perception that blobs were missing. The problem was with the parsing of response and we have fixed this problem in v1.3.</p>
<p><b>13. </b><b>Bug: DataServiceContext timeout is in seconds but the value is set as milliseconds</b></p>
<p>In Storage Client Library v1.2, timeout is incorrectly set as milliseconds on the DataServiceContext. DataServiceContext treatsthe integer as seconds and not milliseconds. We now correctly set the timeout in v1.3.</p>
<p><b>14. </b><b>Validation added for CloudBlobClient.</b><a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.cloudblobclient.writeblocksizeinbytes.aspx"><b>WriteBlockSizeInBytes</b></a><b> </b></p>
<p>WriteBlockSizeInBytes controls the block size when using block blob uploads. In Storage Client Library v1.2, there was no validation done for the value. </p>
<p>In Storage Client Library v1.3, we have restricted the valid range for WriteBlockSizeInBytes to be [1MB-4MB]. An ArgumentOutOfRangeException is thrown if the value is outside this range.</p>
<h3>Other Bug Fixes and Improvements</h3>
<p><b>1. </b><b>Provide overloads to get a snapshot for blob constructors and methods that get reference to blobs.</b></p>
<p>Constructors include CloudBlob, CloudBlockBlob, CloudPageBlob and methods like CloudBlobClient&rsquo;s GetBlobReference, GetBlockBlobReference and GetPageBlobReference all have overloads that take snapshot time. Here is an example: </p>
<pre class="code"><span style="color: #2b91af">CloudStorageAccount </span>account = <span style="color: #2b91af">CloudStorageAccount</span>.Parse(Program.ConnectionString);
<span style="color: #2b91af">CloudBlobClient </span>client = account.CreateCloudBlobClient();
<span style="color: #2b91af">CloudBlob </span>baseBlob = client.GetBlockBlobReference(<span style="color: #a31515">"photos/seattle.jpg"</span>);

<span style="color: #2b91af">CloudBlob </span>snapshotBlob = baseBlob.CreateSnapshot();      

<span style="color: green">// save the snapshot time for later use
</span><span style="color: #2b91af">DateTime </span>snapshotTime = snapshotBlob.SnapshotTime.Value;

<span style="color: green">// Use the saved snapshot time to get a reference to snapshot blob 
// by utilizing the new overload and then delete the snapshot
</span><span style="color: #2b91af">CloudBlob </span>snapshotRefernce = client.GetBlobReference(blobName, snapshotTime);
snapshotRefernce.Delete();</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><b>2. </b><b>CloudPageBlob now has a </b><a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.cloudpageblob.clearpages.aspx"><b>ClearPage</b></a><b> method.</b></p>
<p>We have provided a new API to clear a page in page blob:</p>
<pre class="code"><span style="color: blue">public void </span>ClearPages(<span style="color: blue">long </span>startOffset, <span style="color: blue">long </span>length)</pre>
<p><b>3. </b><b>Bug: Reads using BlobStream issues a GetBlockList even when the blob is a Page Blob</b></p>
<p>In Storage Client Library v1.2, a GetBlockList is always invoked even for reading Page blobs leading to an expected exception being handled by the code. </p>
<p>In Storage Client Library v1.3 we issue FetchAttributes when the blob type is not known. This avoids an erroneous GetBlockList call on a page blob instance. If the blob type is known in your application, please use the appropriate blob type to avoid this extra call. </p>
<p>Example: when reading a page blob, the following code will not incur the extra FetchAttributes call since the BlobStream was retrieved using a CloudPageBlob instance.</p>
<pre class="code"><span style="color: #2b91af">CloudPageBlob </span>pageBlob = container.GetPageBlobReference(<span style="color: #a31515">"mypageblob.vhd"</span>);
<span style="color: #2b91af">BlobStream </span>stream = pageBlob.OpenRead();
<span style="color: green">// Read from stream&hellip;
</span></pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>However, the following code would incur the extra FetchAttributes call to determine the blob type:</p>
<pre class="code"><span style="color: #2b91af">CloudBlob </span>pageBlob = container.GetBlobReference(<span style="color: #a31515">"mypageblob.vhd"</span>);
<span style="color: #2b91af">BlobStream </span>stream = pageBlob.OpenRead();
<span style="color: green">// Read from stream&hellip;
</span></pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><a name="_Toc277482687"></a><a name="_Toc277482604"><b>4. </b><b>Bug: WritePages does not reset the stream on retries</b></a></p>
<p>As we had <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/15/stream-position-not-reset-on-retries-in-pageblob-writepages-api.aspx">posted on our site</a>, In Storage Client Library v1.2, WritePages API does not reset the stream on a retry leading to exceptions<a name="_GoBack"></a>. We have fixed this when the stream is seekable, and reset the stream back to the beginning when doing the retry. For non seekable streams, we throw NotSupportedException exception.</p>
<p><b>5. </b><b>Bug: Retry logic retries on all 5XX errors</b></p>
<p>In Storage Client Library v1.2, HttpStatusCode NotImplemented and HttpVersionNotSupported results in a retry. There is no point in retrying on such failures. In Storage Client Library v1.3, we throw a StorageServerException exception and do not retry.</p>
<p><b></b></p>
<p><b>6. </b><b>Bug: SharedKeyLite authentication scheme for Blob and Queue throws NullReference exception</b></p>
<p>We now support <a href="http://msdn.microsoft.com/en-us/library/dd179428.aspx">SharedKeyLite</a> scheme for blobs and queues.</p>
<p><a name="_Toc277482714"></a><a name="_Toc277482631"><b>7. </b><b>Bug: CreateTableIfNotExist has a race condition that can lead to an exception &ldquo;TableAlreadyExists&rdquo; being thrown </b></a></p>
<p>CreateTableIfNotExist first checks for the table existence before sending a create request. Concurrent requests of CreateTableIfNotExist can lead to all but one of them failing with TableAlreadyExists and this error is not handled in Storage Client Library v1.2 leading to a StorageException being thrown. In Storage Client Library v1.3, we now check for this error and return false indicating that the table already exists without throwing the exception.</p>
<p><b>8. </b><b>Provide property for controlling block upload for CloudBlob </b></p>
<p>In Storage Client Library v1.2, <a href="http://msdn.microsoft.com/en-us/library/dd135726.aspx">block upload</a> is used only if the upload size is 32MB or greater. Up to 32MB, all blob uploads via UploadByteArray, UploadText, UploadFile are done as a single blob upload via <a href="http://msdn.microsoft.com/en-us/library/dd179451.aspx">PutBlob</a>. </p>
<p>In Storage Client Library v1.3, we have preserved the default behavior of v1.2 but have provided a property called <a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.cloudblobclient.singleblobuploadthresholdinbytes.aspx">SingleBlobUploadThresholdInBytes</a> which can be set to control what size of blob will upload via blocks versus a single put blob. For example, the setting the following code will upload all blobs up to 8MB as a single put blob and will use block upload for blob sizes greater than 8MB. </p>
<pre class="code"><span style="color: #2b91af">CloudBlobClient</span>.SingleBlobUploadThresholdInBytes = 8 * 1024 *1024;</pre>
<p>The valid range for this property is [1MB &ndash; 64MB). </p>
<p>Jai Haridas</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/issues-known/" rel="tag">Issues - Known</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/releases/" rel="tag">Releases</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-storage-client-library/" rel="tag">Windows Azure Storage Client Library</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (2)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2010%2F11%2F30%2Fchanges-in-windows-azure-storage-client-library-windows-azure-sdk-1-3%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-2851">
				<div id="div-comment-2851" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Peter Kellner</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/#comment-2851">
			December 1, 2010 at 10:44 am</a>		</div>

		<p>Thanks for the improvements. </p>
<p>I&#39;m still confused on #3, CreateIfNotExist. &nbsp;It would help me if you would show an example (best practices) for achieving the functionality &quot;CreateIfNotExist&quot;, even if that means somehow check to see if it exists, then create. &nbsp;This point has created a bunch of forum questions (including by me) and the answer above (don&#39;t do it, create another name) is not very satisfying. &nbsp;The name I use has meaning and I don&#39;t want to create another level of redirection in creating a new container name that I have to track someplace else.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2010%2F11%2F30%2Fchanges-in-windows-azure-storage-client-library-windows-azure-sdk-1-3%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-2841">
				<div id="div-comment-2841" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Jai Haridas (MSFT)</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/11/30/changes-in-windows-azure-storage-client-library-windows-azure-sdk-1-3/#comment-2841">
			December 3, 2010 at 8:55 am</a>		</div>

		<p>Hi Peter,</p>
<p>I understand that this indirection is relatively little more work than defining them as constants in a file, but following this pattern allows you to continue purging your data efficiently and in addition decouples your application logic from Windows Azure Storage service&#39;s GC process. </p>
<p>There are various scenarios where this fits is quite well:</p>
<p>1&gt; Scenario: Container for files that need to be purged periodically</p>
<p>Create a container/table for say every month example: News_Nov_2010. This way when you want to purge the data, you still need just one call to delete the container. The application always forms the container name using the current month and year and can set this to change based on a timer.</p>
<p>2&gt; Scenario: Testing environments </p>
<p>The account/container/table names can come from configuration files/Tables. Maintain separate files for Test vs. Production environments. If configuration file is used, then you can check-in the new names into your source control. If the list is maintained in a table, one option is to run a script that goes and creates the new tables before updating the configuration table with the new names. During initialization phase, your application will read this configuration and set the table names to use.</p>
<p>As for the CreateTableIfExists, you would need to handle exceptions. Here is some very trivial code: </p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bool isCreated = client.CreateTableIfNotExist(containerName);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;catch (StorageException e)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Log(&quot;Exception: {0}, {1}-{2}&quot;, </p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;e.ErrorCode, </p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;e.ExtendedErrorInformation.ErrorCode, </p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;e);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // We could have some errors here like TableBeingDeleted and since the container is not created, we cannot continue.</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;catch (Exception e)</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Log(&quot;Table Exception: {0}&quot;, e);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p>If required, you can wrap the above code in a retry of your own: &nbsp;on an exception, wait for 40 seconds and retry. Retry at most X times (where X is based on how much your application can wait during initialization).</p>
<p>Thanks,</p>
<p>Jai</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2010%2F11%2F30%2Fchanges-in-windows-azure-storage-client-library-windows-azure-sdk-1-3%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->