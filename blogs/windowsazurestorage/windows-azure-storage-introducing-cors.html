---
layout: windowsazurestorage
title: Windows Azure Storage&#58; Introducing CORS
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-148" class="post-148 post type-post status-publish format-standard hentry category-uncategorized">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage: Introducing CORS</h1>		<div class="rating-wrap">
		<div id="star-rating-148" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="148" data-container="body" data-toggle="tooltip" title="2 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2014-02-03T10:50:00+00:00">February 3, 2014</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comments">6</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/&quot;, &quot;text&quot;: &quot;Windows Azure Storage: Introducing CORS&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/&quot;, &quot;text&quot;: &quot;Windows Azure Storage: Introducing CORS&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>We recently released CORS(Cross Origin Resource Sharing) for Windows Azure Storage. <a href="http://en.wikipedia.org/wiki/Cross-Origin_Resource_Sharing" target="_blank">CORS</a> is supported for Blob, Table and Queue services and can be enabled for each service through the <a href="https://github.com/WindowsAzure/azure-storage-net" target="_blank">Windows Azure Storage Client Library 3.0</a>. In this blog, we will explain CORS and how Windows Azure Storage supports CORS with an example. The complete sample code can be found in <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">here</a>.</p>
<h3>What is CORS</h3>
<p>Web Browsers, also referred to as User Agents, commonly apply same origin restriction policy to network requests. These restrictions prevent client-side web applications running from a specific domain to issue requests to another domain for security reasons. As an example, a piece of JavaScript code loaded as part of <a href="http://www.contoso.com/">http://www.contoso.com</a> cannot issue requests at will to any other domain like <a href="http://www.northwindtraders.com/">http://www.northwindtraders.com</a> since the Web Browser will prevent such requests from executing.</p>
<p>CORS is a mechanism that would relax such restriction and allows domains to give each other permissions for accessing each other&rsquo;s resources. The User Agent in this case would send extra headers in order to ensure that the JavaScript code loaded from a certain domain say <a href="http://www.contoso.com/">www.contoso.com</a> is allowed to access resources located at <a href="http://www.northwindtraders.com/">www.northwindtraders.com</a>. In this case the latter domain could either reply back with extra headers allowing or denying <a href="http://www.contoso.com/">www.contoso.com</a> access to its resources.</p>
<p>CORS extends HTTP specification and more details can be found at <a href="http://www.w3.org/TR/cors/" target="_blank">http://www.w3.org/TR/cors/</a>.</p>
<h3>Why CORS in Windows Azure Storage</h3>
<p>In the absence of CORS, websites that use Windows Azure Storage service would need to act as a proxy for storage calls. All requests to storage would need to be proxied via the service and hence the service would have to scale out their servers in case of load increase. As an example, assume that you have a feature as part of your <a href="http://www.contoso.com/">http://www.contoso.com</a> website where users can upload blobs and you want to persist them in your Windows Azure Storage account contoso.blob.core.windows.net. In this case, the upload would have to be done from the browser to your service which in turn would PUT the data in the storage account. This means you would need to scale out your service whenever there is an increase in your website upload traffic.</p>
<p>With CORS, you can eliminate the need to have your service in the upload path. You would in this case enable CORS on your contoso.blob.core.windows.net storage account and allow contoso.com access. Then, your Javascript code can now directly upload blobs using <a href="http://msdn.microsoft.com/en-us/library/windowsazure/ee395415.aspx" target="_blank">shared access signatures</a> to your storage account without the need of a proxy service. You can therefore benefit from the massive scale of the Windows Azure Storage service without needing to scale out a service in order to deal with any increase in upload traffic to your website.</p>
<p>Please note that CORS is not an authentication mechanism. Any request made against a storage resource when CORS is enabled must either have a proper authentication signature, or must be made against a public resource.</p>
<p>For more details on CORS for Windows Azure Storage, please refer to the following MSDN documentation <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx</a>.</p>
<h3>How Does CORS work</h3>
<p>Typically, CORS is accomplished in 2 phases. A <strong>preflight Request</strong> (OPTIONS) request followed by the <strong>actual request</strong> i.e. GET, PUT, POST, etc.</p>
<p>In some cases, User Agents will not issue a preflight requests in case of <a href="http://www.w3.org/TR/cors/#simple-cross-origin-request" target="_blank">simple requests</a> that are issues with <a href="http://www.w3.org/TR/cors/#simple-method" target="_blank">simple methods</a> such as GET.</p>
<h5>Preflight Request</h5>
<p>Preflight request is a mechanism to query the CORS restriction imposed by the service. The User Agent will issue such request whenever some code as part of the Javascript attempts to send a request to another domain. The Preflight requests is an OPTIONS request that carries the actual request headers, the intended HTTP request and the Originating domain. The recipient service would then evaluate the intended operation based on a pre-configured set of rules that imposes restriction on the origin, requested headers, methods, etc. and would either accept or reject the request. In the case of Windows Azure Storage, CORS rules are configured per Service (Blob, Table or Queue) and the preflight requests are evaluated accordingly and not against the individual resource.</p>
<p>Preflight requests are typically cached by the browser and therefore subsequent requests would then skip this step where the actual request will be dispatched in case the cached preflight request had succeeded. The TTL (Time to Live) for cache is configurable.</p>
<h5>Actual Request</h5>
<p>Actual request refers to the request that the client intended. Such requests also have an additional header &ldquo;Origin&rdquo; added by the User Agent.</p>
<p>Successful CORS requests have valid Access-Control response headers. In case no Access-Control headers are returned, the browser would deny the request issuer from seeing the response. Note that the request will still be processed by the service regardless if the Origin header matches a configured rule. The Web Browser decides what part, if any, of the response is exposed to the JavaScript code based on the Access-Control response headers values.</p>
<p>There are some scenarios where the OPTIONS request is not required and therefore is not issued by the Web Browser. Instead Actual requests are directly dispatched and such requests referred to as a <a href="http://www.w3.org/TR/cors/#simple-cross-origin-request" target="_blank">simple requests</a>.</p>
<h3>CORS Usage scenarios for Windows Azure Storage</h3>
<p>As mentioned a typical usage for CORS for Blobs would be to allow direct Web Browser file upload against a Windows Azure Storage account. In this case, a user can use CORS along with SAS (Shared Access Signature) authentication mechanism in order to grant Web Browser write privilege to your storage account. In this case, whenever a user is ready to upload, the JavaScript code would request a blob SAS URL to upload against from your service and then perform a PUT blob request against storage. It is recommended that you limit the access time of the SAS token to the needed duration time in order to limit any security risks and the specific container and or blob to be uploaded. Best practices for SAS usage can be found in <a href="http://www.windowsazure.com/en-us/manage/services/storage/net/shared-access-signature-part-1/" target="_blank">here</a>.</p>
<p>Another usage of CORS for Windows Azure Table would be to display table data and possibly manipulate such data from the browser. A typical scenario would be to expose an admin page where a user can change some configuration settings for your website that you persist in a Windows Azure Table. In here, you can use CORS, SAS and JSON to implement such capability as is shown in the <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">code sample</a>. JSON in this case would be a natural fit where you can use JQuery capabilities in JavaScript in order to perform Windows Azure Table request and manipulate the data.</p>
<p>We have provided a <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">sample code</a> where we demo JavaScript code that illustrates Blob upload and listing capabilities as well as Insert and Query Entities capabilities for Windows Azure Table using JQuery.</p>
<h3>How to Enable CORS in Windows Azure Storage</h3>
<p>To take advantage of CORS, you first need to enable it and configure it on the desired service (Blob, Table, or Queue) separately. You would have to use the latest storage version &ldquo;<a href="http://msdn.microsoft.com/en-us/library/windowsazure/dd894041.aspx" target="_blank">2013-08-15</a>&rdquo; in order to set CORS rules by either using REST APIs or the Windows Azure Storage Client (<a href="http://www.nuget.org/packages/WindowsAzure.Storage" target="_blank">.Net</a>, <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.windowsazure.storage%22" target="_blank">Java</a>, <a href="http://www.nuget.org/packages/wastorage" target="_blank">C++</a>). Once enabled, you can use any other storage version to interact and issue REST requests against your storage account, such as Put Blob, Query Entity, etc&hellip; while staying compliant with CORS.</p>
<p>The MSDN documentation <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx" target="_blank">here</a> explains in detail how to configure CORS rules on your account via the REST APIs <a href="http://msdn.microsoft.com/en-us/library/windowsazure/hh452235.aspx" target="_blank">Set Blob Service Properties (REST API)</a>, <a href="http://msdn.microsoft.com/en-us/library/windowsazure/hh452232.aspx" target="_blank">Set Queue Service Properties (REST API)</a>, and <a href="http://msdn.microsoft.com/en-us/library/windowsazure/hh452240.aspx" target="_blank">Set Table Service Properties (REST API)</a>.</p>
<p>In this section, we will briefly explain the different CORS rule configuration and show how to use the <a href="http://www.nuget.org/packages/WindowsAzure.Storage" target="_blank">Windows Azure Storage Client .NET Library 3.0</a> in order to enable and configure CORS.</p>
<p>You can configure up to 5 CORS rules for each storage service (i.e. Blob, Table or Queue). An example of a single CORS rule is as such.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: 'Courier New', courier, monospace; font-size: 8pt; direction: ltr; background-color: #f4f4f4;"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">CorsRule</span><span style="color: #0000ff;">&gt;</span><br/>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">AllowedOrigins</span><span style="color: #0000ff;">&gt;</span>http://www.contoso.com, http://www.fabrikam.com<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">AllowedOrigins</span><span style="color: #0000ff;">&gt;</span><br/>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">AllowedMethods</span><span style="color: #0000ff;">&gt;</span>PUT,GET<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">AllowedMethods</span><span style="color: #0000ff;">&gt;</span><br/>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">AllowedHeaders</span><span style="color: #0000ff;">&gt;</span>x-ms-meta-data*,x-ms-meta-target,x-ms-meta-source<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">AllowedHeaders</span><span style="color: #0000ff;">&gt;</span><br/>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ExposedHeaders</span><span style="color: #0000ff;">&gt;</span>x-ms-meta-*<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ExposedHeaders</span><span style="color: #0000ff;">&gt;</span><br/>  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">MaxAgeInSeconds</span><span style="color: #0000ff;">&gt;</span>200<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">MaxAgeInSeconds</span><span style="color: #0000ff;">&gt;</span><br/><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">CorsRule</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>For a detailed explanation of each of the xml elements, please refer to <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx#sectionSection1" target="_blank">this</a> MSDN documentation.</p>
<p>The above rule would permit CORS requests that satisfy the following conditions to be made:</p>
<ul>
<li>Originating from either http://www.contoso.com or http://www.fabrikam.com (AllowedOrigins)</li>
<li>And have an HTTP request method of either PUT or GET (AllowedMethods)</li>
</ul>
<p>Note that you can set both <strong>AllowedOrigins</strong> and <strong>AllowedMethods</strong> to *, which means the service would send required CORS headers for <strong>all methods (PUT, POST, GET, etc.) when invoked by all origins </strong>and is the most typical usage. This does not mean that anyone can access your account. They still need to have proper authentication signature as mentioned before.</p>
<p>The <strong>AllowedHeaders</strong> would let you configure which request headers the client (JavaScript code) can send against your storage account. This is enforced by the Web Browser who would get to learn about these allowed headers through either the preflight request or the actual request where the Windows Azure Storage service would return such list as part of the Access-Control-Allow-Headers response header. Assume that you don&rsquo;t want the client to store arbitrary metadata information when calls are issued from the browser and you want to deny storing any info, for instance, in the x-ms-meta-reserved key. In the above example, you would be limiting the metadata to key names either starting with x-ms-meta-data or exactly matching x-ms-meta-target or x-ms-meta-source. Typically you would want to configure this to *, i.e. Allow all request headers.</p>
<p>The <strong>ExposedHeaders</strong> indicate which response headers can be exposed to the client JavaScript code. This is also enforced by the Web Browser who would learn about these headers through the actual request where Windows Azure Storage Service would return such list of headers as part of the Access-Control-Expose-Headers header response. Typically you would want to configure this to *, i.e. Allow all response headers.</p>
<p>The <strong>MaxAgeInSeconds</strong> indicates the maximum amount time that a browser can cache the preflight OPTIONS request. In the example above, it is set to 200 seconds. It is recommended to set <strong>MaxAgeInSeconds</strong> to a relatively large number if the rules do not change frequently since this will increase the responsiveness of your web application by reducing roundtrips and also reduce your storage billing charges as Preflight requests are billed.</p>
<p>Note that CORS rules are evaluated in the order they appear in XML as part of Set Service Properties REST API. This means that you should consider having the more restrictive rules appear first. Any * rule should then appear last. For more details on CORS rule evaluation, please refer to <a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx#sectionSection0" target="_blank">Understanding CORS Rule Evaluation Logic</a> MSDN documentation.</p>
<h4>Code Sample for Enabling CORS using Windows Azure Storage Client Library 3.0</h4>
<p>Below is a code sample that would enable CORS on a Windows Azure Storage Account for the Blob and Table Service. The code is a snippet from the sample code provided in <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76">here</a>.</p>
<p>The code would first GET the current service properties, enable CORS with a single rule of allowing all origins and HTTP methods (PUT, GET, HEAD and POST), and then commits the modified service properties against both the Blob and Table Service.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: 'Courier New', courier, monospace; font-size: 8pt; direction: ltr; background-color: #f4f4f4;"><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> InitializeCors()<br/>{<br/>     <span style="color: #008000;">// CORS should be enabled once at service startup</span><br/>     <span style="color: #008000;">// Given a BlobClient, download the current Service Properties </span><br/>     ServiceProperties blobServiceProperties = BlobClient.GetServiceProperties();<br/>     ServiceProperties tableServiceProperties = TableClient.GetServiceProperties();<br/><br/>     <span style="color: #008000;">// Enable and Configure CORS</span><br/>     ConfigureCors(blobServiceProperties);<br/>     ConfigureCors(tableServiceProperties);<br/>            <br/>     <span style="color: #008000;">// Commit the CORS changes into the Service Properties</span><br/>     BlobClient.SetServiceProperties(blobServiceProperties);<br/>     TableClient.SetServiceProperties(tableServiceProperties);<br/>}<br/><br/><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span> ConfigureCors(ServiceProperties serviceProperties)<br/>{<br/>    serviceProperties.Cors = <span style="color: #0000ff;">new</span> CorsProperties();<br/>    serviceProperties.Cors.CorsRules.Add(<span style="color: #0000ff;">new</span> CorsRule()<br/>    {<br/>        AllowedHeaders = <span style="color: #0000ff;">new</span> List&lt;<span style="color: #0000ff;">string</span>&gt;() { <span style="color: #006080;">"*"</span> },<br/>        AllowedMethods = CorsHttpMethods.Put | CorsHttpMethods.Get | CorsHttpMethods.Head | CorsHttpMethods.Post,<br/>        AllowedOrigins = <span style="color: #0000ff;">new</span> List&lt;<span style="color: #0000ff;">string</span>&gt;() { <span style="color: #006080;">"*"</span> },<br/>        ExposedHeaders = <span style="color: #0000ff;">new</span> List&lt;<span style="color: #0000ff;">string</span>&gt;() { <span style="color: #006080;">"*"</span> },<br/>        MaxAgeInSeconds = 1800 <span style="color: #008000;">// 30 minutes</span><br/>     });<br/>}</pre>
</div>
<h3>Sample JavaScript Code for uploading a Blob to Windows Azure Storage</h3>
<p>This below sample is a code snippet that would allow you to upload a file directly from the Web Browser into Windows Azure Storage using JavaScript. The full code is available in <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76">here</a>. The code below is a snippet from the UploadImage.cshtml file.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: 'Courier New', courier, monospace; font-size: 8pt; direction: ltr; background-color: #f4f4f4;"><span style="color: #008000;">// Method uploads a blob to Azure Storage by using a Blob SAS URL.</span><br/><span style="color: #008000;">// The Web Browser will add the necessary CORS headers and issue a preflight request if needed.</span><br/><span style="color: #008000;">// blobSasUrl: Blob SAS URL already obtained through an Ajax call to own service</span><br/><span style="color: #008000;">// fileDataAsArrayBuffer: an ArrayBuffer (Byte Array) containing the raw data of the file to be uploaded</span><br/><span style="color: #0000ff;">function</span> uploadImage(blobSasUrl, fileDataAsArrayBuffer) {<br/>    <span style="color: #0000ff;">var</span> ajaxRequest = <span style="color: #0000ff;">new</span> XMLHttpRequest();<br/><br/>    <span style="color: #008000;">// Once the image is successfully upload, we will call render Image that would show the uploaded image</span><br/>    ajaxRequest.onreadystatechange = <span style="color: #0000ff;">function</span>() {<span style="color: #0000ff;">return</span> renderImage(ajaxRequest, blobSasUrl)};<br/><br/>    <span style="color: #0000ff;">try</span> {<br/>        <span style="color: #008000;">// Performing a PutBlob (BlockBlob) against storage</span><br/>        ajaxRequest.open(<span style="color: #006080;">'PUT'</span>, blobSasUrl, <span style="color: #0000ff;">true</span>);<br/>        ajaxRequest.setRequestHeader(<span style="color: #006080;">'Content-Type'</span>, <span style="color: #006080;">'image/jpeg'</span>);<br/>        ajaxRequest.setRequestHeader(<span style="color: #006080;">'x-ms-blob-type'</span>, <span style="color: #006080;">'BlockBlob'</span>);<br/>        ajaxRequest.send(fileDataAsArrayBuffer);<br/>    }<br/>    <span style="color: #0000ff;">catch</span> (e) {<br/>        alert(<span style="color: #006080;">"can't upload the image to server.\n"</span> + e.toString());<br/>    }<br/>}</pre>
<p>The code first calls into your ASP.NET service in order to retrieve the Blob SAS URL. Here is the code that does that and which eventually calls into the uploadImage method above. It first loads the selected files, then retrieves the Blob SAS URL and finally calls into uploadImage in order to upload the image into Azure Storage.</div>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: 'Courier New', courier, monospace; font-size: 8pt; direction: ltr; background-color: #f4f4f4;"><span style="color: #008000;">// This Method is called after the user selects the images to upload.</span><br/><span style="color: #008000;">// It loops over all selected files and uploads them one by one into Azure Storage.</span><br/><span style="color: #0000ff;">function</span> handleFileSelect(evt) {<br/>    <span style="color: #0000ff;">var</span> files = evt.target.files; <span style="color: #008000;">// all selected files (FileList object)</span><br/><br/>    <span style="color: #008000;">// Loop through the FileList, save them and render image files as thumbnails.</span><br/>    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0, file; file = files[i]; i++) {<br/>        <span style="color: #008000;">// Create a reader that would read the entire file data as ArrayBuffer</span><br/>        <span style="color: #0000ff;">var</span> reader = <span style="color: #0000ff;">new</span> FileReader();<br/><br/>        <span style="color: #008000;">// AJAX URL that would be used to request an Azure Blob SAS URL</span><br/>        file.getSasUri = <span style="color: #006080;">"/Home/GetBlobSasUrl"</span> + <span style="color: #006080;">"?blobName="</span> + file.name;<br/><br/>        reader.onloadend = (<span style="color: #0000ff;">function</span> (theFile) {<br/>            <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span> (e) {<br/>                <span style="color: #008000;">// Once the reader is done reading the file bytes</span><br/>                <span style="color: #008000;">// We will issue an AJAX call against our service to get the SAS URL</span><br/>                $.ajax({<br/>                    type: <span style="color: #006080;">'GET'</span>,<br/>                    url: theFile.getSasUri,<br/>                    success: <span style="color: #0000ff;">function</span> (res, status, xhr) {<br/>                        <span style="color: #008000;">// Called into GetBlobSasUrl to generate the SAS for the required blob</span><br/>                        blobSasUrl = xhr.responseText;<br/>                        <span style="color: #008000;">// Now we have a SAS url that we will use to upload the image</span><br/>                        <span style="color: #008000;">// Pass in the SAS URL and the ArrayBuffer to be uploaded</span><br/>                        uploadImage(blobSasUrl, e.target.result);<br/>                    },<br/>                    error: <span style="color: #0000ff;">function</span> (res, status, xhr) {<br/>                        alert(<span style="color: #006080;">"can't get sas from the server"</span>);<br/>                    }<br/>                });<br/>            };<br/>        })(file);<br/><br/>        <span style="color: #008000;">// Read in the image file as an ArrayBuffer. Once done the reader.onloadend event is raised</span><br/>        reader.readAsArrayBuffer(file);<br/>    }<br/>}</pre>
</div>
<h3>Sample JQuery Code for accessing Windows Azure Table</h3>
<p>Please refer to the sample code provided in <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">here</a> for JQuery code for InsertEntity and QueryEntities code. A starting point would be the InsertTableEntities.cshtml and QueryTableEntities.cshtml files.</p>
<h3>CORS Sample Code</h3>
<p>The CORS code sample can be found <a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">in here</a>. Please ensure that you have the latest version of the <a href="http://docs.nuget.org/docs/start-here/installing-nuget" target="_blank">NuGet Package Manager</a> installed in order to get access to the referenced libraries.</p>
<p>The sample by default is configured to use the Windows Azure Storage Emulator which can be downloaded from <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2014/01/27/windows-azure-storage-emulator-2-2-1-preview-release-with-support-for-2013-08-15-version.aspx" target="_blank">here</a>. You can use your Windows Azure Storage account by configuring AzureCommon.StorageAccount as part of the AzureCommon.cs file.</p>
<h3>Summary</h3>
<p>To summarize, the support for CORS in Windows Azure Storage allows application developers to use scripts in their web pages to directly communicate with Windows Azure storage resources (blobs, tables and queues) without having to proxy the calls through their web service. The <a href="https://github.com/WindowsAzure/azure-storage-net" target="_blank">Windows Azure Storage Client Library</a> makes it simple to configure CORS.</p>
<p>Wael Abdelghani and Jean Ghanem</p>
<p>&nbsp;</p>
<p>&nbsp;<strong>Resources</strong></p>
<p><a href="http://code.msdn.microsoft.com/Windows-Azure-Storage-CORS-45e5ce76" target="_blank">CORS Sample code on MSDN</a></p>
<p><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2013/11/27/windows-azure-storage-release-introducing-cors-json-minute-metrics-and-more.aspx" target="_blank">Windows Azure Storage Release - Introducing CORS, JSON, Minute Metrics, and More</a></p>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/dd894041.aspx" target="_blank">2013-08-15 Storage REST version</a> release notes</p>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsazure/dn535601.aspx" target="_blank">Cross-Origin Resource Sharing (CORS) Support for the Windows Azure Storage Services</a></p>
<p>Windows Azure Storage Libraries</p>
<ul>
<li>.Net <a href="http://www.nuget.org/packages/WindowsAzure.Storage" target="_blank">Binaries(NuGet)</a> <a href="https://github.com/WindowsAzure/azure-storage-net" target="_blank">Source (GitHub)</a></li>
<li>C++ <a href="http://www.nuget.org/packages/wastorage" target="_blank">Binaries (NuGet)</a> <a href="https://github.com/WindowsAzure/azure-storage-cpp" target="_blank">Source (GitHub)</a></li>
<li>Java <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.windowsazure.storage%22" target="_blank">Binaries(Maven)</a> <a href="https://github.com/WindowsAzure/azure-storage-java" target="_blank">Source (GitHub)</a></li>
</ul>
<p>&nbsp;</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (6)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-391">
				<div id="div-comment-391" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Gangsir</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-391">
			February 12, 2014 at 10:32 pm</a>		</div>

		<p>Great introduction of CORS</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-413">
				<div id="div-comment-413" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Ahmet Alp Balkan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-413">
			March 20, 2014 at 12:49 pm</a>		</div>

		<p>Finally, thanks! Looking forward to see index.html support for containers!</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-500">
				<div id="div-comment-500" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Sam K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-500">
			August 10, 2014 at 6:25 am</a>		</div>

		<p>While the CORS functionality of the blob store itself works fine, and it adds the correct Access-Control and Vary: Origin headers in the response, there are still some issues that don&#39;t seem to be addressed.</p>
<p>* Adding CORS policy seems to only affect files created AFTER the policy was added. Any existing files will behave as if CORS does not exist.</p>
<p>* The Azure CDN which is running of a blob store will strip out the Vary:Origin and Access-Control headers entirely. It&#39;ll serve the same response whatever the origin is. This makes the CDN unable to serve static website files, namely fonts, as browsers block them by default (ironically a policy Microsoft adopted first in IE).</p>
<p>Is there a team member I can make contact with to discuss these limitations, I have a test case that shows how the CDN doesn&#39;t work.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-501">
				<div id="div-comment-501" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">jaidevh1@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-501">
			August 10, 2014 at 7:22 pm</a>		</div>

		<p>@sam,</p>
<p>CORS should impact all files &#8211; even old ones too. Are you sure it is not the caching layer serving the cached content since TTL is set to large number?</p>
<p>About the CDN, we can work with Azure CDN team to figure this one out. Can you please email jharidas at Microsoft dot com with details?</p>
<p>Thanks,</p>
<p>Jai</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-502">
				<div id="div-comment-502" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Sam K</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-502">
			August 11, 2014 at 3:30 am</a>		</div>

		<p>@Jai,</p>
<p>yes you&#39;re right the CDN does cache the response for old files. I&#39;ve written to you separately about the CDN stripping out the CORS headers.</p>
<p>Thanks.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-531">
				<div id="div-comment-531" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/5cbc7ca3d53016b3c53ea2cf70d1ed02?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/5cbc7ca3d53016b3c53ea2cf70d1ed02?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">olympus@huge.it</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/02/03/windows-azure-storage-introducing-cors/#comment-531">
			September 22, 2014 at 2:33 am</a>		</div>

		<p>so is it possible to host fonts on Azure CDN? I tried, but still seems that CORS doesn&#39;t work&#8230;</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F02%2F03%2Fwindows-azure-storage-introducing-cors%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->