---
layout: windowsazurestorage
title: (Cross-Post) Monitoring, Diagnosing and Troubleshooting Azure Storage
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-170" class="post-170 post type-post status-publish format-standard hentry category-uncategorized">

	<header class="entry-header single">
		<h1 class="entry-title">(Cross-Post) Monitoring, Diagnosing and Troubleshooting Azure Storage</h1>		<div class="rating-wrap">
		<div id="star-rating-170" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="170" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2014-09-24T07:34:00+00:00">September 24, 2014</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/&quot;, &quot;text&quot;: &quot;(Cross-Post) Monitoring, Diagnosing and Troubleshooting Azure Storage&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/&quot;, &quot;text&quot;: &quot;(Cross-Post) Monitoring, Diagnosing and Troubleshooting Azure Storage&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>Diagnosing and troubleshooting issues in modern online applications is more complex than in traditional client-server applications because they include:</p>
<ul>
<li>Complex topologies with components running PaaS or IaaS infrastructure, on-premises, on mobile devices, or some combination of these</li>
<li>Network traffic that traverses public and private networks; including devices with unpredictable connectivity</li>
<li>Multiple storage technologies such as Microsoft Azure Storage Tables, Blobs, Queues, or Files in addition to other data stores such as relational databases.</li>
</ul>
<p>The Azure Storage service includes sophisticated capabilities to help you to manage these challenges. These capabilities include enabling you to <em>monitor </em>the Storage services your application uses for any unexpected changes in behavior (such as slower than usual response times) as well as extensive <em>logging</em> capabilities &ndash; both in the storage service and client applications developed with the storage client libraries. The information you obtain from both monitoring and logging will help you to <em>diagnose</em> and <em>troubleshoot</em> the issue and determine the appropriate steps you can take to remediate it. The analytics capability has been designed not to affect the performance of your operations, plus includes the ability to define retention policies for managing the amount of storage consumed.</p>
<p>To help you learn how to manage the health of your online services we have developed the <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/" target="_blank">Storage Monitoring, Diagnosing and Troubleshooting Guide</a>. This includes prescriptive guidance on monitoring and diagnosing problems related to health, availability, performance and capacity &ndash; as well as actionable troubleshooting guidance for the top issues that ourselves and our support teams face when working with customers. For anyone building Storage based applications we believe this guide is essential reading! The illustration below shows extracts from each of the sections focused on how to manage the performance of your application.</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/0245.clip_image002_02A98835.jpg" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/0245.clip_5F00_image002_5F00_02A98835.jpg"><img style="margin-left: 0px; display: inline; margin-right: 0px; border-width: 0px;" title="clip_image002" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/0741.clip_image002_thumb_302AA7F8.jpg" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/0741.clip_5F00_image002_5F00_thumb_5F00_302AA7F8.jpg" alt="clip_image002" width="643" height="367" border="0"/></a></p>
<h2>Example Scenario &ndash; Investigating the performance degradation of an application</h2>
<p>To illustrate how the guide can help you, we will walk through a scenario that we see frequently &ndash; and that is where a customer reports that the performance of their application is slower than normal. If the customer doesn&rsquo;t have a monitoring strategy in place it can be difficult and time consuming to determine the root cause of this problem.</p>
<p>The <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#monitoring-your-storage-service" target="_blank">monitoring</a><em></em> section of the guide walks you through some key metrics that you should be capturing and monitoring on an ongoing basis looking for unexpected changes in these values as an indicator that you may have an issue that needs investigation. Two metrics that are relevant to this particular scenario are the <strong>AverageE2ELatency</strong> and <strong>AverageServerLatency</strong> metrics. <strong>AverageE2ELatency</strong> is a measure of end-to-end latency that includes the time taken by our service to read the request from the client and send the response back to the client in addition to the time taken to process the request (therefore includes network latency once the request reaches the storage service); <strong>AverageServerLatency</strong> is a measure of just the processing time by our service and therefore excludes any network latency related to communicating with the client or latencies associated with the client application populating and consuming the send and response buffers.</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/3302.image_63DE647D.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/3302.image_5F00_63DE647D.png"><img style="margin-left: 0px; display: inline; margin-right: 0px; border-width: 0px;" title="image" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/8105.image_thumb_51959DBB.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/8105.image_5F00_thumb_5F00_51959DBB.png" alt="image" width="667" height="112" border="0"/></a></p>
<p>From looking at the metrics data in the portal (see the illustration above) the AverageE2Elatency is significantly higher than the AverageServerLatency. The first thing you would now want to do is compare this with baseline metrics that you should establish through ongoing monitoring of your service &ndash; and initially during performance testing of your application and a limited release to production. For now we will assume this discrepancy is indeed an issue outside of the Azure Storage Service &ndash; at which point we can use the <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#troubleshooting-guidance" target="_blank">troubleshooting decision tree</a> to take you to the section "<a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency" target="_blank">Metrics show high AverageE2ELatency and low AverageServerLatency</a>". This section then discusses different possibilities to explore:</p>
<ul>
<li>Client performance issues - Possible reasons for the client responding slowly include having a limited number of available connections or threads, or being low on resources such as CPU, memory or network bandwidth. You may be able to resolve the issue by modifying the client code to be more efficient (for example by using asynchronous calls to the storage service), or by using a larger Virtual Machine (with more cores and more memory)&hellip; See <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency" target="_blank">here</a> for more information.</li>
<li>Network latency issues - Typically, high end-to-end latency caused by the network is due to transient conditions. You can investigate both transient and persistent network issues such as dropped packets by using tools such as Wireshark or Microsoft Message Analyzer. For more information about using Wireshark to troubleshoot network issues, see "<a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendix-2" target="_blank">Appendix 2: Using Wireshark to capture network traffic</a>." For more information about using Microsoft Message Analyzer to troubleshoot network issues, see "<a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendix-3" target="_blank">Appendix 3: Using Microsoft Message Analyzer to capture network traffic</a>."&hellip; See <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-high-AverageE2ELatency-and-low-AverageServerLatency" target="_blank">here</a> for more information.</li>
</ul>
<p>After reading the client performance section and verifying that the discrepancy between AverageE2ELatency and AverageServerLatency was only occurring for queue operations and not for blob operations the guide directs you to read an article about the Nagle algorithm and how it is not friendly towards small requests. After appropriate testing this was identified as being the problem and the code was updated to turn off Nagle&rsquo;s algorithm. Doing so and monitoring our AverageE2ELatency after the change showed a marked improvement in AverageE2ELatency.</p>
<p>Other issues that can cause intermittent fluctuations in response times include poor network conditions and server side failures. In either of these situations the client application may retry an operation thus increasing the perceived latency for that particular operation. In these cases you would likely see both AverageE2ELatency and AverageServerLatency being low. In this situation the troubleshooting decision tree would take you to this section &ldquo;<a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#metrics-show-low-AverageE2ELatency-and-low-AverageServerLatency" target="_blank">Metrics show low AverageE2ELatency and low AverageServerLatency but the client is experiencing high latency</a>" which walks you through appropriate troubleshooting techniques. The section on "<a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#end-to-end-tracing" target="_blank">End-to-end tracing</a>&rdquo; also provides additional information on how client and server request correlation can assist in troubleshooting these types of issues.</p>
<p>Hopefully this scenario demonstrates the importance of proactively monitoring your service plus having a good understanding of the different tools available to assist you when problems do occur.</p>
<h2>Summary and Call to Action</h2>
<p>To help you learn how to manage the health of your online services we have developed the <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/" target="_blank">Storage Monitoring, Diagnosing and Troubleshooting Guide</a>. This includes prescriptive guidance on monitoring and diagnosing problems related to health, capacity, availability and performance &ndash; as well as actionable suggestions for troubleshooting top issues that ourselves and our support teams face in working with customers.</p>
<p>We have also looked at related guidance and created / updated content relating to:</p>
<ul>
<li>Enabling Metrics and Logs using either the Azure Portal, PowerShell or via APIs See: <a href="http://go.microsoft.com/fwlink/?linkid=510865&amp;clcid=0x409" target="_blank">Enabling Storage Metrics and Viewing Metrics Data</a> and <a href="http://msdn.microsoft.com/en-us/library/dn782840.aspx" target="_blank">Enabling Storage Logging and Accessing Log Data</a></li>
<li>Enabling logging within the .NET and Java Client libraries &ndash; this is especially useful when diagnosing application specific issues such as client connectivity. See: <a href="http://msdn.microsoft.com/en-us/library/dn782839.aspx" target="_blank">Client-side Logging with the .NET Storage Client Library</a> and <a href="http://msdn.microsoft.com/en-us/library/dn782844.aspx" target="_blank">Client-side Logging with the Microsoft Azure Storage SDK for Java</a></li>
<li>Instructions for using networking tools to diagnose network connectivity issues. See: <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#appendices" target="_blank">Analyzing Network Traffic using Network Analysis Tools</a>, and</li>
<li>Instructions for correlating data from storage logs, network logs and client libs. See: <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/#end-to-end-tracing">End-to-End Tracing</a></li>
</ul>
<p>In terms of next steps we recommend:</p>
<ul>
<li><a href="http://go.microsoft.com/fwlink/?linkid=510865&amp;clcid=0x409" target="_blank">Enable metrics</a> and <a href="http://msdn.microsoft.com/en-us/library/dn782840.aspx" target="_blank">logging</a> on your production storage accounts &ndash; as it is not enabled by default</li>
<li>Read the monitoring and diagnosing sections of the <a href="http://azure.microsoft.com/en-us/documentation/articles/storage-monitoring-diagnosing-troubleshooting/" target="_blank">guide</a> so you can update your management policies</li>
<li>Book mark the guide to assist with troubleshooting when problems do occur</li>
</ul>
<p>We hope this guidance makes managing your online services much simpler!</p>
<p>Jason Hogg</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/09/24/cross-post-monitoring-diagnosing-and-troubleshooting-azure-storage/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F09%2F24%2Fcross-post-monitoring-diagnosing-and-troubleshooting-azure-storage%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->