---
layout: windowsazurestorage
title: Windows Azure Drive Demo at MIX 2010
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-13" class="post-13 post type-post status-publish format-standard hentry category-uncategorized tag-windows-azure-blobs tag-windows-azure-blobs-page tag-windows-azure-drives">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Drive Demo at MIX 2010</h1>		<div class="rating-wrap">
		<div id="star-rating-13" class="wds-ratings" data-rating="0" data-userrating="0" data-postid="13" data-container="body" data-toggle="tooltip" title="0 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 0 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2010-03-28T19:38:00+00:00">March 28, 2010</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/&quot;, &quot;text&quot;: &quot;Windows Azure Drive Demo at MIX 2010&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/&quot;, &quot;text&quot;: &quot;Windows Azure Drive Demo at MIX 2010&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p><p>With a <a href="http://go.microsoft.com/?linkid=9710117" mce_href="http://go.microsoft.com/?linkid=9710117">Windows Azure Drive</a>, applications running in the Windows Azure cloud can use existing NTFS APIs to access a network attached durable drive.&nbsp; The durable drive is actually a <a href="http://msdn.microsoft.com/en-us/library/ee691964.aspx">Page Blob</a> formatted as a single volume NTFS Virtual Hard Drive (VHD).&nbsp; </p><br/>
<p>In the <a href="http://live.visitmix.com/MIX10/Sessions/SVC05" mce_href="http://live.visitmix.com/MIX10/Sessions/SVC05">MIX 2010 talk on Windows Azure Storage</a> I gave a short 10 minute demo (starts at 19:20) on using Windows Azure Drives.&nbsp; Credit goes to Andy Edwards, who put together the demo. The demo focused on showing how easy it is to use a VHD on Windows 7, then uploading a VHD to a Windows Azure Page Blob, and then mounting it for a Windows Azure application to use. </p><br/>
<p>The following recaps what was shown in the demo and points out a few things glossed over.</p><br/>
<p><b>Using VHDs in Windows 7</b></p><br/>
<p>One can easily create and use VHDs on your local Windows 7 machine.&nbsp;&nbsp; To do this run “diskmgmt.msc”.&nbsp;&nbsp; This will bring up the Disk Management program in Windows 7.&nbsp; You can then use the “Action” menu to create VHDs and attach (mount) VHDs.&nbsp; Note, Windows Azure Drives only supports “Fixed Size” VHDs (we do not not support “Dynamic” VHDs).&nbsp; So when creating a VHD in Disk Management, use the “Fixed Size” option.</p><br/>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001_2.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001_2.png"><img style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title="clip_image001" border="0" alt="clip_image001" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001_thumb.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001_thumb.png" width="298" height="188"></a></p><br/>
<p>Once the VHD is attached, you can then store data in it as any normal NTFS drive.&nbsp; </p><br/>
<p>You can also use Disk Management to detach a drive by right clicking on the mounted disk, and then choosing “Detach VHD”. This is shown in the below, where we right clicked on Disk 1, and it brought up the menu below to “Detach VHD” the X: drive we had mounted.</p><br/>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_2.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_2.png"><img style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_thumb.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_thumb.png" width="319" height="436"></a> </p><br/>
<p><b></b></p><br/>
<p><b>Uploading VHDs into a Windows Azure Page Blob</b></p><br/>
<p>The demo then showed using a command line tool Andy wrote to upload the local VHD file to a Page Blob in a Windows Azure Storage account using the Storage Client Library.&nbsp; <em><a href="http://blogs.msdn.com/windowsazurestorage/archive/2010/04/11/using-windows-azure-page-blobs-and-how-to-efficiently-upload-and-download-page-blobs.aspx">The next blog posting will go into Page Blobs and provide the code for this tool</a>.</em></p><br/>
<p><b>Using a Windows Azure Drive in the Cloud Application</b></p><br/>
<p>The demo then showed how to code up and use a Windows Azure Drive in a Windows Azure role.&nbsp;&nbsp; To do this we used the <a href="http://www.microsoft.com/downloads/en/confirmation.aspx?familyId=5664019e-6860-4c33-9843-4eb40b297ab6&amp;displayLang=en">Windows Azure SDK</a> and the <a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.aspx" mce_href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.aspx">Windows Azure Storage Client Library</a> provided with it, so make sure you have the Windows Azure SDK installed.</p><br/>
<ul><br/>
<li><strong>Setting up the storage account </strong></li></ul><br/>
<p>The first step in your application is to create a configuration settings to specify the storage account name and its secret key.&nbsp; To do this you would add a configuration setting to your ServiceConfiguration.cscfg as shown below:</p><pre class="code">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">ConfigurationSettings</span><span style="COLOR: blue">&gt;<br/>
      &lt;</span><span style="COLOR: #a31515">Setting </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">CloudStorageAccount</span>" <br>       <span style="COLOR: red">value</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">DefaultEndpointsProtocol=http; <br>       AccountName=xdrivedemo;AccountKey=vhz/HSBZzBwiNpx9399hnWAe3zJGX … f+VvVA4OQ==</span>" <span style="COLOR: blue">/&gt;<br/>
    &lt;/</span><span style="COLOR: #a31515">ConfigurationSettings</span><span style="COLOR: blue">&gt;<br/>
</span> <br> </pre><br/>
<p>The storage account name we are using for the demo is “xdrivedemo” (the storage AccountKey isn’t fully listed for obvious reasons). </p><br/>
<p>Now the same configuration setting can be specified by clicking on your web or worker role in Visual Studio to get the following settings screen.&nbsp;&nbsp; To create the storage account configuration setting select “Settings” and then use “Add Setting”.</p><br/>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_10.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_10.png"><img style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_thumb_4.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/image_thumb_4.png" width="613" height="118"></a> </p><br/>
<p>In the above, we added the CloudStorageAccount configuration setting with the storage account name and key.&nbsp; When creating the setting we specified its type to be “Connection String”.&nbsp;&nbsp; When you do this, you’ll see a “…” at the end in the value field.&nbsp; When you click on that you’ll see the following dialog box, where you can enter your storage account name and account key.</p><br/>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B5%5D.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B5%5D.png"><img style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title="clip_image001[5]" border="0" alt="clip_image001[5]" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B5%5D_thumb.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B5%5D_thumb.png" width="506" height="314"></a></p><br/>
<p>Once the storage account configuration settings has been entered, we now need to write the code to allow us to access the storage account in our application.&nbsp; To do this, in the application we create a <a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.cloudstorageaccount.aspx">CloudStorageAccount</a> object or static member.&nbsp; We can use this to then access our Windows Azure Storage account where the Page Blobs (drives) will be stored. This is done with the following code:</p><pre class="code"><span style="COLOR: blue"></span></pre><pre class="code"><span style="COLOR: blue">public </span><span style="COLOR: #2b91af">CloudStorageAccount </span>account;<br/>
account = <span style="COLOR: #2b91af">CloudStorageAccount</span>.FromConfigurationSetting(<br>          <span style="COLOR: #a31515">"CloudStorageAccount"</span>); <br> </pre><a href="http://11011.net/software/vspaste"></a><br/>
<p>At this point, we have an “account” object that we can use to perform actions against our storage account in the cloud.</p><br/>
<p mce_keep="true">&nbsp;</p><br/>
<ul><br/>
<li><strong>Initializing the Drive Cache </strong></li></ul><br/>
<p>Now before the application can use a Windows Azure Drive it first needs to initialize the Drive Cache.&nbsp; This initialization only needs to be done once per running VM instance.&nbsp; Once this initialization is done successfully for the VM instance, then all processes/threads running under that instance can mount and manipulate drives.</p><br/>
<p>To perform the drive cache initialization we first need to reserve part of the local disk resources for the VM instance to be used by the Drive Cache.&nbsp; To do this, we first specify a Local Storage resource as part of the ServiceDefinition.csdef as follows:</p><pre class="code">    <span style="COLOR: blue">&lt;</span><span style="COLOR: #a31515">LocalResources</span><span style="COLOR: blue">&gt;<br/>
      &lt;</span><span style="COLOR: #a31515">LocalStorage </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">AzureDriveCache</span>" <br>       <span style="COLOR: red">cleanOnRoleRecycle</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">false</span>" <span style="COLOR: red">sizeInMB</span><span style="COLOR: blue">=</span>"<span style="COLOR: blue">1000</span>" <span style="COLOR: blue">/&gt;<br/>
    &lt;/</span><span style="COLOR: #a31515">LocalResources</span><span style="COLOR: blue">&gt;<br/>
</span> <br>&nbsp; </pre><br/>
<p>Alternatively, one can use the web/worker role interface specification provided as part of the SDK in Visual Studio to create the local storage resource.&nbsp; To do this, click on your web or worker role in Visual Studio to get the following settings screen.&nbsp;&nbsp; Then to create the local storage resource, select “Local Storage”. Then select “Add Local Storage”.&nbsp; You then give it a name and specify the amount of local storage you want this resource to have in MBytes as shown here:</p><br/>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B7%5D.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B7%5D.png"><img style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title="clip_image001[7]" border="0" alt="clip_image001[7]" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_msdn/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B7%5D_thumb.png" original-url="http://blogs.msdn.com/blogfiles/windowsazurestorage/WindowsLiveWriter/EfficientUploadandDownloadofPageBlobs_BF5E/clip_image001%5B7%5D_thumb.png" width="476" height="161"></a></p><br/>
<p>In the above, we’ve specified to reserve 1 GByte of the local disk space for this resource.&nbsp; We also left “Clean on Role Recycle”&nbsp; unchecked because we don’t want the cache flushed if/when the role restarts.&nbsp; </p><br/>
<p>The disk space for this local storage resource comes out the allocated disk space for the VM instance you are running your role on.&nbsp; The maximum size you can specify for the local storage resource is the maximum local disk space your VM instance can have depending upon the VM size you have chosen (<a href="http://msdn.microsoft.com/en-us/library/ee814754.aspx">Small, Medium, Large or Extra Large</a>).&nbsp; For example, a small VM instance provides up to 250 GBytes of local disk space.</p><br/>
<p>Now that we have the local storage resource defined, we now need to initialize the drive cache.&nbsp; To do this, we add the following code to do this initialization when the role starts up:</p><pre class="code"><span style="COLOR: #2b91af">LocalResource </span>azureDriveCache = <br>           <span style="COLOR: #2b91af">RoleEnvironment</span>.GetLocalResource(<span style="COLOR: #a31515">"AzureDriveCache"</span>);<br/>
<span style="COLOR: #2b91af">CloudDrive</span>.InitializeCache(azureDriveCache.RootPath + <br>           <span style="COLOR: #a31515">"cache"</span>, azureDriveCache.MaximumSizeInMegabytes); <br> </pre><br/>
<p>For this, we pass into InitializeCache the RootPath of our local storage resource, which specifies the drive letter to use for the cache. Then the second parameter is the amount storage space from this local storage resource we want to use for the drive cache.&nbsp; Note, this drive cache is to be used across all of the drives to be mounted on this VM instance.&nbsp; You can mount up to 16 drives, and all of these mounted drives share this drive cache disk space that is set aside by this call to InitailizeCache.</p><br/>
<p>One point here is that there is currently a bug in InitializeCache when its first parameter (the path) ends in “\”.&nbsp;&nbsp; This is why we add the “cache” in the above, which puts the drive cache files under a cache directory in that RootPath. Another option to get around this bug would be to trim the “\” off as follows:</p><pre class="code"><span style="COLOR: #2b91af">CloudDrive</span>.InitializeCache(azureDriveCache.RootPath.TrimEnd({<span style="COLOR: #a31515">'\\'</span>}), <br>           azureDriveCache.MaximumSizeInMegabytes); <br> </pre><a href="http://11011.net/software/vspaste"></a><br/>
<p>At this point we have initialized the drive cache, so we can start accessing and using Windows Azure Drives in our application.</p><br/>
<ul><br/>
<li><strong>Creating a drive</strong> </li></ul><br/>
<p>Before we mount a drive we first need to have either uploaded a single volume NTFS VHD into a Page Blob (as we did in the demo), or create a drive with our application in the cloud.&nbsp; Creating a drive can be done with the following:</p><pre class="code"><span style="COLOR: #2b91af">CloudDrive </span>drive = account.CreateCloudDrive(containerName+<span style="COLOR: #a31515">"/"</span>+blobName);<br/>
drive.Create(sizeOfDriveInMegabytes); <br> </pre><br/>
<p>We first create a CloudDrive object specifying the container name and blob name for the Page Blob we want to create.&nbsp; The CloudDrive Create method call will then create the Page Blob in the storage account under “containerName/blobName”, and it will be created with the size in megabytes passed into the Create.&nbsp;&nbsp; Note, the “containerName” <a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.cloudblobcontainer.aspx">Blob Container</a> must already exist in the storage account for the call to succeed, so please make sure you have created that ahead of time.</p><br/>
<p>In addition to creating the Page Blob, the CloudDrive Create method will also format the contents of the Page Blob as a single volume NTFS Fixed Size VHD.&nbsp;&nbsp; Note, the smallest drive you can create is 16MBytes, and the maximum size is 1TByte.</p><br/>
<p>One important point here is that for a Page Blob, all pages that do not have any data stored in them are treated as initialized to zero, and you are only charged for pages you write data into.&nbsp; We take advantage of this when using Page Blobs as VHDs, since when you create and initialize a Fixed Size VHD most of it consists of empty blocks.&nbsp;&nbsp; As we showed in the demo, we had a VHD of 100MBytes and we only had to upload 3MBs of pages, since the rest of the VHD was effectively still zeros.&nbsp;&nbsp; Therefore, when you create a VHD using CloudDrive Create, the formatting only stores data in the pages that need to be updated in order to represent the VHD format and single volume NTFS initialization.&nbsp;&nbsp; This means that your drive after creation will cost just a small fraction of the size you created, since most of the pages are empty.</p><br/>
<ul><br/>
<li><strong>Mounting a drive </strong></li></ul><br/>
<p>Once the drive cache has been initialized, the application can now start to use Windows Azure Drives.&nbsp; To mount a drive one just needs to create a CloudDrive object using the “account” created earlier.&nbsp; When doing this, we pass in the container name and blob name for the Page Blob we want to access using the CloudDrive object as follows:</p><pre class="code"><span style="COLOR: #2b91af">CloudDrive </span>drive = account.CreateCloudDrive(containerName+<span style="COLOR: #a31515">"/"</span>+blobName);<br/>
<span style="COLOR: blue">string </span>path = drive.Mount(sizeOfDriveCacheToUse, <br>                          <span style="COLOR: #2b91af">DriveMountOptions</span>.None); <br> </pre><br/>
<p>When calling mount, you pass in the amount of the drive cache space to use for this specific drive being mounted, and the <a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.drivemountoptions.aspx">drive mount options</a> you want to use.&nbsp; Most applications will want to use the default “DriveMountOptions.None”.&nbsp; A successful mount will return a string specifying the drive letter the VHD was mounted to, so the application can start using the NTFS drive.</p><br/>
<p>Remember that a given VM instance can mount up to 16 drives, and all of these mounted drives share the total amount of drive cache space when calling InitializeCache described earlier.&nbsp; This means that the sum of all of the sizeOfDriveCacheToUse parameters for all of the currently active mounted drives for a VM instance has to be less than or equal to the amount of local disk space put aside for the Drive Cache when calling InitializeCache as described earlier.</p><br/>
<ul><br/>
<li><strong>Unmounting a drive</strong> </li></ul><br/>
<p>Then to unmount the drive, it is as easy as creating a CloudDrive object and calling unmount as follows:</p><pre class="code"><span style="COLOR: #2b91af">CloudDrive </span>drive = account.CreateCloudDrive(containerName+<span style="COLOR: #a31515">"/"</span>+blobName);<br/>
drive.Unmount(); <br> </pre><a href="http://11011.net/software/vspaste"></a><br/>
<ul><br/>
<li><strong>Snapshotting a drive </strong></li></ul><br/>
<p>Then to create a snapshot of the drive you just need to do the following:</p><pre class="code"><span style="COLOR: #2b91af">CloudDrive </span>drive = account.CreateCloudDrive(containerName+<span style="COLOR: #a31515">"/"</span>+blobName);<br/>
<span style="COLOR: #2b91af">Uri </span>snapshotUri = drive.Snapshot(); <br> </pre><a href="http://11011.net/software/vspaste"></a><br/>
<p>Snapshots are read-only.&nbsp; Snapshots can be created while the drive is mounted or when it is unmounted.&nbsp;&nbsp; Snapshotting a drive is useful for creating backups of your drives.&nbsp;&nbsp; Under the covers this uses the <a href="http://msdn.microsoft.com/en-us/library/ee691971.aspx">Page Blob Snapshot</a> command.&nbsp; A nice advantage of this is that you only pay for the unique pages across all of the snapshots and the baseline version of the Page Blob.&nbsp; So as you keep on updating the Page Blob you are only paying for the delta changes being made over the last stored snapshot.</p><br/>
<p><b>Summary</b></p><br/>
<p>Finally, there are a few areas that are worth summarizing and re-emphasizing about Windows Azure Drives:</p><br/>
<ul><br/>
<li>Only Fixed Size VHDs are supported. </li><br/>
<li>The minimum drive size supported is 16MBytes and the maximum is 1TByte. </li><br/>
<li>A VM instance can mount up to 16 drives, and all the active mounts share the drive disk cache space reserved by InitializeCache. </li><br/>
<li>A Page Blob Drive can only be mounted to a single VM instance at a time for read/write access. </li><br/>
<li>Snapshot Page Blob Drives are read-only and can be mounted as read-only drives by multiple different VM instances at the same time. </li><br/>
<li>The Page Blob Drives stored in the Cloud can only be mounted by Windows Azure applications running in the Cloud.&nbsp;&nbsp; We do not provide a driver with the SDK that allows local mounting of the Page Blob Drives in the Cloud. </li><br/>
<li>When uploading a VHD to a Page Blob, make sure you do not upload the empty pages in the VHD, since the Page Blob in the Cloud will by default treat these as initialized to zero.&nbsp; This will reduce your costs of uploading and storing the VHD Page Blob in the Cloud.&nbsp;&nbsp; </li></ul><br/>
<p>Brad Calder <br>Windows Azure Storage</p></p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-blobs/" rel="tag">Windows Azure Blobs</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-blobs-page/" rel="tag">Windows Azure Blobs - Page</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-drives/" rel="tag">Windows Azure Drives</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2010/03/28/windows-azure-drive-demo-at-mix-2010/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2010%2F03%2F28%2Fwindows-azure-drive-demo-at-mix-2010%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->