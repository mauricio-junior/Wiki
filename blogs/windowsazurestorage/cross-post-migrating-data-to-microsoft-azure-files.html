---
layout: windowsazurestorage
title: (Cross-Post) Migrating Data to Microsoft Azure Files
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-161" class="post-161 post type-post status-publish format-standard hentry category-uncategorized">

	<header class="entry-header single">
		<h1 class="entry-title">(Cross-Post) Migrating Data to Microsoft Azure Files</h1>		<div class="rating-wrap">
		<div id="star-rating-161" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="161" data-container="body" data-toggle="tooltip" title="1 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2014-07-24T13:13:00+00:00">July 24, 2014</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/#comments">2</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/&quot;, &quot;text&quot;: &quot;(Cross-Post) Migrating Data to Microsoft Azure Files&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/&quot;, &quot;text&quot;: &quot;(Cross-Post) Migrating Data to Microsoft Azure Files&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<h2>About Microsoft Azure Files</h2>
<p>Microsoft Azure Files is a cloud based storage service that exposes SMB2.1 protocol based file shares in the cloud. Applications running in Azure can now easily share files between VMs using standard and familiar file system APIs like ReadFile and WriteFile. In addition, the files can also be accessed at the same time via a REST interface, which opens a variety of hybrid scenarios. Finally, Azure Files is built on the same technology as the Blob, Table, and Queue Services, which means Azure Files is able to leverage the existing availability, durability, scalability, and geo redundancy that is built into our platform. The service is currently in preview. To read more details about the service, please refer to our <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx" target="_blank">blog post on Files</a>.</p>
<p>&nbsp;</p>
<h2>Migrating Data</h2>
<p>As you start to use Azure Files, you may need to move large amount of existing data into the Files service. There are many options for moving data efficiently to Azure Files, and which you choose will depend on where the data is originally located. The rest of this post discusses these options, and how to achieve best performance using each option.</p>
<blockquote>
<h3>1. On-premise to Azure Files over the internet</h3>
</blockquote>
<p>To copy files, you can use the <a href="https://aka.ms/AzCopy" target="_blank">AzCopy</a> tool provided by Microsoft Azure. AzCopy implements a number of optimizations to ensure best throughput for the copy job (e.g., parallel uploads, multiple threads, correct handling of throttling, etc.).</p>
<p>The format of the AzCopy command line is:</p>
<blockquote>
<p><span style="font-family: Consolas; font-size: small;">AzCopy &lt;source path&gt; &lt;destination URL&gt; [optional filespec] /S /DestKey:&lt;YourKey&gt;</span></p>
</blockquote>
<p>Where</p>
<p><span style="font-family: Consolas;"><span style="font-size: small;">source</span> path</span> is the path to the directory you want to migrate</p>
<p><span style="font-family: Consolas;"><span style="font-size: small;">destination</span> URL</span> is the http URL to the directory you want to copy to</p>
<p><span style="font-family: Consolas; font-size: small;">filespec</span> specifies any file filters for files you want to move (default is *.*)</p>
<p><span style="font-family: Consolas; font-size: small;">YourKey</span> is the storage account key for the destination storage account</p>
<p><span style="font-family: Consolas; font-size: small;">/S</span> is an optional switch to copy all directories and subdirectories under the source directory</p>
<p>AzCopy has many other command-line options, and you should use any others that make sense for your case. For more information, refer to this <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/12/03/azcopy-uploading-downloading-files-for-windows-azure-blobs.aspx" target="_blank">blog post on AzCopy</a>.</p>
<p>Here is an example command to copy files in the c:\data directory to Azure Files:</p>
<blockquote>
<p><span style="font-size: small;"><span style="font-family: Consolas;">AzCopy c:\data </span><span style="font-family: Consolas;">https://myaccount.file.core.windows.net/myshare</span><span style="font-family: Consolas;"> *.* /S /DestKey:myStorageAccountKey</span></span></p>
</blockquote>
<blockquote>
<h3>2. Azure Disk on an IaaS VM to Azure File</h3>
</blockquote>
<p>Customers who run a File server role on IaaS VMs in Azure are finding the Azure File service very attractive, since it frees them from having to manage a file server themselves</p>
<p>To migrate data from an IaaS disk to a Share, you need to:</p>
<ol>
<li>Attach the disk to the VM</li>
<li>Mount the share on your VM</li>
<li>Use robocopy to copy the data into the Azure File shares</li>
</ol>
<p><a href="http://technet.microsoft.com/en-us/library/cc733145.aspx" target="_blank">Robocopy</a> is a free and robust file copy utility included in Windows, for doing large file copies.</p>
<p>The command-line format to use is:</p>
<blockquote>
<p><span style="font-family: Consolas;"><span style="font-size: small;"><strong>Robocopy</strong> &lt;source path&gt; &lt;dest path&gt; [optional filespec] /MIR /MT:16</span></span></p>
</blockquote>
<p>Where:</p>
<p><span style="font-family: Consolas;"><span style="font-size: small;">source</span> path</span> is the path to the directory you want to copy</p>
<p><span style="font-family: Consolas;"><span style="font-size: small;">dest</span> path</span> is the path to the destination directory</p>
<p><span style="font-family: Consolas; font-size: small;">filespec</span> specifies any file filters for files you want to copy (default is *.*)</p>
<p><span style="font-family: Consolas; font-size: small;">MT</span> is the number of threads to use (see discussion below)</p>
<p>When using robocopy, you should choose the &ldquo;/mt&rdquo; parameter to maximize throughput. This lets you control how many parallel threads do the copy, essentially controlling the queue depth of the IO requests to storage. A very low thread count does not queue enough requests on the server to let you take advantage of the inherent parallelism of our <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/12/30/windows-azure-storage-architecture-overview.aspx" target="_blank">cloud architecture</a>. A very high thread count risks server-side throttling, which end up reducing throughput. In our testing, we have found queue depths between 16 to 32 to be best for maximizing throughput.</p>
<h4>Methods to avoid:</h4>
<p>We have found it suboptimal to use xcopy or Windows Explorer to do large file copies to Azure Files. Those tools work great for file copies to NTFS filesystems, but do not provide sufficient parallelism for copying to Azure Files. Azure Files supports highly parallel IO, so many threads doing concurrent copies results in significantly better performance. Using robocopy with the right thread count provides much higher throughput for the copy, resulting in shorter total time to transfer the data.</p>
<blockquote>
<h3>3. Azure Blob to Azure File</h3>
</blockquote>
<p>The fastest way to move data from Azure Blobs to Azure File is to use AzCopy. You should run AzCopy from a VM in the same datacenter as the destination storage account.</p>
<p>An example AzCopy command for doing this is below:</p>
<blockquote>
<p><span style="font-family: Consolas;"><span style="font-size: small;"><strong>AzCopy</strong> https://myaccount1.blob.core.windows.net/mycontainer Z:\mydirectory *.* /SourceKey:myStorageAccountKey</span></span></p>
</blockquote>
<p>(This assumes that the File share is mapped to drive Z)</p>
<p>In this case the data is downloaded to the VM and then copied to Azure Files.</p>
<p>For details on how to use AzCopy, see discussion in section 1 above. To see the command-line options for blobs and other blob-specific options like SAS, run AzCopy with &ldquo;AzCopy /?&rdquo;.</p>
<blockquote>
<h3>4. Cloud Drive to Azure Disk</h3>
</blockquote>
<p><a href="http://azure.microsoft.com/blog/2010/02/01/beta-release-of-windows-azure-drive/" target="_blank">Cloud Drive</a> was released as a preview in 2010. It enabled customers using Azure Cloud Services to mount a page blob as a drive on Web and Worker Roles in Azure. With the release of Azure Files, all the scenarios supported by Cloud Drive can now be better served using Azure Files. Cloud Drives will be deprecated in 2015, so we recommend any customers still using Cloud Drives to migrate their data to Azure Files. The way to move the data is very similar to moving data from Azure VMs using VHDs:</p>
<ol>
<li>Mount the blob as a disk using Cloud Drive (most customers do this as part of the Web or Worker roles&rsquo; setup)</li>
<li>Mount the share on your VM. See this <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2014/05/12/introducing-microsoft-azure-file-service.aspx" target="_blank">blog post</a> on how to create and mount a share.</li>
<li>Use Robocopy to copy the data. See discussion in section 3 on using Robocopy, and the &ldquo;/mt&rdquo; parameter for maximum throughput.</li>
</ol>
<p>We hope these options of moving data to Azure Files will help move your data to the File Service efficiently and help you use the Service to optimize your existing scenarios while enabling new scenarios for your applications and business.</p>
<p>Atul Sikaria</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (2)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F07%2F24%2Fcross-post-migrating-data-to-microsoft-azure-files%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-524">
				<div id="div-comment-524" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Frank Li</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/#comment-524">
			September 12, 2014 at 12:11 pm</a>		</div>

		<p>Hi,</p>
<p>I&#39;m currently looking into how to upload a file programmatically into the file share using Azure Files service. However I haven&#39;t found any related methods to do that nor any sample code.</p>
<p>If it is possible, could you post a sample piece of code that performs file uploading to the files service?</p>
<p>Thanks a lot!</p>
<p>Frank</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F07%2F24%2Fcross-post-migrating-data-to-microsoft-azure-files%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-527">
				<div id="div-comment-527" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Andrew Edwards</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2014/07/24/cross-post-migrating-data-to-microsoft-azure-files/#comment-527">
			September 15, 2014 at 1:26 pm</a>		</div>

		<p>Hi Frank,</p>
<p>The below is an example of how to use the .Net Microsoft Azure Storage Client Library (<a rel="nofollow" target="_new" href="http://www.nuget.org/packages/WindowsAzure.Storage/">http://www.nuget.org/&#8230;/WindowsAzure.Storage</a>) to upload a file to the a file share.</p>
<p>Thanks</p>
<p>Andrew Edwards</p>
<p>Microsoft Azure Storage</p>
<p>using Microsoft.WindowsAzure.Storage.Auth;</p>
<p>using Microsoft.WindowsAzure.Storage.File;</p>
<p>class Uploader</p>
<p>{</p>
<p> &nbsp; &nbsp;static public void Main(string [] argString)</p>
<p> &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;Args args;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;if (!ParseArgs(argString, out args))</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;{</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Usage();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;StorageCredentials creds = new StorageCredentials(args.accountName, args.storageKey);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;CloudFile cloudFile = new CloudFile(args.cloudUrl, creds);</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp;cloudFile.UploadFromFile(args.localName, System.IO.FileMode.Open);</p>
<p> &nbsp; &nbsp;}</p>
<p> &nbsp; &nbsp;&#8230;</p>
<p>}</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2014%2F07%2F24%2Fcross-post-migrating-data-to-microsoft-azure-files%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->