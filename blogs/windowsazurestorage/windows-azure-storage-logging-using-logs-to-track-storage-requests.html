---
layout: windowsazurestorage
title: Windows Azure Storage Logging&#58; Using Logs to Track Storage Requests
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-55" class="post-55 post type-post status-publish format-standard hentry category-uncategorized tag-analytics-logging-metrics">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage Logging: Using Logs to Track Storage Requests</h1>		<div class="rating-wrap">
		<div id="star-rating-55" class="wds-ratings" data-rating="4" data-userrating="0" data-postid="55" data-container="body" data-toggle="tooltip" title="4 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2011-08-02T21:49:00+00:00">August 2, 2011</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#comments">4</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Logging: Using Logs to Track Storage Requests&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Logging: Using Logs to Track Storage Requests&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>Windows Azure Storage Logging provides a trace of the executed requests against your storage account (Blobs, Tables and Queues).&#160; It allows you to monitor requests to your storage accounts, understand performance of individual requests, analyze usage of specific containers and blobs, and debug storage APIs at a request level. </p>
<h3>What is logged?</h3>
<p>You control what types of requests are logged for your account. We categorize requests into 3 kinds: READ, WRITE and DELETE operations. You can set the logging properties for each service indicating the types of operations they are interested in. For example, opting to have delete requests logged for blob service will result in blob or container deletes to be recorded.&#160; Similarly, logging reads and writes will capture reads/writes on properties or the actual objects in the service of interest.&#160; Each of these options must be explicitly set to true (data is captured) or false (no data is captured).</p>
<h3>What requests are logged?</h3>
<p>The following authenticated and anonymous requests are logged.</p>
<ul>
<li>Authenticated Requests:
<ul>
<li>Signed requests to user data. This includes failed requests such as throttled, network exceptions, etc. </li>
<li>SAS (Shared Access Signature) requests whose authentication is validated </li>
<li>User requests to analytics data </li>
</ul>
</li>
<li>Anonymous Requests:
<ul>
<li>Successful anonymous requests. </li>
<li>If an anonymous request results in one of the following errors, it will be logged
<ul>
<li>Server errors – Typically seen as InternalServerError or ServerBusy </li>
<li>Client and Server Timeout errors (seen as InternalServerError with StorageErrorCode = Timeout) </li>
<li>GET requests that fail with 304 i.e. Not Modified </li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The following requests are not logged</p>
<ul>
<li>Authenticated Requests:
<ul>
<li>System requests to write and delete the analytics data </li>
</ul>
</li>
<li>Anonymous Requests:
<ul>
<li>Failed anonymous requests (other than those listed above) are not logged so that the logging system is not spammed with invalid anonymous requests. </li>
</ul>
</li>
</ul>
<p>During normal operation all requests are logged; but it is important to note that&#160; logging is provided on a best effort basis.&#160; This means we do not guarantee that every message will be logged due to the fact that the log data is buffered in memory at the storage front-ends before being written out, and if a role is restarted then its buffer of logs would be lost. </p>
<h3>What data do my logs contain and in what format?</h3>
<p>Each request is represented by one or more log records.&#160; A log record is a single line in the blob log and the fields in the log record are ‘;’ separated. We opted for a ‘;’ separated log file rather than a custom format or XML so that existing tools like LogParser, Excel&#160; etc, can be easily extended or used to analyze the logs. Any field that may contain ‘;’ is enclosed in quotes and html encoded (using <a href="http://msdn.microsoft.com/en-us/library/4fkewx0t.aspx">HtmlEncode</a> method).</p>
<p>Each record will contain the following fields:</p>
<ol>
<li>Log Version (string): The log version. We currently use “1.0”. </li>
<li>Transaction Start Time (timestamp): The UTC time at which the request was received by our service. </li>
<li>REST Operation Type (string) – will be one of the REST APIs. See “Operation Type: What APIs are logged?” section below for more details. </li>
<li>Request Status (string) – The status of request operation. See Transaction Status section below for more details. </li>
<li>HTTP Status Code (string): E.g. “200”. This can also be “Unknown” in cases where communication with the client is interrupted before we can set the status code. </li>
<li>E2E Latency (duration): The total time in milliseconds taken to complete a request in the Windows Azure Storage Service. This value includes the required processing time within Windows Azure Storage to read the request, send the response, and receive acknowledgement of the response. </li>
<li>Server Latency (duration): The total processing time in milliseconds taken by the Windows Azure Storage Service to process a request. This value does not include the network latency specified in E2E Latency. </li>
<li>Authentication type (string) – authenticated, SAS, or anonymous. </li>
<li>Requestor Account Name (string): The account making the request. For anonymous and SAS requests this will be left empty. </li>
<li>Owner Account Name (string): The owner of the object(s) being accessed. </li>
<li>Service Type (string): The service the request was for (blob, queue, table). </li>
<li>Request URL (string): The full request URL that came into the service – e.g. “PUT <a href="http://myaccount.blob.core.windows.net/mycontainer/myblob?comp=block&amp;blockId">http://myaccount.blob.core.windows.net/mycontainer/myblob?comp=block&amp;blockId</a>=”. This is always quoted. </li>
<li>Object Key (string): This is the key of the object the request is operating on. E.g. for Blob: “/myaccount/mycontainer/myblob”. E.g. for Queue: “/myaccount/myqueue”. E.g. For Table: “/myaccount/mytable/partitionKey/rowKey”. Note: If custom domain names are used, we still have the actual account name in this key, not the domain name. This field is always quoted. </li>
<li>Request ID (guid): The x-ms-request-id of the request. This is the request id assigned by the service. </li>
<li>Operation Number (int): There is a unique number for each operation executed for the request that is logged. Though most operations will just have “0” for this (See examples below), there are operations which will contain multiple entries for a single request.
<ol>
<li>Copy Blob will have 3 entries in total and operation number can be used to distinguish them. The log entry for Copy will have operation number “0” and the source read and destination write will have 1 and 2 respectively. </li>
<li>Table Batch command.&#160; An example is a batch command with two Insert’s: the Batch would have “0” for operation number, the first insert would have “1”, and the second Insert would have “2”. </li>
</ol>
</li>
<li>Client IP (string): The client IP from which the request came. </li>
<li>Request Version (string): The x-ms-version used to execute the request. This is the same x-ms-version response header that we return. </li>
<li>Request Header&#160; Size&#160; (long): The size of the request header. </li>
<li>Request Packet Size (long) : The size of the request payload read by the service. </li>
<li>Response Header&#160; Size&#160; (long): The size of the response header. </li>
<li>Response Packet Size (long) : The size of the response payload written by the service.      <br/>NOTE: The above request and response sizes may not be filled if a request fails. </li>
<li>Request Content Length (long): The value of Content-Length header. This should be the same size of Request Packet Size (except for error scenarios) and helps confirm the content length sent by clients. </li>
<li>Request MD5 (string): The value of Content-MD5 (or x-ms-content-md5) header passed in the request. This is the MD5 that represents the content transmitted over the wire. For PutBlockList operation, this means that the value stored is for the content of the PutBlockList and not the blob itself. </li>
<li>Server MD5 (string): The md5 value evaluated on the server. For PutBlob, PutPage, PutBlock, we store the server side evaluated content-md5 in this field even if MD5 was not sent in the request. </li>
<li>ETag(string): For objects for which an ETag is returned, the ETag of the object is logged. Please note that we will not log this in operations that can return multiple objects. This field is always quoted. </li>
<li>Last Modified Time (DateTime): For objects where a Last Modified Time (LMT) is returned, it will be logged.&#160; If the LMT is not returned, it will be ‘‘(empty string).&#160; Please note that we will not log this in operations that can return multiple objects. </li>
<li>ConditionsUsed(string): Semicolon separated list of ConditionName=value. This is always quoted. ConditionName can be one of the following:
<ol>
<li><em>If-Modified-Since</em><em></em> </li>
<li><em>If-Unmodified-Since</em><em></em> </li>
<li><em>If-Match</em><em></em> </li>
<li><em>If-None-Match</em> </li>
</ol>
</li>
<li>User Agent (string): The User-Agent header.&#160;&#160; </li>
<li>Referrer (string): The “Referrer” header. We log up to the first 1 KB chars. </li>
<li>Client Request ID (string): This is custom logging information which can be passed by the user via x-ms-client-request-id header (see below for more details). This is opaque to the service and has a limit of 1KB characters. This field is always quoted. </li>
</ol>
<p>&#160;</p>
<h4>Examples</h4>
<p><strong>Put Blob      <br/></strong>1.0;2011-07-28T18:02:40.6271789Z;PutBlob;Success;201;28;21;authenticated;sally;sally;blob;&quot;http://sally.blob.core.windows.net/thumbnails/lake.jpg?timeout=30000&quot;;&quot;/sally/thumbnails/lake.jpg&quot;;fb658ee6-6123-41f5-81e2-4bfdc178fea3;0;201.9.10.20;2009-09-19;438;100;223;0;100;;&quot;66CbMXKirxDeTr82SXBKbg==&quot;;&quot;0x8CE1B67AD25AA05&quot;;Thursday, 28-Jul-11 18:02:40 GMT;;;;&quot;7/28/2011 6:02:40 PM ab970a57-4a49-45c4-baa9-20b687941e32&quot;</p>
<p><strong>Anonymous Get Blob      <br/></strong>1.0;2011-07-28T18:52:40.9241789Z;GetBlob;AnonymousSuccess;200;18;10;anonymous;;sally;blob;&quot;http:// sally.blob.core.windows.net/thumbnails/lake.jpg?timeout=30000&quot;;&quot;/sally/thumbnails/lake.jpg&quot;;a84aa705-8a85-48c5-b064-b43bd22979c3;0;123.100.2.10;2009-09-19;252;0;265;100;0;;;&quot;0x8CE1B6EA95033D5&quot;;Thursday, 28-Jul-11 18:52:40 GMT;;;;&quot;7/28/2011 6:52:40 PM ba98eb12-700b-4d53-9230-33a3330571fc&quot;</p>
<p><strong>Copy Blob      <br/></strong>Copy blob will have 3 log lines logged. The request id will be the same but operation id (highlighted in the examples below) will be incremented. The line with operation ID 0 represents the entire copy blob operation. The operation ID 1 represents the source blob retrieval for the copy. This operation is called CopyBlobSource. Operation ID 2 represents destination blob information and the operation is called CopyBlobDestination. The CopyBlobSource will not have information like request size or response size set and is meant only to provide information like name, conditions used etc. about the source blob.</p>
<p>1.0;2011-07-28T18:02:40.6526789Z;CopyBlob;Success;201;28;28;authenticated;account8ce1b67a9e80b35;sally;blob;&quot;http://sally.blob.core.windows.net/thumbnails/lake.jpg?timeout=30000&quot;;&quot;/sally/thumbnails/lakebck.jpg&quot;;85ba10a5-b7e2-495e-8033-588e08628c5d;0;268.20.203.21;2009-09-19;505;0;188;0;0;;;&quot;0x8CE1B67AD473BC5&quot;;Thursday, 28-Jul-11 18:02:40 GMT;;;;&quot;7/28/2011 6:02:40 PM 683803d3-538f-4ba8-bc7c-24c83aca5b1a&quot;</p>
<p>1.0;2011-07-28T18:02:40.6526789Z;CopyBlobSource;Success;201;28;28;authenticated;sally;sally;blob;&quot;http://sally.blob.core.windows.net/thumbnails/lake.jpg?timeout=30000&quot;;&quot;/sally/thumbnails/d1c77aca-cf65-4166-9401-0fd3df7cf754&quot;;85ba10a5-b7e2-495e-8033-588e08628c5d;1;268.20.203.21;2009-09-19;505;0;188;0;0;;;;;;;;&quot;7/28/2011 6:02:40 PM 683803d3-538f-4ba8-bc7c-24c83aca5b1a&quot;</p>
<p>1.0;2011-07-28T18:02:40.6526789Z;CopyBlobDestination;Success;201;28;28;authenticated;sally;sally;blob;&quot;http://sally.blob.core.windows.net/thumbnails/lake.jpg?timeout=30000&quot;;&quot;/sally/thumbnails/lakebck.jpg&quot;;85ba10a5-b7e2-495e-8033-588e08628c5d;2;268.20.203.21;2009-09-19;505;0;188;0;0;;;;;;;;&quot;7/28/2011 6:02:40 PM 683803d3-538f-4ba8-bc7c-24c83aca5b1a&quot;</p>
<p><strong>Table Batch Request or entity group requests with 2 inserts.      <br/></strong>The first one stands for the batch request, and the latter two represent the actual inserts. NOTE: the key for the batch is the key of the first command in the batch. The operation number is used to identify different individual commands in the batch</p>
<p>1.0;2011-07-28T18:02:40.9701789Z;EntityGroupTransaction;Success;202;104;61;authenticated;sally;sally;table;&quot;http://sally.table.core.windows.net/$batch&quot;;&quot;/sally&quot;;b59c0c76-dc04-48b7-9235-80124f0066db;0;268.20.203.21;2009-09-19;520;100918;235;189150;100918;;;;;;;;&quot;7/28/2011 6:02:40 PM 70b9cb5c-8e2f-4e8a-bf52-7b79fcdc56e7&quot;</p>
<p>1.0;2011-07-28T18:02:40.9701789Z;InsertEntity;Success;202;104;61;authenticated;sally;sally;table;&quot;http:// sally.table.core.windows.net/$batch&quot;;&quot;/sally/orders/5f1a7147-28df-4398-acf9-7d587c828df9/a9225cef-04aa-4bbb-bf3b-b0391e3c436e&quot;;b59c0c76-dc04-48b7-9235-80124f0066db;1;268.20.203.21;2009-09-19;520;100918;235;189150;100918;;;&quot;W/&amp;quot;datetime'2011-07-28T18%3A02%3A41.0086789Z'&amp;quot;&quot;;Thursday, 28-Jul-11 18:02:41 GMT;;;;&quot;7/28/2011 6:02:40 PM 70b9cb5c-8e2f-4e8a-bf52-7b79fcdc56e7&quot;</p>
<p>1.0;2011-07-28T18:02:40.9701789Z;InsertEntity;Success;202;104;61;authenticated;sally;sally;table;&quot;http:// sally.table.core.windows.net/$batch&quot;;&quot;/sally/orders/5f1a7147-28df-4398-acf9-7d587c828df9/a9225cef-04aa-4bbb-bf3b-b0391e3c435d&quot;;b59c0c76-dc04-48b7-9235-80124f0066db;2;268.20.203.21;2009-09-19;520;100918;235;189150;100918;;;&quot;W/&amp;quot;datetime'2011-07-28T18%3A02%3A41.0086789Z'&amp;quot;&quot;;Thursday, 28-Jul-11 18:02:41 GMT;;;;&quot;7/28/2011 6:02:40 PM 70b9cb5c-8e2f-4e8a-bf52-7b79fcdc56e7&quot;</p>
<p>&#160;</p>
<h4>Operation Type: What APIs are logged?</h4>
<p>The APIs recorded in the logs are listed by service below, which match the REST APIs for Windows Azure Storage. Note that for operations that have multiple operations executed (e.g. Batch) as part of them, the field OperationType will contain multiple records with a main record (that has Operation Number ‘0’) and an individual record for each sub operation.</p>
<h5><span style="font-size: small;"><a href="http://msdn.microsoft.com/en-us/library/dd135733.aspx">Blob Service APIs</a></span></h5>
<ul>
<li>AcquireLease </li>
<li>BreakLease </li>
<li>ClearPage </li>
<li>CopyBlob
<ul>
<li>CopyBlobSource: Information about the source that was copied and is used only for logs </li>
<li>CopyBlobDestination: Information about the destination and is used only for logs </li>
</ul>
</li>
<li>CreateContainer </li>
<li>DeleteBlob </li>
<li>DeleteContainer </li>
<li>GetBlob </li>
<li>GetBlobMetadata </li>
<li>GetBlobProperties </li>
<li>GetBlockList </li>
<li>GetContainerACL </li>
<li>GetContainerMetadata </li>
<li>GetContainerProperties </li>
<li>GetLeaseInfo </li>
<li>GetPageRegions </li>
<li>LeaseBlob </li>
<li>ListBlobs </li>
<li>ListContainers </li>
<li>PutBlob </li>
<li>PutBlockList </li>
<li>PutBlock </li>
<li>PutPage </li>
<li>ReleaseLease </li>
<li>RenewLease </li>
<li>SetBlobMetadata </li>
<li>SetBlobProperties </li>
<li>SetContainerACL </li>
<li>SetContainerMetadata </li>
<li>SnapshotBlob </li>
<li>SetBlobServiceProperties </li>
<li>GetBlobServiceProperties </li>
</ul>
<h5><span style="font-size: small;">&#160;<a href="http://msdn.microsoft.com/en-us/library/dd179363.aspx">Queue Service APIs</a></span></h5>
<ul>
<li>ClearMessages </li>
<li>CreateQueue </li>
<li>DeleteQueue </li>
<li>DeleteMessage </li>
<li>GetQueueMetadata </li>
<li>GetQueue </li>
<li>GetMessage </li>
<li>GetMessages </li>
<li>ListQueues </li>
<li>PeekMessage </li>
<li>PeekMessages </li>
<li>PutMessage </li>
<li>SetQueueMetadata </li>
<li>SetQueueServiceProperties </li>
<li>GetQueueServiceProperties </li>
</ul>
<p><span style="font-size: small;"><a href="http://msdn.microsoft.com/en-us/library/dd179423.aspx">Table Service APIs</a></span></p>
<ul>
<li>EntityGroupTransaction </li>
<li>CreateTable </li>
<li>DeleteTable </li>
<li>DeleteEntity </li>
<li>InsertEntity </li>
<li>QueryEntity </li>
<li>QueryEntities </li>
<li>QueryTable </li>
<li>QueryTables </li>
<li>UpdateEntity </li>
<li>MergeEntity </li>
<li>SetTableServiceProperties </li>
<li>GetTableServiceProperties </li>
</ul>
<p>&#160;</p>
<h4>Transaction Status</h4>
<p>This table shows the different statuses that can be written to your log. </p>
<table style="width: 625px;" border="1" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td valign="top" width="259">
<p><b>Status (this is a string field)</b></p>
</td>
<td valign="top" width="366">
<p><b>Description</b></p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>Success </b></p>
</td>
<td valign="top" width="366">
<p>Indicates the request was successful</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousSuccess </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous request was successful</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASSuccess </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request was successful</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ThrottlingError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the request was throttled with http status code ServerBusy i.e. 503.&#160; The user is expected to back-off on throttling errors.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousThrottlingError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous request was throttled with http status code ServerBusy i.e. 503.&#160; The user is expected to back-off on throttling errors.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASThrottlingError </b></p>
<p><b>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request was throttled with http status code ServerBusy i.e. 503.&#160; The user is expected to back-off on throttling errors.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ClientTimeoutError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the authenticated request timed out.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
<p>This is marked as client side timeout error when the user’s network IO is slow and the timeout provided was less than expected value for a slow network. In other words, if a request spends most time in reading/writing from/to client and does not allow sufficient time for the server to process, we will term these timeouts as ClientTimeoutErrror. To determine what is the minimum time required by a server to process a request, please refer to the times posted <a href="http://go.microsoft.com/fwlink/?LinkId=159705">here</a>.</p>
<p>Any other timeout will be deemed as ServerTimeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousClientTimeoutError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous request timed out.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
<p>This is marked as client side timeout error when the user’s network IO is slow and the timeout provided was less than expected value for a slow network. In other words, if a request spends most time in reading/writing from/to client and does not allow sufficient time for the server to process, we will term these timeouts as AnonymousClientTimeoutErrror. To determine what is the minimum time required by a server to process a request, please refer to the times posted <a href="http://go.microsoft.com/fwlink/?LinkId=159705">here</a>.</p>
<p>Any other timeout will be deemed as AnonymousServerTimeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASClientTimeoutError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request timed out.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
<p>This is marked as client side timeout error when the user’s network IO is slow and the timeout provided was less than expected value for a slow network. In other words, if a request spends most time in reading/writing from/to client and does not allow sufficient time for the server to process, we will term these timeouts as SASClientTimeoutErrror. To determine what is the minimum time required by a server to process a request, please refer to the times posted <a href="http://go.microsoft.com/fwlink/?LinkId=159705">here</a>.</p>
<p>Any other timeout will be deemed as SASServerTimeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ServerTimeoutError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the request timed out because of a problem on the server end. Users are expected to back-off on these errors.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousServerTimeoutError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous request timed out because of a problem on the server end. Users are expected to back-off on these errors.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASServerTimeoutError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request timed out because of a problem on the server end. Users are expected to back-off on these errors.</p>
<p>These are seen as timeout errors or Http Status code 500 with Storage error code as “Timeout”.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ClientOtherError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the authenticated request failed as expected.</p>
<p>Examples are Resource already exists, Resource not found etc.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASClientOtherError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request failed as expected.</p>
<p>Examples are Resource already exists, Resource not found etc.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousClientOtherError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous requests failed precondition checks (like If- Modified etc.) for GET requests.</p>
<p>Examples: Conditional GET requests that fail the check.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>ServerOtherError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that authenticated request failed due to unknown server error.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousServerOtherError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that anonymous request failed due to unknown server error.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASServerOtherError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that SAS request failed due to unknown server error.</p>
<p>These are typically Http Status code 500 with Storage error code other than Timeout.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AuthorizationError </b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the authenticated requests failed authorization check.</p>
<p>Example: write requests from users to&#160; logs under $logs will be treated as Authorization error</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASAuthorizationError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS requests failed authorization check.</p>
<p>Example: write requests using SAS when only read access was provided Authorization error</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>NetworkError </b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the authenticated request failed because of network error.</p>
<p>Example: Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>AnonymousNetworkError (long)</b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the anonymous request failed because of a network error.</p>
<p>Example: Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
</td>
</tr>
<tr>
<td valign="top" width="259">
<p><b>SASNetworkError</b><b></b></p>
<p><b>&#160;</b></p>
</td>
<td valign="top" width="366">
<p>Indicates that the SAS request failed because of network error.</p>
<p>Example: Network errors occur when a user prematurely closes the connection before the timeout expires or if there are problems in any of the intermediate switches.</p>
</td>
</tr>
</tbody>
</table>
<p>&#160;</p>
<h3>Client Request Id</h3>
<p>One of the logged fields is called the Client Request Id.&#160; A client can choose to pass this client perspective id up to 1KB in size as a HTTP header “x-ms-client-request-id” in with every request and it will be logged for the request.&#160; Note, if you use the optional client request id header, it is used in constructing the canonicalized header, since all headers starting with “x-ms” are part of the <a href="http://msdn.microsoft.com/en-us/library/dd179428.aspx#Constructing_Element">resource canonicalization</a> used for signing a request.</p>
<p>Since this is treated as an id that a client may associate with a request, it is very helpful to investigate requests that failed due to network or timeout errors. For example, you can search for requests in the log with the given client request id&#160; to see if the request timed out, and see if the E2E latency indicates that there is a slow network connection. As noted above, some requests may not get logged due to node failures.</p>
<h3>Where can I find the logs and how does the system store them?</h3>
<p>The analytics logging data is stored as <a href="http://msdn.microsoft.com/en-us/library/ee691964.aspx">block blobs</a> in a container called $logs in your blob namespace for the storage account being logged. The $logs container is created automatically when you turn logging on and once created this container cannot be deleted, though the blobs stored in the container can be deleted. The $logs container can be accessed using “http://&lt;accountname&gt;.blob.core.windows.net/$logs” URL.&#160; Note that normal container listing operations that you issue to list your containers will not list the $logs container. But you can list the blobs inside the $logs container itself. Logs will be organized in the $logs namespace per hour by service type (Blob, Table and Queue). Log entries are written only if there are eligible requests to the service and the operation type matches the type opted for logging. For example, if there was no table activity on an account for an hour but we had blob activity, no logs would be created for the table service but we would have some for blob service. If in the next hour there is table activity, table logs would be created for that hour.</p>
<p>We use block blobs to store the log entries as block blobs represents files better than page blobs. In addition, the 2 phase write semantics of block blobs allows our system to write a set of log entries as a block in the block blob. Log entries are accumulated and written to a block when the size reaches 4 MB or if it has been up to 5 minutes since the entries have been flushed to a block. The system will <a href="http://msdn.microsoft.com/en-us/library/dd179467.aspx">commit the block blob</a> if the size of the uncommitted blob reaches 150MB or if it has been up to 5 minutes since the first block was uploaded – whichever is reached first. Once a blob is committed, it is not updated with any more blocks of log entries. Since a block blob is available to read only after commit operation, you can be assured that once a log blob is committed it will never be updated again.</p>
<p>NOTE: Applications should not take any dependency on the above mentioned size and time trigger for flushing a log entry or committing the blob as it can change without notice.</p>
<h3>What is the naming convention used for logs?</h3>
<p>Logging in a distributed system is a challenging problem. What makes it challenging is the fact that there are many servers that can process requests for a single account and hence be a source for these log entries. Logs from various sources need to be combined into a single log. Moreover, clock skews cannot be ruled out and the number of log entries produced by a single account in a distributed system can easily run into thousands of log entries per second. To ensure that we provide a pattern to process these logs efficiently despite these challenges, we have a naming scheme and we store additional metadata for the logs that allow easy log processing.</p>
<p>The log name under the $logs container will have the following format:</p>
<p>&lt;service name&gt;/YYYY/MM/DD/hhmm/&lt;Counter&gt;.log</p>
<ul>
<li>Service Name: “blob”, “table”, “queue” </li>
<li>YYYY – The four digit year for the log </li>
<li>MM – The two digit month for the log </li>
<li>DD – The two digit day for the log </li>
<li>hh – The two digit hour (24 hour format) representing the starting hour for all the logs. All timestamps are in UTC </li>
<li>mm – The two digit number representing the starting minute for all the logs. This is always 00 for this version and kept for future use </li>
<li>Counter – A zero based counter as there can be multiple logs generated for a single hour. The counter is padded to be 6 digits. The counter progress is based on the last log’s counter value within a given hour. Hence if you delete the last log blob, you may have the same blob name repeat again. It is recommended to not delete the blob logs right away. </li>
</ul>
<p>The following are properties of the logs:</p>
<ul>
<li>A request is logged based on when it ends. For example, if a request starts 13:57 and lasts for 5 minutes, it will make it into the log at the time it ended.&#160; It will therefore appear in a log with hh=1400. </li>
<li>Log entries can be recorded out of order which implies that just inspecting the first and last log entry is not sufficient to figure if the log contains the time range you may be interested in. </li>
</ul>
<p>To aid log analysis we store the following metadata for each of the log blobs:</p>
<ul>
<li>LogType = The type of log entries that a log contains. It is described as combination of read, write and delete.&#160; The types will be comma separated. This allows you to download blobs which have the operation type that you are interested in. </li>
<li>StartTime = The minimum time of a log entry in the log. It is of form YYYY-MM-DDThh:mm:ssZ. This represents the start time for a request that is logged in the blob. </li>
<li>EndTime = The maximum time of a log entry in the log of form YYYY-MM-DDThh:mm:ssZ. This represents the maximum start time of a request logged in the blob. </li>
<li>LogVersion = The version of the log format.&#160; Currently 1.0. This can be used to process a given blob as all entries in the blob will conform to this version. </li>
</ul>
<p>With the above you can list of all of the blobs with the “include=metadata” option to quickly see which blob logs have the given time range of logs for processing.</p>
<p>For example, assume we have a blob log that contains write events generated at 05:10:00 UTC on 2011/03/04 and contains requests that started at 05:02:30.0000001Z until 05:08:05.1000000X, the log name will be: $logs/blob/2011/03/04/0500/000000.log and the metadata will contain the following properties:</p>
<ul>
<li>LogType=write </li>
<li>StartTime=2011-03-04T05:02:30.0000001Z </li>
<li>EndTime=2011-03-04T05:08:05.1000000Z </li>
<li>LogVersion=1.0 </li>
</ul>
<p>Note, duplicate log records may exist in logs generated for the same hour and can be detected by checking for duplicate RequestId and Operation number.</p>
<h3>Operations on $logs container and manipulating log data</h3>
<p>As we mentioned above, once you enable logging, your log data is stored as <a href="http://msdn.microsoft.com/en-us/library/ee691964.aspx">block blobs</a> in a container called $logs in the blob namespace of your account. You can access your $logs container using http://&lt;accountname&gt;.blob.core.windows.net/$logs. To list your logs you can use the <a href="http://msdn.microsoft.com/en-us/library/dd135734.aspx">list blobs API</a>. The logs are stored organized by service type (blob, table and queue) and are sorted by generation date/time within each service type.&#160; The log name under the $logs container will have the following format: &lt;service name&gt;/YYYY/MM/DD/hhmm/&lt;Counter&gt;.log </p>
<p>The following operations are the operations allowed on the $logs container:</p>
<ul>
<li>List blobs in $logs container. (Note that $logs will not be displayed in result of listing all containers in the account namespace). </li>
<li>Read committed blobs under $logs. </li>
<li>Delete specific logs. Note: logs can be deleted but the container itself cannot be deleted.<b></b> </li>
<li>Get metadata/properties for the log. </li>
</ul>
<p>An example request for each type of operation can be found below:</p>
<ul>
<li>List logs      <br/>GET <a href="http://sally.blob.core.windows.net/$logs?restype=container&amp;comp=list">http://sally.blob.core.windows.net/$logs?restype=container&amp;comp=list</a> </li>
<li>List logs generated for blob service from 2011-03-24 05:00 until 05:59      <br/>GET <a href="http://sally.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03/24/0500/&amp;include=metadata">http://sally.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03/24/0500/&amp;include=metadata</a> </li>
<li>Download a specific log      <br/>GET <a href="http://sally.blob.core.windows.net/$logs/blob/2011/03/24/0500/000000.log">http://sally.blob.core.windows.net/$logs/blob/2011/03/24/0500/000000.log</a> </li>
<li>Delete a specific log      <br/>Delete <a href="http://sally.blob.core.windows.net/$logs/blob/2011/03/24/0500/000000.log">http://sally.blob.core.windows.net/$logs/blob/2011/03/24/0500/000000.log</a> </li>
</ul>
<p>To improve enumerating the logs you can pass a prefix when using the list blobs API.&#160; For example, to filter blobs by date/time the logs are generated on, you can pass a date/time as the prefix (blob/2011/04/24/) when using the list blobs API.</p>
<p>Listing all logs generated in the month of March in 2011 for the Blob service would be done as follows: <a href="http://myaccount.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03">http://myaccount.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03</a></p>
<p>You can filter down to a specific hour using the prefix. For example, if you want to scan logs generated for March 24<sup>th</sup> 2011 at 6 PM (18:00), use     <br/><a href="http://myaccount.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03/24/1800/">http://myaccount.blob.core.windows.net/$logs?restype=container&amp;comp=list&amp;prefix=blob/2011/03/24/1800/</a></p>
<p>It is important to note that log entries are written only if there are requests to the service.&#160; For example, if there was no table activity on an account for an hour but you had blob activity, no logs would be created for the table service but you would have some for blob service.&#160; If in the next hour there is table activity, table logs would be created for that hour.</p>
<h3>What is the versioning story?</h3>
<p>The following describes the versioning for logs:</p>
<ul>
<li>The version is stored in the blob metadata and each log entry as the first field.&#160; </li>
<li>All records within a single blob will have the same version. </li>
<li>When new fields are added, they may be added to the end and will not incur a version change if this is the case. Therefore, applications responsible for processing the logs should be designed to interpret only the first set of columns they are expecting and ignore any extra columns in a log entry. </li>
<li>Examples of when a version change could occur:
<ul>
<li>The representation needs to change for a particular field (example – data type changes). </li>
<li>A field needs to be removed. </li>
</ul>
</li>
</ul>
<h3>What is the scalability targets and capacity limits for logs and how does this related to my storage account?</h3>
<p>Capacity and scale for your analytics account is separate from your ‘regular’ account.&#160; There is separate 20TB allocated for analytics data (this includes both metrics and logs data).&#160; This is not included as part of the 100TB limit for an individual account.&#160; In addition, $logs are kept in a separate part of the namespace for the storage account, so it is throttled separately from the storage account, and requests issued by Windows Azure Storage to generate or delete these logs do not affect the per partition or per account scale targets described in the&#160; <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/05/10/windows-azure-storage-abstractions-and-their-scalability-targets.aspx">Storage Scalability Targets</a> blog post.&#160; </p>
<h3>How do I cleanup my logs?</h3>
<p>To ease the management of your logs, we have provided the functionality of retention policy which will automatically cleanup ‘old’ logs without you being charged for the cleanup. It is recommended that you set a retention policy for logs such that your analytics data will be within the 20TB limit allowed for analytics data (logs and metrics combined) as described above.</p>
<p>A maximum of 365 days is allowed for retention policy. Once a retention policy is set, the system will delete the logs when logs age beyond the number of days set in the policy. This deletion will be done lazily in the background. Retention policy can be turned off at any time but if set, the retention policy is enforced even if logging is turned off. For example: If you set the retention policy for logging to be 10 days for blob service, then all the logs for blob service will be deleted if the content is &gt; 10 days.&#160;&#160; If you do not set a retention policy you can manage your data by manually deleting entities (like you delete entities in regular tables) whenever you wish to do so.</p>
<h3>What charges occur due to logging?</h3>
<p>The billable operations listed below are charged at the same rates applicable to all Windows Azure Storage operations. For more information on how these transactions are billed, see <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx">Understanding Windows Azure Storage Billing - Bandwidth, Transactions, and Capacity</a>.</p>
<p>The capacity used by $logs is billable and the following actions performed by Windows Azure are billable:</p>
<ul>
<li>Requests to create blobs for logging </li>
</ul>
<p class="BulletedList1">The following actions performed by a client are billable:</p>
<ul>
<li>Read and delete requests to $logs </li>
</ul>
<p>If you have configured a data retention policy, you are not charged when Windows Azure Storage deletes old logging data. However, if you delete $logs data, your account is charged for the delete operations. </p>
<h3>Turning Logging On</h3>
<p>A REST API call, as shown below, is used to turn on Logging. In this example, logging is turned on for deletes and writes, but not for reads. The retention policy is enabled and set to ten days - so the analytics service will take care of deleting data older than ten days for you at no additional cost.&#160; Note that you need to turn on logging separately for blobs, tables, and queues. The example below demonstrates how to turn logging on for blobs.</p>
<pre class="code"><span style="text-decoration: underline;"><strong>Request: <br/></strong></span>PUT <a href="http://sally.blob.core.windows.net/?restype=service&amp;comp=properties">http:<span style="color: green;">//sally.blob.core.windows.net/?restype=service&amp;comp=properties</span></a> <br/>HTTP/1.1
x-ms-version: 2009-09-19
x-ms-date: Fri, 25 Mar 2011 23:13:08 GMT
Authorization: SharedKey sally:zvfPm5cm8CiVP2VA9oJGYpHAPKxQb1HD44IWmubot0A=
Host: sally.blob.core.windows.net

&lt;?xml version=<span style="color: rgb(163, 21, 21);">&quot;1.0&quot; </span>encoding=<span style="color: rgb(163, 21, 21);">&quot;utf-8&quot;</span>?&gt;
&lt;StorageServiceProperties&gt;

    &lt;Logging&gt;
        &lt;<span style="color: rgb(43, 145, 175);">Version</span>&gt;1.0&lt;/<span style="color: rgb(43, 145, 175);">Version</span>&gt;
        &lt;Delete&gt;<span style="color: blue;">true </span>&lt;/Delete&gt;
        &lt;Read&gt; <span style="color: blue;">false</span>&lt;/Read&gt;
        &lt;Write&gt;<span style="color: blue;">true </span>&lt;/Write&gt;
        &lt;RetentionPolicy&gt;
        &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
        &lt;Days&gt;7&lt;/Days&gt;
    &lt;/RetentionPolicy&gt;
    &lt;/Logging&gt;

    &lt;Metrics&gt;
        &lt;<span style="color: rgb(43, 145, 175);">Version</span>&gt;1.0&lt;/<span style="color: rgb(43, 145, 175);">Version</span>&gt;
        &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
        &lt;IncludeAPIs&gt;<span style="color: blue;">true</span>&lt;/IncludeAPIs&gt;
        &lt;RetentionPolicy&gt;
            &lt;Enabled&gt;<span style="color: blue;">true</span>&lt;/Enabled&gt;           
            &lt;Days&gt;10&lt;/Days&gt;
        &lt;/RetentionPolicy&gt;
    &lt;/Metrics&gt;

&lt;/StorageServiceProperties &gt;

<span style="text-decoration: underline;"><strong>Response: <br/></strong></span>HTTP/1.1 202 
<span style="color: rgb(43, 145, 175);">Content</span>-Length: 0
Server: Windows-Azure-Metrics/1.0 Microsoft-HTTPAPI/2.0
x-ms-request-id: 4d02712a-a68a-4763-8f9b-c2526625be68
x-ms-version: 2009-09-19
Date: Fri, 25 Mar 2011 23:13:08 GMT</pre>
<p>The above logging and metrics section shows you how to configure what you want to track in your analytics logs and metrics data.&#160; The logging configuration values are described below:</p>
<ul>
<li>Version - The version of Analytics Logging used to record the entry. </li>
<li>Delete (Boolean) – set to true if you want to track delete requests and false if you do not </li>
<li>Read (Boolean) – set to true if you want to track read requests and false if you do not </li>
<li>Write (Boolean) – set to true if you want to track write requests and false if you do not </li>
<li>Retention policy – this is where you set the retention policy to help you manage the size of your analytics data
<ul>
<li>Enabled (Boolean) – set to true if you want to enable a retention policy. We recommend that you do this. </li>
<li>Days (int) – the number of days you want to keep your analytics logging data. This can be a max of 365 days and a min of 1 day. </li>
</ul>
</li>
</ul>
<p>For more information, please see the <a href="http://msdn.microsoft.com/en-us/library/hh343270.aspx">MSDN Documentation</a>. (this link will be live later today)</p>
<p>To turn on analytics, here are extensions to StorageClient library’s CloudBlobClient, CloudTableClient and CloudQueueClient. The extension methods and utility methods that accomplish this is just sample code in which error handling has been removed for brevity. </p>
<p>Let us start by listing a sample code that uses the extension samples:</p>
<pre class="code">AnalyticsSettings settings = <span style="color: blue;">new </span>AnalyticsSettings()
    {
        LogType = LoggingLevel.Delete | LoggingLevel.Read | LoggingLevel.Write,
        IsLogRetentionPolicyEnabled = <span style="color: blue;">true</span>,
        LogRetentionInDays = 1,
        IsMetricsRetentionPolicyEnabled = <span style="color: blue;">true</span>,
        MetricsRetentionInDays = 7,
        MetricsType = MetricsType.All
    };

<span style="color: green;">// set the settings for each service
</span>blobClient.SetServiceSettings(settings);
queueClient.SetServiceSettings(account.QueueEndpoint, settings);
tableClient.SetServiceSettings(settings);

<span style="color: green;">// get the settings from each service
</span>AnalyticsSettings blobSettings = blobClient.GetServiceSettings();
AnalyticsSettings tableSettings = tableClient.GetServiceSettings();
AnalyticsSettings queueSettings = queueClient.GetServiceSettings(account.QueueEndpoint);</pre>
<p>We have added here a new self-explanatory settings class called AnalyticsSettings to contain the settings that can be set / retrieved. Each property listed in settings above has a property representing it. </p>
<pre class="code"><span style="color: blue;">using </span>System;

<span style="color: blue;">namespace </span>AnalyticsSamples
{

    [<span style="color: rgb(43, 145, 175);">Flags</span>]
    <span style="color: blue;">public enum </span><span style="color: rgb(43, 145, 175);">LoggingLevel
    </span>{
        None = 0,
        Delete = 2,
        Write = 4,
        Read = 8,
    }

    [<span style="color: rgb(43, 145, 175);">Flags</span>]
    <span style="color: blue;">public enum </span><span style="color: rgb(43, 145, 175);">MetricsType
    </span>{
        None = 0x0,
        ServiceSummary = 0x1,
        ApiSummary = 0x2,
        All = ServiceSummary | ApiSummary,
    }

    <span style="color: gray;">/// &lt;summary&gt;
    /// </span><span style="color: green;">The analytic settings that can set/get
    </span><span style="color: gray;">/// &lt;/summary&gt;
    </span><span style="color: blue;">public class </span><span style="color: rgb(43, 145, 175);">AnalyticsSettings
    </span>{
        <span style="color: blue;">public static string </span>Version = <span style="color: rgb(163, 21, 21);">&quot;1.0&quot;</span>;

        <span style="color: blue;">public </span>AnalyticsSettings()
        {
            <span style="color: blue;">this</span>.LogType = LoggingLevel.None;
            <span style="color: blue;">this</span>.LogVersion = AnalyticsSettings.Version;
            <span style="color: blue;">this</span>.IsLogRetentionPolicyEnabled = <span style="color: blue;">false</span>;
            <span style="color: blue;">this</span>.LogRetentionInDays = 0;

            <span style="color: blue;">this</span>.MetricsType = MetricsType.None;
            <span style="color: blue;">this</span>.MetricsVersion = AnalyticsSettings.Version;
            <span style="color: blue;">this</span>.IsMetricsRetentionPolicyEnabled = <span style="color: blue;">false</span>;
            <span style="color: blue;">this</span>.MetricsRetentionInDays = 0;
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The type of logs subscribed for
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public </span>LoggingLevel LogType { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The version of the logs
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public string </span>LogVersion { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Flag indicating if retention policy is set for logs in $logs
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public bool </span>IsLogRetentionPolicyEnabled { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The number of days to retain logs for under $logs container
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public int </span>LogRetentionInDays { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The metrics version
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public string </span>MetricsVersion { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">A flag indicating if retention policy is enabled for metrics
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public bool </span>IsMetricsRetentionPolicyEnabled { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The number of days to retain metrics data
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public int </span>MetricsRetentionInDays { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; }

        <span style="color: blue;">private </span>MetricsType metricsType = MetricsType.None;

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">The type of metrics subscribed for
        </span><span style="color: gray;">/// &lt;/summary&gt;
        </span><span style="color: blue;">public </span>MetricsType MetricsType
        {
            <span style="color: blue;">get
            </span>{
                <span style="color: blue;">return </span>metricsType;
            }

            <span style="color: blue;">set
            </span>{
                <span style="color: blue;">if </span>(<span style="color: blue;">value </span>== MetricsType.ApiSummary)
                {
                    <span style="color: blue;">throw new </span><span style="color: rgb(43, 145, 175);">ArgumentException</span>(<span style="color: rgb(163, 21, 21);">&quot;Including just ApiSummary is invalid.&quot;</span>);
                }

                <span style="color: blue;">this</span>.metricsType = <span style="color: blue;">value</span>;
            }
        }
    }
}</pre>
<p>Now that we have covered the basic class, let us go over the extension class that provides the ability to set/get settings. This class provides extension methods SetServicesettings and GetServiceSettings on each one of the client objects. The rest is self-explanatory as the extension method takes the settings and then calls a single method to dispatch the settings by serializing/deserializing the settings class.</p>
<p>NOTE: Because CloudQueueClient does not expose the BaseUri property, the extension takes the base Uri explicitly. </p>
<pre class="code"><span style="color: blue;">using </span>System;
<span style="color: blue;">using </span>System.Text;
<span style="color: blue;">using </span>Microsoft.WindowsAzure.StorageClient;
<span style="color: blue;">using </span>System.Globalization;
<span style="color: blue;">using </span>System.Net;
<span style="color: blue;">using </span>Microsoft.WindowsAzure;
<span style="color: blue;">using </span>System.IO;
<span style="color: blue;">using </span>System.Xml;

<span style="color: blue;">namespace </span>AnalyticsSamples
{
    <span style="color: blue;">public static class </span><span style="color: rgb(43, 145, 175);">AnalyticsSettingsExtension
    </span>{
        <span style="color: blue;">static string </span>RequestIdHeaderName = <span style="color: rgb(163, 21, 21);">&quot;x-ms-request-id&quot;</span>;
        <span style="color: blue;">static string </span>VersionHeaderName = <span style="color: rgb(163, 21, 21);">&quot;x-ms-version&quot;</span>;
        <span style="color: blue;">static string </span>Sep2009Version = <span style="color: rgb(163, 21, 21);">&quot;2009-09-19&quot;</span>;
        <span style="color: blue;">static </span><span style="color: rgb(43, 145, 175);">TimeSpan </span>DefaultTimeout = <span style="color: rgb(43, 145, 175);">TimeSpan</span>.FromSeconds(30);

        <span style="color: blue;">#region </span>Analytics
        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Set blob analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudBlobClient client, AnalyticsSettings settings)
        {
            SetSettings(client.BaseUri, client.Credentials, settings, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Set queue analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;baseUri&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudQueueClient client, Uri baseUri, AnalyticsSettings settings)
        {
            SetSettings(baseUri, client.Credentials, settings, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Set blob analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">public static void </span>SetServiceSettings(<span style="color: blue;">this </span>CloudTableClient client, AnalyticsSettings settings)
        {
            SetSettings(client.BaseUri, client.Credentials, settings, <span style="color: blue;">true </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Set analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;baseUri&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;credentials&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;useSharedKeyLite&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">public static void </span>SetSettings(Uri baseUri, StorageCredentials credentials, AnalyticsSettings settings, <span style="color: blue;">bool </span>useSharedKeyLite)
        {
            UriBuilder builder = <span style="color: blue;">new </span>UriBuilder(baseUri);
            builder.Query = <span style="color: blue;">string</span>.Format(
                <span style="color: rgb(43, 145, 175);">CultureInfo</span>.InvariantCulture,
                <span style="color: rgb(163, 21, 21);">&quot;comp=properties&amp;restype=service&amp;timeout={0}&quot;</span>, 
                DefaultTimeout.TotalSeconds);

            HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(builder.Uri);
            request.Headers.Add(VersionHeaderName, Sep2009Version);
            request.Method = <span style="color: rgb(163, 21, 21);">&quot;PUT&quot;</span>;

            StorageCredentialsAccountAndKey accountAndKey = credentials <span style="color: blue;">as </span>StorageCredentialsAccountAndKey;
            <span style="color: blue;">using </span>(<span style="color: rgb(43, 145, 175);">MemoryStream </span>buffer = <span style="color: blue;">new </span><span style="color: rgb(43, 145, 175);">MemoryStream</span>())
            {
                XmlTextWriter writer = <span style="color: blue;">new </span>XmlTextWriter(buffer, <span style="color: rgb(43, 145, 175);">Encoding</span>.UTF8);
                SettingsSerializerHelper.SerializeAnalyticsSettings(writer, settings);
                writer.Flush();
                buffer.Seek(0, <span style="color: rgb(43, 145, 175);">SeekOrigin</span>.Begin);
                request.ContentLength = buffer.Length;

                <span style="color: blue;">if </span>(useSharedKeyLite)
                {
                    credentials.SignRequestLite(request);
                }
                <span style="color: blue;">else
                </span>{
                    credentials.SignRequest(request);
                }

                <span style="color: blue;">using </span>(<span style="color: rgb(43, 145, 175);">Stream </span>stream = request.GetRequestStream())
                {
                    stream.Write(buffer.GetBuffer(), 0, (<span style="color: blue;">int</span>)buffer.Length);
                }

                <span style="color: blue;">try
                </span>{
                    <span style="color: blue;">using </span>(HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                    {
                        <span style="color: rgb(43, 145, 175);">Console</span>.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Response Request Id = {0} Status={1}&quot;</span>, response.Headers[RequestIdHeaderName], response.StatusCode);
                        <span style="color: blue;">if </span>(HttpStatusCode.Accepted != response.StatusCode)
                        {
                            <span style="color: blue;">throw new </span><span style="color: rgb(43, 145, 175);">Exception</span>(<span style="color: rgb(163, 21, 21);">&quot;Request failed with incorrect response status.&quot;</span>);
                        }
                    }
                }
                <span style="color: blue;">catch </span>(WebException e)
                {
                    <span style="color: rgb(43, 145, 175);">Console</span>.WriteLine(
                        <span style="color: rgb(163, 21, 21);">&quot;Response Request Id={0} Status={1}&quot;</span>,
                        e.Response != <span style="color: blue;">null </span>? e.Response.Headers[RequestIdHeaderName] : <span style="color: rgb(163, 21, 21);">&quot;Response is null&quot;</span>,
                        e.Status);
                    <span style="color: blue;">throw</span>;
                }

            }
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Get blob analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudBlobClient client)
        {
            <span style="color: blue;">return </span>GetSettings(client.BaseUri, client.Credentials, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Get queue analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;baseUri&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudQueueClient client, Uri baseUri)
        {
            <span style="color: blue;">return </span>GetSettings(baseUri, client.Credentials, <span style="color: blue;">false </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Get table analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;client&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static </span>AnalyticsSettings GetServiceSettings(<span style="color: blue;">this </span>CloudTableClient client)
        {
            <span style="color: blue;">return </span>GetSettings(client.BaseUri, client.Credentials, <span style="color: blue;">true </span><span style="color: green;">/* useSharedKeyLite */</span>);
        }

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Get analytics settings
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;baseUri&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;credentials&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;useSharedKeyLite&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static </span>AnalyticsSettings GetSettings(Uri baseUri, StorageCredentials credentials, <span style="color: blue;">bool </span>useSharedKeyLite)
        {
            UriBuilder builder = <span style="color: blue;">new </span>UriBuilder(baseUri);
            builder.Query = <span style="color: blue;">string</span>.Format(
                <span style="color: rgb(43, 145, 175);">CultureInfo</span>.InvariantCulture,
                <span style="color: rgb(163, 21, 21);">&quot;comp=properties&amp;restype=service&amp;timeout={0}&quot;</span>,
                DefaultTimeout.TotalSeconds);

            HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(builder.Uri);
            request.Headers.Add(VersionHeaderName, Sep2009Version);
            request.Method = <span style="color: rgb(163, 21, 21);">&quot;GET&quot;</span>;

            StorageCredentialsAccountAndKey accountAndKey = credentials <span style="color: blue;">as </span>StorageCredentialsAccountAndKey;

            <span style="color: blue;">if </span>(useSharedKeyLite)
            {
                credentials.SignRequestLite(request);
            }
            <span style="color: blue;">else
            </span>{
                credentials.SignRequest(request);
            }

            <span style="color: blue;">try
            </span>{
                <span style="color: blue;">using </span>(HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                {
                    <span style="color: rgb(43, 145, 175);">Console</span>.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Response Request Id={0} Status={1}&quot;</span>, response.Headers[RequestIdHeaderName], response.StatusCode);

                    <span style="color: blue;">if </span>(HttpStatusCode.OK != response.StatusCode)
                    {
                        <span style="color: blue;">throw new </span><span style="color: rgb(43, 145, 175);">Exception</span>(<span style="color: rgb(163, 21, 21);">&quot;expected HttpStatusCode.OK&quot;</span>);
                    }

                    <span style="color: blue;">using </span>(<span style="color: rgb(43, 145, 175);">Stream </span>stream = response.GetResponseStream())
                    {
                        <span style="color: blue;">using </span>(<span style="color: rgb(43, 145, 175);">StreamReader </span>streamReader = <span style="color: blue;">new </span><span style="color: rgb(43, 145, 175);">StreamReader</span>(stream))
                        {
                            <span style="color: blue;">string </span>responseString = streamReader.ReadToEnd();
                            <span style="color: rgb(43, 145, 175);">Console</span>.WriteLine(responseString);

                            XmlReader reader = XmlReader.Create(<span style="color: blue;">new </span><span style="color: rgb(43, 145, 175);">MemoryStream</span>(<span style="color: rgb(43, 145, 175);">ASCIIEncoding</span>.UTF8.GetBytes(responseString)));
                            <span style="color: blue;">return </span>SettingsSerializerHelper.DeserializeAnalyticsSettings(reader);
                        }
                    }
                }
            }
            <span style="color: blue;">catch </span>(WebException e)
            {
                <span style="color: rgb(43, 145, 175);">Console</span>.WriteLine(
                    <span style="color: rgb(163, 21, 21);">&quot;Response Request Id={0} Status={1}&quot;</span>,
                    e.Response != <span style="color: blue;">null </span>? e.Response.Headers[RequestIdHeaderName] : <span style="color: rgb(163, 21, 21);">&quot;Response is null&quot;</span>,
                    e.Status);
                <span style="color: blue;">throw</span>;
            }
        }
        <span style="color: blue;">#endregion
    </span>}
}</pre>
<p>Now to the crux of the code which handles serialization/deserialization. This code provides a SerializeAnalyticsSettings method that serializes AnalyticsSettings class into the format expected by the service and provides DeserializeAnalyticsSettings to reconstruct the AnalyticsSettings class from the response for GET REST method.</p>
<p><span style="color: blue;"></span></p>
<pre class="code"><span style="color: blue;">using </span>System.Xml;

<span style="color: blue;">namespace </span>AnalyticsSamples
{
    <span style="color: blue;">public static class </span><span style="color: rgb(43, 145, 175);">SettingsSerializerHelper
    </span>{
        <span style="color: blue;">private const string </span>RootPropertiesElementName = <span style="color: rgb(163, 21, 21);">&quot;StorageServiceProperties&quot;</span>;
        <span style="color: blue;">private const string </span>VersionElementName = <span style="color: rgb(163, 21, 21);">&quot;Version&quot;</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyElementName = <span style="color: rgb(163, 21, 21);">&quot;RetentionPolicy&quot;</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyEnabledElementName = <span style="color: rgb(163, 21, 21);">&quot;Enabled&quot;</span>;
        <span style="color: blue;">private const string </span>RetentionPolicyDaysElementName = <span style="color: rgb(163, 21, 21);">&quot;Days&quot;</span>;

        <span style="color: blue;">private const string </span>LoggingElementName = <span style="color: rgb(163, 21, 21);">&quot;Logging&quot;</span>;
        <span style="color: blue;">private const string </span>ApiTypeDeleteElementName = <span style="color: rgb(163, 21, 21);">&quot;Delete&quot;</span>;
        <span style="color: blue;">private const string </span>ApiTypeReadElementName = <span style="color: rgb(163, 21, 21);">&quot;Read&quot;</span>;
        <span style="color: blue;">private const string </span>ApiTypeWriteElementName = <span style="color: rgb(163, 21, 21);">&quot;Write&quot;</span>;

        <span style="color: blue;">private const string </span>MetricsElementName = <span style="color: rgb(163, 21, 21);">&quot;Metrics&quot;</span>;
        <span style="color: blue;">private const string </span>IncludeApiSummaryElementName = <span style="color: rgb(163, 21, 21);">&quot;IncludeAPIs&quot;</span>;
        <span style="color: blue;">private const string </span>MetricsEnabledElementName = <span style="color: rgb(163, 21, 21);">&quot;Enabled&quot;</span>;

        <span style="color: blue;">private const int </span>MaximumRetentionDays = 365;

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Reads the settings provided from stream
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlReader&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static </span>AnalyticsSettings DeserializeAnalyticsSettings(XmlReader xmlReader)
        {
            <span style="color: green;">// Read the root and check if it is empty or invalid
            </span>xmlReader.Read();
            xmlReader.ReadStartElement(SettingsSerializerHelper.RootPropertiesElementName);

            AnalyticsSettings settings = <span style="color: blue;">new </span>AnalyticsSettings();

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.LoggingElementName))
                {
                    DeserializeLoggingElement(xmlReader, settings);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.MetricsElementName))
                {
                    DeserializeMetricsElement(xmlReader, settings);
                }
                <span style="color: blue;">else
                </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement();

            <span style="color: blue;">return </span>settings;
        }


        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Write the settings provided to stream
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;inputStream&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">public static void </span>SerializeAnalyticsSettings(XmlWriter xmlWriter, AnalyticsSettings settings)
        {
            xmlWriter.WriteStartDocument();
            xmlWriter.WriteStartElement(SettingsSerializerHelper.RootPropertiesElementName);

            <span style="color: green;">//LOGGING STARTS HERE
            </span>xmlWriter.WriteStartElement(SettingsSerializerHelper.LoggingElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.VersionElementName);
            xmlWriter.WriteValue(settings.LogVersion);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isReadEnabled = (settings.LogType &amp; LoggingLevel.Read) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeReadElementName);
            xmlWriter.WriteValue(isReadEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isWriteEnabled = (settings.LogType &amp; LoggingLevel.Write) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeWriteElementName);
            xmlWriter.WriteValue(isWriteEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isDeleteEnabled = (settings.LogType &amp; LoggingLevel.Delete) != LoggingLevel.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.ApiTypeDeleteElementName);
            xmlWriter.WriteValue(isDeleteEnabled);
            xmlWriter.WriteEndElement();

            SerializeRetentionPolicy(xmlWriter, settings.IsLogRetentionPolicyEnabled, settings.LogRetentionInDays);
            xmlWriter.WriteEndElement(); <span style="color: green;">// logging element

            //METRICS STARTS HERE
            </span>xmlWriter.WriteStartElement(SettingsSerializerHelper.MetricsElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.VersionElementName);
            xmlWriter.WriteValue(settings.MetricsVersion);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">bool </span>isServiceSummaryEnabled = (settings.MetricsType &amp; MetricsType.ServiceSummary) != MetricsType.None;
            xmlWriter.WriteStartElement(SettingsSerializerHelper.MetricsEnabledElementName);
            xmlWriter.WriteValue(isServiceSummaryEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">if </span>(isServiceSummaryEnabled)
            {
                <span style="color: blue;">bool </span>isApiSummaryEnabled = (settings.MetricsType &amp; MetricsType.ApiSummary) != MetricsType.None;
                xmlWriter.WriteStartElement(SettingsSerializerHelper.IncludeApiSummaryElementName);
                xmlWriter.WriteValue(isApiSummaryEnabled);
                xmlWriter.WriteEndElement();
            }

            SerializeRetentionPolicy(
                xmlWriter,
                settings.IsMetricsRetentionPolicyEnabled,
                settings.MetricsRetentionInDays);
            xmlWriter.WriteEndElement(); <span style="color: green;">// metrics 

            </span>xmlWriter.WriteEndElement(); <span style="color: green;">// root element
            </span>xmlWriter.WriteEndDocument();
        }

        <span style="color: blue;">private static void </span>SerializeRetentionPolicy(XmlWriter xmlWriter, <span style="color: blue;">bool </span>isRetentionEnabled, <span style="color: blue;">int </span>days)
        {
            xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyElementName);

            xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyEnabledElementName);
            xmlWriter.WriteValue(isRetentionEnabled);
            xmlWriter.WriteEndElement();

            <span style="color: blue;">if </span>(isRetentionEnabled)
            {
                xmlWriter.WriteStartElement(SettingsSerializerHelper.RetentionPolicyDaysElementName);
                xmlWriter.WriteValue(days);
                xmlWriter.WriteEndElement();
            }

            xmlWriter.WriteEndElement(); <span style="color: green;">// Retention policy for logs
        </span>}

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Reads the logging element and fills in the values in Analyticssettings instance
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlReader&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">private static void </span>DeserializeLoggingElement(
            XmlReader xmlReader,
            AnalyticsSettings settings)
        {
            <span style="color: green;">// Read logging element
            </span>xmlReader.ReadStartElement(SettingsSerializerHelper.LoggingElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.VersionElementName))
                {
                    settings.LogVersion = xmlReader.ReadElementString(SettingsSerializerHelper.VersionElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeReadElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeReadElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Read;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeWriteElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeWriteElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Write;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.ApiTypeDeleteElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.ApiTypeDeleteElementName))
                    {
                        settings.LogType = settings.LogType | LoggingLevel.Delete;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyElementName))
                {
                    <span style="color: green;">// read retention policy for logging
                    </span><span style="color: blue;">bool </span>isRetentionEnabled = <span style="color: blue;">false</span>;
                    <span style="color: blue;">int </span>retentionDays = 0;
                    DeserializeRetentionPolicy(xmlReader, <span style="color: blue;">ref </span>isRetentionEnabled, <span style="color: blue;">ref </span>retentionDays);
                    settings.IsLogRetentionPolicyEnabled = isRetentionEnabled;
                    settings.LogRetentionInDays = retentionDays;
                }
                <span style="color: blue;">else
                </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement();<span style="color: green;">// end Logging element
        </span>}

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Reads the metrics element and fills in the values in Analyticssettings instance
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlReader&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">private static void </span>DeserializeMetricsElement(
            XmlReader xmlReader,
            AnalyticsSettings settings)
        {
            <span style="color: blue;">bool </span>includeAPIs = <span style="color: blue;">false</span>;

            <span style="color: green;">// read the next element - it should be metrics. 
            </span>xmlReader.ReadStartElement(SettingsSerializerHelper.MetricsElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.VersionElementName))
                {
                    settings.MetricsVersion = xmlReader.ReadElementString(SettingsSerializerHelper.VersionElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.MetricsEnabledElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.MetricsEnabledElementName))
                    {
                        <span style="color: green;">// only if metrics is enabled will we read include API
                        </span>settings.MetricsType = settings.MetricsType | MetricsType.ServiceSummary;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.IncludeApiSummaryElementName))
                {
                    <span style="color: blue;">if </span>(DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.IncludeApiSummaryElementName))
                    {
                        includeAPIs = <span style="color: blue;">true</span>;
                    }
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyElementName))
                {
                    <span style="color: green;">// read retention policy for metrics
                    </span><span style="color: blue;">bool </span>isRetentionEnabled = <span style="color: blue;">false</span>;
                    <span style="color: blue;">int </span>retentionDays = 0;
                    DeserializeRetentionPolicy(xmlReader, <span style="color: blue;">ref </span>isRetentionEnabled, <span style="color: blue;">ref </span>retentionDays);
                    settings.IsMetricsRetentionPolicyEnabled = isRetentionEnabled;
                    settings.MetricsRetentionInDays = retentionDays;
                }
                <span style="color: blue;">else
                </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            <span style="color: blue;">if </span>((settings.MetricsType &amp; MetricsType.ServiceSummary) != MetricsType.None)
            {
                <span style="color: green;">// If Metrics is enabled, IncludeAPIs must be included.
                </span><span style="color: blue;">if </span>(includeAPIs)
                {
                    settings.MetricsType = settings.MetricsType | MetricsType.ApiSummary;
                }
            }

            xmlReader.ReadEndElement();<span style="color: green;">// end metrics element
        </span>}


        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Reads the retention policy in logging and metrics elements 
        </span><span style="color: gray;">/// </span><span style="color: green;">and fills in the values in Analyticssettings instance.
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlReader&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;isRetentionEnabled&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;retentionDays&quot;&gt;&lt;/param&gt;
        </span><span style="color: blue;">private static void </span>DeserializeRetentionPolicy(
            XmlReader xmlReader,
            <span style="color: blue;">ref bool </span>isRetentionEnabled,
            <span style="color: blue;">ref int </span>retentionDays)
        {
            xmlReader.ReadStartElement(SettingsSerializerHelper.RetentionPolicyElementName);

            <span style="color: blue;">while </span>(<span style="color: blue;">true</span>)
            {
                <span style="color: blue;">if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyEnabledElementName))
                {
                    isRetentionEnabled = DeserializeBooleanElementValue(
                        xmlReader,
                        SettingsSerializerHelper.RetentionPolicyEnabledElementName);
                }
                <span style="color: blue;">else if </span>(xmlReader.IsStartElement(SettingsSerializerHelper.RetentionPolicyDaysElementName))
                {
                    <span style="color: blue;">string </span>intValue = xmlReader.ReadElementString(
                        SettingsSerializerHelper.RetentionPolicyDaysElementName);
                    retentionDays = <span style="color: blue;">int</span>.Parse(intValue);
                }
                <span style="color: blue;">else
                </span>{
                    <span style="color: blue;">break</span>;
                }
            }

            xmlReader.ReadEndElement(); <span style="color: green;">// end reading retention policy
        </span>}

        <span style="color: gray;">/// &lt;summary&gt;
        /// </span><span style="color: green;">Read a boolean value for xml element
        </span><span style="color: gray;">/// &lt;/summary&gt;
        /// &lt;param name=&quot;xmlReader&quot;&gt;&lt;/param&gt;
        /// &lt;param name=&quot;elementToRead&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        </span><span style="color: blue;">private static bool </span>DeserializeBooleanElementValue(
            XmlReader xmlReader,
            <span style="color: blue;">string </span>elementToRead)
        {
            <span style="color: blue;">string </span>boolValue = xmlReader.ReadElementString(elementToRead);
            <span style="color: blue;">return bool</span>.Parse(boolValue);
        }
    }
}</pre>
<h3>Downloading your log data</h3>
<p>Since listing normal containers does not list out $logs container, existing tools will not be able to display these logs. In absence of existing tools, we wanted to provide a quick reference application with source code to make this data accessible.</p>
<p>The following application takes the service to download the logs for, the start time and end time for log entries and a file to export to. It then exports all log entries to the file in a csv format.</p>
<p>For example the following command will select all logs that have log entries in the provided time range and download all the log entries in those logs into a file called mytablelogs.txt:</p>
<p>DumpLogs table .\mytablelogs.txt&#160; “2011-07-26T22:00Z” “2011-07-26T23:30Z”</p>
<pre class="code"><span style="color: blue;">const string </span>ConnectionStringKey = <span style="color: rgb(163, 21, 21);">&quot;ConnectionString&quot;</span>;
<span style="color: blue;">const string </span>LogStartTime = <span style="color: rgb(163, 21, 21);">&quot;StartTime&quot;</span>;
<span style="color: blue;">const string </span>LogEndTime = <span style="color: rgb(163, 21, 21);">&quot;EndTime&quot;</span>;

<span style="color: blue;">static void </span>Main(<span style="color: blue;">string</span>[] args)
{
    <span style="color: blue;">if </span>(args.Length &lt; 3 || args.Length &gt; 4)
    {
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Usage: DumpLogs &lt;service to search - blob|table|queue&gt; &lt;output file name&gt; &lt;Start time in UTC&gt; &lt;Optional End time in UTC&gt;.&quot;</span>);
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Example: DumpLogs blob test.txt \&quot;2011-06-26T22:30Z\&quot; \&quot;2011-06-26T22:50Z\&quot;&quot;</span>);
        <span style="color: blue;">return</span>;
    }

    <span style="color: blue;">string </span>connectionString = ConfigurationManager.AppSettings[ConnectionStringKey];

    CloudStorageAccount account = CloudStorageAccount.Parse(connectionString);
    CloudBlobClient blobClient = account.CreateCloudBlobClient();

    DateTime startTimeOfSearch = DateTime.Parse(args[2]);
    DateTime endTimeOfSearch = DateTime.UtcNow;

    <span style="color: blue;">if </span>(args.Length == 4)
    {
        endTimeOfSearch = DateTime.Parse(args[3]);
    }

    List&lt;CloudBlob&gt; blobList = ListLogFiles(blobClient, args[0], startTimeOfSearch.ToUniversalTime(), endTimeOfSearch.ToUniversalTime());
    DumpLogs(blobList, args[1]);
}



<span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Given service name, start time for search and end time for search, creates a prefix that can be used
</span><span style="color: gray;">/// </span><span style="color: green;">to efficiently get a list of logs that may match the search criteria
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;service&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;startTime&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endTime&quot;&gt;&lt;/param&gt;
/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color: blue;">static string </span>GetSearchPrefix(<span style="color: blue;">string </span>service, DateTime startTime, DateTime endTime)
{
    StringBuilder prefix = <span style="color: blue;">new </span>StringBuilder(<span style="color: rgb(163, 21, 21);">&quot;$logs/&quot;</span>);

    prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0}/&quot;</span>, service);

    <span style="color: green;">// if year is same then add the year
    </span><span style="color: blue;">if </span>(startTime.Year == endTime.Year)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0}/&quot;</span>, startTime.Year);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if month is same then add the month
    </span><span style="color: blue;">if </span>(startTime.Month == endTime.Month)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0:D2}/&quot;</span>, startTime.Month);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if day is same then add the day
    </span><span style="color: blue;">if </span>(startTime.Day == endTime.Day)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0:D2}/&quot;</span>, startTime.Day);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if hour is same then add the hour
    </span><span style="color: blue;">if </span>(startTime.Hour == endTime.Hour)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;log-{0:D2}00&quot;</span>, startTime.Hour);
    }

    <span style="color: blue;">return </span>prefix.ToString();
}

<span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Given a service, start time, end time, provide list of log files
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;blobClient&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;serviceName&quot;&gt;</span><span style="color: green;">The name of the service interested in</span><span style="color: gray;">&lt;/param&gt;
/// &lt;param name=&quot;startTimeForSearch&quot;&gt;</span><span style="color: green;">Start time for the search</span><span style="color: gray;">&lt;/param&gt;
/// &lt;param name=&quot;endTimeForSearch&quot;&gt;</span><span style="color: green;">End time for the search</span><span style="color: gray;">&lt;/param&gt;
/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color: blue;">static </span>List&lt;CloudBlob&gt; ListLogFiles(CloudBlobClient blobClient, <span style="color: blue;">string </span>serviceName, DateTime startTimeForSearch, DateTime endTimeForSearch)
{
    List&lt;CloudBlob&gt; selectedLogs = <span style="color: blue;">new </span>List&lt;CloudBlob&gt;();

    <span style="color: green;">// form the prefix to search. Based on the common parts in start and end time, this prefix is formed
    </span><span style="color: blue;">string </span>prefix = GetSearchPrefix(serviceName, startTimeForSearch, endTimeForSearch);

    Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Prefix used for log listing = {0}&quot;</span>, prefix);

    <span style="color: green;">// List the blobs using the prefix
    </span>IEnumerable&lt;IListBlobItem&gt; blobs = blobClient.ListBlobsWithPrefix(
        prefix,
        <span style="color: blue;">new </span>BlobRequestOptions()
        {
            UseFlatBlobListing = <span style="color: blue;">true</span>,
            BlobListingDetails = BlobListingDetails.Metadata
        });


    <span style="color: green;">// iterate through each blob and figure the start and end times in the metadata
    </span><span style="color: blue;">foreach </span>(IListBlobItem item <span style="color: blue;">in </span>blobs)
    {
        CloudBlob log = item <span style="color: blue;">as </span>CloudBlob;
        <span style="color: blue;">if </span>(log != <span style="color: blue;">null</span>)
        {
            <span style="color: green;">// we will exclude the file if the file does not have log entries in the interested time range.
            </span>DateTime startTime = DateTime.Parse(log.Metadata[LogStartTime]).ToUniversalTime();
            DateTime endTime = DateTime.Parse(log.Metadata[LogEndTime]).ToUniversalTime();

            <span style="color: blue;">bool </span>exclude = (startTime &gt; endTimeForSearch || endTime &lt; startTimeForSearch);

            Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;{0} Log {1} Start={2:U} End={3:U}.&quot;</span>,
                exclude ? <span style="color: rgb(163, 21, 21);">&quot;Ignoring&quot; </span>: <span style="color: rgb(163, 21, 21);">&quot;Selected&quot;</span>,
                log.Uri.AbsoluteUri,
                startTime,
                endTime);

            <span style="color: blue;">if </span>(!exclude)
            {
                selectedLogs.Add(log);
            }
        }
    }

    <span style="color: blue;">return </span>selectedLogs;
}


<span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Dump all log entries to file irrespective of the time.
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;blobList&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;fileName&quot;&gt;&lt;/param&gt;
</span><span style="color: blue;">static void </span>DumpLogs(List&lt;CloudBlob&gt; blobList, <span style="color: blue;">string </span>fileName)
{

    <span style="color: blue;">if </span>(blobList.Count &gt; 0)
    {
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Dumping log entries from {0} files to '{1}'&quot;</span>, blobList.Count, fileName);
    }
    <span style="color: blue;">else
    </span>{
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;No logs files have selected.&quot;</span>);
    }

    <span style="color: blue;">using </span>(StreamWriter writer = <span style="color: blue;">new </span>StreamWriter(fileName))
    {
        writer.Write(
            <span style="color: rgb(163, 21, 21);">&quot;Log version; Transaction Start Time; REST Operation Type; Transaction Status; HTTP Status; E2E Latency; Server Latency; Authentication Type; Accessing Account; Owner Account; Service Type;&quot;</span>);
        writer.Write(
            <span style="color: rgb(163, 21, 21);">&quot;Request url; Object Key; RequestId; Operation #; User IP; Request Version; Request Header Size; Request Packet Size; Response Header Size;&quot;</span>);
        writer.WriteLine(
            <span style="color: rgb(163, 21, 21);">&quot;Response Packet Size; Request Content Length; Request MD5; Server MD5; Etag returned; LMT; Condition Used; User Agent; Referrer; Client Request Id&quot;</span>);
        <span style="color: blue;">foreach </span>(CloudBlob blob <span style="color: blue;">in </span>blobList)
        {
            <span style="color: blue;">using </span>(Stream stream = blob.OpenRead())
            {
                <span style="color: blue;">using </span>(StreamReader reader = <span style="color: blue;">new </span>StreamReader(stream))
                {
                    <span style="color: blue;">string </span>logEntry;
                    <span style="color: blue;">while </span>((logEntry = reader.ReadLine()) != <span style="color: blue;">null</span>)
                    {
                        writer.WriteLine(logEntry);
                    }
                }
            }
        }
    }
}</pre>
<p>&#160;</p>
<h3>Case Study</h3>
<p>To put the power of log analytics into perspective, we will end this post with a sample application. Below, we cover a very simple console application that allows search (e.g., grep) functionality over logs.&#160; One can imagine extending this to download the logs and analyze it and store data in structured storage such as Windows Azure Tables or SQL Azure for additional querying over the data.</p>
<p>Description: A console program that takes as input: service name to search for, log type to search, start time for the search, end time for the search and the keyword to search for in the logs. The output is log entries that match the search criteria and contains the keyword.</p>
<p>We will start with the method “ListLogFiles”. The method will use the input arguments to create a prefix for the blob listing operation. This method makes use of the utility methods GetSearchPrefix to get the prefix for listing operation. The prefix uses service name, start and end time to format the prefix. The start and end times are compared and only the parts that match are used in the prefix search. For example: If start time is &quot;2011-06-27T02:50Z&quot; and end time is &quot;2011-06-27T03:08Z&quot;, then the prefix for blob service will be: “$logs/blob/2011/06/27/”. If the hour had matched then the prefix would be: “$logs/blob/2011/06/27/0200”.&#160; The listing result contains metadata for each blob in the result.&#160; The start time, end time and logging level is then matched to see if the log contains any entries that may match the time criteria. If it does, then we add the log to the list of logs we will be interested in downloading. Otherwise, we skip the log file.</p>
<p>NOTE: Exception handling and parameter validation is omitted for brevity.</p>
<pre class="code"><span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Given a service, start time, end time, and operation types (i.e. READ/WRITE/DELETE) to search for, this method
</span><span style="color: gray;">/// </span><span style="color: green;">iterates through blob logs and selects the ones that match the service and time range.
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;blobClient&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;serviceName&quot;&gt;</span><span style="color: green;">The name of the service interested in</span><span style="color: gray;">&lt;/param&gt;
/// &lt;param name=&quot;startTimeForSearch&quot;&gt;</span><span style="color: green;">Start time for the search</span><span style="color: gray;">&lt;/param&gt;
/// &lt;param name=&quot;endTimeForSearch&quot;&gt;</span><span style="color: green;">End time for the search</span><span style="color: gray;">&lt;/param&gt;
/// &lt;param name=&quot;operationTypes&quot;&gt;</span><span style="color: green;">A ',' separated operation types used as logging level</span><span style="color: gray;">&lt;/param&gt;
/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color: blue;">static </span>List&lt;CloudBlob&gt; ListLogFiles(
CloudBlobClient blobClient, 
<span style="color: blue;">string </span>serviceName, 
DateTime startTimeForSearch, 
DateTime endTimeForSearch, 
<span style="color: blue;">string </span>operationTypes)
{
    List&lt;CloudBlob&gt; selectedLogs = <span style="color: blue;">new </span>List&lt;CloudBlob&gt;();
            
    <span style="color: green;">// convert a ',' separated log type to a &quot;flag&quot; enum 
    </span>LoggingLevel loggingLevelsToFind = GetLoggoingLevel(operationTypes);

    <span style="color: green;">// form the prefix to search. Based on the common parts in start and end time, this prefix is formed
    </span><span style="color: blue;">string </span>prefix = GetSearchPrefix(serviceName, startTimeForSearch, endTimeForSearch);

    Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Prefix used = {0}&quot;</span>, prefix);

    <span style="color: green;">// List the blobs using the prefix
    </span>IEnumerable&lt;IListBlobItem&gt; blobs = blobClient.ListBlobsWithPrefix(
        prefix, 
        <span style="color: blue;">new </span>BlobRequestOptions()
        {
            UseFlatBlobListing = <span style="color: blue;">true</span>,
            BlobListingDetails = BlobListingDetails.Metadata
        });
            
                           
    <span style="color: green;">// iterate through each blob and figure the start and end times in the metadata
    </span><span style="color: blue;">foreach </span>(IListBlobItem item <span style="color: blue;">in </span>blobs)
    {                            
        CloudBlob log = item <span style="color: blue;">as </span>CloudBlob;
        <span style="color: blue;">if </span>(log != <span style="color: blue;">null</span>)
        {
            DateTime startTime = DateTime.Parse(log.Metadata[LogStartTime]).ToUniversalTime();
            DateTime endTime = DateTime.Parse(log.Metadata[LogEndTime]).ToUniversalTime();
            <span style="color: blue;">string </span>logTypes = log.Metadata[LogEntryTypes].ToUpper();

            LoggingLevel levelsInLog = GetLoggoingLevel(logTypes);

            <span style="color: green;">// we will exclude the file if the time range does not match or it does not contain the log type 
            // we are searching for
            </span><span style="color: blue;">bool </span>exclude = (startTime &gt; endTimeForSearch 
                || endTime &lt; startTimeForSearch 
                || (loggingLevelsToFind &amp; levelsInLog) == LoggingLevel.None);

            Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;{0} Log {1} Start={2:U} End={3:U} Types={4}.&quot;</span>,
                exclude ? <span style="color: rgb(163, 21, 21);">&quot;Ignoring&quot; </span>: <span style="color: rgb(163, 21, 21);">&quot;Selected&quot;</span>,
                log.Uri.AbsoluteUri,
                startTime,
                endTime,
                logTypes);
                    
            <span style="color: blue;">if </span>(!exclude)
            {
                selectedLogs.Add(log);
            }
        }
    }
       
    <span style="color: blue;">return </span>selectedLogs;
}

<span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Given service name, start time for search and end time for search, creates a prefix that can be used
</span><span style="color: gray;">/// </span><span style="color: green;">to efficiently get a list of logs that may match the search criteria
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;service&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;startTime&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;endTime&quot;&gt;&lt;/param&gt;
/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color: blue;">static string </span>GetSearchPrefix(<span style="color: blue;">string </span>service, DateTime startTime, DateTime endTime)
{
    StringBuilder prefix = <span style="color: blue;">new </span>StringBuilder(<span style="color: rgb(163, 21, 21);">&quot;$logs/&quot;</span>);
            
    prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0}/&quot;</span>, service);
            
    <span style="color: green;">// if year is same then add the year
    </span><span style="color: blue;">if </span>(startTime.Year == endTime.Year)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0}/&quot;</span>, startTime.Year);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if month is same then add the month
    </span><span style="color: blue;">if </span>(startTime.Month == endTime.Month)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0:D2}/&quot;</span>, startTime.Month);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if day is same then add the day
    </span><span style="color: blue;">if </span>(startTime.Day == endTime.Day)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0:D2}/&quot;</span>, startTime.Day);
    }
    <span style="color: blue;">else
    </span>{
        <span style="color: blue;">return </span>prefix.ToString();
    }

    <span style="color: green;">// if hour is same then add the hour
    </span><span style="color: blue;">if </span>(startTime.Hour == endTime.Hour)
    {
        prefix.AppendFormat(<span style="color: rgb(163, 21, 21);">&quot;{0:D2}00&quot;</span>, startTime.Hour);
    }

    <span style="color: blue;">return </span>prefix.ToString();
}</pre>
<p>&#160;</p>
<p>Once we have a list of logs, then we just need to iterate and see if the log entry in the log contains the keyword.</p>
<pre class="code"><span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Displays all log entries containing a keyword
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;blobList&quot;&gt;&lt;/param&gt;
/// &lt;param name=&quot;keyword&quot;&gt;&lt;/param&gt;
</span><span style="color: blue;">static void </span>DisplayLogs(List&lt;CloudBlob&gt; blobList, <span style="color: blue;">string </span>keyword)
{
    Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Log entries matching '{0}' are: &quot;</span>, keyword);

    <span style="color: blue;">foreach </span>(CloudBlob blob <span style="color: blue;">in </span>blobList)
    {
        <span style="color: blue;">using </span>(Stream stream = blob.OpenRead())
        {
            <span style="color: blue;">using </span>(StreamReader reader = <span style="color: blue;">new </span>StreamReader(stream))
            {
                <span style="color: blue;">string </span>logEntry;
                <span style="color: blue;">while</span>((logEntry = reader.ReadLine()) != <span style="color: blue;">null</span>)
                {
                    <span style="color: blue;">if </span>(logEntry.Contains(keyword))
                    {
                        Console.WriteLine(logEntry);
                    }
                }
            }
        }
    }

    Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;End searching for '{0}'&quot;</span>, keyword);
}


<span style="color: gray;">/// &lt;summary&gt;
/// </span><span style="color: green;">Given a ',' separated list of log types aka operation types, it returns the logging level 
</span><span style="color: gray;">/// &lt;/summary&gt;
/// &lt;param name=&quot;loggingLevels&quot;&gt;&lt;/param&gt;
/// &lt;returns&gt;&lt;/returns&gt;
</span><span style="color: blue;">static </span>LoggingLevel GetLoggoingLevel(<span style="color: blue;">string </span>loggingLevels)
{
    <span style="color: blue;">string</span>[] loggingLevelList = loggingLevels.ToUpper().Split(<span style="color: rgb(163, 21, 21);">','</span>);
    LoggingLevel level = LoggingLevel.None;
    <span style="color: blue;">foreach </span>(<span style="color: blue;">string </span>logLevel <span style="color: blue;">in </span>loggingLevelList)
    {
        <span style="color: blue;">if </span>(<span style="color: blue;">string</span>.Equals(<span style="color: rgb(163, 21, 21);">&quot;READ&quot;</span>, logLevel))
        {
            level |= LoggingLevel.Read;
        }
        <span style="color: blue;">else if </span>(<span style="color: blue;">string</span>.Equals(<span style="color: rgb(163, 21, 21);">&quot;WRITE&quot;</span>, logLevel))
        {
            level |= LoggingLevel.Write;
        }
        <span style="color: blue;">else if </span>(<span style="color: blue;">string</span>.Equals(<span style="color: rgb(163, 21, 21);">&quot;DELETE&quot;</span>, logLevel))
        {
            level |= LoggingLevel.Delete;
        }
    }

    <span style="color: blue;">return </span>level;
}

[Flags]
<span style="color: blue;">public enum </span>LoggingLevel
{
     None = 0,
     Delete = 2,
     Write = 4,
     Read = 8,
 }</pre>
<p>The main method then just invokes ListLogFiles and DisplayLogs.</p>
<pre class="code"><span style="color: blue;">static void </span>Main(<span style="color: blue;">string</span>[] args)
{
    <span style="color: blue;">if </span>(args.Length &lt; 4)
    {
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Usage: LogFind &lt;service to search - blob|table|queue&gt; &lt;Comma separated lit of operations&gt; &lt;Start time in UTC for search&gt; &lt;End time in UTC for search&gt; &lt;search string&gt;.&quot;</span>);
        Console.WriteLine(<span style="color: rgb(163, 21, 21);">&quot;Example: LogFind blob \&quot;WRITE,DELETE\&quot; \&quot;2011-06-26T22:30Z\&quot; \&quot;2011-06-26T22:50Z\&quot; \&quot;DeleteContainer\&quot;&quot;</span>);
        <span style="color: blue;">return</span>;
    }

    CloudStorageAccount account = CloudStorageAccount.Parse(ConnectionString);
    CloudBlobClient blobClient = account.CreateCloudBlobClient();
           
    DateTime startTimeOfSearch = DateTime.Parse(args[2]).ToUniversalTime();
    DateTime endTimeOfSearch = DateTime.Parse(args[3]).ToUniversalTime();

    List&lt;CloudBlob&gt; blobList = ListLogFiles(blobClient, args[0], startTimeOfSearch, endTimeOfSearch, args[1]);
    DisplayLogs(blobList, args[4]);
}</pre>
<p>Given the above methods, to search for log entries between 02:50 and 3:05 for DeleteContainer, the following can be executed. The spew from the console application is self-describing. It lists all the logs that are created between the two dates and then selects only the ones that have “Delete” in the LogType and then once it gets the eligible logs, it downloads it and then outputs any lines in the log that contains the search keyword:</p>
<p>&#160;<b>LogFind blob &quot;DELETE&quot; &quot;2011-06-27T02:50Z&quot; &quot;2011-06-27T03:05Z&quot; &quot;DeleteContainer&quot;</b></p>
<p>This could give the following example results in the command line window:</p>
<pre class="code">This could give the following example results <span style="color: blue;">in </span>the command line window:
Prefix used = $logs/blob/2011/06/27/
Selected Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0200-000000 Start=Monday, June 27, 2011 2:58:06 AM End=Monday, June 27, 2011 2:59:45 AM Types=READ,WRITE,DELETE.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0300-000000 Start=Monday, June 27, 2011 3:00:25 AM End=Monday, June 27, 2011 3:53:42 AM Types=READ,WRITE.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0500-000000 Start=Monday, June 27, 2011 5:03:47 AM End=Monday, June 27, 2011 5:03:47 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0600-000000 Start=Monday, June 27, 2011 6:05:48 AM End=Monday, June 27, 2011 6:13:31 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0600-000001 Start=Monday, June 27, 2011 6:11:55 AM End=Monday, June 27, 2011 6:14:23 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0600-000002 Start=Monday, June 27, 2011 6:40:55 AM End=Monday, June 27, 2011 6:41:56 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0600-000003 Start=Monday, June 27, 2011 6:52:23 AM End=Monday, June 27, 2011 6:58:33 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0700-000000 Start=Monday, June 27, 2011 7:00:44 AM End=Monday, June 27, 2011 7:05:31 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0700-000001 Start=Monday, June 27, 2011 7:06:52 AM End=Monday, June 27, 2011 7:12:56 AM Types=READ.
</span>Ignoring Log http:<span style="color: green;">//gameusnorth.blob.core.windows.net/$logs/blob/2011/06/27/0700-000002 Start=Monday, June 27, 2011 7:21:13 AM End=Monday, June 27, 2011 7:26:21 AM Types=READ,WRITE.

</span>Log entries matching <span style="color: rgb(163, 21, 21);">'DeleteContainer' </span>are:

1.0;2011-06-27T03:00:40.4636789Z;DeleteContainer;Success;202;18;18;authenticated;gameusnorth;gameusnorth;blob;<span style="color: rgb(163, 21, 21);">&quot;http://gameusnorth.blob.core.windows.net/photos?restype=container&amp;amp;timeout=30000&quot;</span>;<span style="color: rgb(163, 21, 21);">&quot;/gameusnorth /photos&quot;</span>;e09a61de-e47b-40aa-86e0-05fe620f818f;0;268.20.203.21;2009-09-19;364;0;125;0;0;;;;;;;;<span style="color: rgb(163, 21, 21);">&quot;ClientID f38d713b-7113-4fea-9173-9e9b00b22f71&quot;


</span>End searching <span style="color: blue;">for </span><span style="color: rgb(163, 21, 21);">'DeleteContainer'
</span>Press any key to <span style="color: blue;">continue </span>. . .</pre>
<p>
  <br/>For more information, please see the <a href="http://msdn.microsoft.com/en-us/library/hh343270.aspx">MSDN Documentation</a>.</p>
<p>Jai Haridas, Monilee Atkinson, and Brad Calder</p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/analytics-logging-metrics/" rel="tag">Analytics - Logging &amp; Metrics</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (4)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F02%2Fwindows-azure-storage-logging-using-logs-to-track-storage-requests%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-2471">
				<div id="div-comment-2471" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/4c02447e7bd98a97aba79228bf830364?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/4c02447e7bd98a97aba79228bf830364?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn"><a href="http://blogs.msdn.com/scott_5F00_b_5F00_arbeit_4000_hotmail.com/ProfileUrlRedirect.ashx" rel="external nofollow" class="url">scott_b_arbeit@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#comment-2471">
			August 13, 2011 at 11:15 pm</a>		</div>

		<p>Great feature, and great writeup and sample code to go with it. This blog entry will definitely save me some effort, and I really appreciate it.</p>
<p>One question (that I&#39;m guessing I already know the answer to): what happens to logging/metrics when I&#39;m serving a blob through Windows Azure CDN, where Blob Storage only gets hit once-per-TTL?</p>
<p>And, if the answer is &quot;yeah, we&#39;re not logging CDN hits&quot; then you can guess what my next formal feature request is going to be. 🙂 &nbsp;(Not that I&#39;m not incredibly grateful for what you&#39;ve done here already.) In effect, the logging/metrics feature seems so good that it almost acts as a disincentive to use the CDN, when you&#39;re looking to track hits.</p>
<p>Thanks!</p>
<p>Scott</p>
<p>Seattle, WA, USA</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F02%2Fwindows-azure-storage-logging-using-logs-to-track-storage-requests%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-2461">
				<div id="div-comment-2461" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a79a1b675acd535552dd5817613979ab?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a79a1b675acd535552dd5817613979ab?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn"><a href="http://blogs.msdn.com/Brad-Calder-_2800_MSFT_2900_/ProfileUrlRedirect.ashx" rel="external nofollow" class="url">shop.calder@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#comment-2461">
			August 16, 2011 at 8:18 pm</a>		</div>

		<p>@Scott</p>
<p>When the Azure CDN access your storage account (e.g., when the TTL expires), that request will be logged inside of the storage account. &nbsp;The hits at the Azure CDN edges are not logged as part of the storage account (only the requests that directly hit the storage account). &nbsp; So you won’t see logging/metrics for Azure CDN hits as part of the storage account’s logging/metrics. &nbsp;</p>
<p>Yes, the Azure CDN team is looking at providing logging for requests coming into Azure CDN in the future.</p>
<p>Brad</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F02%2Fwindows-azure-storage-logging-using-logs-to-track-storage-requests%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-2451">
				<div id="div-comment-2451" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/2502e35d8b29ead96f8fbc2db45195c4?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/2502e35d8b29ead96f8fbc2db45195c4?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn"><a href="http://blogs.msdn.com/atul.b86_4000_hotmail.com/ProfileUrlRedirect.ashx" rel="external nofollow" class="url">atul.b86@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#comment-2451">
			December 15, 2011 at 2:20 am</a>		</div>

		<p>@Brad </p>
<p>very usefull post&#8230;. </p>
<p>I have one question, did Storage Logging affect the performance?</p>
<p>Atul</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F02%2Fwindows-azure-storage-logging-using-logs-to-track-storage-requests%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-2441">
				<div id="div-comment-2441" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7baef01f55b96f7ef6e7d2270e0b7ec6?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn"><a href="http://blogs.msdn.com/Jai-Haridas-_2D00_-MSFT/ProfileUrlRedirect.ashx" rel="external nofollow" class="url">jaidevh1@hotmail.com</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2011/08/02/windows-azure-storage-logging-using-logs-to-track-storage-requests/#comment-2441">
			December 20, 2011 at 8:49 pm</a>		</div>

		<p>@Atul, user&#39;s storage account is not impacted by the system writing logging data to the user&#39;s storage account.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2011%2F08%2F02%2Fwindows-azure-storage-logging-using-logs-to-track-storage-requests%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->