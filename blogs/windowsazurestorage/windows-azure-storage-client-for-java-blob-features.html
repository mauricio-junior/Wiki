---
layout: windowsazurestorage
title: Windows Azure Storage Client for Java Blob Features
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-67" class="post-67 post type-post status-publish format-standard hentry category-uncategorized tag-windows-azure-blobs tag-windows-azure-storage-client-library">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage Client for Java Blob Features</h1>		<div class="rating-wrap">
		<div id="star-rating-67" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="67" data-container="body" data-toggle="tooltip" title="1 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2012-03-05T09:41:07+00:00">March 5, 2012</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Client for Java Blob Features&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Client for Java Blob Features&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		</p>
<p>We have released the Storage Client for Java with support for Windows Azure Blobs, Queues, and Tables. Our goal is to continue to improve the development experience when writing cloud applications using Windows Azure Storage. As such, we have incorporated feedback from customers and forums for the current .NET libraries to help create a more seamless API that is both powerful and simple to use. This blog post serves as an overview of a few new features for Blobs that are currently unique to the Storage Client for Java, which are designed to address common scenarios when working with Cloud workloads. </p>
<h4>MD5</h4>
<p>One of the key pieces of feedback we get is to make working with MD5 easier and more seamless. For java we have simplified this scenario to provide consistent behavior and simple configuration. </p>
<p>There are two different ways to use Content-MD5s in the Blob service: a transactional MD5 is used to provide data integrity during transport of blocks or pages of a blob, which is not stored with the blob, and an MD5 of the entire blob, which is stored with the blob and returned on subsequent GET operations (see the <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/02/18/windows-azure-blob-md5-overview.aspx">blog post here</a> for information on what the server provides). </p>
<p>To make this easy, we have designed high level controls for common cross cutting scenarios that will be respected by every API. For example, no matter which API a user chooses to upload a blob (page or block) the MD5 settings will be honored. Additionally we have decoupled transactional MD5 (which is useful to ensure transport integrity of individual blocks and pages) and Blob Level MD5 which sets the MD5 value on the entire blob, which is then returned on subsequent GETs.&#160; </p>
<p>The following example illustrates how to use <i>BlobRequestOptions</i> to utilize transactional content md5 to ensure that uploads and downloads are validated correctly. Note: transactional MD5 is not needed when using HTTPS as HTTPS provides its own integrity mechanism. Both the transactional MD5 and the full blob level MD5 are set to false (turned off) by default.&#160; The following shows how to turn both of them on.</p>
<pre class="code"><span style="color: green">// Define BlobRequestOptions to use transactional MD5
</span>BlobRequestOptions options = <span style="color: blue">new </span>BlobRequestOptions();
options.setUseTransactionalContentMD5(<span style="color: blue">true</span>);
options.setStoreBlobContentMD5 (<span style="color: blue">true</span>); <span style="color: green">// Set full blob level MD5


</span>blob.upload(sourceStream blobLength,
            <span style="color: blue">null </span><span style="color: green">/* AccessCondition */</span>,
            options,
            <span style="color: blue">null </span><span style="color: green">/* OperationContext */</span>);

blobRef.download(outStream,
            <span style="color: blue">null </span><span style="color: green">/* AccessCondition */</span>,
            options,
            <span style="color: blue">null </span><span style="color: green">/* OperationContext */</span>);</pre>
<p>&#160;</p>
<h4>Sparse Page Blob</h4>
<p>The most common use for page blobs among cloud applications is to back a VHD (Virtual Hard Drive) image.&#160; When a page blob is first created it exists as a range of zero filled bytes. The Windows Azure Blob service provides the ability to write in increments of 512 byte pages and keep track of which pages have been written to. As such it is possible for a client to know which pages still contain zero filled data and which ones contain valid data.&#160; </p>
<p>We are introducing a new feature in this release of the Storage Client for Java which can omit 512 byte aligned ranges of zeros when uploading a page blob, and subsequently intelligently download only the non-zero data. During a download when the library detects that the current data being read exists in a zero’d region the client simply generates these zero’d bytes without making additional requests to the server. Once the read continues on into a valid range of bytes the library resumes making requests to the server for the non-zero’d data.</p>
<p>The following example illustrates how to use BlobRequestOptions to use the sparse page blob feature.</p>
<pre class="code"><span style="color: green">// Define BlobRequestOptions to use sparse page blob
</span>BlobRequestOptions options = <span style="color: blue">new </span>BlobRequestOptions();
options.setUseSparsePageBlob(<span style="color: blue">true</span>);
blob.create(length);

<span style="color: green">// Alternatively could use blob.openOutputStream
</span>blob.upload(sourceStream blobLength,
            <span style="color: blue">null </span><span style="color: green">/* AccessCondition */</span>,
            options,
            <span style="color: blue">null </span><span style="color: green">/* OperationContext */</span>);

<span style="color: green">// Alternatively could use blob.openInputStream
</span>blobRef.download(outStream,
            <span style="color: blue">null </span><span style="color: green">/* AccessCondition */</span>,
            options,
            <span style="color: blue">null </span><span style="color: green">/* OperationContext */</span>);</pre>
<p>Please note this optimization works in chunked read and commit sizes (configurable via <i>CloudBlobClient. setStreamMinimumReadSizeInBytes </i>and <i>CloudBlobClient.setPageBlobStreamWriteSizeInBytes</i>&#160; respectively).&#160; If a given read or commit consists entirely of zeros then the operation is skipped altogether.&#160; Alternatively if a given read or commit chunk consists of only a subset of non-zero data then it is possible that the library will “shrink” the read or commit chunk by ignoring any beginning or ending pages which consist entirely of zeros. This allows us to optimize both cost (fewer transactions) and speed (less data) in a predictable manner.&#160; <b></b></p>
<h4>Download Resume</h4>
<p>Another new feature to this release of the Storage Client for Java is the ability for full downloads to resume themselves in the event of a disconnect or exception.&#160; The most cost efficient way for a client to download a given blob is in a single REST GET call.&#160; However if you are downloading a large blob, say of several GB, an issue arises on how to handle disconnects and errors without having to pre-buffer data or re-download the entire blob.&#160;&#160; </p>
<p>To solve this issue, the blob download functionality will now check the retry policy specified by the user and determine if the user desires to retry the operation. If the operation should not be retried it will simply throw as expected, however if the retry policy indicates the operation should be retried then the download will revert to using a <i>BlobInputStream</i> positioned to the current location of the download with an ETag check. This allows the user to simply “resume” the download in a performant and fault-tolerant way. This feature is enabled for all downloads via the <i>CloudBlob.download</i> method.</p>
<h4>Best Practices</h4>
<p>We’d also like to share some best practices for using blobs with the Storage Client for Java:</p>
<ul>
<li>Always provide the length of the data being uploaded if it is available; alternatively a user may specify -1 if the length is not known. This is needed for authentication. Uploads that specify -1 will cause the Storage Client to pre-read the data to determine its length, (and potentially to calculate md5 if enabled). If the <i>InputStream </i>provided is not markable <i>BlobOutputStream</i> is used.</li>
<li>Use markable streams (i.e. <i>BufferedInputStream</i>) when uploading Blobs. In order to support retries and to avoid having to prebuffer data in memory a stream must be markable so that it can be rewound in the case of an exception to retry the operation. When the stream provided does not support mark the Storage Client will use a <i>BlobOutputStream</i> which will internally buffer individual blocks until they are commited. Note: uploads that are over <i>CloudBlobClient</i>.<i>getSingleBlobPutThresholdInBytes</i>() (Default is 32 MB, but can be set up to 64MB) will also be uploaded using the <i>BlobOutputStream</i>.</li>
<li>If you already have the MD5 for a given blob you can set it directly via <i>CloudBlob.getProperties().setContentMd5</i> and it will be sent on a subsequent Blob upload or by calling <i>CloudBlob.uploadProperties</i>(). This can potentially increase performance by avoiding a duplicate calculation of MD5. </li>
<li>Please note MD5 is disabled by default, see the MD5 section above regarding how to utilize MD5.</li>
<li><i>BlobOutputStreams</i> commit size is configurable via <i>CloudBlobClient.setWriteBlockSizeInBytes() </i>for BlockBlobs and <i>CloudBlobClient.setPageBlobStreamWriteSizeInBytes() </i>for Page Blobs</li>
<li><i>BlobInputStreams </i>minimum read size is configurable via <i>CloudBlobClient.setStreamMinimumReadSizeInBytes</i>()<i></i></li>
<li>For lower latency uploads <i>BlobOutputStream</i> can execute multiple parallel requests. The concurrent request count is default to 1 (no concurrency) and is configurable via <i>CloudBlobClient.setConcurrentRequestCount</i>(). <i>BlobOutputStream</i> is accessible via <i>Cloud[Block|Page]Blob.openOutputStream</i> or by uploading a stream that is greater than <i>CloudBlobClient</i>.<i>getSingleBlobPutThresholdInBytes</i>() for BlockBlob or 4 MB for PageBlob.<i></i></li>
</ul>
<h4>Summary</h4>
<p>This post has covered a few interesting features in the recently released Windows Azure Storage Client for Java. We very much appreciate all the feedback we have gotten from customers and through the forums, please keep it coming. Feel free to leave comments below,</p>
<p>Joe Giardino<br/>
  <br/>Developer</p>
<p>Windows Azure Storage</p>
<h4>Resources</h4>
<p><b>Get the Windows Azure SDK for Java</b></p>
<ul>
<li><a href="http://go.microsoft.com/fwlink/?LinkID=234491&amp;clcid=0x409">Download the Windows Azure SDK for Java</a></li>
<li><a href="https://github.com/WindowsAzure/azure-sdk-for-java">Windows Azure SDK for Java source code on GitHub</a></li>
</ul>
<p><b>Learn more about the Windows Azure Storage Client for Java</b></p>
<ul>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-overview.aspx">Windows Azure Storage Client for Java Object Model Overview</a><a name="_GoBack"></a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/blob-storage/">How to Use the Blob Storage Service from Java</a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/">Windows Azure SDK for Java Developer Center</a></li>
</ul>
<p><b>Learn more about Windows Azure Storage</b></p>
<ul>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/05/10/windows-azure-storage-abstractions-and-their-scalability-targets.aspx">Windows Azure Storage Abstractions and their Scalability Targets</a></li>
<li><a href="http://social.msdn.microsoft.com/Forums/en-US/windowsazuredata/threads">Windows Azure Storage, CDN, and Caching Forum</a></li>
</ul>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-blobs/" rel="tag">Windows Azure Blobs</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-storage-client-library/" rel="tag">Windows Azure Storage Client Library</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-blob-features/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F03%2F05%2Fwindows-azure-storage-client-for-java-blob-features%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->