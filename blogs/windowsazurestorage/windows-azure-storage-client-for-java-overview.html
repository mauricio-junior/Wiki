---
layout: windowsazurestorage
title: Windows Azure Storage Client for Java Overview
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-71" class="post-71 post type-post status-publish format-standard hentry category-uncategorized tag-releases tag-windows-azure-storage-client-library">

	<header class="entry-header single">
		<h1 class="entry-title">Windows Azure Storage Client for Java Overview</h1>		<div class="rating-wrap">
		<div id="star-rating-71" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="71" data-container="body" data-toggle="tooltip" title="1 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2012-03-05T09:49:58+00:00">March 5, 2012</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/#respond">0</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Client for Java Overview&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/&quot;, &quot;text&quot;: &quot;Windows Azure Storage Client for Java Overview&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>We released the Storage Client for Java with support for Windows Azure Blobs, Queues, and Tables. Our goal is to continue to improve the development experience when writing cloud applications using Windows Azure Storage. This release is a Community Technology Preview (CTP) and will be supported by Microsoft. As such, we have incorporated feedback from customers and forums for the current .NET libraries to help create a more seamless API that is both powerful and simple to use. This blog post serves as an overview of the library and covers some of the implementation details that will be helpful to understand when developing cloud applications in Java. Additionally, we’ve provided two additional blog posts that cover some of the unique features and programming models for the <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-blob-features.aspx">blob</a> and <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-tables-deep-dive.aspx">table</a> service.</p>
<h4>Packages</h4>
<p>The Storage Client for Java is distributed in the Windows Azure SDK for Java jar (see below for locations). For the optimal development experience import the client sub package directly (com.microsoft.windowsazure.services.[blob|queue|table].<b>client</b>). This blog post refers to this client layer.</p>
<p>The relevant packages are broken up by service:</p>
<p><b>Common</b></p>
<p><b>com.microsoft.windowsazure.services.core.storage</b> – This package contains all storage primitives such as <i>CloudStorageAccount</i>, <i>StorageCredentials</i>, Retry Policies, etc.<b></b></p>
<p><b>Services</b></p>
<p><b>com.microsoft.windowsazure.services.blob.client</b> – This package contains all the functionality for working with the Windows Azure Blob service, including <i>CloudBlobClient</i>, <i>CloudBlob</i>, etc.</p>
<p><b>com.microsoft.windowsazure.services.queue.client</b> – This package contains all the functionality for working with the Windows Azure Queue service, including <i>CloudQueueClient</i>, <i>CloudQueue</i>, etc.</p>
<p><b>com.microsoft.windowsazure.services.table.client</b> – This package contains all the functionality for working with the Windows Azure Table service, including <i>CloudTableClient</i>, <i>TableServiceEntity</i>, etc.</p>
<h4>Services</h4>
<p>While this document describes the common concepts for all of the above packages, it’s worth briefly summarizing the capabilities of each client library. Blob and Table each have some interesting features that warrant further discussion. For those, we’ve provided additional blog posts linked below. The client API surface has been designed to be easy to use and approachable, however to accommodate more advanced scenarios we have provided optional extension points when necessary. </p>
<h5>Blob</h5>
<p>The Blob API supports all of the normal Blob Operations (upload, download, snapshot, set/get metadata, and list), as well as the normal container operations (create, delete, list blobs). However we have gone a step farther and also provided some additional conveniences such as Download Resume, Sparse Page Blob support, simplified MD5 scenarios, and simplified access conditions.</p>
<p>To better explain these unique features of the Blob API, we have published an additional <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-blob-features.aspx">blog post</a> which discusses these features in detail. You can also see additional samples in our article <a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/blob-storage/">How to Use the Blob Storage Service from Java</a>.</p>
<p><b>Sample – Upload a File to a Block Blob</b></p>
<pre class="code"><span style="color: green">// You will need these imports
</span>import com.microsoft.windowsazure.services.blob.client.CloudBlobClient;
import com.microsoft.windowsazure.services.blob.client.CloudBlobContainer;
import com.microsoft.windowsazure.services.blob.client.CloudBlockBlob;
import com.microsoft.windowsazure.services.core.storage.CloudStorageAccount;

<span style="color: green">// Initialize Account
</span>CloudStorageAccount account = CloudStorageAccount.parse([ACCOUNT_STRING]);

<span style="color: green">// Create the blob client
</span>CloudBlobClient blobClient = account.createCloudBlobClient();

<span style="color: green">// Retrieve reference to a previously created container
</span>CloudBlobContainer container = blobClient.getContainerReference(<span style="color: #a31515">&quot;mycontainer&quot;</span>);

<span style="color: green">// Create or overwrite the &quot;myimage.jpg&quot; blob with contents from a local
// file
</span>CloudBlockBlob blob = container.getBlockBlobReference(<span style="color: #a31515">&quot;myimage.jpg&quot;</span>);
File source = <span style="color: blue">new </span>File(<span style="color: #a31515">&quot;c:\\myimages\\myimage.jpg&quot;</span>);
blob.upload(<span style="color: blue">new </span>FileInputStream(source), source.length());</pre>
<p>(Note: It is best practice to always provide the length of the data being uploaded if it is available; alternatively a user may specify -1 if the length is not known)</p>
<h5>Table</h5>
<p>The Table API provides a minimal client surface that is incredibly simple to use but still exposes enough extension points to allow for more advanced “NoSQL” scenarios. These include built in support for POJO, HashMap based “property bag” entities, and projections. Additionally, we have provided optional extension points to allow clients to customize the serialization and deserialization of entities which will enable more advanced scenarios such as creating composite keys from various properties etc.</p>
<p>Due to some of the unique scenarios listed above the Table service has some requirements and capabilities that differ from the Blob and Queue services. To better explain these capabilities and to provide a more comprehensive overview of the Table API we have published an in depth <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-tables-deep-dive.aspx">blog post</a> which includes the overall design of Tables, the relevant best practices, and code samples for common scenarios. You can also see more samples in our article <a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/table-service/">How to Use the Table Storage Service from Java</a>.</p>
<p><b>Sample – Upload an Entity to a Table</b></p>
<pre class="code"><span style="color: green">// You will need these imports
</span>import com.microsoft.windowsazure.services.core.storage.CloudStorageAccount;
import com.microsoft.windowsazure.services.table.client.CloudTableClient;
import com.microsoft.windowsazure.services.table.client.TableOperation;

<span style="color: green">// Retrieve storage account from connection-string
</span>CloudStorageAccount storageAccount = CloudStorageAccount.parse([ACCOUNT_STRING]);

<span style="color: green">// Create the table client.
</span>CloudTableClient tableClient = storageAccount.createCloudTableClient();
         
<span style="color: green">// Create a new customer entity.
</span>CustomerEntity customer1 = <span style="color: blue">new </span>CustomerEntity(<span style="color: #a31515">&quot;Harp&quot;</span>, <span style="color: #a31515">&quot;Walter&quot;</span>);
customer1.setEmail(<span style="color: #a31515">&quot;Walter@contoso.com&quot;</span>);
customer1.setPhoneNumber(<span style="color: #a31515">&quot;425-555-0101&quot;</span>);

<span style="color: green">// Create an operation to add the new customer to the people table.
</span>TableOperation insertCustomer1 = TableOperation.insert(customer1);

<span style="color: green">// Submit the operation to the table service.
</span>tableClient.execute(<span style="color: #a31515">&quot;people&quot;</span>, insertCustomer1);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><b></b></p>
<h5>Queue<b></b></h5>
<p><b></b></p>
<p>The Queue API includes convenience methods for all of the functionality available through REST. Namely creating, modifying and deleting queues, adding, peeking, getting, deleting, and updating messages, and also getting the message count. Here is a sample of creating a queue and adding a message, and you can also read <a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/queue-service/">How to Use the Queue Storage Service from Java</a>.</p>
<p><b>Sample – Create a Queue and Add a Message to it</b></p>
<pre class="code"><span style="color: green">// You will need these imports
</span>import com.microsoft.windowsazure.services.core.storage.CloudStorageAccount;
import com.microsoft.windowsazure.services.queue.client.CloudQueue;
import com.microsoft.windowsazure.services.queue.client.CloudQueueClient;
import com.microsoft.windowsazure.services.queue.client.CloudQueueMessage;
<span style="color: green">// Retrieve storage account from connection-string
</span>CloudStorageAccount storageAccount = CloudStorageAccount.parse([ACCOUNT_STRING]);

<span style="color: green">// Create the queue client
</span>CloudQueueClient queueClient = storageAccount.createCloudQueueClient();

<span style="color: green">// Retrieve a reference to a queue
</span>CloudQueue queue = queueClient.getQueueReference(<span style="color: #a31515">&quot;myqueue&quot;</span>);

<span style="color: green">// Create the queue if it doesn't already exist
</span>queue.createIfNotExist();

<span style="color: green">// Create a message and add it to the queue
</span>CloudQueueMessage message = <span style="color: blue">new </span>CloudQueueMessage(<span style="color: #a31515">&quot;Hello, World&quot;</span>);
queue.addMessage(message);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>&#160;</p>
<h4>Design</h4>
<p>When designing the Storage Client for Java, we set up a series of design guidelines to follow throughout the development process. In order to reflect our commitment to the Java community working with Azure, we decided to design an entirely new library from the ground up that would feel familiar to Java developers. While the basic object model is somewhat similar to our .NET Storage Client Library there have been many improvements in functionality, consistency, and ease of use which will address the needs of both advanced users and those using the service for the first time.</p>
<p><b>Guidelines</b></p>
<ul>
<li><b>Convenient and performant – </b>This default implementation is simple to use, however we will always be able to support the performance-critical scenarios. For example, Blob upload APIs require a length of data for authentication purposes. If this is unknown a user may pass -1, and the library will calculate this on the fly. However, for performance critical applications it is best to pass in the correct number of bytes. <b></b></li>
<li><b>Users own their requests – </b>We have provided mechanisms that will allow users to determine the exact number of REST calls being made, the associated request ids, HTTP status codes, etc. (See <i>OperationContext</i> in the Object Model discussion below for more). We have also annotated every method that will potentially make a REST request to the service with the @DoesServiceRequest annotation. This all ensures that you, the developer, are able to easily understand and control the requests made by your application, even in scenarios like Retry, where the Java Storage Client library may make multiple calls before succeeding.<b></b></li>
<li>· <b>Look and feel – </b><b></b></li>
<ul>
<li>Naming is consistent. Logical antonyms are used for complimentary actions (i.e. upload and download, create and delete, acquire and release) <b></b></li>
<li>get/set prefixes follow Java conventions and are reserved for local client side “properties”<b></b></li>
<li>Minimal overloads per method. One with the minimum set of required parameters and one overload including all optional parameters which may be null. The one exception is listing methods have 2 minimum overloads to accommodate the common scenario of listing with prefix.<b></b></li>
</ul>
<li><b>Minimal API Surface – </b>In order to keep the API surface smaller we have reduced the number of extraneous helper methods. For example, Blob contains a single upload and download method that use Input / OutputStreams. If a user wishes to handle data in text or byte form, they can simply pass in the relevant stream.<b></b></li>
<li><b>Provide advanced features in a discoverable way –</b> In order to keep the core API simple and understandable advanced features are exposed via either the <i>RequestOptions </i>or optional parameters. <b></b></li>
<li><b>Consistent Exception Handling - </b>The library immediately will throw any exception encountered prior to making the request to the server. Any exception that occurs during the execution of the request will subsequently be wrapped inside a <i>StorageException</i>. </li>
<li><b>Consistency –</b> objects are consistent in their exposed API surface and functionality. For example a Blob, Container, or Queue all expose an <i>exists()</i> method </li>
</ul>
<h4>Object Model</h4>
<p>The Storage Client for Java uses local client side objects to interact with objects that reside on the server. There are additional features provided to help determine if an operation should execute, how it should execute, as well as provide information about what occurred when it was executed. (See Configuration and Execution below)</p>
<h5>Objects</h5>
<p><b>StorageAccount</b></p>
<p>The logical starting point is a <i>CloudStorageAccount</i> which contains the endpoint and credential information for a given storage account. This account then creates logical service clients for each appropriate service: <i>CloudBlobClient</i>, <i>CloudQueueClient</i>, and <i>CloudTableClient</i>. <i>CloudStorageAccount</i> also provides a static factory method to easily configure your application to use the local storage emulator that ships with the Windows Azure SDK.</p>
<p>A CloudStorageAccount can be created by parsing an account string which is in the format of: </p>
<pre class="code"><span style="color: #a31515">&quot;DefaultEndpointsProtocol=http[s];AccountName=&lt;account name&gt;;AccountKey=&lt;account key&gt;&quot;

</span></pre>
<p>Optionally, if you wish to specify a non-default DNS endpoint for a given service you may include one or more of the following in the connection string.</p>
<pre class="code">“BlobEndpoint=&lt;endpoint&gt;”, “QueueEndpoint=&lt;endpoint&gt;”, “TableEndpoint=&lt;endpoint&gt;”</pre>
<p><b>Sample – Creating a CloudStorageAccount from an account string</b></p>
<pre class="code"><span style="color: green">// Initialize Account
</span>CloudStorageAccount account = CloudStorageAccount.parse([ACCOUNT_STRING]);</pre>
<p><b>ServiceClients</b></p>
<p>Any service wide operation resides on the service client. Default configuration options such as timeout, retry policy, and other service specific settings that objects associated with the client will reference are stored here as well.</p>
<p>For example:</p>
<ul>
<li>To turn on <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-analytics.aspx">Storage Analytics</a> for the blob service a user would call <i>CloudBlobClient</i>.<i>uploadServiceProperties</i>(properties)</li>
<li>To list all queues a user would call <i>CloudQueueClient.listQueues</i>()</li>
<li>To set the default timeout to 30 seconds for objects associated with a given client a user would call Cloud[Blob|Queue|Table]Client.setTimeoutInMs(30 * 1000)</li>
</ul>
<p><b>Cloud Objects</b></p>
<p>Once a user has created a service client for the given service it’s time to start directly working with the Cloud Objects of that service. A CloudObject is a <i>CloudBlockBlob</i>, <i>CloudPageBlob</i>, <i>CloudBlobContainer</i>, and <i>CloudQueue</i>, each of which contains methods to interact with the resource it represents in the service. </p>
<p>Below are basic samples showing how to create a Blob Container, a Queue, and a Table. See the samples in the Services section for examples of how to interact with a CloudObjects.</p>
<p><b>Blobs</b></p>
<pre class="code"><span style="color: green">// Retrieve reference to a previously created container
</span>CloudBlobContainer container = blobClient.getContainerReference(<span style="color: #a31515">&quot;mycontainer&quot;</span>);

<span style="color: green">// Create the container if it doesn't already exist
</span>container.createIfNotExist()</pre>
<p><b>Queues</b></p>
<pre class="code"><span style="color: green">// Retrieve a reference to a queue
</span>CloudQueue queue = queueClient.getQueueReference(<span style="color: #a31515">&quot;myqueue&quot;</span>);

<span style="color: green">// Create the queue if it doesn't already exist
</span>queue.createIfNotExist();</pre>
<p><b>Tables</b></p>
<p>Note: You may notice that unlike blob and queue the table service does not use a CloudObject to represent an individual table, this is due to the unique nature of the table service which will is covered more in depth in the Tables deep dive <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/01/windows-azure-storage-client-for-java-tables-deep-dive.aspx">blog post</a>. Instead, table operations are performed via the CloudTableClient object:<b></b></p>
<pre class="code"><span style="color: green">// Create the table if it doesn't already exist
</span>tableClient.createTableIfNotExists(<span style="color: #a31515">&quot;people&quot;</span>);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p>&#160;</p>
<h5>Configuration and Execution</h5>
<p>In each maximum overload of each method provided in the library you will note there are two or three extra optional parameters provided depending on the service, all of which accept null to allow users to utilize just a subset of the features they require. For example to utilize only <i>RequestOptions </i>simply pass in null to <i>AccessCondition</i> and <i>OperationContext</i>. These objects for these optional parameters provide the user an easy way to determine if an operation should execute, how to execute it, and retrieve additional information about how it was executed when it completes.</p>
<p><b>AccessCondition</b></p>
<p>An <i>AccessCondition’s</i> primary purpose is to determine if an operation should execute, and is supported when using the Blob service. Specifically, <i>AccessCondition </i>encapsulates Blob leases as well as the If-Match, If-None-Match, If-Modified_Since, and the If-Unmodified-Since HTTP headers. An <i>AccessCondition</i> may be reused across operations as long as the given condition is still valid. For example, a user may only wish to delete a blob if it hasn’t been modified since last week. By using an <i>AccessCondition,</i> the library will send the HTTP &quot;If-Unmodified-Since&quot; header to the server which may not process the operation if the condition is not true. Additionally, blob leases can be specified through an <i>AccessCondition</i> so that only operations from users holding the appropriate lease on a blob may succeed.</p>
<p><i>AccessCondition</i> provides convenient static factory methods to generate an <i>AccessCondition</i> instance for the most common scenarios (IfMatch, IfNoneMatch, IfModifiedSince, IfNotModifiedSince, and Lease) however it is possible to utilize a combination of these by simply calling the appropriate setter on the condition you are using. </p>
<p>The following example illustrates how to use an <i>AccessCondition</i> to only upload the metadata on a blob if it is a specific version. </p>
<pre class="code">blob.uploadMetadata(AccessCondition.generateIfMatchCondition(currentETag), <span style="color: blue">null </span><span style="color: green">/* RequestOptions */</span>, <span style="color: blue">null</span><span style="color: green">/* OperationContext */</span>);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><b>Here are some Examples</b>:</p>
<pre class="code"><span style="color: green">//Perform Operation if the given resource is not a specified version:
</span>AccessCondition.generateIfNoneMatchCondition(eTag)

<span style="color: green">//Perform Operation if the given resource has been modified since a given date:
</span>AccessCondition. generateIfModifiedSinceConditionlastModifiedDate)

<span style="color: green">//Perform Operation if the given resource has not been modified since a given date:
</span>AccessCondition. generateIfNotModifiedSinceCondition(date)

<span style="color: green">//Perform Operation with the given lease id (Blobs only):
</span>AccessCondition. generateLeaseCondition(leaseID)

<span style="color: green">//Perform Operation with the given lease id if it has not been modified since a given date:
</span>AccessCondition condition = AccessCondition. generateLeaseCondition (leaseID);
condition. setIfUnmodifiedSinceDate(date);</pre>
<p><b>RequestOptions</b></p>
<p>Each Client defines a service specific RequestOptions (i.e. <i>BlobRequestOptions</i>, <i>QueueRequestOptions, </i>and <i>TableRequestOptions</i>) that can be used to modify the execution of a given request. All service request options provide the ability to specify a different timeout and retry policy for a given operation; however some services may provide additional options. For example the <i>BlobRequestOptions</i> includes an option to specify the concurrency to use when uploading a given blob. RequestOptions are not stateful and may be reused across operations. As such, it is common for applications to design RequestOptions for different types of workloads. For example an application may define a <i>BlobRequestOptions</i> for uploading large blobs concurrently, and a <i>BlobRequestOptions</i> with a smaller timeout when uploading metadata.</p>
<p>The following example illustrates how to use BlobRequestOptions to upload a blob using up to 8 concurrent operations with a timeout of 30 seconds each.</p>
<pre class="code">BlobRequestOptions options = <span style="color: blue">new </span>BlobRequestOptions();

<span style="color: green">// Set ConcurrentRequestCount to 8
</span>options.setConcurrentRequestCount(8);

<span style="color: green">// Set timeout to 30 seconds
</span>options.setTimeoutIntervalInMs(30 * 1000); 

blob.upload(<span style="color: blue">new </span>ByteArrayInputStream(buff),
     blobLength,
     <span style="color: blue">null </span><span style="color: green">/* AccessCondition */</span>,
     options,
     <span style="color: blue">null </span><span style="color: green">/* OperationContext */</span>);</pre>
<p><a href="http://11011.net/software/vspaste"></a></p>
<p><p><b></b></p>
<p><b></b></p>
<p>  <b>OperationContext</b></p>
<p>The <i>OperationContext</i> is used to provide relevant information about how a given operation executed. This object is by definition stateful and should not be reused across operations. Additionally the <i>OperationContext</i> defines an event handler that can be subscribed to in order to receive notifications when a response is received from the server. With this functionality, a user could start uploading a 100 GB blob and update a progress bar after every 4 MB block has been committed. </p>
<p>Perhaps the most powerful function of the <i>OperationContext</i> is to provide the ability for the user to inspect how an operation executed. For each REST request made against a server, the <i>OperationContext</i> stores a <i>RequestResult</i> object that contains relevant information such as the HTTP status code, the request ID from the service, start and stop date, etag, and a reference to any exception that may have occurred. This can be particularly helpful to determine if the retry policy was invoked and an operation took more than one attempt to succeed. Additionally, the Service Request ID and start/end times are useful when escalating an issue to Microsoft. </p>
<p>The following example illustrates how to use <i>OperationContext</i> to print out the HTTP status code of the last operation.</p>
<pre class="code">OperationContext opContext = <span style="color: blue">new </span>OperationContext();
queue.createIfNotExist(<span style="color: blue">null </span><span style="color: green">/* RequestOptions */</span>, opContext);
System.<span style="color: blue">out</span>.println(opContext.getLastResult().getStatusCode());</pre>
<p>&#160;</p>
<h4>Retry Policies</h4>
<p>Retry Policies have been engineered so that the policies can evaluate whether to retry on various HTTP status codes. Although the default policies will not retry 400 class status codes, a user can override this behavior by creating their own retry policy. Additionally, RetryPolicies are stateful per operation which allows greater flexibility in fine tuning the retry policy for a given scenario. </p>
<p>The Storage Client for Java ships with 3 standard retry policies which can be customized by the user. The default retry policy for all operations is an exponential backoff with up to 3 additional attempts as shown below:</p>
<pre class="code"><span style="color: blue">new </span>RetryExponentialRetry(  
    3000 <span style="color: green">/* minBackoff in milliseconds */</span>,
    30000 <span style="color: green">/* delatBackoff in milliseconds */</span>,
    90000 <span style="color: green">/* maxBackoff in milliseconds */</span>,
    3 <span style="color: green">/* maxAttempts */</span>);</pre>
<p>With the above default policy, the retry will approximately occur after: 3,000ms, 35,691ms and 90,000ms</p>
<p>If the number of attempts should be increased, one can use the following:</p>
<pre class="code"><span style="color: blue">new </span>RetryExponentialRetry(  
    3000 <span style="color: green">/* minBackoff in milliseconds */</span>,
    30000 <span style="color: green">/* delatBackoff in milliseconds */</span>,
    90000 <span style="color: green">/* maxBackoff in milliseconds */</span>,
    6 <span style="color: green">/* maxAttempts */</span>);</pre>
<p>With the above policy, the retry will approximately occur after: 3,000ms, 28,442ms and 80,000ms, 90,000ms, 90,000ms and 90,000ms.</p>
<p>NOTE: the time provided is an approximation because the exponential policy introduces a +/-20% random delta as described below. </p>
<p><b>NoRetry - </b>Operations will not be retried</p>
<p><b>LinearRetry</b> - Represents a retry policy that performs a specified number of retries, using a specified fixed time interval between retries.</p>
<p><b>ExponentialRetry (default) </b>- Represents a retry policy that performs a specified number of retries, using a randomized exponential backoff scheme to determine the interval between retries. This policy introduces a +/- %20 random delta to even out traffic in the case of throttling.</p>
<p>A user can configure the retry policy for all operations directly on a service client, or specify one in the RequestOptions for a specific method call. The following illustrates how to configure a client to use a linear retry with a 3 second backoff between attempts and a maximum of 3 additional attempts for a given operation.<b></b></p>
<pre class="code">serviceClient.setRetryPolicyFactory(<span style="color: blue">new </span>RetryLinearRetry(3000,3));</pre>
<p>Or</p>
<pre class="code">TableRequestOptions options = <span style="color: blue">new </span>TableRequestOptions();
options.setRetryPolicyFactory(<span style="color: blue">new </span>RetryLinearRetry(3000, 3));</pre>
<p><b>Custom Policies</b></p>
<p>There are two aspects of a retry policy, the policy itself and an associated factory. To implement a custom interface a user must derive from the abstract base class <i>RetryPolicy</i> and implement the relevant methods. Additionally, an associated factory class must be provided that implements the <i>RetryPolicyFactory</i> interface to generate unique instances for each logical operation. For simplicities sake the policies mentioned above implement the <i>RetryPolicyFactory </i>interface themselves, however it is possible to use two separate classes </p>
<h4>Note about .NET Storage Client</h4>
<p>During the development of the Java library we have identified many substantial improvements in the way our API can work. We are committed to bringing these improvements back to .NET while keeping in mind that many clients have built and deployed applications on the current API, so stay tuned.</p>
<h4>Summary</h4>
<p>We have put a lot of work into providing a truly first class development experience for the Java community to work with Windows Azure Storage. We very much appreciate all the feedback we have gotten from customers and through the forums, please keep it coming. Feel free to leave comments below,</p>
<p>Joe Giardino<br/>
  <br/>Developer</p>
<p>Windows Azure Storage</p>
<h4>Resources</h4>
<p><b>Get the Windows Azure SDK for Java</b></p>
<ul>
<li><a href="http://go.microsoft.com/fwlink/?LinkID=234491&amp;clcid=0x409">Download the Windows Azure SDK for Java</a></li>
<li><a href="https://github.com/WindowsAzure/azure-sdk-for-java">Windows Azure SDK for Java source code on GitHub</a></li>
</ul>
<p><b>Learn more about the Windows Azure Storage Client for Java</b></p>
<ul>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-tables-deep-dive.aspx">Windows Azure Storage Client for Java Tables Deep Dive</a></li>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/03/05/windows-azure-storage-client-for-java-blob-features.aspx">Windows Azure Storage Client for Java Blob Features</a><a name="_GoBack"></a></li>
<li><a href="http://code.msdn.microsoft.com/windowsazure/Windows-Azure-SDK-for-Java-bb556c0a">Windows Azure Storage Client for Java Storage Samples</a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/blob-storage/">How to Use the Blob Storage Service from Java</a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/queue-service/">How to Use the Queue Storage Service from Java</a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/how-to-guides/table-service/">How to Use the Table Storage Service from Java</a></li>
<li><a href="http://www.windowsazure.com/en-us/develop/java/">Windows Azure SDK for Java Developer Center</a></li>
</ul>
<p><b>Learn more about Windows Azure Storage</b></p>
<ul>
<li><a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2010/05/10/windows-azure-storage-abstractions-and-their-scalability-targets.aspx">Windows Azure Storage Abstractions and their Scalability Targets</a><b></b></li>
<li><a href="http://social.msdn.microsoft.com/Forums/en-US/windowsazuredata/threads">Windows Azure Storage, CDN, and Caching Forum</a></li>
</ul>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/releases/" rel="tag">Releases</a> <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-storage-client-library/" rel="tag">Windows Azure Storage Client Library</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (0)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2012/03/05/windows-azure-storage-client-for-java-overview/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2012%2F03%2F05%2Fwindows-azure-storage-client-for-java-overview%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->