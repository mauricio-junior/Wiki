---
layout: windowsazurestorage
title: Announcing Storage Client Library 2.1 RTM & CTP for Windows Phone
weight: 3
---

<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-137" class="post-137 post type-post status-publish format-standard hentry category-uncategorized tag-windows-azure-storage-client-library">

	<header class="entry-header single">
		<h1 class="entry-title">Announcing Storage Client Library 2.1 RTM &amp; CTP for Windows Phone</h1>		<div class="rating-wrap">
		<div id="star-rating-137" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="137" data-container="body" data-toggle="tooltip" title="2 user(s) rated">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div aria-label="Select 5 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="5"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span><span aria-hidden="true" class="star-5"><span>&#x2605;</span></span></div><div aria-label="Select 4 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="4"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span><span aria-hidden="true" class="star-4"><span>&#x2605;</span></span></div><div aria-label="Select 3 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="3"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span><span aria-hidden="true" class="star-3"><span>&#x2605;</span></span></div><div aria-label="Select 2 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="2"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span><span aria-hidden="true" class="star-2"><span>&#x2605;</span></span></div><div aria-label="Select 1 star, this article is 5 star rated" tabindex="0" class="wds-ratings-stars wds-ratings-stars-enable-editing" data-stars="1"><span aria-hidden="true" class="star-1"><span>&#x2605;</span></span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<img alt="avatar of windows-azure-storage" src="https://i1.social.s-msft.com/profile/u/avatar.jpg?displayname=Windows+Azure+Storage&amp;size=extralarge&amp;version=00000000-0000-0000-0000-000000000000" class="avatar avatar-22 photo" height="22" width="22"/><span class="byline"><span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="59e1aedafa2d4428b7004b2c2fac4adc" href="https://social.msdn.microsoft.com/profile/Windows+Azure+Storage">Windows Azure Storage</a></span></span><span class="posted-on posted-on-margin"><span class="screen-reader-text"></span><time class="entry-date published updated" datetime="2013-09-06T17:01:00+00:00">September 6, 2013</time></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comments">10</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li><div class="fb-share-button" data-href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/&amp;src=sdkpreparse">Share</a></div></li>
			<div id="fb-root" style="display:none"></div>

			<li class="social-icon twitter"><a data-social="{&quot;type&quot;:&quot;twitter&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/&quot;, &quot;text&quot;: &quot;Announcing Storage Client Library 2.1 RTM &amp; CTP for Windows Phone&quot;}" href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social="{&quot;type&quot;:&quot;linkedin&quot;, &quot;url&quot;:&quot;https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/&quot;, &quot;text&quot;: &quot;Announcing Storage Client Library 2.1 RTM &amp; CTP for Windows Phone&quot;}" href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		jQuery( window ).load(function () {
			jQuery.getScript('https://blogs.msdn.microsoft.com/windowsazurestorage/wp-content/themes/microsoft/js/social-counts.js?ver=02092017')
				.done(function(script,textStatus) {
					window.msdnsocial.ajax('https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/');
				});
		});
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p>We are pleased to announce that the storage client for .NET 2.1 has RTM’d. This release includes several notable features such as Async Task methods, IQueryable for Tables, buffer pooling support, and much more. In addition we are releasing the CTP of the storage client for Windows Phone 8. With the existing support for Windows Runtime clients can now leverage Windows Azure Storage via a consistent API surface across multiple windows platforms. As usual all of the source code is available via github (see resources section below). You can download the latest binaries via the following nuget Packages:</p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage/2.1.0.0">Nuget – 2.1 RTM</a></p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage-Preview">Nuget – 2.1 For Windows Phone and Windows RunTime (Preview)</a></p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage.Table-Preview">Nuget – 2.1 Tables Extension library for Non-JavaScript Windows RunTime apps (Preview)</a></p>
<p>This remainder of this blog will cover some of the new features and scenarios in additional detail and provide supporting code samples. As always we appreciate your feedback, so please feel free to add comments below.</p>
<h4>Fundamentals</h4>
<p>For this release we focused heavily on fundamentals by dramatically expanding test coverage, and building an automated performance suite that let us benchmark performance behaviors across various high scale scenarios.</p>
<p>Here are a few highlights for the 2.1 release:</p>
<ul>
<li>Over 1000 publicly available Unit tests covering every public API</li>
<li>Automated Performance testing to validate performance impacting changes</li>
<li>Expanded Stress testing to ensure data correctness under massive loads</li>
<li>Key performance improving features that target memory behavior and shared infrastructure (more details below)</li>
</ul>
<h4>Performance</h4>
<p>We are always looking for ways to improve the performance of client applications by improving the storage client itself and by exposing new features that better allow clients to optimize their applications. In this release we have done both and the results are dramatic.</p>
<p>For example, below are the results from one of the test scenarios we execute where a single XL VM round trips 30 256MB Blobs simultaneously (7.5 GB in total). As you can see there are dramatic improvements in both latency and CPU usage compared to SDK 1.7 (CPU drops almost 40% while latency is reduced by 16.5% for uploads and 23.2% for downloads). Additionally, you may note the actual latency improvements between 2.0.5.1 and 2.1 are only a few percentage points. This is because we have successfully removed the client out of the critical path resulting in an application that is now entirely dependent on the network. Further, while we have improved performance in this scenario CPU usage has dropped another 13% on average compared to SDK 2.0.5.1.</p>
<p>&#160;</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/6136.perf_38A6583C.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/6136.perf_5F00_38A6583C.png"><img title="perf" style="display: inline; background-image: none;" border="0" alt="perf" src="https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/36/55/metablogapi/8524.perf_thumb_4D2BA7BA.png" original-url="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-36-55-metablogapi/8524.perf_5F00_thumb_5F00_4D2BA7BA.png" width="457" height="317"/></a></p>
<p>This is just one example of the performance improvements we have made, for more on performance as well as best practices please see the Tech Ed Presentation in the Resources section below.</p>
<h4>Async Task Methods</h4>
<p>Each public API now exposes an Async method that returns a task for a given operation. Additionally, these methods support pre-emptive cancellation via an overload which accepts a <em>CancellationToken</em>. If you are running under .NET 4.5, or using the Async Targeting Pack for .NET 4.0, you can easily leverage the async / await pattern when writing your applications against storage.</p>
<h4>Buffer Pooling</h4>
<p>For high scale applications, Buffer Pooling is a great strategy to allow clients to re-use existing buffers across many operations. In a managed environment such as .NET, this can dramatically reduce the number of cycles spent allocating and subsequently garbage collecting semi-long lived buffers.</p>
<p>To address this scenario each Service Client now exposes a <em>BufferManager</em> property of type <em>IBufferManager</em>. This property will allow clients to leverage a given buffer pool with any associated objects to that service client instance. For example, all <em>CloudTable</em> objects created via <em>CloudTableClient.GetTableReference()</em> would make use of the associated service clients <em>BufferManager</em>. The <em>IBufferManager</em> is patterned after the <a href="http://msdn.microsoft.com/en-us/library/system.servicemodel.channels.buffermanager.aspx"><em>BufferManager</em></a> in System.ServiceModel.dll to allow desktop clients to easily leverage an existing implementation provided by the framework. (Clients running on other platforms such as Windows Runtime or Windows Phone may implement a pool against the <em>IBufferManager</em> interface)</p>
<p>For desktop applications to leverage the built in BufferManager provided by the System.ServiceModel.dll a simple adapter is required:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">using</span> Microsoft.WindowsAzure.Storage;<br/><span style="color: rgb(0, 0, 255);">using</span> System.ServiceModel.Channels;<br/><br/><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">class</span> WCFBufferManagerAdapter : IBufferManager<br/>{<br/>   <span style="color: rgb(0, 0, 255);">private</span> <span style="color: rgb(0, 0, 255);">int</span> defaultBufferSize = 0;<br/><br/>   <span style="color: rgb(0, 0, 255);">public</span> WCFBufferManagerAdapter(BufferManager manager, <span style="color: rgb(0, 0, 255);">int</span> defaultBufferSize)<br/>   {<br/>       <span style="color: rgb(0, 0, 255);">this</span>.Manager = manager;<br/>       <span style="color: rgb(0, 0, 255);">this</span>.defaultBufferSize = defaultBufferSize;<br/>   }<br/><br/>   <span style="color: rgb(0, 0, 255);">public</span> BufferManager Manager { get; <span style="color: rgb(0, 0, 255);">internal</span> set; }<br/><br/>   <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">void</span> ReturnBuffer(<span style="color: rgb(0, 0, 255);">byte</span>[] buffer)<br/>   {<br/>       <span style="color: rgb(0, 0, 255);">this</span>.Manager.ReturnBuffer(buffer);<br/>   }<br/><br/>   <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">byte</span>[] TakeBuffer(<span style="color: rgb(0, 0, 255);">int</span> bufferSize)<br/>   {<br/>       <span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(0, 0, 255);">this</span>.Manager.TakeBuffer(bufferSize);<br/>   }<br/><br/>   <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">int</span> GetDefaultBufferSize()<br/>   {<br/>       <span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(0, 0, 255);">this</span>.defaultBufferSize;<br/>   }<br/>}</pre>
</div>
<p>With this in place my application can now specify a shared buffer pool across any resource associated with a given service client by simply setting the BufferManager property.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">BufferManager mgr = BufferManager.CreateBufferManager([MaxBufferPoolSize], [MaxBufferSize]);<br/><br/>serviceClient.BufferManager = <span style="color: rgb(0, 0, 255);">new</span> WCFBufferManagerAdapter(mgr, [MaxBufferSize]);</pre>
</div>
<h4>Multi-Buffer Memory Stream</h4>
<p>During the course of our performance investigations we have uncovered a few performance issues with the <em>MemoryStream</em> class provided in the BCL (specifically regarding Async operations, dynamic length behavior, and single byte operations). To address these issues we have implemented a new Multi-Buffer memory stream which provides consistent performance even when length of data is unknown. This class leverages the <em>IBufferManager</em> if one is provided by the client to utilize the buffer pool when allocating additional buffers. As a result, any operation on any service that potentially buffers data (Blob Streams, Table Operations, etc.) now consumes less CPU, and optimally uses a shared memory pool.</p>
<h4>.NET MD5 is now default</h4>
<p>Our performance testing highlighted a slight performance degradation when utilizing the FISMA compliant native MD5 implementation compared to the built in .NET implementation. As such, for this release the .NET MD5 is now used by default, any clients requiring FISMA compliance can re-enable it as shown below:</p>
<p>CloudStorageAccount.UseV1MD5 = false;</p>
<h4>New Range Based Overloads</h4>
<p>In 2.1 Blob upload API’s include an overload which allows clients to only upload a given range of the byte array or stream to the blob. This feature allows clients to avoid potentially pre-buffering data prior to uploading it to the storage service. Additionally, there are new download range API’s for both streams and byte arrays that allow efficient fault tolerant range downloads without the need to buffer any data on the client side.</p>
<h4>Client Tracing</h4>
<p>The 2.1 release implements .NET Tracing, allowing users to enable log information regarding request execution and REST requests (See below for a table of what information is logged). Additionally, Windows Azure Diagnostics provides a trace listener that can redirect client trace messages to the WADLogsTable if users wish to persist these traces to the cloud.</p>
<h5>Logged Data</h5>
<p>Each log line will include the following data:</p>
<ul>
<li>Client Request ID: Per request ID that is specified by the user in OperationContext</li>
<li>Event: Free-form text</li>
</ul>
<p>As part of each request the following data will be logged to make it easier to correlate client-side logs to server-side logs:</p>
<ul>
<li>Request:</li>
<li>Request Uri</li>
<li>Response:</li>
<li>Request ID</li>
<li>
<div align="justify">HTTP status code</div>
</li>
</ul>
<h4>Trace Levels</h4>
<table style="width: 899px;" cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td valign="top" width="110">
<p><strong>Level</strong></p>
</td>
<td valign="top" width="787">
<p align="justify"><strong>Events</strong></p>
</td>
</tr>
<tr>
<td valign="top" width="110">
<p><strong>Off</strong></p>
</td>
<td valign="top" width="787">
<p>Nothing will be logged.</p>
</td>
</tr>
<tr>
<td valign="top" width="110">
<p><strong>Error</strong></p>
</td>
<td valign="top" width="787">
<p>If an exception cannot or will not be handled internally and will be thrown to the user; it will be logged as an error.</p>
</td>
</tr>
<tr>
<td valign="top" width="110">
<p><strong>Warning</strong></p>
</td>
<td valign="top" width="787">
<p>If an exception is caught and handled internally, it will be logged as a warning. Primary use case for this is the retry scenario, where an exception is not thrown back to the user to be able to retry. It can also happen in operations such as CreateIfNotExists, where we handle the 404 error silently.</p>
</td>
</tr>
<tr>
<td valign="top" width="110">
<p><strong>Informational</strong></p>
</td>
<td valign="top" width="787">
<p>The following info will be logged:</p>
<ul>
<li>Right after the user calls a method to start an operation, request details such as URI and client request ID will be logged.</li>
<li>Important milestones such as Sending Request Start/End, Upload Data Start/End, Receive Response Start/End, Download Data Start/End will be logged to mark the timestamps.</li>
<li>Right after the headers are received, response details such as request ID and HTTP status code will be logged.</li>
<li>If an operation fails and the storage client decides to retry, the reason for that decision will be logged along with when the next retry is going to happen.</li>
<li>All client-side timeouts will be logged when storage client decides to abort a pending request.</li>
</ul>
</td>
</tr>
<tr>
<td valign="top" width="110">
<p><strong>Verbose</strong></p>
</td>
<td valign="top" width="787">
<p>Following info will be logged:</p>
<ul>
<li>String-to-sign for each request</li>
<li>Any extra details specific to operations (this is up to each operation to define and use)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h4>
  <br/><span>Enabling Tracing</span></h4>
<p>A key concept is the opt-in / opt-out model that the client provides to tracing. In typical applications it is customary to enable tracing at a given verbosity for a specific class. This works fine for many client applications, however for cloud applications that are executing at scale this approach may generate much more data than what is required by the user. As such we have provided the ability for clients to work in either an opt-in model for tracing which allows clients to configure listeners at a given verbosity, but only log specific requests if and when they choose. Essentially this design provides the ability for users to perform “vertical” logging across layers of the stack targeted at specific requests rather than “horizontal” logging which would record all traffic seen by a specific class or layer.</p>
<p>To enable tracing in .NET you must add a trace source for the storage client to the app.config and set the verbosity:</p>
<div id="codeSnippetWrapper">
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">system.diagnostics</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>  <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">sources</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">source</span> <span style="color: rgb(255, 0, 0);">name</span><span style="color: rgb(0, 0, 255);">=&quot;Microsoft.WindowsAzure.Storage&quot;</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>      <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">listeners</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>        <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">add</span> <span style="color: rgb(255, 0, 0);">name</span><span style="color: rgb(0, 0, 255);">=&quot;myListener&quot;</span><span style="color: rgb(0, 0, 255);">/&gt;</span><br/>      <span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">listeners</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">source</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>  <span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">sources</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>  <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">switches</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">add</span> <span style="color: rgb(255, 0, 0);">name</span><span style="color: rgb(0, 0, 255);">=&quot;Microsoft.WindowsAzure.Storage&quot;</span> <span style="color: rgb(255, 0, 0);">value</span><span style="color: rgb(0, 0, 255);">=&quot;Verbose&quot;</span> <span style="color: rgb(0, 0, 255);">/&gt;</span><br/>  <span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">switches</span><span style="color: rgb(0, 0, 255);">&gt;</span>    <br/>  …</pre>
</p></div>
<p>Then add a listener to record the output; in this case we will simply record it to application.log</div>
<div>&#160;</div>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">sharedListeners</span><span style="color: rgb(0, 0, 255);">&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(128, 0, 0);">add</span> <span style="color: rgb(255, 0, 0);">name</span><span style="color: rgb(0, 0, 255);">=&quot;myListener&quot;</span> <br/>      <span style="color: rgb(255, 0, 0);">type</span><span style="color: rgb(0, 0, 255);">=&quot;System.Diagnostics.TextWriterTraceListener&quot;</span> <br/>      <span style="color: rgb(255, 0, 0);">initializeData</span><span style="color: rgb(0, 0, 255);">=&quot;application.log&quot;</span><span style="color: rgb(0, 0, 255);">/&gt;</span><br/><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(128, 0, 0);">sharedListeners</span><span style="color: rgb(0, 0, 255);">&gt;</span></pre>
<p>The application is now set to log all trace messages created by the storage client up to the Verbose level. However, if a client wishes to enable logging only for specific clients or requests they can further configure the default logging level in their application by setting <em>OperationContext.DefaultLogLevel</em> and then opt-in any specific requests via the OperationContext object:</div>
<div>&#160;</div>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 128, 0);">// Disable Default Logging</span><br/>OperationContext.DefaultLogLevel = LogLevel.Off;<br/><br/><span style="color: rgb(0, 128, 0);">// Configure a context to track my upload and set logging level to verbose</span><br/>OperationContext myContext = <span style="color: rgb(0, 0, 255);">new</span> OperationContext() { LogLevel = LogLevel.Verbose };<br/>blobRef.UploadFromStream(stream, myContext);</pre>
</div>
<p>With client side tracing used in conjunction with <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx">storage logging</a> clients can now get a complete view of their application from both the client and server perspectives.</p>
<h4>Blob Features</h4>
<h5>Blob Streams</h5>
<p>In the 2.1 release, we improved blob streams that are created by OpenRead and OpenWrite APIs of CloudBlockBlob and CloudPageBlob. The write stream returned by OpenWrite can now upload much faster when the parallel upload functionality is enabled by keeping number of active writers at a certain level. Moreover, the return type is changed from a Stream to a new type named CloudBlobStream, which is derived from Stream. CloudBlobStream offers the following new APIs:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">abstract</span> ICancellableAsyncResult BeginCommit(AsyncCallback callback, <span style="color: rgb(0, 0, 255);">object</span> state);<br/><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">abstract</span> ICancellableAsyncResult BeginFlush(AsyncCallback callback, <span style="color: rgb(0, 0, 255);">object</span> state);<br/><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">abstract</span> <span style="color: rgb(0, 0, 255);">void</span> Commit();<br/><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">abstract</span> <span style="color: rgb(0, 0, 255);">void</span> EndCommit(IAsyncResult asyncResult);<br/><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">abstract</span> <span style="color: rgb(0, 0, 255);">void</span> EndFlush(IAsyncResult asyncResult);</pre>
</div>
<p>Flush already exists in Stream itself, so CloudBlobStream only adds asynchronous version. However, Commit is a completely new API that now allows the caller to commit before disposing the Stream. This allows much easier exception handling during commit and also the ability to commit asynchronously.</p>
<p>The read stream returned by OpenRead does not have a new type, but it now has true synchronous and asynchronous implementations. Clients can now get the stream synchronously via OpenRead or asynchronously using [Begin|End]OpenRead. Moreover, after the stream is opened, all synchronous calls such as querying the length or the Read API itself are truly synchronous, meaning that they do not call any asynchronous APIs internally.</p>
<h4>Table Features</h4>
<h5>IgnorePropertyAttribute</h5>
<p>When persisting POCO objects to Windows Azure Tables in some cases clients may wish to omit certain client only properties. In this release we are introducing the <em>IgnorePropertyAttribute</em> to allow clients an easy way to simply ignore a given property during serialization and de-serialization of an entity. The following snippet illustrates how to ignore my FirstName property of my entity via the <em>IgnorePropertyAttribute:</em></p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">class</span> Customer : TableEntity<br/>{<br/>   [IgnoreProperty]<br/>   <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">string</span> FirstName { get; set; }<br/>}</pre>
</div>
<h5>Compiled Serializers</h5>
<p>When working with POCO types previous releases of the SDK relied on reflection to discover all applicable properties for serialization / de-serialization at runtime. This process was both repetitive and expensive computationally. In 2.1 we are introducing support for Compiled Expressions which will allow the client to dynamically generate a LINQ expression at runtime for a given type. This allows the client to do the reflection process once and then compile a Lambda at runtime which can now handle all future read and writes of a given entity type. In performance micro-benchmarks this approach is roughly 40x faster than the reflection based approach computationally.</p>
<p>All compiled expressions for read and write are held in a static concurrent dictionaries on <em>TableEntity</em>. If you wish to disable this feature simply set <em>TableEntity.DisableCompiledSerializers</em> = true;</p>
<h5>Serialize 3<sup>rd</sup> Party Objects</h5>
<p>In some cases clients wish to serialize objects in which they do not control the source, for example framework objects or objects form 3<sup>rd</sup> party libraries. In previous releases clients were required to write custom serialization logic for each type they wished to serialize. In the 2.1 release we are exposing the core serialization and de-serialization logic for any CLR type. This allows clients to easily persist and read back entities objects for types that do not derive from <em>TableEntity</em> or implement the <em>ITableEntity</em> interface. This pattern can also be especially useful when exposing DTO types via a service as the client will longer be required to maintain two entity types and marshal between them.</p>
<p>A general purpose adapter pattern can be used which will allow clients to simply wrap an object instance in generic adapter which will handle serialization for a given type. The example below illustrates this pattern:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);"><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">class</span> EntityAdapter&lt;T&gt; : ITableEntity <span style="color: rgb(0, 0, 255);">where</span> T : <span style="color: rgb(0, 0, 255);">new</span>()<br/>{        <br/>    <span style="color: rgb(0, 0, 255);">public</span> EntityAdapter()<br/>    {<br/>        <span style="color: rgb(0, 128, 0);">// If you would like to work with objects that do not have a default Ctor you can use (T)Activator.CreateInstance(typeof(T));</span><br/>        <span style="color: rgb(0, 0, 255);">this</span>.InnerObject = <span style="color: rgb(0, 0, 255);">new</span> T();<br/>    }<br/><br/>    <span style="color: rgb(0, 0, 255);">public</span> EntityAdapter(T innerObject)<br/>    {<br/>        <span style="color: rgb(0, 0, 255);">this</span>.InnerObject = innerObject;<br/>    }<br/><br/>    <span style="color: rgb(0, 0, 255);">public</span> T InnerObject { get; set; }<br/><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// Gets or sets the entity's partition key.</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;/summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;value&gt;The partition key of the entity.&lt;/value&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">string</span> PartitionKey { [TODO: Must implement logic to map PartitionKey to <span style="color: rgb(0, 0, 255);">object</span> here!] get; set; } <br/><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// Gets or sets the entity's row key.</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;/summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;value&gt;The row key of the entity.&lt;/value&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">string</span> RowKey {[TODO: Must implement logic to map RowKey to <span style="color: rgb(0, 0, 255);">object</span> here!] get; set; }<br/><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// Gets or sets the entity's timestamp.</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;/summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;value&gt;The timestamp of the entity.&lt;/value&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">public</span> DateTimeOffset Timestamp { get; set; }<br/><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// Gets or sets the entity's current ETag. Set this value to '*' in order to blindly overwrite an entity as part of an update operation.</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;/summary&gt;</span><br/>    <span style="color: rgb(0, 128, 0);">/// &lt;value&gt;The ETag of the entity.&lt;/value&gt;</span><br/>    <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">string</span> ETag { get; set; }<br/><br/>    <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">virtual</span> <span style="color: rgb(0, 0, 255);">void</span> ReadEntity(IDictionary&lt;<span style="color: rgb(0, 0, 255);">string</span>, EntityProperty&gt; properties, OperationContext operationContext)<br/>    {<br/>       TableEntity.ReadUserObject(<span style="color: rgb(0, 0, 255);">this</span>.InnerObject, properties, operationContext);<br/>    }<br/><br/>    <span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">virtual</span> IDictionary&lt;<span style="color: rgb(0, 0, 255);">string</span>, EntityProperty&gt; WriteEntity(OperationContext operationContext)<br/>    {<br/>       <span style="color: rgb(0, 0, 255);">return</span> TableEntity.WriteUserObject(<span style="color: rgb(0, 0, 255);">this</span>.InnerObject, operationContext);<br/>    }<br/> }</pre>
<p>The following example uses the EntityAdapter pattern to insert a DTO object directly to the table via the adapter:</div>
<div>&#160;</div>
<div>
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">table.Execute(TableOperation.Insert(<span style="color: rgb(0, 0, 255);">new</span> EntityAdapter&lt;CustomerDTO&gt;(customer)));</pre>
</div>
<div>&#160;</div>
<div>Further I can retrieve this entity back via:</div>
<div>&#160;</div>
<div>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">testTable.Execute(TableOperation.Retrieve&lt;EntityAdapter&lt;CustomerDTO&gt;&gt;(pk, rk)).Result;</pre>
<p>Note, the Compiled Serializer functionality will be utilized for any types serialized or deserialized via <em>TableEntity.[Read|Write]UserObject.</em></div>
<h5>Table IQueryable</h5>
<p>In 2.1 we are adding <em>IQueryable</em> support for the Table Service layer on desktop and phone. This will allow users to construct and execute queries via LINQ similar to WCF Data Services, however this implementation has been specifically optimized for Windows Azure Tables and NoSQL concepts. The snippet below illustrates constructing a query via the new <em>IQueryable</em> implementation:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">var query = from ent <span style="color: rgb(0, 0, 255);">in</span> currentTable.CreateQuery&lt;CustomerEntity&gt;()<br/>            <span style="color: rgb(0, 0, 255);">where</span> ent.PartitionKey == “users” &amp;&amp; ent.RowKey = “joe”<br/>            select ent;</pre>
<p>The <em>IQueryable </em>implementation transparently handles continuations, and has support to add <em>RequestOptions</em>, <em>OperationContext</em>, and client side <em>EntityResolvers</em> directly into the expression tree. Additionally, since this makes use of existing infrastructure optimizations such as <em>IBufferManager</em>, Compiled Serializers, and Logging are fully supported.</div>
<p>Note, to support <em>IQueryable</em> projections the type constraint on <em>TableQuery</em> of <em>ITableEntity, new()</em> has been removed. Instead, any <em>TableQuery</em> objects not created via the new <em>CloudTable.CreateQuery&lt;T&gt;()</em> method will enforce this constraint at runtime.</p>
<h4>Conceptual model</h4>
<p>We are committed to backwards compatibility, as such we strive to make sure we introduce as few breaking changes as possible for existing clients. Therefore, in addition to supporting the new <em>IQueryable</em> mode of execution, we continue to support the 2.x “fluent” mode of constructing queries via the Where, Select, and Take methods. However, these modes are not strictly interoperable while constructing queries as they store data in different forms.</p>
<p>Aside from query construction, a key difference between the two modes is that the <em>IQueryable</em> interface requires that the query object be able to execute itself, as compared to the previous model of executing queries via a <em>CloudTable</em> object. A brief summary of these two modes of execution is listed below:</p>
<p><strong>Fluent Mode (2.0.x)</strong></p>
<ul>
<li>Queries are created by directly calling a constructor</li>
<li>Queries are executed against a CloudTable object via ExecuteQuery[Segmented] methods</li>
<li>EntityResolver specified in execute overload</li>
<li>Fluent methods Where, Select, and Take are provided</li>
</ul>
<p><strong>IQueryable Mode (2.1+)</strong></p>
<ul>
<li>Queries are created by an associated table, i.e. CloudTable.CreateQuery&lt;T&gt;()</li>
<li>Queries are executed by enumerating the results, or by Execute[Segmented] methods on TableQuery</li>
<li>EntityResolver specified via LINQ extension method Resolve</li>
<li>IQueryable Extension Methods provided : WithOptions, WithContext, Resolve, AsTableQuery</li>
</ul>
<p>The table below illustrates various scenarios between the two modes</p>
</div>
<table style="width: 1400px;" cellspacing="0" cellpadding="0" border="1">
<tbody>
<tr>
<td valign="top" width="83">&#160;</td>
<td valign="top" width="600">
<p><strong>Fluent Mode</strong></p>
</td>
<td valign="top" width="600">
<p><strong>IQueryable Mode</strong></p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Construct Query</strong></p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; stringQuery = new TableQuery&lt;ComplexEntity&gt;()</p>
</td>
<td valign="top" width="650">
<p>TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Filter</strong></p>
</td>
<td valign="top" width="600">
<p>q.Where(TableQuery.GenerateFilterCondition(&quot;val&quot;,QueryComparisons.GreaterThanOrEqual, 50));</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; query =(from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; where ent.val &gt;= 50select ent);</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Take</strong></p>
</td>
<td valign="top" width="600">
<p>q.Take(5);</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt;&#160; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select ent).<strong>Take(5);</strong></p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Projection</strong></p>
</td>
<td valign="top" width="600">
<p>q.Select(new List&lt;string&gt;() { &quot;A&quot;, &quot;C&quot; })</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ProjectedEntity&gt;&#160; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select new ProjectedEntity(){a = ent.a,b = ent.b,c = ent.c…});</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Entity Resolver</strong></p>
</td>
<td valign="top" width="600">
<p>currentTable.ExecuteQuery(query, resolver)</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select ent).Resolve(resolver);</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Execution </strong><strong></strong></p>
</td>
<td valign="top" width="600">
<p>currentTable.ExecuteQuery(query)</p>
</td>
<td valign="top" width="600">
<p>foreach (ProjectedPOCO ent in query)</p>
<p><strong>&lt; OR &gt; </strong></p>
<p>query.AsTableQuery().Execute(options, opContext)</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Execution Segmented</strong></p>
</td>
<td valign="top" width="600">
<p>TableQuerySegment&lt;Entity&gt; seg = currentTable.ExecuteQuerySegmented(query, continuationToken, options, opContext);</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select ent).AsTableQuery().ExecuteSegmented(token, options, opContext);</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Request Options</strong></p>
</td>
<td valign="top" width="600">
<p>currentTable.ExecuteQuery(query, options, null)<strong></strong></p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select ent).WithOptions(options);</p>
<p><strong>&lt; OR &gt;</strong></p>
<p>query.AsTableQuery().Execute(options, null)</p>
</td>
</tr>
<tr>
<td valign="top" width="83">
<p><strong>Operation Context</strong><strong></strong></p>
</td>
<td valign="top" width="600">
<p>currentTable.ExecuteQuery(query, null, opContext)</p>
</td>
<td valign="top" width="600">
<p>TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; select ent).WithContext(opContext);</p>
<p><strong>&lt; OR &gt;</strong></p>
<p>query.AsTableQuery().Execute(null, opContext)</p>
</td>
</tr>
</tbody>
</table>
<div>&#160;</div>
<h4>Complete Query</h4>
<p>The query below illustrates many of the supported extension methods and returns an enumerable of string values corresponding to the “Name” property on the entities.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">var nameResults = (from ent <span style="color: rgb(0, 0, 255);">in</span> currentTable.CreateQuery&lt;POCOEntity&gt;()<br/>                     <span style="color: rgb(0, 0, 255);">where</span> ent.Name == <span style="color: rgb(0, 96, 128);">&quot;foo&quot;</span><br/>                     select ent)<br/>                     .Take(5)<br/>                     .WithOptions(<span style="color: rgb(0, 0, 255);">new</span> TableRequestOptions())<br/>                     .WithContext(<span style="color: rgb(0, 0, 255);">new</span> OperationContext())<br/>                     .Resolve((pk, rk, ts, props, etag) =&gt; props[<span style="color: rgb(0, 96, 128);">&quot;Name&quot;</span>].StringValue);</pre>
<p>Note the three extension methods which allow a <em>TableRequestOptions</em>, an <em>OperationContext</em>, and an <em>EntityResolver</em> to be associated with a given query. These extensions are available by including a using statement for the Microsoft.WindowsAzure.Storage.Tables.Queryable namespace.</div>
<p>The extension .<em>AsTableQuery()</em> is also provided, however unlike the WCF implementation this is no longer mandatory, it simply allows clients more flexibility in query execution by providing additional methods for execution such as Task, APM, and segmented execution methods. </p>
<h4>Projection</h4>
<p>In traditional LINQ providers projection is handled via the select new keywords, which essentially performs two separate actions. The first is to analyze any properties that are accessed and send them to the server to allow it to only return desired columns, this is considered server side projection. The second is to construct a client side action which is executed for each returned entity, essentially instantiating and populating its properties with the data returned by the server, this is considered client side projection. In the implementation released in 2.1 we have allowed clients to separate these two different types of projections by allowing them to be specified separately in the expression tree. (Note, you can still use the traditional approach via select new if you prefer.)</p>
<h4>Server Side Projection Syntax</h4>
<p>For a simple scenario where you simply wish to filter the properties returned by the server a convenient helper is provided. This does not provide any client side projection functionality, it simply limits the properties returned by the service. Note, by default PartitionKey, RowKey, TimeStamp, and Etag are always requested to allow for subsequent updates to the resulting entity.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">IQueryable&lt;POCOEntity&gt; projectionResult = from ent <span style="color: rgb(0, 0, 255);">in</span> currentTable.CreateQuery&lt;POCOEntity&gt;()<br/>                                          select TableQuery.Project(ent, <span style="color: rgb(0, 96, 128);">&quot;a&quot;</span>, <span style="color: rgb(0, 96, 128);">&quot;b&quot;</span>);</pre>
</div>
<p>This has the same effect as writing the following, but with improved performance and simplicity:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">IQueryable&lt;POCOEntity&gt; projectionResult = from ent <span style="color: rgb(0, 0, 255);">in</span> currentTable.CreateQuery&lt;POCOEntity&gt;()<br/>                                          select <span style="color: rgb(0, 0, 255);">new</span> POCOEntity()<br/>                                          {<br/>                                              PartitionKey = ent.PartitionKey,<br/>                                              RowKey = ent.RowKey,<br/>                                              Timestamp = ent.Timestamp,<br/>                                              a = ent.a,<br/>                                              b = ent.b<br/>                                          };</pre>
</div>
<h4>Client Side Projection Syntax with resolver</h4>
<p>For scenarios where you wish to perform custom client processing during deserialization the <em>EntityResolver</em> is provided to allow the client to inspect the data prior to determining its type or return value. This essentially provides an open ended hook for clients to control deserialization in any way they wish. The example below performs both a server side and client side project, projecting into a concatenated string of the “FirstName” and “LastName” properties.</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">IQueryable&lt;<span style="color: rgb(0, 0, 255);">string</span>&gt; fullNameResults = (from ent <span style="color: rgb(0, 0, 255);">in</span> from ent <span style="color: rgb(0, 0, 255);">in</span> currentTable.CreateQuery&lt;POCOEntity&gt;()<br/>                                      select TableQuery.Project(ent, <span style="color: rgb(0, 96, 128);">&quot;FirstName&quot;</span>, <span style="color: rgb(0, 96, 128);">&quot;LastName&quot;</span>))<br/>                                      .Resolve((pk, rk, ts, props, etag) =&gt; props[<span style="color: rgb(0, 96, 128);">&quot;FirstName&quot;</span>].StringValue + props[<span style="color: rgb(0, 96, 128);">&quot;LastName&quot;</span>].StringValue);</pre>
<p>The <em>EntityResolver</em> can read the data directly off of the wire which avoids the step of de-serializing the data into the base entity type and then selecting out the final result from that “throw away” intermediate object. Since <em>EntityResolver</em> is a delegate type any client side projection logic can be implemented here (See the NoSQL section <a href="http://blogs.msdn.com/b/windowsazurestorage/archive/2012/11/06/windows-azure-storage-client-library-2-0-tables-deep-dive.aspx">here</a> for a more in depth example).<strong></strong></div>
<h6>Type-Safe DynamicTableEntity Query Construction</h6>
<p>The <em>DynamicTableEntity</em> type allows for clients to interact with schema-less data in a simple straightforward way via a dictionary of properties. However constructing type-safe queries against schema-less data presents a challenge when working with the <em>IQueryable</em> interface and LINQ in general as all queries must be of a given type which contains relevant type information for its properties. So for example, let’s say I have a table that has both customers and orders in it. Now if I wish to construct a query that filters on columns across both types of data I would need to create some dummy CustomerOrder super entity which contains the union of properties between the Customer and Order entities.</p>
<p>This is not ideal, and this is where the <em>DynamicTableEntity</em> comes in. The <em>IQueryable</em> implementation has provided a way to check for property access via the <em>DynamicTableEntity</em> Properties dictionary in order to provide for type-safe query construction. This allows the user to indicate to the client the property it wishes to filter against and its type. The sample below illustrates how to create a query of type <em>DynamicTableEntity </em>and construct a complex filter on different properties:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="margin: 0em; padding: 0px; width: 100%; text-align: left; color: black; line-height: 12pt; overflow: visible; font-family: &quot;Courier New&quot;, courier, monospace; font-size: 8pt; direction: ltr; background-color: rgb(244, 244, 244);">TableQuery&lt;DynamicTableEntity&gt; res = from ent <span style="color: rgb(0, 0, 255);">in</span> table.CreateQuery&lt;DynamicTableEntity&gt;()<br/>                                     <span style="color: rgb(0, 0, 255);">where</span> ent.Properties[<span style="color: rgb(0, 96, 128);">&quot;customerid&quot;</span>].StringValue == <span style="color: rgb(0, 96, 128);">&quot;customer_1&quot;</span> ||<br/>                                     ent.Properties[<span style="color: rgb(0, 96, 128);">&quot;orderdate&quot;</span>].DateTimeOffsetValue &gt; startDate                       <br/>                                     select ent;</pre>
<p>In the example above the <em>IQueryable </em>was smart enough to infer that the client is filtering on the “customerid” property as a string, and the “orderdate” as a DateTimeOffset and constructed the query accordingly.</div>
<h4>Windows Phone Known Issue</h4>
<p>The current CTP release contains a known issue where in some cases calling HttpWebRequest.Abort() may not result in the HttpWebRequest’s callback being called. As such, it is possible when cancelling an outstanding request the callback may be lost and the operation will not return. This issue will be addressed in a future release.</p>
<h4>Summary</h4>
<p>We are continuously making improvements to the developer experience for Windows Azure Storage and very much value your feedback. Please feel free to leave comments and questions below,</p>
<p>&#160;</p>
<p>Joe Giardino</p>
<p>&#160;</p>
<h4>Resources</h4>
<p><a href="https://channel9.msdn.com/Events/TechEd/NorthAmerica/2013/WAD-B406#fbid=Rou_KM-O_sL">Getting the most out of Windows Azure Storage – TechEd NA ‘13</a></p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage/2.1.0.0">Nuget – 2.1 RTM</a></p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage-Preview">Nuget – 2.1 For Windows Phone and Windows RunTime (Preview)</a></p>
<p><a href="http://www.nuget.org/packages/WindowsAzure.Storage.Table-Preview">Nuget – 2.1 Tables Extension library for Non-JavaScript Windows RunTime apps (Preview)</a></p>
<p><a href="https://github.com/WindowsAzure/azure-sdk-for-net/">Github</a></p>
<p><a href="https://github.com/WindowsAzure/azure-sdk-for-net/blob/preview/microsoft-azure-api/Services/Storage/changelog.txt">2.1 Complete Changelog</a></p>
<div><span style="font-size: 10px;"><br/>
    <br/></span></div>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.msdn.microsoft.com/windowsazurestorage/tag/windows-azure-storage-client-library/" rel="tag">Windows Azure Storage Client Library</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (10)	</div>

		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-322">
				<div id="div-comment-322" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a4d47bd52a3581a8588cc24dc4df7696?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/a4d47bd52a3581a8588cc24dc4df7696?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">alex.bachinskiy@live.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-322">
			September 9, 2013 at 4:12 am</a>		</div>

		<p>After upgrading from RC I get the following error in runtime:</p>
<p>Could not load file or assembly &#39;Microsoft.WindowsAzure.Storage, Version=2.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&#39; or one of its dependencies. The located assembly&#39;s manifest definition does not match the assembly reference. (Exception from HRESULT: 0x80131040)</p>
<p>Don&#39;t know how to fix it 🙁</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-323">
				<div id="div-comment-323" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/419b33245887eb453bdf6c8715579628?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/419b33245887eb453bdf6c8715579628?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">serdar.ozler@outlook.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-323">
			September 9, 2013 at 4:47 pm</a>		</div>

		<p>@Alex</p>
<p>Please use Assembly Binding Log Viewer (<a rel="nofollow" target="_new" href="http://msdn.microsoft.com/en-us/library/e74a18c4.aspx">msdn.microsoft.com/&#8230;/e74a18c4.aspx</a>) to debug which assembly fails to load and why it fails.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-327">
				<div id="div-comment-327" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">zac</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-327">
			September 17, 2013 at 11:58 am</a>		</div>

		<p>Where exactly are the methods that return Task&lt;T&gt;? &nbsp;I don&#39;t see any. &nbsp;Only APM-style. &nbsp;An example that uses async/await with this new library would be much appreciated.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-328">
				<div id="div-comment-328" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/b596cd385878c1dc59067dc534e2ab25?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b596cd385878c1dc59067dc534e2ab25?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">joegiardino@live.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-328">
			September 21, 2013 at 6:39 pm</a>		</div>

		<p>@zac</p>
<p>The Task / Task&lt;T&gt; methods all use the Async postfix nomenclature. For example blobref.DeleteAsync(); This can be awaited via async/await if you like, or executed with standard tpl methods. If you do not see these *Async methods please confirm you have the 2.1 bits and not the 2.0.x.x package. For more code samples please reference the Task test methods in the GitHub repo above (for example <a href="https://github.com/WindowsAzure/azure-sdk-for-net/blob/master/microsoft-azure-api/Services/Storage/Test/Unit/DotNetCommon/Blob/CloudBlockBlobTest.cs#L540" rel="nofollow" target="_new">github.com/&#8230;/CloudBlockBlobTest.cs</a>)</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-333">
				<div id="div-comment-333" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Eli Schleifer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-333">
			September 30, 2013 at 7:50 am</a>		</div>

		<p>Is the BufferManager turned on by default for clients, or do we need to implement it specifically?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-341">
				<div id="div-comment-341" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/8c620e6d8920938432627bb871ae33e3?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8c620e6d8920938432627bb871ae33e3?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">larry@ldlsoftware.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-341">
			October 15, 2013 at 10:15 am</a>		</div>

		<p>I have a Win RT app that uses code such as this (from 2.0):</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TableQuerySegment&lt;PerformanceCounter&gt; currentSegment = null;</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TableQuery&lt;PerformanceCounter&gt; query = new TableQuery&lt;PerformanceCounter&gt;();</p>
<p> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentSegment = await table.ExecuteQuerySegmentedAsync(query, currentSegment != null ? currentSegment.ContinuationToken : null);</p>
<p>What is the equivalent code in 2.1? &nbsp;e.g., TableQuery&lt;entity&gt; has been removed?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-342">
				<div id="div-comment-342" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/f2923a77d45ac29d069430a6d810e51f?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/f2923a77d45ac29d069430a6d810e51f?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">veena_udayabhanu@hotmail.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-342">
			October 15, 2013 at 2:29 pm</a>		</div>

		<p>@Larry</p>
<p>TableQuery&lt;entity&gt; still exists and there has been no change. Please make sure you have downloaded the table extension package for Non-Javascript Windows Runtime from Nuget. You can find it here : <a rel="nofollow" target="_new" href="http://www.nuget.org/packages/WindowsAzure.Storage.Table-Preview">http://www.nuget.org/&#8230;/WindowsAzure.Storage.Table-Preview</a>.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-343">
				<div id="div-comment-343" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/8c620e6d8920938432627bb871ae33e3?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/8c620e6d8920938432627bb871ae33e3?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">larry@ldlsoftware.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-343">
			October 15, 2013 at 8:29 pm</a>		</div>

		<p>Thanks Veena &#8211; definitely my bad &#8211; the second link at the top of the page also has &#39;Windows Run Time&#39; in the title &#8211; that was the one I installed. &nbsp;I&#39;m good now. &nbsp;Thanks again.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-349">
				<div id="div-comment-349" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">Andi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-349">
			November 5, 2013 at 11:30 am</a>		</div>

		<p>When I try to use the IQueryable mode from within WinRT; e.g. TableQuery&lt;ComplexEntity&gt; query = (from ent in table.CreateQuery&lt;ComplexEntity&gt;()</p>
<p>I get a compile error, that </p>
<p>&#39;Microsoft.WindowsAzure.Storage.Table.CloudTable&#39; does not contain a definition for &#39;CreateQuery&#39; and no extension method &#39;CreateQuery&#39; accepting a first argument of type &#39;Microsoft.WindowsAzure.Storage.Table.CloudTable&#39; could be found (are you missing a using directive or an assembly reference?)</p>
<p>Any ideas?</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-350">
				<div id="div-comment-350" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/b596cd385878c1dc59067dc534e2ab25?s=56&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/b596cd385878c1dc59067dc534e2ab25?s=112&amp;d=mm&amp;r=g 2x" class="avatar avatar-56 photo" height="56" width="56"/>			<cite class="fn">joegiardino@live.com</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.msdn.microsoft.com/windowsazurestorage/2013/09/06/announcing-storage-client-library-2-1-rtm-ctp-for-windows-phone/#comment-350">
			November 5, 2013 at 12:00 pm</a>		</div>

		<p>@Andi,</p>
<p>Unfortunately the IQueryable implementation is not yet available on WindowsRT ( it is available on WindowsPhone &amp; Desktop). We will be looking at adding this support in the future.</p>

		<div class="reply"><a rel="nofollow" class="comment-reply-login" href="https://blogs.msdn.microsoft.com/windowsazurestorage/wp-login.php?redirect_to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fwindowsazurestorage%2F2013%2F09%2F06%2Fannouncing-storage-client-library-2-1-rtm-ctp-for-windows-phone%2F">Log in to Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->